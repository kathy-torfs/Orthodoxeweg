<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Verhalen ‚Äì Orthodoxe Kinderpagina</title>
  <link rel="icon" href="https://kathy-torfs.github.io/Orthodoxeweg/images/kruis.png" />

  <style>
    :root{
      --primair:#7bb235; --donker:#67510C;
      --pastel1:#fff6e5; --pastel2:#fffde6; --pastel3:#ffe8ec; --pastel4:#e7f8ff;
      --pastel5:#e6ffe5; --pastel6:#fff2fb; --pastel7:#f5ffe5; --pastel8:#f5e8ff;
      --pastel9:#fff6fb; --pastel10:#e7fff9; --pastel11:#f3e6ff; --pastel12:#ffeae6;
      --pastel13:#ecffe9; --pastel14:#f7fff3; --pastel15:#eafffa; --pastel16:#fff4ea;
    }
    body{
      margin:0; font-family:'Comic Sans MS', Arial, sans-serif; color:#333;
      min-height:100vh; background:var(--pastel1); transition:background .6s;
    }

    main{ max-width: 900px; margin: 24px auto; padding: 0 2vw; }

    .tabs {
      display:flex; justify-content:center; gap:14px; margin-bottom:20px;
    }
    .tab-btn {
      background:#fff3c4; border:2px solid #f0d77a;
      border-radius:10px; padding:10px 18px; cursor:pointer;
      font-weight:bold; transition:transform .2s;
    }
    .tab-btn:hover { transform:scale(1.07); }
    .tab-btn.active { background:#ffe892; border-color:#f4c84b; }

    .quote-block {
      background:#fffef9;
      border-left:6px solid var(--primair);
      border-radius:14px;
      padding:20px;
      margin:20px 0;
      box-shadow:0 4px 14px rgba(0,0,0,0.08);
      position:relative;
    }
    .quote-block h2 {
      margin-top:0;
      color:var(--primair);
      font-size:1.4em;
    }
    .quote-block p {
      margin:10px 0;
      line-height:1.6;
      color:#4a3b20;
      font-size:1.05em;
    }
    .print-btn {
      position:absolute; top:12px; right:12px;
      background:#7a5f35; color:#fff; border:none;
      border-radius:50%; width:34px; height:34px;
      cursor:pointer; font-size:1em;
    }
    .plaat-wrapper {
      margin:12px 0; text-align:center;
    }
    .plaat-wrapper img { max-width:100%; border-radius:8px; }
    .plaat-print {
      margin-top:6px;
      background:#7bb235; color:#fff; border:none;
      border-radius:6px; padding:6px 12px; cursor:pointer;
    }

    @media print {
      body { background:#fff; }
      .tabs, .print-btn, #kinder-header, .plaat-print { display:none !important; }
      .quote-block { box-shadow:none; border:1px solid #000; }
    }
  </style>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

  <!-- Laadt de header + menubalk -->
  <script defer src="common/layout.js"></script>
</head>
<body>
  <div id="kinder-header" data-header-src="common/header.html"></div>

  <main>
    <div class="tabs">
      <button class="tab-btn active" onclick="toonTab('kleuters')">üë∂ Kleuters</button>
      <button class="tab-btn" onclick="toonTab('lagere')">üìñ Lagere school</button>
    </div>

    <div id="kleuters" class="tab-content">
      <div id="kleutersVerhalen">Laden‚Ä¶</div>
    </div>

    <div id="lagere" class="tab-content" style="display:none;">
      <div id="lagereVerhalen">Laden‚Ä¶</div>
    </div>
  </main>

  <script>
    (function(){
      const p=['var(--pastel1)','var(--pastel2)','var(--pastel3)','var(--pastel4)','var(--pastel5)','var(--pastel6)','var(--pastel7)','var(--pastel8)','var(--pastel9)','var(--pastel10)','var(--pastel11)','var(--pastel12)','var(--pastel13)','var(--pastel14)','var(--pastel15)','var(--pastel16)'];
      document.body.style.background = p[Math.floor(Math.random()*p.length)];
    })();

    function toonTab(id){
      document.querySelectorAll(".tab-content").forEach(d=>d.style.display="none");
      document.getElementById(id).style.display="block";
      document.querySelectorAll(".tab-btn").forEach(b=>b.classList.remove("active"));
      event.target.classList.add("active");
    }

    function printVerhaal(id){
      const inhoud=document.getElementById(id).innerHTML;
      const w=window.open("","","width=800,height=600");
      w.document.write(`<html><head><title>Print</title></head><body>${inhoud}</body></html>`);
      w.document.close();
      w.print();
    }

    function printPlaat(url){
      const w=window.open("","","width=800,height=600");
      w.document.write(`<html><head><title>Print</title></head><body style="text-align:center"><img src="${url}" style="max-width:100%"></body></html>`);
      w.document.close();
      w.print();
    }

    if (!firebase.apps.length) {
      firebase.initializeApp({
        apiKey:"AIzaSyBG1iQBmruHUZI1OeW8RgbJ_TPit_7a2LQ",
        authDomain:"orthodoxeweg.firebaseapp.com",
        projectId:"orthodoxeweg"
      });
    }
    const db=firebase.firestore();
    const parochieId=localStorage.getItem("ingelogdeParochie");

    async function laadVerhalen(doelgroep, containerId){
      const div=document.getElementById(containerId);
      div.innerHTML="Laden‚Ä¶";
      try{
        const snap=await db.collection("parochies").doc(parochieId)
          .collection("heiligen")
          .where("doelgroep","==",doelgroep)
          .where("zichtbaar","==",true)
          .orderBy("aangemaaktOp","desc")
          .get();

        div.innerHTML="";
        if(snap.empty){
          div.innerHTML="<p>‚ö†Ô∏è Geen verhalen beschikbaar.</p>";
          return;
        }

        snap.forEach(doc=>{
          const d=doc.data();
          const id="verhaal-"+doc.id;

          let blok=`
            <div class="quote-block" id="${id}">
              <button class="print-btn" onclick="printVerhaal('${id}')">üñ®Ô∏è</button>
              <h2>${d.titel||"Naamloos verhaal"}</h2>
              <p>${(d.verhaal||"").replace(/<br>/g,"<br>")}</p>
          `;

          if(d.platen && d.platen.length>0){
            d.platen.forEach(p=>{
              blok+=`
                <div class="plaat-wrapper">
                  <img src="${p.url}" alt="plaat">
                  ${p.tekst?`<p style="font-style:italic">${p.tekst}</p>`:""}
                  <button class="plaat-print" onclick="printPlaat('${p.url}')">üñ®Ô∏è Print plaat</button>
                </div>
              `;
            });
          }

          blok+=`</div>`;
          div.innerHTML+=blok;
        });
      }catch(e){
        console.error(e);
        div.innerHTML="‚ö†Ô∏è Fout bij laden verhalen.";
      }
    }

    laadVerhalen("kleuters","kleutersVerhalen");
    laadVerhalen("lagere","lagereVerhalen");
  </script>
</body>
</html>
