<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>üìñ Heiligen ‚Äì Orthodoxe Kinderpagina</title>
  <link rel="icon" href="https://kathy-torfs.github.io/Orthodoxeweg/images/kruis.png">
  <style>
    body {margin:0;font-family:Comic Sans MS, Arial,sans-serif;background:#f5e9b8;color:#4a3b20}
    main {display:flex;max-width:1200px;margin:20px auto;padding:0 20px;gap:20px}
    h1{text-align:center;color:#4e2710}
    .tabs{display:flex;justify-content:center;gap:12px;margin:10px 0}
    .tabs button{padding:8px 14px;border:none;border-radius:6px;cursor:pointer;font-weight:bold}
    .tabs button.actief{background:#7bb235;color:#fff}
    .lijst{flex:1;background:#fff9e2;border:2px solid #d6c290;border-radius:12px;padding:12px;max-height:80vh;overflow-y:auto}
    .lijst h2{text-align:center;margin:0 0 10px}
    .item{padding:8px;background:#fff;border:1px solid #dbc592;border-radius:8px;margin-bottom:6px;cursor:pointer}
    .item:hover{background:#f7eecb}
    .detail{flex:2;background:#fffef9;border:2px solid #e2d1a5;border-radius:12px;box-shadow:0 6px 18px rgba(0,0,0,0.12);padding:20px;min-height:500px}
    .detail h2{text-align:center;margin-top:0}
    .plaat{display:flex;flex-direction:column;align-items:center}
    .plaat img{max-width:100%;max-height:300px;border-radius:12px;border:2px solid #dab97a;margin-bottom:10px}
    .navigatie{display:flex;justify-content:space-between;margin-top:10px}
    .btn{padding:8px 16px;border:none;border-radius:8px;cursor:pointer;font-weight:bold}
    .btn.print{background:#7a5f35;color:#fff}
    .btn.print:hover{background:#5a4225}
    .btn.nav{background:#7bb235;color:#fff}
    .btn.nav:hover{background:#5e8e29}
  </style>
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  <script defer src="common/layout.js"></script>
</head>
<body>
  <div id="kinder-header" data-header-src="common/header.html"></div>
  <h1>üìñ Verhalen van de Heiligen</h1>

  <!-- Tabs -->
  <div class="tabs">
    <button id="tabKleuters" class="actief" onclick="wisselDoelgroep('kleuters')">üë∂ Kleuters</button>
    <button id="tabLagere" onclick="wisselDoelgroep('lagere')">üìö Lagere school</button>
  </div>

  <main>
    <!-- Indexlijst -->
    <div class="lijst">
      <h2>Heiligenlijst</h2>
      <div id="heiligenLijst">Laden‚Ä¶</div>
    </div>

    <!-- Detail -->
    <div class="detail" id="detailPaneel">
      <p style="text-align:center;color:#888;">‚¨ÖÔ∏è Kies links een heilige</p>
    </div>
  </main>

  <script>
    // Firebase init
    if (!firebase.apps.length) {
      firebase.initializeApp({
        apiKey:"AIzaSyBG1iQBmruHUZI1OeW8RgbJ_TPit_7a2LQ",
        authDomain:"orthodoxeweg.firebaseapp.com",
        projectId:"orthodoxeweg"
      });
    }
    const db=firebase.firestore();
    const parochieId=localStorage.getItem("ingelogdeParochie");

    let huidigDoelgroep="kleuters";
    let huidigeHeilige=null;
    let huidigePlaatIndex=0;

    function wisselDoelgroep(d){
      huidigDoelgroep=d;
      document.getElementById("tabKleuters").classList.toggle("actief", d==="kleuters");
      document.getElementById("tabLagere").classList.toggle("actief", d==="lagere");
      laadHeiligen();
      document.getElementById("detailPaneel").innerHTML="<p style='text-align:center;color:#888;'>‚¨ÖÔ∏è Kies links een heilige</p>";
    }

    async function laadHeiligen(){
      const lijstEl=document.getElementById("heiligenLijst");
      lijstEl.innerHTML="‚è≥ Laden...";
      try{
        const snap=await db.collection("parochies").doc(parochieId)
          .collection("heiligen")
          .where("doelgroep","==",huidigDoelgroep)
          .where("zichtbaar","==",true).get();
        lijstEl.innerHTML="";
        if(snap.empty){lijstEl.innerHTML="<p>Geen verhalen beschikbaar.</p>";return;}
        snap.forEach(doc=>{
          const d=doc.data();
          const div=document.createElement("div");
          div.className="item";
          div.textContent=d.titel||doc.id;
          div.onclick=()=>toonDetail({id:doc.id,...d});
          lijstEl.appendChild(div);
        });
      }catch(e){
        console.error(e);
        lijstEl.innerHTML="‚ö†Ô∏è Fout bij laden.";
      }
    }

    function toonDetail(h){
      huidigeHeilige=h;
      huidigePlaatIndex=0;
      if(huidigDoelgroep==="kleuters" && h.platen?.length){
        toonPlaat();
      } else {
        document.getElementById("detailPaneel").innerHTML=`
          <h2>${h.titel||"Naamloze heilige"}</h2>
          <p>${(h.verhaal||"").replace(/<br>/g,"<br>")}</p>
        `;
      }
    }

    function toonPlaat(){
      const h=huidigeHeilige;
      const p=h.platen[huidigePlaatIndex];
      document.getElementById("detailPaneel").innerHTML=`
        <h2>${h.titel}</h2>
        <div class="plaat">
          <img src="${p.url}">
          <p>${p.tekst||""}</p>
          <div class="navigatie">
            <button class="btn nav" onclick="vorigePlaat()" ${huidigePlaatIndex===0?"disabled":""}>‚¨ÖÔ∏è Vorige</button>
            <button class="btn print" onclick="printPlaat(${huidigePlaatIndex})">üñ®Ô∏è Print</button>
            <button class="btn nav" onclick="volgendePlaat()" ${huidigePlaatIndex===h.platen.length-1?"disabled":""}>Volgende ‚û°Ô∏è</button>
          </div>
        </div>
      `;
    }

    function volgendePlaat(){if(huidigePlaatIndex<huidigeHeilige.platen.length-1){huidigePlaatIndex++;toonPlaat();}}
    function vorigePlaat(){if(huidigePlaatIndex>0){huidigePlaatIndex--;toonPlaat();}}

    function printPlaat(index){
      const h=huidigeHeilige;
      const plaat=h.platen[index];
      const keuze=confirm("Wil je de plaat MET tekst printen?\nOK = met tekst, Annuleren = zonder tekst.");
      let inhoud=`<img src="${plaat.url}" style="max-width:100%;display:block;margin:0 auto;">`;
      if(keuze){inhoud+=`<p style="margin-top:10px;font-size:1.1em;">${plaat.tekst||""}</p>`;}
      const w=window.open("","","width=800,height=600");
      w.document.write(`<html><head><title>Print</title></head><body>${inhoud}</body></html>`);
      w.document.close();
      w.print();
    }

    // Init
    laadHeiligen();
  </script>
</body>
</html>
