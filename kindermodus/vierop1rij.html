<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Vier op een Rij ‚Äì Orthodoxe Kinderpagina</title>
  <link rel="icon" href="https://kathy-torfs.github.io/Orthodoxeweg/images/kruis.png" />

  <style>
    :root{
      --primair:#7bb235; --donker:#67510C;
      --pastel1:#fff6e5; --pastel2:#fffde6; --pastel3:#ffe8ec; --pastel4:#e7f8ff;
      --pastel5:#e6ffe5; --pastel6:#fff2fb; --pastel7:#f5ffe5; --pastel8:#f5e8ff;
      --pastel9:#fff6fb; --pastel10:#e7fff9; --pastel11:#f3e6ff; --pastel12:#ffeae6;
      --pastel13:#ecffe9; --pastel14:#f7fff3; --pastel15:#eafffa; --pastel16:#fff4ea;
    }
    body{
      margin:0; font-family:'Comic Sans MS', Arial, sans-serif; color:#333;
      min-height:100vh; background:var(--pastel1); transition:background .6s;
    }
    main{ max-width:1000px; margin:20px auto; padding:0 16px; text-align:center }

    #board{
      display:grid;
      grid-template-columns:repeat(7, min(12vw,60px));
      grid-template-rows:repeat(6, min(12vw,60px));
      gap:6px;
      margin:20px auto;
      width:max-content;
      touch-action:manipulation;
    }
    .cell{
      width:min(12vw,60px);
      height:min(12vw,60px);
      border-radius:50%;
      background:#fff;
      border:2px solid #6f4e1a;
      cursor:pointer;
      box-shadow:0 1px 2px rgba(0,0,0,.1) inset;
    }
    .player{ background:#e53935; }
    .computer{ background:#ffeb3b; }

    #status{ margin-top:10px; font-weight:bold }
    .actions{ margin:14px 0 6px }
    .btn{
      background:var(--primair); color:#fff; border:none; border-radius:8px;
      padding:8px 14px; font-weight:bold; cursor:pointer;
    }
    .btn:disabled{ opacity:.6; cursor:not-allowed }
  </style>

  <!-- Header + menubalk + beveiliging -->
  <script defer src="https://kathy-torfs.github.io/Orthodoxeweg/kindermodus/common/layout.js"></script>
</head>
<body>
  <!-- Header en menubalk -->
  <div id="kinder-header" data-header-src="https://kathy-torfs.github.io/Orthodoxeweg/kindermodus/common/header.html"></div>

  <main>
    <h1>Vier op een Rij</h1>
    <div class="actions">
      <button id="startBtn" class="btn" type="button">Spel starten (20 punten)</button>
      <button id="resetBtn" class="btn" type="button" style="display:none;">Opnieuw spelen</button>
    </div>
    <div id="board" aria-label="Vier op een rij speelbord" style="display:none;"></div>
    <div id="status"></div>
  </main>

  <script>
    // Pastelachtergrond
    (function(){
      const p=['var(--pastel1)','var(--pastel2)','var(--pastel3)','var(--pastel4)','var(--pastel5)',
               'var(--pastel6)','var(--pastel7)','var(--pastel8)','var(--pastel9)','var(--pastel10)',
               'var(--pastel11)','var(--pastel12)','var(--pastel13)','var(--pastel14)',
               'var(--pastel15)','var(--pastel16)'];
      document.body.style.background = p[Math.floor(Math.random()*p.length)];
    })();

    // Header laden
    (function boot(){
      if (!(window.KinderLayout)) return setTimeout(boot, 120);
      const el = document.getElementById('kinder-header');
      window.KinderLayout.mountHeader({
        rootId: 'kinder-header',
        headerSrc: el.dataset.headerSrc,
        active: 'spelletjes'
      });
    })();

    // ===== Vier op een Rij =====
    const rows = 6, cols = 7;
    let board, gameOver, busy;
    const boardDiv = document.getElementById('board');
    const statusDiv = document.getElementById('status');
    const startBtn = document.getElementById('startBtn');
    const resetBtn = document.getElementById('resetBtn');

    function init(){
      board = Array.from({length:rows}, () => Array(cols).fill(null));
      gameOver = false; busy = false;
      drawBoard();
      statusDiv.textContent = 'Jij (rood) bent aan de beurt';
    }

    function drawBoard(){
      boardDiv.innerHTML = '';
      for(let r=0;r<rows;r++){
        for(let c=0;c<cols;c++){
          const cell = document.createElement('div');
          cell.className = 'cell';
          cell.dataset.row = r;
          cell.dataset.col = c;
          cell.addEventListener('click', onCellClick, {passive:true});
          boardDiv.appendChild(cell);
        }
      }
      renderChips();
    }

    function renderChips(){
      boardDiv.querySelectorAll('.cell').forEach(cell=>{
        cell.classList.remove('player','computer');
        const r = +cell.dataset.row, c = +cell.dataset.col;
        if (board[r][c]==='player') cell.classList.add('player');
        if (board[r][c]==='computer') cell.classList.add('computer');
      });
    }

    function onCellClick(e){
      if (gameOver || busy) return;
      const col = +e.currentTarget.dataset.col;
      if (!drop(col,'player')) return;
      renderChips();
      if (checkWin('player')) return endGame('Jij wint! üéâ');
      if (isDraw()) return endGame('Gelijkspel ü§ù');
      busy = true;
      setTimeout(()=>{ computerMove(); busy=false; }, 400);
    }

    function drop(col, who){
      for(let r=rows-1;r>=0;r--){
        if(!board[r][col]){ board[r][col]=who; return true; }
      }
      return false;
    }

    function getNextOpenRow(col){
      for(let r=rows-1;r>=0;r--) if(!board[r][col]) return r;
      return -1;
    }

    function isDraw(){ return board.every(row => row.every(cell => cell)); }

    function checkWin(who, grid=board){
      const dirs = [[0,1],[1,0],[1,1],[1,-1]];
      for(let r=0;r<rows;r++){
        for(let c=0;c<cols;c++){
          if(grid[r][c]!==who) continue;
          for(const [dr,dc] of dirs){
            let count=1, rr=r+dr, cc=c+dc;
            while(rr>=0&&rr<rows&&cc>=0&&cc<cols&&grid[rr][cc]===who){
              count++; rr+=dr; cc+=dc;
            }
            if(count>=4) return true;
          }
        }
      }
      return false;
    }

    function checkWinner(grid){
      if (checkWin('player', grid)) return 'player';
      if (checkWin('computer', grid)) return 'computer';
      return null;
    }

    function endGame(msg){
      statusDiv.textContent = msg;
      gameOver = true;
    }

    // ===== Kindvriendelijke AI =====
    function computerMove(){
      if (gameOver) return;

      // 1. Win pakken
      for (let c=0;c<cols;c++){
        const r = getNextOpenRow(c);
        if (r!==-1){
          const tmp = board.map(row=>row.slice());
          tmp[r][c]='computer';
          if (checkWinner(tmp)==='computer'){
            drop(c,'computer'); renderChips();
            if (checkWin('computer')) return endGame('De computer wint! ü§ñ');
            if (isDraw()) return endGame('Gelijkspel ü§ù');
            statusDiv.textContent = 'Jij (rood) bent aan de beurt';
            return;
          }
        }
      }

      // 2. Blokkeren
      for (let c=0;c<cols;c++){
        const r = getNextOpenRow(c);
        if (r!==-1){
          const tmp = board.map(row=>row.slice());
          tmp[r][c]='player';
          if (checkWinner(tmp)==='player'){
            drop(c,'computer'); renderChips();
            if (checkWin('computer')) return endGame('De computer wint! ü§ñ');
            if (isDraw()) return endGame('Gelijkspel ü§ù');
            statusDiv.textContent = 'Jij (rood) bent aan de beurt';
            return;
          }
        }
      }

      // 3. Willekeurig
      const options = [];
      for (let c=0;c<cols;c++) if (getNextOpenRow(c)!==-1) options.push(c);
      const choice = options[Math.floor(Math.random()*options.length)];
      drop(choice,'computer'); renderChips();
      if (checkWin('computer')) return endGame('De computer wint! ü§ñ');
      if (isDraw()) return endGame('Gelijkspel ü§ù');
      statusDiv.textContent = 'Jij (rood) bent aan de beurt';
    }

    // ===== Start & Reset =====
    startBtn.addEventListener('click', () => {
      // TODO: Firestore puntencontrole (nu dummy)
      // if (points < 20) { alert("Niet genoeg punten"); return; }
      // else { punten aftrekken }
      startBtn.style.display = 'none';
      resetBtn.style.display = 'inline-block';
      boardDiv.style.display = 'grid';
      init();
    });

    resetBtn.addEventListener('click', init);
  </script>
</body>
</html>
