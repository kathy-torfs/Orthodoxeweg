<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Vier op een Rij ‚Äì Orthodoxe Kinderpagina</title>
  <link rel="icon" href="https://kathy-torfs.github.io/Orthodoxeweg/images/kruis.png">
  <!-- Laad jullie layout.js (inclusief includeHTML) -->
  <script src="https://kathy-torfs.github.io/Orthodoxeweg/common/layout.js" defer></script>

  <style>
    :root{
      --primair:#7bb235; --donker:#67510C;
    }
    body{margin:0; font-family:Arial,sans-serif; background:#f5e9b8; color:#6f4e1a}

    /* Ruimte onder header/nav die via include geladen worden */
    main{max-width:1000px; margin:20px auto; padding:0 16px; text-align:center}

    /* Spelbord */
    #board{
      display:grid;
      grid-template-columns:repeat(7, min(12vw,60px));
      grid-template-rows:repeat(6, min(12vw,60px));
      gap:6px;
      margin:20px auto;
      width:max-content;
      touch-action:manipulation;
    }
    .cell{
      width:min(12vw,60px);
      height:min(12vw,60px);
      border-radius:50%;
      background:#fff;
      border:2px solid #6f4e1a;
      cursor:pointer;
      box-shadow:0 1px 2px rgba(0,0,0,.1) inset;
    }
    .player{ background:#e53935; }   /* rood */
    .computer{ background:#ffeb3b; } /* geel */

    #status{ margin-top:10px; font-weight:bold }
    .actions{ margin:14px 0 6px }
    .btn{
      background:var(--primair); color:#fff; border:none; border-radius:8px;
      padding:8px 14px; font-weight:bold; cursor:pointer;
    }
    .btn:disabled{ opacity:.6; cursor:not-allowed }
  </style>
</head>
<body>
  <!-- JULLIE HEADER VIA INCLUDE (g√©√©n eigen header in deze pagina) -->
  <div data-include-html="https://kathy-torfs.github.io/Orthodoxeweg/common/header.html"></div>

  <main>
    <h1>Vier op een Rij</h1>

    <div class="actions">
      <button id="resetBtn" class="btn" type="button">Opnieuw spelen</button>
    </div>

    <div id="board" aria-label="Vier op een rij speelbord"></div>
    <div id="status">Jij (rood) bent aan de beurt</div>
  </main>

  <script>
    // Wacht tot layout.js geladen is en voer includeHTML uit indien nodig
    document.addEventListener('DOMContentLoaded', () => {
      if (typeof includeHTML === 'function') { includeHTML(); }
    });

    // ===== Spel-logica =====
    const rows = 6, cols = 7;
    let board, gameOver, busy;

    const boardDiv = document.getElementById('board');
    const statusDiv = document.getElementById('status');
    const resetBtn = document.getElementById('resetBtn');

    function init(){
      board = Array.from({length:rows}, () => Array(cols).fill(null));
      gameOver = false;
      busy = false;
      drawBoard();
      statusDiv.textContent = 'Jij (rood) bent aan de beurt';
    }

    function drawBoard(){
      boardDiv.innerHTML = '';
      for(let r=0;r<rows;r++){
        for(let c=0;c<cols;c++){
          const cell = document.createElement('div');
          cell.className = 'cell';
          cell.dataset.row = r;
          cell.dataset.col = c;
          cell.addEventListener('click', onCellClick, {passive:true});
          boardDiv.appendChild(cell);
        }
      }
      renderChips();
    }

    function renderChips(){
      boardDiv.querySelectorAll('.cell').forEach(cell=>{
        cell.classList.remove('player','computer');
        const r = +cell.dataset.row, c = +cell.dataset.col;
        if (board[r][c]==='player') cell.classList.add('player');
        if (board[r][c]==='computer') cell.classList.add('computer');
      });
    }

    function onCellClick(e){
      if (gameOver || busy) return;
      const col = +e.currentTarget.dataset.col;
      if (!drop(col,'player')) return;            // kolom vol
      renderChips();
      if (checkWin('player')) return endGame('Jij wint! üéâ');
      if (isDraw()) return endGame('Gelijkspel ü§ù');
      busy = true;
      setTimeout(()=>{ computerMove(); busy=false; }, 350);
    }

    function drop(col, who){
      for(let r=rows-1;r>=0;r--){
        if(!board[r][col]){ board[r][col]=who; return true; }
      }
      return false;
    }

    function getNextOpenRow(col){
      for(let r=rows-1;r>=0;r--) if(!board[r][col]) return r;
      return -1;
    }

    function isDraw(){ return board.every(row => row.every(cell => cell)); }

    function checkWin(who, grid=board){
      const dirs = [[0,1],[1,0],[1,1],[1,-1]];
      for(let r=0;r<rows;r++){
        for(let c=0;c<cols;c++){
          if(grid[r][c]!==who) continue;
          for(const [dr,dc] of dirs){
            let count=1, rr=r+dr, cc=c+dc;
            while(rr>=0&&rr<rows&&cc>=0&&cc<cols&&grid[rr][cc]===who){
              count++; rr+=dr; cc+=dc;
            }
            if(count>=4) return true;
          }
        }
      }
      return false;
    }

    function checkWinner(grid){
      if (checkWin('player', grid)) return 'player';
      if (checkWin('computer', grid)) return 'computer';
      return null;
    }

    function endGame(msg){
      statusDiv.textContent = msg;
      gameOver = true;
    }

    // ===== Kindvriendelijke AI =====
    // 1) Pakt winst als die klaar ligt
    // 2) Blokkeert speler als die op 1 zet van winst staat
    // 3) Anders: willekeurige geldige kolom
    function computerMove(){
      if (gameOver) return;

      // 1. Win-chance pakken
      for (let c=0;c<cols;c++){
        const r = getNextOpenRow(c);
        if (r!==-1){
          const tmp = board.map(row=>row.slice());
          tmp[r][c]='computer';
          if (checkWinner(tmp)==='computer'){
            drop(c,'computer'); renderChips();
            if (checkWin('computer')) return endGame('De computer wint! ü§ñ');
            if (isDraw()) return endGame('Gelijkspel ü§ù');
            statusDiv.textContent = 'Jij (rood) bent aan de beurt';
            return;
          }
        }
      }

      // 2. Blokkeren als speler bijna wint
      for (let c=0;c<cols;c++){
        const r = getNextOpenRow(c);
        if (r!==-1){
          const tmp = board.map(row=>row.slice());
          tmp[r][c]='player';
          if (checkWinner(tmp)==='player'){
            drop(c,'computer'); renderChips();
            if (checkWin('computer')) return endGame('De computer wint! ü§ñ');
            if (isDraw()) return endGame('Gelijkspel ü§ù');
            statusDiv.textContent = 'Jij (rood) bent aan de beurt';
            return;
          }
        }
      }

      // 3. Willekeurig zetten
      const options = [];
      for (let c=0;c<cols;c++) if (getNextOpenRow(c)!==-1) options.push(c);
      const choice = options[Math.floor(Math.random()*options.length)];
      drop(choice,'computer'); renderChips();
      if (checkWin('computer')) return endGame('De computer wint! ü§ñ');
      if (isDraw()) return endGame('Gelijkspel ü§ù');
      statusDiv.textContent = 'Jij (rood) bent aan de beurt';
    }

    resetBtn.addEventListener('click', init);
    init();
  </script>
</body>
</html>
