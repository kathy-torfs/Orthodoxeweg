<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Bijbelverhaal â€“ Orthodoxe Kinderpagina</title>
  <link rel="icon" href="https://kathy-torfs.github.io/Orthodoxeweg/images/kruis.png" />

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js"></script>

  <style>
    body {
      margin: 0;
      font-family: "Comic Sans MS", "Comic Neue", cursive, sans-serif;
      min-height: 100vh;
      background-color: var(--pastel1);
      background-image: url("https://kathy-torfs.github.io/Orthodoxeweg/images/wolkjes.png");
      background-repeat: repeat;
      background-size: 900px auto;
      transition: background-color .6s;
    }

    main {
      max-width: 1200px;
      margin: 30px auto;
      padding: 0 2vw;
      display: flex;
      gap: 24px;
    }

    .boek {
      flex: 1;
      background: #fffef9;
      border: 2px solid #e0d5b0;
      border-radius: 14px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.08);
      padding: 24px;
      line-height: 1.6;
      font-size: 1.1em;
    }

    .boek h2 {
      margin-top: 0;
      color: var(--primair);
      font-family: "Comic Neue", cursive, sans-serif;
    }

    .vraagblok {
      margin-bottom: 20px;
      padding: 14px;
      border: 1.5px dashed #ccc7a5;
      border-radius: 10px;
      background: #fffdfa;
    }

    .vraagblok h3 {
      margin: 0 0 10px;
      font-size: 1.1em;
      color: var(--donker);
    }

    .vraagblok button {
      display: block;
      width: 100%;
      margin: 6px 0;
      padding: 8px;
      border-radius: 8px;
      border: 1.5px solid #ddd;
      background: #fff;
      cursor: pointer;
      transition: background 0.2s;
      font-family: inherit;
    }
    .vraagblok button:hover {
      background: #f7ffe5;
    }

    .reflectie {
      margin-top: 20px;
      padding: 14px;
      border-radius: 10px;
      border: 1.5px dashed #bbb;
      background: #fffdfa;
    }
    .reflectie textarea {
      width: 100%;
      min-height: 90px;
      font-family: inherit;
      border-radius: 8px;
      border: 1.5px solid #ddd;
      padding: 10px;
      resize: vertical;
    }
    .reflectie button {
      margin-top: 10px;
      padding: 8px 16px;
      border-radius: 8px;
      border: none;
      background: var(--primair);
      color: white;
      font-weight: bold;
      cursor: pointer;
    }
  </style>

  <!-- Header & menubalk -->
  <script defer src="common/layout.js"></script>
</head>
<body>
  <div id="kinder-header" data-header-src="common/header.html"></div>

  <main>
    <!-- Linker pagina: bijbelverhaal -->
    <div class="boek" id="bijbelverhaal">
      <h2>Bijbelverhaal</h2>
      <div id="verhaal-tekst">Verhaal wordt geladenâ€¦</div>
    </div>

    <!-- Rechter pagina: vragen en reflectie -->
    <div class="boek">
      <h2>Vragen & Reflectie</h2>
      <div id="vragen-container">Vragen ladenâ€¦</div>

      <div class="reflectie">
        <h3>Jouw reflectie</h3>
        <textarea id="reflectieInput" placeholder="Schrijf hier jouw gedachtenâ€¦"></textarea>
        <button onclick="opslaanReflectie()">Opslaan (+20 punten)</button>
      </div>
    </div>
  </main>

  <script>
    // Firebase init
    const firebaseConfig = {
      apiKey:"AIzaSyBG1iQBmruHUZI1OeW8RgbJ_TPit_7a2LQ",
      authDomain:"orthodoxeweg.firebaseapp.com",
      projectId:"orthodoxeweg",
      storageBucket:"orthodoxeweg.appspot.com",
      messagingSenderId:"408582263618",
      appId:"1:408582263618:web:0a20f4bf0704989d3ceedb"
    };
    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Wacht tot ACTIVE_USER geladen is vanuit layout.js
    function boot() {
      if (!window.ACTIVE_USER) return setTimeout(boot, 150);

      const verhaalRef = db.collection("parochies")
        .doc(window.ACTIVE_USER.parochieId)
        .collection("leden")
        .doc(window.ACTIVE_USER.lidId)
        .collection("kinderen")
        .doc(window.ACTIVE_USER.kindId);

      // Verhaal ophalen
      verhaalRef.get().then(docSnap => {
        if (docSnap.exists) {
          const data = docSnap.data();
          document.getElementById("verhaal-tekst").textContent = data.bijbelverhaal || "Geen verhaal gevonden.";
          laadVragen(data.vragen || []);
        }
      });
    }

    // Vragen renderen
    function laadVragen(vragen) {
      const container = document.getElementById("vragen-container");
      container.innerHTML = "";
      vragen.forEach((vraag, i) => {
        const blok = document.createElement("div");
        blok.className = "vraagblok";
        blok.innerHTML = `<h3>${vraag.vraag}</h3>`;
        vraag.antwoorden.forEach(antwoord => {
          const btn = document.createElement("button");
          btn.textContent = antwoord.tekst;
          btn.onclick = () => controleerAntwoord(vraag, antwoord.juist);
          blok.appendChild(btn);
        });
        container.appendChild(blok);
      });
    }

    // Antwoordcontrole
    function controleerAntwoord(vraag, juist) {
      if (juist) {
        alert("Juist! +10 punten ðŸŽ‰");
        updatePunten(10);
      } else {
        alert("Helaas, probeer verder!");
      }
    }

    // Reflectie opslaan
    function opslaanReflectie() {
      const tekst = document.getElementById("reflectieInput").value.trim();
      if (!tekst) return alert("Schrijf eerst iets!");
      const ref = db.collection("parochies")
        .doc(window.ACTIVE_USER.parochieId)
        .collection("leden")
        .doc(window.ACTIVE_USER.lidId)
        .collection("kinderen")
        .doc(window.ACTIVE_USER.kindId);
      ref.update({
        reflectie: tekst,
        punten: firebase.firestore.FieldValue.increment(20)
      });
      alert("Bedankt voor je reflectie! +20 punten ðŸŽ‰");
      document.getElementById("reflectieInput").value = "";
    }

    // Punten bijwerken
    function updatePunten(extra) {
      const ref = db.collection("parochies")
        .doc(window.ACTIVE_USER.parochieId)
        .collection("leden")
        .doc(window.ACTIVE_USER.lidId)
        .collection("kinderen")
        .doc(window.ACTIVE_USER.kindId);
      ref.update({
        punten: firebase.firestore.FieldValue.increment(extra)
      });
    }

    boot();
  </script>
</body>
</html>
