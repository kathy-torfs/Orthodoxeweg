<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>voetbalspel ‚Äì Orthodoxe Kinderpagina</title> 
<link rel="icon" href="https://kathy-torfs.github.io/Orthodoxeweg/images/kruis.png">

<!-- üéâ Confetti -->
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>

<style>
body{
  background:#2d7a2d;
  margin:0;padding:20px;
  font-family:Arial,sans-serif;
  text-align:center;
  overflow-x:hidden;
}
h1{color:white;margin-bottom:10px;}
#levelinfo{color:white;font-weight:bold;margin-bottom:20px;}

#veld{
  position:relative;
  width:90%;
  max-width:900px;
  height:500px;
  margin:0 auto 20px auto;
  background:repeating-linear-gradient(90deg,#3fa33f 0 40px,#2d7a2d 40px 80px);
  border:5px solid white;
  border-radius:12px;
  overflow:hidden;
}
#veld::before{
  content:"";
  position:absolute;
  top:0;left:50%;
  width:2px;height:100%;
  background:white;
}
#veld::after{
  content:"";
  position:absolute;
  top:50%;left:50%;
  width:120px;height:120px;
  border:2px solid white;
  border-radius:50%;
  transform:translate(-50%,-50%);
}
.goal{
  position:absolute;
  top:35%;height:30%;width:60px;
  border:2px solid white;
  background:repeating-linear-gradient(45deg,rgba(255,255,255,0.3) 0 5px,transparent 5px 10px);
  display:flex;align-items:center;justify-content:center;
  font-size:28px;color:white;
}
.goal.left{left:0;}    /* linkse goal = üòá */
.goal.right{right:0;}  /* rechtse goal = üòà */

.speler{ position:absolute; text-align:center; transform:translate(-50%,-50%); }
.speler .hoofd{ font-size:32px; display:block; margin-bottom:-6px; }
.shirt{
  width:50px;height:35px;border-radius:6px;font-weight:bold;line-height:35px;
  color:black;box-shadow:0 0 4px rgba(0,0,0,0.4);
}
.shirt.engel{background:#57b8f3;}
.shirt.duivel{background:#d93838;}

.spring{animation:jump 0.6s ease;}
@keyframes jump{
  0%{transform:translate(-50%,-50%) scale(1);}
  40%{transform:translate(-50%,-60%) scale(1.15);}
  100%{transform:translate(-50%,-50%) scale(1);}
}
#bal{
  position:absolute;
  font-size:34px;
  transition:all 0.9s cubic-bezier(.35,1.2,.4,1);
  transform:translate(-50%,-50%);
  z-index:10;
}

/* knoppen & popup */
button{
  margin-top:15px;padding:10px 18px;font-size:16px;border:none;border-radius:8px;
  background:#7bb235;color:white;cursor:pointer;
}
button:hover{background:#689c2e;}
#popup{
  position:fixed;inset:0;background:rgba(0,0,0,0.4);
  display:none;justify-content:center;align-items:center;z-index:20;
}
#popup-content{
  background:#7fd8d7;border-radius:12px;padding:20px;width:90%;max-width:420px;
  text-align:center;color:black;box-shadow:0 0 15px rgba(0,0,0,0.4);
}
#popup-content h2{margin-top:0;font-size:20px;color:black;}
.antw-btn{
  display:block;width:100%;margin:8px 0;padding:12px;border:none;border-radius:8px;
  background:white;color:black;cursor:pointer;font-size:16px;
  box-shadow:0 2px 4px rgba(0,0,0,0.2);
}
.antw-btn:hover{background:#dff8f7;}

/* üèÜ Einde-popup */
#eindePopup{
  position:fixed;inset:0;background:rgba(0,0,0,0.5);
  display:none;justify-content:center;align-items:center;flex-direction:column;z-index:30;color:white;
}
#eindePopup .box{
  background:#ffffff;color:black;border-radius:16px;padding:30px;text-align:center;
  width:90%;max-width:420px;box-shadow:0 0 20px rgba(0,0,0,0.5);
}
#eindePopup h2{margin-top:0;}
#eindePopup .emoji{font-size:60px;margin-bottom:10px;}
</style>
</head>
<body>

<!-- Header -->
<div id="kinder-header"></div>
<script src="https://kathy-torfs.github.io/Orthodoxeweg/kindermodus/common/layout.js"></script>

<h1>Engeltjes vs Duiveltjes</h1>
<div id="levelinfo">Level 1</div>

<div id="veld">
  <div class="goal left">üòá</div>
  <div class="goal right">üòà</div>
  <div id="spelers"></div>
  <div id="bal">‚öΩ</div>
</div>

<!-- Startknop -->
<button id="startknop">Start het spel</button>
<button id="vraagBtn" style="display:none;">Volgende vraag</button>

<!-- Vraag-popup -->
<div id="popup">
  <div id="popup-content">
    <h2 id="vraagtekst">Vraag</h2>
    <div id="antwoorden"></div>
    <button id="sluit">Sluit</button>
  </div>
</div>

<!-- üèÜ Einde-popup -->
<div id="eindePopup">
  <div class="box">
    <div class="emoji" id="eindeEmoji"></div>
    <h2 id="eindeTitel"></h2>
    <p id="eindeTekst"></p>
    <button id="opnieuwBtn">Speel opnieuw</button>
  </div>
</div>

<script src="vragen.js"></script>
<script>
/* === DOM refs === */
const veld=document.getElementById('veld');
const spelersDiv=document.getElementById('spelers');
const bal=document.getElementById('bal');
const popup=document.getElementById('popup');
const vraagBtn=document.getElementById('vraagBtn');
const startknop=document.getElementById('startknop');
const vraagtekst=document.getElementById('vraagtekst');
const antwoordenDiv=document.getElementById('antwoorden');
const sluitBtn=document.getElementById('sluit');
const levelinfo=document.getElementById('levelinfo');
const eindePopup=document.getElementById('eindePopup');
const eindeEmoji=document.getElementById('eindeEmoji');
const eindeTitel=document.getElementById('eindeTitel');
const eindeTekst=document.getElementById('eindeTekst');
const opnieuwBtn=document.getElementById('opnieuwBtn');

/* === Geluiden (bestanden in dezelfde map) === */
const fluit  = new Audio("referee-whistle-blow-gymnasium-6320.mp3");
const applaus= new Audio("crowd-applause-236697.mp3");
const boe    = new Audio("crowd-disappointment-reaction-352718.mp3");
const cheer  = new Audio("crowd-cheer-applause-victory-fanfare-clapping-236698.mp3");

/* === Game state === */
let huidigLevel=1;
let vragenQueue=[];            // 1 zonde + 5 levelvragen, in volgorde
let levelPool=[];              // extra levelvragen indien meer nodig
let vraagIndex=0;              // 1e is zonde
let engelIndex=0;              // 0..5
let duivelIndex=0;             // 0..5
let spelGestart=false;
let scoreEngel=0;
let scoreDuivel=0;

/* === Helpers === */
function randomPos(baseX,baseY,spread){
  return {x:baseX+(Math.random()*spread-spread/2),
          y:baseY+(Math.random()*spread-spread/2)};
}

/* Keeper met shirt (geen nummer) */
function maakKeeper(team, pos){
  const el=document.createElement("div");
  el.className="speler";
  el.id=team+"Keeper";
  el.style.left=pos.x+"%";
  el.style.top=pos.y+"%";
  const icoon = team==="engel" ? "üòá" : "üòà";
  el.innerHTML = `
    <div class="hoofd">${icoon}</div>
    <div class="shirt ${team}">&nbsp;</div>
  `;
  spelersDiv.appendChild(el);
}

function tekenSpelers(){
  spelersDiv.innerHTML="";

  /* üìç GESPIEGELD OPSTELLING:
     - Engelen links (1..4 links, 5 bij tegenstandersgoal rechts)
     - Duivels rechts (1..4 rechts, 5 bij tegenstandersgoal links)
   */
  const engelBasis = [
    {x:20,y:30},{x:25,y:55},{x:30,y:40},{x:28,y:70},{x:88,y:50} // 5 bij tegenpartij
  ];
  const duivelBasis = [
    {x:80,y:30},{x:75,y:55},{x:70,y:40},{x:72,y:70},{x:12,y:50} // 5 bij tegenpartij
  ];

  engelBasis.forEach((p,i)=>{ if(i<4) Object.assign(p,randomPos(p.x,p.y,5)); });
  duivelBasis.forEach((p,i)=>{ if(i<4) Object.assign(p,randomPos(p.x,p.y,5)); });

  // Keepers midden in HUN doel (shirt zonder nummer)
  maakKeeper("engel", {x:3,  y:50});  // linkse goal
  maakKeeper("duivel",{x:97, y:50});  // rechtse goal

  for(let i=0;i<5;i++){
    maakSpeler("engel", i+1, engelBasis[i]);
    maakSpeler("duivel", i+1, duivelBasis[i]);
  }
}

function maakSpeler(team,num,pos){
  const el=document.createElement("div");
  el.className="speler";
  el.id=team+num;
  el.style.left=pos.x+"%";
  el.style.top=pos.y+"%";
  el.innerHTML=`<div class="hoofd">${team==="engel"?"üòá":"üòà"}</div>
                <div class="shirt ${team}">${num}</div>`;
  spelersDiv.appendChild(el);
}

function setBal(xPerc,yPerc){ bal.style.left=xPerc+"%"; bal.style.top=yPerc+"%"; }
function shuffle(arr){ for(let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]]; } return arr; }

/* === Level / vragen === */
function laadLevel(level){
  huidigLevel=level;
  levelinfo.textContent="Level "+level;

  engelIndex=0; duivelIndex=0; vraagIndex=0;
  setBal(50,50);
  tekenSpelers();

  const zondeVragen = vragen.filter(v => v.difficulty === "zonde");
  const levelVragen = vragen.filter(v => v.difficulty === level);
  const randomZonde = zondeVragen[Math.floor(Math.random()*zondeVragen.length)];
  const vijfLevel   = shuffle(levelVragen.slice()).slice(0,5);

  vragenQueue = [randomZonde, ...vijfLevel];
  levelPool   = levelVragen.filter(v => !vijfLevel.includes(v));

  fluit.currentTime=0; fluit.play(); // fluit bij aftrap
}

function volgendeVraagObject(){
  if(vraagIndex < vragenQueue.length) return vragenQueue[vraagIndex++];
  if(levelPool.length===0) levelPool = vragen.filter(v=>v.difficulty===huidigLevel);
  return levelPool[Math.floor(Math.random()*levelPool.length)];
}

/* === Vraag UI === */
vraagBtn.onclick=()=>toonVraag();
sluitBtn.onclick=()=>popup.style.display="none";

function toonVraag(){
  if(!spelGestart) return;
  const v = volgendeVraagObject();
  vraagtekst.textContent=v.q;

  const indices=[...v.a.keys()];
  shuffle(indices);
  antwoordenDiv.innerHTML="";
  indices.forEach(i=>{
    const btn=document.createElement("button");
    btn.className="antw-btn";
    btn.textContent=v.a[i];
    btn.onclick=()=>controleerAntwoord(i===v.correct);
    antwoordenDiv.appendChild(btn);
  });

  popup.style.display="flex";
}

function moveBalTo(team,index){
  const speler=document.getElementById(team+index);
  const shirt=speler.querySelector(".shirt");
  const rect=shirt.getBoundingClientRect();
  const veldRect=veld.getBoundingClientRect();
  const x=((rect.left+rect.width/2)-veldRect.left)/veldRect.width*100;
  const y=((rect.top+rect.height/2)-veldRect.top)/veldRect.height*100;
  setBal(x,y);
  speler.classList.add("spring");
  setTimeout(()=>speler.classList.remove("spring"),600);
}

/* === Antwoord-logica === */
function controleerAntwoord(isJuist){
  popup.style.display="none";

  if(isJuist){
    applaus.currentTime=0; applaus.play();
    if(engelIndex < 5){
      engelIndex++;
      moveBalTo("engel",engelIndex);
    }else{
      goal("engel");
    }
  }else{
    boe.currentTime=0; boe.play();
    if(duivelIndex < 5){
      duivelIndex++;
      moveBalTo("duivel",duivelIndex);
    }else{
      goal("duivel");
    }
  }
}

/* === Goals & einde === */
function goal(team){
  fluit.currentTime=0; fluit.play();
  cheer.currentTime=0; cheer.play();

  if(team==="engel"){
    // Engelen scoren in RECHTSE goal ‚Üí rechtsonder hoek
    setBal(98,70);
    scoreEngel++;
    setTimeout(()=>volgendeLevel(),900);
  }else{
    // Duivels scoren in LINKSE goal ‚Üí linksboven hoek
    setBal(2,30);
    scoreDuivel++;
    setTimeout(()=>volgendeLevel(),900);
  }
}

function volgendeLevel(){
  if(huidigLevel < 3){
    laadLevel(huidigLevel+1);
  }else{
    eindeSpel();
  }
}

function eindeSpel(){
  eindePopup.style.display="flex";
  const winstEngel = scoreEngel>scoreDuivel;
  const gelijk = scoreEngel===scoreDuivel;
  if(gelijk){
    eindeEmoji.textContent="‚öñÔ∏è";
    eindeTitel.textContent="Gelijkspel!";
    eindeTekst.textContent="Iedereen heeft geweldig gespeeld!";
  }else if(winstEngel){
    eindeEmoji.textContent="üèÜüòá";
    eindeTitel.textContent="Proficiat, de engeltjes winnen!";
    eindeTekst.textContent="Hemelse overwinning! üéâ";
  }else{
    eindeEmoji.textContent="üòàüéâ";
    eindeTitel.textContent="De duiveltjes winnen!";
    eindeTekst.textContent="Volgende keer beter, engeltjes!";
  }
  confetti({particleCount:240,spread:90,origin:{y:0.6}});
}

opnieuwBtn.onclick=()=>{
  eindePopup.style.display="none";
  scoreEngel=0; scoreDuivel=0;
  startknop.style.display="inline-block";
  vraagBtn.style.display="none";
  spelGestart=false;
  setBal(50,50);
};

/* === Start === */
startknop.onclick=()=>{
  spelGestart=true;
  startknop.style.display="none";
  vraagBtn.style.display="inline-block";
  scoreEngel=0; scoreDuivel=0;
  laadLevel(1);
};
</script>
</body>
</html>
