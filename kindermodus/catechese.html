<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Catechese – Orthodoxe Kinderpagina</title>
  <link rel="icon" href="https://kathy-torfs.github.io/Orthodoxeweg/images/kruis.png">
  <style>
    :root {
      --primair: #7bb235;
      --donker: #67510C;
      --pastel1: #fff6e5; --pastel2: #fffde6; --pastel3: #ffe8ec; --pastel4: #e7f8ff;
      --pastel5: #e6ffe5; --pastel6: #fff2fb; --pastel7: #f5ffe5; --pastel8: #f5e8ff;
      --pastel9: #fff6fb; --pastel10: #e7fff9; --pastel11: #f3e6ff; --pastel12: #ffeae6;
      --pastel13: #ecffe9; --pastel14: #f7fff3; --pastel15: #eafffa; --pastel16: #fff4ea;
      --rand:#f1e6c8; --kaart:#ffffff; --text:#333;
    }
    body {
      margin: 0;
      font-family: 'Comic Sans MS', Arial, sans-serif;
      color: #333;
      min-height: 100vh;
      background: var(--pastel1);
      transition: background 0.6s;
      overflow-x: hidden;
    }

    /* === Begroetingsbalk (exact overgenomen) === */
    .bovenrij { width: 100%; max-width: 1280px; margin: 0 auto; display: flex; align-items: center; justify-content: space-between; gap: 0; padding: 22px 2vw 8px 2vw; box-sizing: border-box; }
    .bovenrij .links { display: flex; align-items: center; gap: 18px; }
    .photeinos-wave-img { width: 120px; min-width: 54px; max-width: 26vw; height: 120px; border-radius: 50%; background: #fff; border: 2.2px solid #dab97a; box-shadow: 0 2px 12px #dab97a2a; object-fit: cover; margin-right: 0; user-drag: none; -webkit-user-drag: none; display: block; }
    .begroeting { font-size: 2.2em; font-weight: bold; color: var(--primair); text-shadow: 0 2px 8px #b3d9ff44; letter-spacing: 0.01em; line-height: 1.04; margin: 0; text-align: left; white-space: nowrap; }
    .bovenrij .rechts { display: flex; align-items: center; gap: 18px; margin-left: 24px; }
    .uitlog-kind-btn { background: #e24343; color: #fff; border: none; padding: 11px 24px; border-radius: 9px; font-weight: bold; font-size: 1.1em; cursor: pointer; box-shadow: 0 2px 10px #b04141ab; transition: background 0.2s; z-index: 10; margin-left: 12px; }
    .uitlog-kind-btn:hover { background: #b72828; }
    .puntenvlam-balk { display: flex; flex-direction: column; align-items: center; position: relative; width: 58px; min-width: 44px; height: 74px; margin-left: 22px; }
    .puntenvlam-img { width: 58px; height: 74px; display: block; user-drag: none; -webkit-user-drag: none; }
    .punten-teller-balk { position: absolute; left: 0; right: 0; top: 63%; text-align: center; font-family: 'Comic Sans MS', Arial, sans-serif; font-size: 1.33em; color: #bf5300; font-weight: bold; text-shadow: 0 2px 10px #fffef9, 0 1px 0 #ffecb3; pointer-events: none; letter-spacing: 0.03em; filter: drop-shadow(0 2px 2px #fffef9); transition: transform 0.14s; }

    @media (max-width: 1100px) { .photeinos-wave-img { width: 17vw; height: 17vw; min-width: 60px; max-width: 120px;} .puntenvlam-balk, .puntenvlam-img { width: 44px; height: 60px;} }
    @media (max-width: 900px) { .bovenrij { padding-top: 10px; } .photeinos-wave-img { width: 16vw; height: 16vw; min-width: 44px;} .begroeting { font-size: 1.2em;} .puntenvlam-balk, .puntenvlam-img { width: 36px; height: 48px;} }
    @media (max-width: 600px) { .photeinos-wave-img { width: 24vw; height: 24vw; min-width: 28px;} .puntenvlam-balk, .puntenvlam-img { width: 27px; height: 35px;} }

    /* === Menubalk (exact overgenomen) === */
    nav.kinder-menu { width: 100vw; max-width: 1280px; margin: 0 auto; display: flex; justify-content: center; align-items: center; gap: 32px; padding: 36px 0 25px 0; box-sizing: border-box; min-height: 88px; flex-wrap: wrap; transition: gap 0.2s; }
    nav.kinder-menu a { display: flex; align-items: center; justify-content: center; background: none; border: none; box-shadow: none; padding: 0; cursor: pointer; outline: none; border-radius: 12px; transition: transform 0.13s; }
    nav.kinder-menu a:focus, nav.kinder-menu a:hover { transform: scale(1.12); }
    .menu-icoon { width: 72px; height: 72px; object-fit: contain; border-radius: 16px; background: #fff9d5; box-shadow: 0 2px 7px #ffe17e25; border: 2.2px solid #ffe05e; transition: box-shadow 0.13s, border-color 0.13s, width 0.2s, height 0.2s; display: block; }
    nav.kinder-menu a:focus .menu-icoon, nav.kinder-menu a:hover .menu-icoon { box-shadow: 0 5px 16px #ffe17e55; border-color: #ffbe23; }

    .spacer-begroeting-menu { height: 38px; }

    /* === Catechese index UI === */
    .container-catechese { max-width: 1100px; margin: 0 auto; padding: 0 12px 44px 12px; }
    .toolbar { display:flex; flex-wrap:wrap; gap:10px; align-items:center; margin:10px 0 14px }
    .search { flex:1 1 260px; display:flex; background:#fff; border:1px solid var(--rand); border-radius:12px; padding:8px 10px }
    .search input { border:none; outline:none; flex:1; font-size:16px; background:transparent; color:inherit }
    .chips { display:flex; flex-wrap:wrap; gap:8px }
    .chip { background:#ffe8b3; border:1px solid #f2d9a6; border-radius:999px; padding:6px 12px; cursor:pointer }
    .chip.active { background:#ffd480 }
    select, .btn { background:#fff; border:1px solid var(--rand); border-radius:10px; padding:8px 10px; font-size:14px }
    .grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(260px,1fr)); gap:14px }
    .card { background:#fff; border:1px solid var(--rand); border-radius:16px; padding:14px; display:flex; flex-direction:column; gap:10px; box-shadow:0 2px 4px #0000000d }
    .badge { display:inline-block; font-size:12px; padding:4px 8px; border-radius:999px; border:1px solid #eeddb6; background:#fff }
    .title { font-weight:700; color:#3c2e0f }
    .meta { font-size:13px; color:#6a5a34 }
    .progress { height:8px; border-radius:999px; background:#f3ead2; overflow:hidden; border:1px solid #ead7a6 }
    .progress>span { display:block; height:100%; background:var(--primair); width:0% }
    .actions { display:flex; gap:8px; align-items:center; margin-top:4px }
    .btn.primary { background:var(--primair); border-color:#6aa32a; color:#fff; font-weight:700 }
    .pager { display:flex; gap:8px; justify-content:center; align-items:center; margin:18px 0 }
    .pager .btn[disabled]{ opacity:.5; cursor:not-allowed }
    .empty{ padding:30px; text-align:center; border:2px dashed #f0e2be; border-radius:16px; background:#fff }
  </style>

  <!-- Firebase compat (zelfde versie als je voorbeeld) -->
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore-compat.js"></script>
</head>
<body>
  <!-- Bovenste rij -->
  <div class="bovenrij">
    <div class="links">
      <img src="https://kathy-torfs.github.io/Orthodoxeweg/images/photeinos_wave.gif" alt="Photeinos zwaait" class="photeinos-wave-img" draggable="false">
      <span class="begroeting" id="groet-tekst">Hallo, kind!</span>
    </div>
    <div class="rechts">
      <div class="puntenvlam-balk">
        <img src="https://kathy-torfs.github.io/Orthodoxeweg/images/photeinos_vlam.png" alt="Vlam" class="puntenvlam-img" draggable="false">
        <div id="punten-teller" class="punten-teller-balk">…</div>
      </div>
      <button class="uitlog-kind-btn" onclick="uitloggenKind()">Uitloggen</button>
    </div>
  </div>

  <div class="spacer-begroeting-menu"></div>

  <!-- Menubalk -->
  <nav class="kinder-menu">
    <a href="startpagina.html" title="Startpagina"><img src="https://kathy-torfs.github.io/Orthodoxeweg/images/photeinos_home.png" alt="Startpagina" class="menu-icoon"></a>
    <a href="gebeden.html" title="Ik bid"><img src="https://kathy-torfs.github.io/Orthodoxeweg/images/photeinos_bid.png" alt="Ik bid" class="menu-icoon"></a>
    <a href="catechese.html" title="Catechese"><img src="https://kathy-torfs.github.io/Orthodoxeweg/images/catechese.png" alt="Catechese" class="menu-icoon"></a>
    <a href="heiligen.html" title="Heiligen"><img src="https://kathy-torfs.github.io/Orthodoxeweg/images/photeinos_heiligen.png" alt="Heiligen" class="menu-icoon"></a>
    <a href="bijbelverhalen.html" title="Bijbelverhalen"><img src="https://kathy-torfs.github.io/Orthodoxeweg/images/photeinos_bijbel.png" alt="Bijbelverhalen" class="menu-icoon"></a>
    <a href="spelletjes.html" title="Spelletjes"><img src="https://kathy-torfs.github.io/Orthodoxeweg/images/photeinos_spelletjes.png" alt="Spelletjes" class="menu-icoon"></a>
    <a href="school.html" title="School"><img src="https://kathy-torfs.github.io/Orthodoxeweg/images/photeinos_school.png" alt="School" class="menu-icoon"></a>
  </nav>

  <!-- Inhoud: catechese index -->
  <div class="container-catechese">
    <div class="toolbar">
      <div class="search"><input id="q" type="search" placeholder="Zoek op titel, type of dagnummer…"></div>
      <div class="chips" id="chips">
        <div class="chip active" data-type="alle">Alle</div>
        <div class="chip" data-type="bijbelverhaal">Bijbelverhaal</div>
        <div class="chip" data-type="heiligenverhaal">Heiligenverhaal</div>
        <div class="chip" data-type="traditie">Traditie</div>
      </div>
      <select id="sort">
        <option value="volgnummer-asc">Sorteer: Volgnummer ↑</option>
        <option value="volgnummer-desc">Sorteer: Volgnummer ↓</option>
        <option value="titel-asc">Sorteer: Titel A→Z</option>
      </select>
    </div>

    <div id="results" class="grid" aria-live="polite"></div>
    <div id="empty" class="empty" style="display:none">Geen lessen gevonden. Pas je filters of zoekterm aan.</div>

    <div class="pager" role="navigation" aria-label="Paginatie">
      <button class="btn" id="prev">Vorige</button>
      <span id="pageLabel">Pagina 1</span>
      <button class="btn" id="next">Volgende</button>
    </div>
  </div>

  <script>
    // Random pastel achtergrond
    (function(){
      const pastelKleuren = ['var(--pastel1)','var(--pastel2)','var(--pastel3)','var(--pastel4)','var(--pastel5)','var(--pastel6)','var(--pastel7)','var(--pastel8)','var(--pastel9)','var(--pastel10)','var(--pastel11)','var(--pastel12)','var(--pastel13)','var(--pastel14)','var(--pastel15)','var(--pastel16)'];
      document.body.style.background = pastelKleuren[Math.floor(Math.random()*pastelKleuren.length)];
    })();

    // Welkomstgroet + uitloggen
    const kindNaam = localStorage.getItem("ingelogdKindVoornaam") || "Kind";
    function welkomstGroet(){ const u=new Date().getHours(); if(u>=6&&u<=11)return "Goeiemorgen"; if(u>=12&&u<=16)return "Goeiemiddag"; if(u>=17&&u<=22)return "Goeieavond"; return "Hallo"; }
    document.getElementById("groet-tekst").textContent = `${welkomstGroet()}, ${kindNaam}!`;
    function uitloggenKind(){
      localStorage.removeItem("kindIngelogd");
      localStorage.removeItem("ingelogdKindId");
      localStorage.removeItem("ingelogdKindVoornaam");
      localStorage.removeItem("kindAvatarURL");
      localStorage.removeItem("kindPunten");
      window.location.href = "https://kathy-torfs.github.io/Orthodoxeweg/volwassenmodus/parochie.html";
    }

    // Firebase init + Firestore referenties
    const firebaseConfig = {
      apiKey: "AIzaSyBG1iQBmruHUZI1OeW8RgbJ_TPit_7a2LQ",
      authDomain: "orthodoxeweg.firebaseapp.com",
      projectId: "orthodoxeweg",
      storageBucket: "orthodoxeweg.appspot.com",
      messagingSenderId: "408582263618",
      appId: "1:408582263618:web:0a20f4bf0704989d3ceedb"
    };
    if(!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const parochieId = localStorage.getItem("ingelogdeParochie");
    const ouderLogin = localStorage.getItem("loginKeuze");
    const kindId = localStorage.getItem("ingelogdKindId");

    // Punten laden (zelfde pad als bij gebeden)
    async function laadPunten(){
      const teller = document.getElementById("punten-teller");
      if(!parochieId || !ouderLogin || !kindId){ teller.textContent = "…"; return; }
      try{
        const kindDoc = await db.collection("parochies").doc(parochieId).collection("leden").doc(ouderLogin).collection("kinderen").doc(kindId).get();
        teller.textContent = kindDoc.exists ? (kindDoc.data().punten || 0) : "0";
        teller.style.transform = 'scale(1.18)'; setTimeout(()=>{teller.style.transform='scale(1)'},180);
      }catch{ teller.textContent = "…"; }
    }
    laadPunten();

    // ===== Catechese index =====
    const PAGE_SIZE = 20;
    let allLessons = [], viewLessons = [], currentPage = 1, activeType = "alle";

    const els = {
      q: document.getElementById('q'),
      chips: document.getElementById('chips'),
      sort: document.getElementById('sort'),
      results: document.getElementById('results'),
      empty: document.getElementById('empty'),
      prev: document.getElementById('prev'),
      next: document.getElementById('next'),
      pageLabel: document.getElementById('pageLabel')
    };

    function normalize(s){ return (s||"").toString().toLowerCase().trim(); }
    function getProgress(id){ const raw = localStorage.getItem(`catechese-progress:${id}`); return raw ? Math.max(0, Math.min(100, parseInt(raw,10))) : 0; }
    function setProgress(id,p){ localStorage.setItem(`catechese-progress:${id}`, String(p)); }

    function applyFilters(){
      const q = normalize(els.q.value); let list = allLessons.slice();
      if(activeType!=='alle'){ list = list.filter(x => (x.type||'')===activeType); }
      if(q){ list = list.filter(x => (`${x.titel||''} ${x.type||''} ${x.id||''}`).toLowerCase().includes(q)); }
      const [field,dir]=(els.sort.value||'volgnummer-asc').split('-');
      list.sort((a,b)=>{ let av=a[field], bv=b[field]; if(field==='volgnummer'){av=+av||0; bv=+bv||0;} if(field==='titel'){av=(av||'').toString().toLowerCase(); bv=(bv||'').toString().toLowerCase();} if(av<bv) return dir==='asc'?-1:1; if(av>bv) return dir==='asc'?1:-1; return 0; });
      viewLessons=list; currentPage=1; render();
    }

    function paginate(list,page,size){ return list.slice((page-1)*size, page*size); }

    function render(){
      const pageItems = paginate(viewLessons, currentPage, PAGE_SIZE);
      els.results.innerHTML = '';
      if(!pageItems.length){ els.empty.style.display='block'; }
      else{
        els.empty.style.display='none';
        for(const item of pageItems){
          const prog = getProgress(item.id);
          const card = document.createElement('div');
          card.className='card';
          card.innerHTML = `
            <div class="badge">${item.type||''}</div>
            <div class="title">${item.titel||'(zonder titel)'}</div>
            <div class="meta">Dag: <b>${item.volgnummer ?? '-'}</b></div>
            <div class="progress" title="Voortgang: ${prog}%"><span style="width:${prog}%"></span></div>
            <div class="actions">
              <button class="btn primary">Openen</button>
              <button class="btn" data-boost>+10%</button>
              <button class="btn" data-reset>Reset</button>
            </div>
          `;
          card.querySelector('.btn.primary').addEventListener('click', ()=>{ location.href=`les.html?id=${encodeURIComponent(item.id)}`; });
          card.querySelector('[data-boost]').addEventListener('click', ()=>{ setProgress(item.id, Math.min(100, prog+10)); render(); });
          card.querySelector('[data-reset]').addEventListener('click', ()=>{ setProgress(item.id, 0); render(); });
          els.results.appendChild(card);
        }
      }
      const totalPages = Math.max(1, Math.ceil(viewLessons.length/PAGE_SIZE));
      els.pageLabel.textContent = `Pagina ${currentPage} / ${totalPages}`;
      els.prev.disabled = currentPage<=1; els.next.disabled = currentPage>=totalPages;
    }

    els.q.addEventListener('input', applyFilters);
    els.sort.addEventListener('change', applyFilters);
    els.chips.addEventListener('click', e=>{ const chip=e.target.closest('.chip'); if(!chip) return; [...els.chips.children].forEach(c=>c.classList.remove('active')); chip.classList.add('active'); activeType=chip.dataset.type; applyFilters(); });
    els.prev.addEventListener('click', ()=>{ if(currentPage>1){ currentPage--; render(); }});
    els.next.addEventListener('click', ()=>{ const totalPages=Math.max(1, Math.ceil(viewLessons.length/PAGE_SIZE)); if(currentPage<totalPages){ currentPage++; render(); }});

    // Data laden
    db.collection('kindercatechese').get().then(snap=>{
      const list=[]; snap.forEach(doc=>{ const d=doc.data()||{}; list.push({ id:doc.id, titel:d.titel||'', type:(d.type||'').toLowerCase(), volgnummer:Number(d.volgnummer)||null }); });
      allLessons=list; applyFilters();
    }).catch(err=>{
      console.error(err); els.results.innerHTML=''; els.empty.style.display='block'; els.empty.textContent='Kon catecheselessen niet laden. Controleer Firestore.';
    });
  </script>
</body>
</html>
