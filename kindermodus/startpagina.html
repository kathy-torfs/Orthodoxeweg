<!DOCTYPE html> 
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Welkom – Orthodoxe Kinderpagina</title>
  <link rel="icon" href="https://kathy-torfs.github.io/Orthodoxeweg/images/kruis.png" />

  <style>
    :root{
      --primair:#7bb235; --donker:#67510C;
      --pastel1:#fff6e5; --pastel2:#fffde6; --pastel3:#ffe8ec; --pastel4:#e7f8ff;
      --pastel5:#e6ffe5; --pastel6:#fff2fb; --pastel7:#f5ffe5; --pastel8:#f5e8ff;
      --pastel9:#fff6fb; --pastel10:#e7fff9; --pastel11:#f3e6ff; --pastel12:#ffeae6;
      --pastel13:#ecffe9; --pastel14:#f7fff3; --pastel15:#eafffa; --pastel16:#fff4ea;
    }
    body{
      margin:0; font-family:'Comic Sans MS', Arial, sans-serif; color:#333;
      min-height:100vh; background:var(--pastel1); transition:background .6s; overflow-x:hidden;
    }

    /* Menu pas zichtbaar na intro */
    nav.kinder-menu{
      opacity:0; transform:translateY(-10px); pointer-events:none; transition:opacity .4s, transform .4s;
    }
    .show-menu nav.kinder-menu{
      opacity:1; transform:translateY(0); pointer-events:auto;
    }

    .intro-wrap{
      max-width:1000px; margin:20px auto 40px auto; padding:0 16px;
      display:flex; align-items:center; justify-content:center; flex-direction:column; gap:14px;
    }
    .video-frame{
      position:relative; width:min(92vw,860px); aspect-ratio:16/9; background:#000; border-radius:16px; overflow:hidden;
      box-shadow:0 10px 28px #00000022;
    }
    .video-frame video, .video-frame img{
      width:100%; height:100%; object-fit:cover; display:block;
    }

    /* === Spraakballon ===
       - Verplaats de staart met --tail-x (0% = helemaal links, 100% = rechts)
       - Pas evt. de top/left hieronder aan om de ballon zelf te verschuiven
    */
    .speech{
      position:absolute;
      left:35%;          /* ballon meer naar links */
      top:3%;            /* ballon hoger */
      transform:translateX(-50%);
      background:#fff; color:#1f2937; border-radius:18px; padding:12px 16px;
      box-shadow:0 6px 24px #00000020; max-width:85%; font-size:1.1em; line-height:1.5;
      border:2px solid #ffe0a6;
      --tail-x: 22%;     /* <<<< hier schuif je de staart horizontaal */
    }
    .speech::after{
      content:"";
      position:absolute;
      bottom:-12px;                  /* staart wijst omlaag */
      left:var(--tail-x);            /* horizontale positie vd staart */
      transform:translateX(-50%);
      width:0; height:0;
      border-left:14px solid transparent;
      border-right:14px solid transparent;
      border-top:14px solid #fff;    /* kleur van de ballon */
      filter:drop-shadow(0 2px 1px #00000010);
    }
    .speech .line{ opacity:0; transform:translateY(6px); transition:opacity .4s, transform .4s; }
    .speech .line.show{ opacity:1; transform:translateY(0); }
    .speech .highlight{ color:#7bb235; font-weight:bold; }

    .skip-btn{
      margin-top:8px; background:#eff6ff; color:#1e40af; border:1px solid #93c5fd;
      padding:8px 12px; border-radius:10px; font-weight:bold; cursor:pointer;
    }
    .skip-btn:hover{ background:#e0efff; }

    .welkom-blok{
      background:#fffce7; color:var(--donker);
      border-radius:20px; box-shadow:0 6px 24px #d7cbb133;
      font-size:1.1em; line-height:1.7; text-align:center;
      max-width:900px; width:93vw; margin:10px auto 34px auto; padding:22px 20px;
    }

    @media (max-width:700px){
      .speech{ top:6%; font-size:1em; left:40%; --tail-x: 28%; }
    }
  </style>

  <!-- Firebase compat -->
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore-compat.js"></script>
  <!-- Kinder lay-out: laadt header.html + beveiliging + live puntenteller -->
  <script defer src="common/layout.js"></script>
</head>
<body>
  <!-- Header wordt hier ingeladen -->
  <div id="kinder-header" data-header-src="common/header.html"></div>

  <!-- Intro met video + ballon -->
  <section class="intro-wrap">
    <div class="video-frame">
      <video id="photeinosVideo"
             src="https://kathy-torfs.github.io/Orthodoxeweg/videos/photeinos.mp4"
             autoplay muted playsinline
             onloadeddata="this.play().catch(()=>{})"></video>

      <!-- Fallback-afbeelding -->
      <img id="videoFallback"
           src="https://kathy-torfs.github.io/Orthodoxeweg/images/photeinos_wave.gif"
           alt="Photeinos zwaait" style="display:none" />

      <!-- Tekstballon -->
      <div class="speech" id="speechBox">
        <div class="line" id="line1"></div>
        <div class="line" id="line2" style="margin-top:6px"></div>
      </div>
    </div>
    <button class="skip-btn" id="skipIntro">Sla de intro over</button>
  </section>

  <!-- Korte welkomsttekst -->
  <div class="welkom-blok">
    Welkom! Je kan <strong>lichtjes</strong> verdienen door je <strong>dagelijkse gebeden</strong> te doen,
    je <strong>dagboek</strong> in te vullen en <strong>catecheselessen</strong> te volgen.
    Met die lichtjes speel je spelletjes en vul je je iconengalerij aan. Veel plezier! ✨
  </div>

  <script>
    // Pastel achtergrond
    (function(){
      const p = ['var(--pastel1)','var(--pastel2)','var(--pastel3)','var(--pastel4)','var(--pastel5)','var(--pastel6)','var(--pastel7)','var(--pastel8)','var(--pastel9)','var(--pastel10)','var(--pastel11)','var(--pastel12)','var(--pastel13)','var(--pastel14)','var(--pastel15)','var(--pastel16)'];
      document.body.style.background = p[Math.floor(Math.random()*p.length)];
    })();

    document.addEventListener('DOMContentLoaded', () => {
      startWhenReady();
    });

    function startWhenReady(){
      if (!(window.KinderLayout && window.firebase && firebase.firestore)) {
        return setTimeout(startWhenReady, 120);
      }
      window.KinderLayout.mountHeader({
        rootId: 'kinder-header',
        headerSrc: document.getElementById('kinder-header').dataset.headerSrc,
        active: 'start'
      }).then(runIntro).catch(runIntro);
    }

    async function runIntro(){
      const naam = localStorage.getItem('ingelogdKindVoornaam') || 'Kind';
      const db = firebase.firestore();
      const parochieId = localStorage.getItem('ingelogdeParochie');
      const ouderLogin = localStorage.getItem('loginKeuze');
      const kindId     = localStorage.getItem('ingelogdKindId');

      let punten = 0;
      if (parochieId && ouderLogin && kindId) {
        try{
          const snap = await db.collection('parochies').doc(parochieId)
            .collection('leden').doc(ouderLogin)
            .collection('kinderen').doc(kindId).get();
          punten = snap.exists ? (snap.data().punten || 0) : 0;
        }catch(e){}
      }

      const vid = document.getElementById('photeinosVideo');
      const fallback = document.getElementById('videoFallback');
      vid.addEventListener('error', ()=> { vid.style.display='none'; fallback.style.display='block'; });

      const line1 = document.getElementById('line1');
      const line2 = document.getElementById('line2');

      const regel1 = `Dag <span class="highlight">${naam}</span>! Wat wil je vandaag doen?`;
      const regel2 = `Je hebt al <span class="highlight">${punten}</span> lichtjes. `
                   + `Verdien meer door je <strong>dagelijkse gebeden</strong> te doen, je <strong>dagboek</strong> in te vullen en `
                   + `<strong>catecheselessen</strong> te volgen.`;

      typeInto(line1, regel1, 18, () => {
        line1.classList.add('show');
        setTimeout(() => {
          typeInto(line2, regel2, 14, () => {
            line2.classList.add('show');
            document.body.classList.add('show-menu');
          });
        }, 500);
      });

      document.getElementById('skipIntro').onclick = () => {
        line1.innerHTML = regel1; line1.classList.add('show');
        line2.innerHTML = regel2; line2.classList.add('show');
        document.body.classList.add('show-menu');
      };
    }

    function typeInto(el, html, speed, done){
      const tmp = document.createElement('div');
      tmp.innerHTML = html;
      const plain = tmp.textContent || tmp.innerText || '';
      el.innerHTML = '';
      let i=0;
      const tick = () => {
        if (i < plain.length){
          el.textContent += plain.charAt(i++);
          setTimeout(tick, speed);
        } else {
          el.innerHTML = html;
          if (done) done();
        }
      };
      tick();
    }
  </script>
</body>
</html>
