<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Welkom – Orthodoxe Kinderpagina</title>
  <link rel="icon" href="https://kathy-torfs.github.io/Orthodoxeweg/images/kruis.png" />

  <style>
    :root{
      --primair:#7bb235; --donker:#67510C;
      --pastel1:#fff6e5; --pastel2:#fffde6; --pastel3:#ffe8ec; --pastel4:#e7f8ff;
      --pastel5:#e6ffe5; --pastel6:#fff2fb; --pastel7:#f5ffe5; --pastel8:#f5e8ff;
      --pastel9:#fff6fb; --pastel10:#e7fff9; --pastel11:#f3e6ff; --pastel12:#ffeae6;
      --pastel13:#ecffe9; --pastel14:#f7fff3; --pastel15:#eafffa; --pastel16:#fff4ea;
    }
    body{
      margin:0; font-family:'Comic Sans MS', Arial, sans-serif; color:#333;
      min-height:100vh; background:var(--pastel1); transition:background .6s; overflow-x:hidden;
    }

    /* ---------- Intro/video wrapper: volledig responsive ---------- */
    .intro-wrap{
      max-width:1600px;
      margin: min(3vh,24px) auto min(3.5vh,28px) auto;
      padding: 0 clamp(8px, 2vw, 32px);
      display:flex; flex-direction:column; align-items:center; gap: clamp(6px, 1.2vh, 14px);
    }
    .video-frame{
      position:relative;
      width: clamp(300px, 96vw, 1400px);
      aspect-ratio: 16 / 9;
      background:#000;
      border-radius: clamp(10px, 1.5vw, 18px);
      overflow:hidden;
      box-shadow: 0 clamp(8px, 1.2vw, 14px) clamp(24px, 2.2vw, 36px) #00000026;
    }
    .video-frame video, .video-frame img{
      width:100%; height:100%; object-fit:cover; display:block;
    }

    /* ---------- Transparante overlaytekst (links-boven) ---------- */
    .intro-text{
      position:absolute;
      top: clamp(6px, 1.2vh, 18px);
      left: clamp(6px, 1.2vw, 22px);
      right: clamp(40px, 22vw, 320px); /* ruimte rechts zodat tekst niet over de rand valt */
      background: transparent;
      border: none;
      padding: 0;
      color: #111;                 /* ZWART, zoals gevraagd */
      text-shadow: 0 0 0 rgba(0,0,0,0.0); /* geen omlijning */
      font-size: clamp(0.9rem, 1.15vw, 1.35rem);  /* schaalt mee met scherm */
      line-height: clamp(1.28, 1.2 + 0.2vw, 1.5);
      white-space: pre-line;       /* \n => nieuwe regel */
      pointer-events: none;        /* klikken gaat naar video */
      user-select: none;
    }
    .intro-text .highlight{ color: var(--primair); font-weight: bold; }

    /* ---------- Welkomstblok onder de video ---------- */
    .welkom-blok{
      background:#fffce7; color:var(--donker);
      border-radius: clamp(14px, 1.6vw, 20px);
      box-shadow:0 clamp(6px, 0.9vw, 12px) clamp(24px, 2vw, 30px) #d7cbb133;
      font-size: clamp(0.95rem, 0.9rem + 0.4vw, 1.15rem);
      line-height: 1.7;
      text-align:center;
      max-width: clamp(320px, 92vw, 980px);
      margin: clamp(6px, 0.8vh, 12px) auto clamp(28px, 3.6vh, 44px) auto;
      padding: clamp(14px, 2.2vw, 20px) clamp(12px, 2vw, 24px);
    }

    /* Extra verfijning op héle kleine schermen */
    @media (max-width: 420px){
      .intro-text{
        right: 10%;  /* iets smaller tekstvlak */
        font-size: clamp(0.9rem, 3.8vw, 1.05rem);
        top: 2%;
        left: 3%;
      }
    }
  </style>

  <!-- Firebase compat -->
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore-compat.js"></script>

  <!-- Kinder lay-out: laadt header.html + beveiliging + live puntenteller -->
  <script defer src="common/layout.js"></script>
</head>
<body>
  <!-- Header (begroeting + vlam + menubalk) wordt hier ingeladen -->
  <div id="kinder-header" data-header-src="common/header.html"></div>

  <!-- Intro met video + transparante overlaytekst -->
  <section class="intro-wrap">
    <div class="video-frame">
      <video id="photeinosVideo"
             src="https://kathy-torfs.github.io/Orthodoxeweg/videos/photeinos.mp4"
             autoplay muted playsinline loop
             onloadeddata="this.play().catch(()=>{})"></video>

      <!-- Fallback-afbeelding (indien video niet kan spelen) -->
      <img id="videoFallback"
           src="https://kathy-torfs.github.io/Orthodoxeweg/images/photeinos_wave.gif"
           alt="Photeinos zwaait" style="display:none" />

      <!-- Transparante overlaytekst (links-boven) -->
      <div class="intro-text" id="introText"></div>
    </div>
  </section>

  <!-- Korte welkomsttekst onder de video -->
  <div class="welkom-blok">
    Verdien <strong>lichtjes</strong> door je <strong>dagelijkse gebeden</strong> te doen,
    je <strong>dagboek</strong> in te vullen en <strong>catecheselessen</strong> te volgen.
    Met die lichtjes kan je <strong>spelletjes spelen</strong> en je <strong>iconengalerij</strong> aanvullen. ✨
  </div>

  <script>
    // Zachte pastelachtergrond
    (function(){
      const p = ['var(--pastel1)','var(--pastel2)','var(--pastel3)','var(--pastel4)','var(--pastel5)','var(--pastel6)','var(--pastel7)','var(--pastel8)','var(--pastel9)','var(--pastel10)','var(--pastel11)','var(--pastel12)','var(--pastel13)','var(--pastel14)','var(--pastel15)','var(--pastel16)'];
      document.body.style.background = p[Math.floor(Math.random()*p.length)];
    })();

    // Start wanneer layout + Firebase klaar is
    document.addEventListener('DOMContentLoaded', () => { startWhenReady(); });

    function startWhenReady(){
      if (!(window.KinderLayout && window.firebase && firebase.firestore)) {
        return setTimeout(startWhenReady, 120);
      }
      window.KinderLayout.mountHeader({
        rootId: 'kinder-header',
        headerSrc: document.getElementById('kinder-header').dataset.headerSrc,
        active: 'start'
      }).then(fillIntroText).catch(fillIntroText);
    }

    async function fillIntroText(){
      const naam = localStorage.getItem('ingelogdKindVoornaam') || 'Kind';
      const db = firebase.firestore();
      const parochieId = localStorage.getItem('ingelogdeParochie');
      const ouderLogin = localStorage.getItem('loginKeuze');
      const kindId     = localStorage.getItem('ingelogdKindId');

      // Huidige punten ophalen (header loopt al live)
      let punten = 0;
      if (parochieId && ouderLogin && kindId) {
        try{
          const snap = await db.collection('parochies').doc(parochieId)
            .collection('leden').doc(ouderLogin)
            .collection('kinderen').doc(kindId).get();
          punten = snap.exists ? (snap.data().punten || 0) : 0;
        }catch(e){ /* laat 0 */ }
      }

      // Fallback als video niet speelt
      const vid = document.getElementById('photeinosVideo');
      const fallback = document.getElementById('videoFallback');
      vid.addEventListener('error', ()=> { vid.style.display='none'; fallback.style.display='block'; });
      vid.addEventListener('stalled', ()=> { /* optioneel fallback */ });

      // Tekstregels (white-space:pre-line maakt echte nieuwe regels van \n)
      const lines = [
        `Dag ${naam}!`,
        `Wat wil je vandaag doen?`,
        `Je hebt al ${punten} lichtjes.`,
        `Verdien meer door je dagelijkse gebeden te doen,`,
        `je dagboek in te vullen en`,
        `catecheselessen te volgen.`,
        `Verken zeker alle knoppen in de menubalk! ✨`
      ];
      document.getElementById('introText').textContent = lines.join('\n');
    }
  </script>
</body>
</html>
