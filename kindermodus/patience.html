<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Patience ‚Äì Orthodoxe Kinderpagina</title>
  <link rel="icon" href="images/kruis.png" />

  <style>
    :root{
      --primair:#7bb235; --donker:#67510C;
      --pastel1:#fff6e5; --pastel2:#fffde6; --pastel3:#ffe8ec; --pastel4:#e7f8ff;
      --pastel5:#e6ffe5; --pastel6:#fff2fb; --pastel7:#f5ffe5; --pastel8:#f5e8ff;
      --pastel9:#fff6fb; --pastel10:#e7fff9; --pastel11:#f3e6ff; --pastel12:#ffeae6;
      --pastel13:#ecffe9; --pastel14:#f7fff3; --pastel15:#eafffa; --pastel16:#fff4ea;
    }
    body{
      margin:0; font-family:'Comic Sans MS', Arial, sans-serif; color:#333;
      min-height:100vh; background:var(--pastel1); transition:background .6s;
    }
    main{ max-width:1200px; margin:20px auto; padding:0 16px; text-align:center }

    #gameArea{
      display:flex; flex-direction:column; align-items:center;
    }

    #topRow{
      width:100%; display:flex; justify-content:space-between; margin-bottom:20px;
    }
    #foundations, #stockArea{
      display:flex; gap:12px; min-height:140px;
    }
    .pile, .foundation, .stock, .waste{
      width:90px; height:130px; border:2px dashed #bbb; border-radius:8px;
      position:relative; background:rgba(255,255,255,0.3);
    }
    #tableau{
      display:flex; gap:12px; width:100%; justify-content:center;
    }
    .card{
      width:90px; height:130px; border-radius:8px;
      background:#fff; position:absolute; cursor:pointer;
      display:flex; align-items:center; justify-content:center;
      font-weight:bold; font-size:22px; user-select:none;
      box-shadow:0 2px 6px rgba(0,0,0,0.4);
    }
    .card.red{ color:red; }
    .card.black{ color:black; }
    .card.back{
      background:linear-gradient(45deg, #7bb235, #67510C);
      color:transparent;
    }
  </style>

  <script defer src="common/layout.js"></script>
</head>
<body>
  <div id="kinder-header" data-header-src="common/header.html"></div>

  <main>
    <h1>Patience üÉè‚õ™</h1>
    <div id="gameArea">
      <div id="topRow">
        <div id="foundations">
          <div class="foundation" data-foundation="0"></div>
          <div class="foundation" data-foundation="1"></div>
          <div class="foundation" data-foundation="2"></div>
          <div class="foundation" data-foundation="3"></div>
        </div>
        <div id="stockArea">
          <div class="stock"></div>
          <div class="waste"></div>
        </div>
      </div>
      <div id="tableau">
        <div class="pile" data-pile="0"></div>
        <div class="pile" data-pile="1"></div>
        <div class="pile" data-pile="2"></div>
        <div class="pile" data-pile="3"></div>
        <div class="pile" data-pile="4"></div>
        <div class="pile" data-pile="5"></div>
        <div class="pile" data-pile="6"></div>
      </div>
    </div>
  </main>

  <script>
    // Achtergrond random pastel
    (function(){
      const p=['var(--pastel1)','var(--pastel2)','var(--pastel3)','var(--pastel4)',
               'var(--pastel5)','var(--pastel6)','var(--pastel7)','var(--pastel8)',
               'var(--pastel9)','var(--pastel10)','var(--pastel11)','var(--pastel12)',
               'var(--pastel13)','var(--pastel14)','var(--pastel15)','var(--pastel16)'];
      document.body.style.background=p[Math.floor(Math.random()*p.length)];
    })();

    // Header
    (function boot(){
      if (!(window.KinderLayout)) return setTimeout(boot,120);
      const el=document.getElementById('kinder-header');
      window.KinderLayout.mountHeader({ rootId:'kinder-header', headerSrc:el.dataset.headerSrc, active:'spelletjes' });
    })();

    const suits=["‚ô†","‚ô•","‚ô¶","‚ô£"];
    const values=["A","2","3","4","5","6","7","8","9","10","J","Q","K"];
    let deck=[], stock=[], waste=[], tableau=[[],[],[],[],[],[],[]], foundations=[[],[],[],[]];

    function init(){
      deck=[];
      suits.forEach(s=>{
        values.forEach(v=>{
          deck.push({suit:s,value:v,faceUp:false});
        });
      });
      shuffle(deck);
      // Deel naar tableau
      for(let i=0;i<7;i++){
        for(let j=0;j<=i;j++){
          const card=deck.pop();
          if(j===i) card.faceUp=true;
          tableau[i].push(card);
        }
      }
      stock=deck; waste=[]; render();
    }

    function shuffle(a){
      for(let i=a.length-1;i>0;i--){
        const j=Math.floor(Math.random()*(i+1));
        [a[i],a[j]]=[a[j],a[i]];
      }
    }

    function render(){
      // Tableau
      document.querySelectorAll(".pile").forEach((p,i)=>{
        p.innerHTML="";
        tableau[i].forEach((card,j)=>{
          const div=document.createElement("div");
          div.classList.add("card");
          if(!card.faceUp) div.classList.add("back");
          else{
            div.textContent=card.value+card.suit;
            if(card.suit==="‚ô•"||card.suit==="‚ô¶") div.classList.add("red");
            else div.classList.add("black");
          }
          div.style.top=(card.faceUp? j*30 : j*10)+"px";
          div.draggable=card.faceUp;
          div.dataset.pile=i;
          div.dataset.index=j;
          p.appendChild(div);
        });
      });
      // Stock & Waste
      const stockDiv=document.querySelector(".stock");
      const wasteDiv=document.querySelector(".waste");
      stockDiv.innerHTML=stock.length?"<div class='card back'></div>":"";
      wasteDiv.innerHTML="";
      if(waste.length){
        const top=waste[waste.length-1];
        const div=document.createElement("div");
        div.classList.add("card");
        div.textContent=top.value+top.suit;
        if(top.suit==="‚ô•"||top.suit==="‚ô¶") div.classList.add("red");
        else div.classList.add("black");
        div.dataset.waste="1"; div.draggable=true;
        wasteDiv.appendChild(div);
      }
      // Foundations
      document.querySelectorAll(".foundation").forEach((f,i)=>{
        f.innerHTML="";
        if(foundations[i].length){
          const top=foundations[i][foundations[i].length-1];
          const div=document.createElement("div");
          div.classList.add("card");
          div.textContent=top.value+top.suit;
          if(top.suit==="‚ô•"||top.suit==="‚ô¶") div.classList.add("red");
          else div.classList.add("black");
          f.appendChild(div);
        }
      });
    }

    // Click stock
    document.querySelector(".stock").addEventListener("click",()=>{
      if(stock.length){
        const c=stock.pop(); c.faceUp=true; waste.push(c);
      }else{
        while(waste.length){ const c=waste.pop(); c.faceUp=false; stock.push(c); }
      }
      render();
    });

    // Drag & Drop
    document.addEventListener("dragstart",e=>{
      if(e.target.classList.contains("card")){
        e.dataTransfer.setData("text/plain",JSON.stringify({
          pile:e.target.dataset.pile,
          index:e.target.dataset.index,
          waste:e.target.dataset.waste
        }));
      }
    });
    document.querySelectorAll(".pile,.foundation,.waste").forEach(zone=>{
      zone.addEventListener("dragover",e=>e.preventDefault());
      zone.addEventListener("drop",e=>{
        e.preventDefault();
        const data=JSON.parse(e.dataTransfer.getData("text/plain"));
        let card;
        if(data.waste){
          card=waste.pop();
        }else{
          card=tableau[data.pile].splice(data.index);
          if(tableau[data.pile].length && !tableau[data.pile][tableau[data.pile].length-1].faceUp){
            tableau[data.pile][tableau[data.pile].length-1].faceUp=true;
          }
        }
        if(zone.classList.contains("pile")){
          tableau[zone.dataset.pile]=tableau[zone.dataset.pile].concat(card);
        }else if(zone.classList.contains("foundation")){
          foundations[zone.dataset.foundation].push(...card);
        }
        render();
      });
    });

    init();
  </script>
</body>
</html>
