<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <title>Klassiek Solitaire – Patience</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background: green;
      color: white;
      font-family: Arial, sans-serif;
      user-select: none;
    }
    h1 {
      text-align: center;
      margin: 10px;
    }
    #game {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    #top-row, #tableau {
      display: flex;
      margin: 10px;
    }
    .pile {
      width: 80px;
      height: 120px;
      border: 2px dashed rgba(255,255,255,0.4);
      margin: 5px;
      position: relative;
    }
    .card {
      width: 80px;
      height: 120px;
      border-radius: 6px;
      border: 1px solid #333;
      background: white;
      color: black;
      position: absolute;
      top: 0; left: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 20px;
      cursor: grab;
    }
    .card.red { color: red; }
    .card.back {
      background: darkblue;
      color: transparent;
      cursor: pointer;
    }
    #foundations, #stock-area {
      display: flex;
      flex: 1;
      justify-content: space-between;
      margin: 0 20px;
    }
  </style>
</head>
<body>
  <h1>Patience – Solitaire</h1>
  <div id="game">
    <div id="top-row">
      <div id="stock-area">
        <div id="stock" class="pile"></div>
        <div id="waste" class="pile"></div>
      </div>
      <div id="foundations">
        <div id="foundation-0" class="pile"></div>
        <div id="foundation-1" class="pile"></div>
        <div id="foundation-2" class="pile"></div>
        <div id="foundation-3" class="pile"></div>
      </div>
    </div>
    <div id="tableau">
      <div id="tableau-0" class="pile"></div>
      <div id="tableau-1" class="pile"></div>
      <div id="tableau-2" class="pile"></div>
      <div id="tableau-3" class="pile"></div>
      <div id="tableau-4" class="pile"></div>
      <div id="tableau-5" class="pile"></div>
      <div id="tableau-6" class="pile"></div>
    </div>
  </div>

  <script>
    const suits = ['♠','♥','♦','♣'];
    const values = ['A','2','3','4','5','6','7','8','9','10','J','Q','K'];
    let deck = [];
    let stock = [], waste = [], foundations = [[],[],[],[]], tableau = [[],[],[],[],[],[],[]];

    function createDeck() {
      deck = [];
      for (let s of suits) {
        for (let v of values) {
          deck.push({suit:s, value:v, color:(s==='♥'||s==='♦')?'red':'black'});
        }
      }
      shuffle(deck);
    }
    function shuffle(array) {
      for (let i=array.length-1; i>0; i--) {
        const j=Math.floor(Math.random()*(i+1));
        [array[i],array[j]]=[array[j],array[i]];
      }
    }

    function deal() {
      tableau.forEach(p=>p.splice(0));
      for (let i=0;i<7;i++) {
        for (let j=0;j<=i;j++) {
          let card = deck.pop();
          card.faceUp = (j===i);
          tableau[i].push(card);
        }
      }
      stock = deck.splice(0);
      waste = [];
      render();
    }

    function render() {
      document.querySelectorAll('.pile').forEach(p=>p.innerHTML='');
      // stock
      stock.forEach((c,i)=>{
        let el = createCard(c,false);
        el.classList.add('back');
        el.style.top = `${i*0.2}px`;
        document.getElementById('stock').appendChild(el);
      });
      // waste
      waste.forEach((c,i)=>{
        let el=createCard(c,c.faceUp);
        el.style.left=`${i*15}px`;
        document.getElementById('waste').appendChild(el);
      });
      // foundations
      foundations.forEach((pile,pi)=>{
        pile.forEach((c,i)=>{
          let el=createCard(c,true);
          el.style.top=`${i*2}px`;
          document.getElementById('foundation-'+pi).appendChild(el);
        });
      });
      // tableau
      tableau.forEach((pile,pi)=>{
        pile.forEach((c,i)=>{
          let el=createCard(c,c.faceUp);
          el.style.top=`${i*25}px`;
          el.dataset.pile='tableau';
          el.dataset.index=pi;
          if(c.faceUp) makeDraggable(el,c,pi,i);
          document.getElementById('tableau-'+pi).appendChild(el);
        });
      });
    }

    function createCard(card,faceUp) {
      let el=document.createElement('div');
      el.className='card '+(card.color==='red'?'red':'');
      if(faceUp) {
        el.innerHTML=`<div style="position:absolute;top:2px;left:4px;font-size:14px">${card.value}${card.suit}</div>
                      <div style="font-size:28px">${card.suit}</div>
                      <div style="position:absolute;bottom:2px;right:4px;font-size:14px">${card.value}${card.suit}</div>`;
      }
      return el;
    }

    function makeDraggable(el,card,pileIndex,cardIndex) {
      el.draggable=true;
      el.addEventListener('dragstart',e=>{
        e.dataTransfer.setData('text/plain',JSON.stringify({pileIndex,cardIndex}));
      });
    }

    // drop targets
    document.querySelectorAll('.pile').forEach(p=>{
      p.addEventListener('dragover',e=>e.preventDefault());
      p.addEventListener('drop',e=>{
        e.preventDefault();
        let data=JSON.parse(e.dataTransfer.getData('text/plain'));
        let source=tableau[data.pileIndex];
        let moving=source.slice(data.cardIndex);
        // example: only allow move if target is empty (for K) or descending alternating
        let targetId=p.id;
        if(targetId.startsWith('tableau-')) {
          let ti=parseInt(targetId.split('-')[1]);
          let target=tableau[ti];
          if(target.length===0) {
            if(moving[0].value==='K') {
              tableau[ti]=target.concat(moving);
              source.splice(data.cardIndex);
            }
          } else {
            let top=target[target.length-1];
            if(top.faceUp && isValidMove(moving[0],top)) {
              tableau[ti]=target.concat(moving);
              source.splice(data.cardIndex);
            }
          }
        }
        // TODO: foundation logic
        render();
      });
    });

    function isValidMove(card,target) {
      return card.color!==target.color && values.indexOf(card.value)===values.indexOf(target.value)-1;
    }

    // stock click
    document.getElementById('stock').addEventListener('click',()=>{
      if(stock.length===0) {
        stock=waste.reverse().map(c=>(c.faceUp=false,c));
        waste=[];
      } else {
        let c=stock.pop();
        c.faceUp=true;
        waste.push(c);
      }
      render();
    });

    createDeck();
    deal();
  </script>
</body>
</html>
