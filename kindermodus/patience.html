<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Patience (Solitaire)</title>
  <style>
    body {
      margin:0; font-family:Arial, sans-serif;
      background:green; color:white; text-align:center;
    }
    h1 { margin:10px; }
    #game { padding:10px; }
    #top { display:flex; justify-content:space-between; margin-bottom:20px; }
    .pile {
      width:80px; height:120px;
      border:1px solid white; border-radius:8px;
      background:rgba(255,255,255,0.2);
      position:relative; margin:0 5px;
    }
    #tableau { display:flex; justify-content:space-between; margin-top:20px; }
    .card {
      width:80px; height:120px;
      border-radius:8px; background:white; color:black;
      border:1px solid black; position:absolute;
      text-align:center; font-size:20px; font-weight:bold;
      cursor:grab; user-select:none;
      display:flex; align-items:center; justify-content:center;
    }
    .red { color:red; }
    .hidden {
      background:darkblue; border:1px solid #ccc; color:transparent;
      cursor:default;
    }
  </style>
</head>
<body>
  <h1>Patience (Solitaire)</h1>
  <div id="game">
    <div id="top">
      <div id="foundations" style="display:flex; gap:10px;">
        <div class="pile" id="foundation-0"></div>
        <div class="pile" id="foundation-1"></div>
        <div class="pile" id="foundation-2"></div>
        <div class="pile" id="foundation-3"></div>
      </div>
      <div id="stockWaste" style="display:flex; gap:10px;">
        <div class="pile" id="stock"></div>
        <div class="pile" id="waste"></div>
      </div>
    </div>
    <div id="tableau"></div>
  </div>
  <div id="status"></div>

  <script>
    const suits=["â™ ","â™¥","â™¦","â™£"];
    const values=["A","2","3","4","5","6","7","8","9","10","J","Q","K"];
    let deck=[],tableau=[[],[],[],[],[],[],[]],foundations=[[],[],[],[]],stock=[],waste=[];
    let dragged=null;

    function createDeck(){
      deck=[];
      for(let s of suits){
        for(let v of values){
          deck.push({suit:s,value:v,color:(s=="â™¥"||s=="â™¦")?"red":"black"});
        }
      }
      for(let i=deck.length-1;i>0;i--){
        const j=Math.floor(Math.random()*(i+1));
        [deck[i],deck[j]]=[deck[j],deck[i]];
      }
    }

    function deal(){
      for(let i=0;i<7;i++){
        for(let j=0;j<=i;j++){
          const c=deck.pop(); c.hidden=j<i;
          tableau[i].push(c);
        }
      }
      stock=deck; deck=[];
      render();
    }

    function render(){
      const tabEl=document.getElementById("tableau");
      tabEl.innerHTML="";
      tableau.forEach((pile,pi)=>{
        const pileDiv=document.createElement("div");
        pileDiv.className="pile"; pileDiv.style.width="80px"; pileDiv.style.position="relative";
        pile.forEach((card,ci)=>{
          const cDiv=document.createElement("div");
          cDiv.className="card"+(card.color=="red"?" red":"");
          if(card.hidden) cDiv.classList.add("hidden");
          cDiv.textContent=card.hidden?"":card.value+card.suit;
          cDiv.style.top=(ci*25)+"px";
          cDiv.draggable=!card.hidden;
          cDiv.dataset.pi=pi; cDiv.dataset.ci=ci;
          cDiv.addEventListener("dragstart",dragStart);
          pileDiv.appendChild(cDiv);
        });
        pileDiv.addEventListener("dragover",dragOver);
        pileDiv.addEventListener("drop",drop);
        tabEl.appendChild(pileDiv);
      });

      const stockDiv=document.getElementById("stock");
      stockDiv.innerHTML="";
      if(stock.length){
        const back=document.createElement("div");
        back.className="card hidden";
        stockDiv.appendChild(back);
        stockDiv.onclick=drawFromStock;
      } else stockDiv.onclick=null;

      const wasteDiv=document.getElementById("waste");
      wasteDiv.innerHTML="";
      if(waste.length){
        const top=waste[waste.length-1];
        const cDiv=document.createElement("div");
        cDiv.className="card"+(top.color=="red"?" red":"");
        cDiv.textContent=top.value+top.suit;
        cDiv.draggable=true; cDiv.dataset.waste="1";
        cDiv.addEventListener("dragstart",dragStart);
        wasteDiv.appendChild(cDiv);
      }

      for(let i=0;i<4;i++){
        const f=document.getElementById("foundation-"+i);
        f.innerHTML="";
        if(foundations[i].length){
          const top=foundations[i][foundations[i].length-1];
          const cDiv=document.createElement("div");
          cDiv.className="card"+(top.color=="red"?" red":"");
          cDiv.textContent=top.value+top.suit;
          f.appendChild(cDiv);
        }
        f.addEventListener("dragover",dragOver);
        f.addEventListener("drop",dropFoundation);
      }
    }

    function drawFromStock(){
      if(stock.length){ waste.push(stock.pop()); }
      else { stock=waste.reverse(); waste=[]; }
      render();
    }

    function dragStart(e){ dragged={pi:e.target.dataset.pi,ci:e.target.dataset.ci,waste:e.target.dataset.waste}; }
    function dragOver(e){ e.preventDefault(); }

    function canPlaceOn(card,target){
      if(!target) return card.value=="K"; // alleen koning op lege stapel
      const v1=values.indexOf(card.value),v2=values.indexOf(target.value);
      return card.color!=target.color && v1==v2-1;
    }

    function drop(e){
      e.preventDefault(); if(!dragged) return;
      let moving;
      if(dragged.waste){ moving=[waste.pop()]; }
      else { moving=tableau[dragged.pi].slice(dragged.ci); tableau[dragged.pi]=tableau[dragged.pi].slice(0,dragged.ci); }
      const pi=[...e.currentTarget.parentNode.children].indexOf(e.currentTarget);
      const pile=tableau[pi];
      if(canPlaceOn(moving[0],pile[pile.length-1])){ tableau[pi].push(...moving); }
      else { if(dragged.waste) waste.push(...moving); else tableau[dragged.pi].push(...moving); }
      tableau.forEach(p=>{ if(p.length&&p[p.length-1].hidden) p[p.length-1].hidden=false; });
      render();
    }

    function canPlaceFoundation(card,fPile){
      if(!fPile.length) return card.value=="A";
      const v1=values.indexOf(card.value),v2=values.indexOf(fPile[fPile.length-1].value);
      return card.suit==fPile[fPile.length-1].suit && v1==v2+1;
    }

    function dropFoundation(e){
      e.preventDefault(); if(!dragged) return;
      let card;
      if(dragged.waste){ card=waste.pop(); }
      else { card=tableau[dragged.pi].pop(); }
      const idx=parseInt(e.currentTarget.id.split("-")[1]);
      if(canPlaceFoundation(card,foundations[idx])){ foundations[idx].push(card); }
      else { if(dragged.waste) waste.push(card); else tableau[dragged.pi].push(card); }
      tableau.forEach(p=>{ if(p.length&&p[p.length-1].hidden) p[p.length-1].hidden=false; });
      render(); checkWin();
    }

    function checkWin(){
      if(foundations.every(f=>f.length==13)){
        document.getElementById("status").textContent="ðŸŽ‰ Gefeliciteerd, je hebt gewonnen!";
      }
    }

    createDeck(); deal();
  </script>
</body>
</html>
