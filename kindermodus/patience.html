<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <title>Solitaire - Patience - Kaartspel spelen</title>
  
  <style>
    canvas {
      position: fixed;
      z-index: 10000;
      left: 0;
      top: 0;
      pointer-events: none;
    }
    button {
      color: #fff;
      font-family: inherit;
      font-weight: 500;
      padding: 6px 12px;
      font-size: 16px;
      cursor: pointer;
      background-color: transparent;
      border: none;
    }
    button:hover { background-color: rgba(0, 0, 0, 0.3); border-color: rgba(0, 0, 0, 0.3); }
    #spelcontainer::after, .clearfix::after { clear: both; content: ""; display: table; }

    #spelcontainer {
      position: absolute;
      left: 10;
      top: 60;
      height: 80vh;
      width: 770px;
      text-align: center;
    }
    #controls {
      position: absolute;
      width: 770px;
      left: 10;
      top: 5;
      box-sizing: border-box;
      background-color: #3B96E5;
    }
    #score { color: #fff; float: right; padding: 6px 12px; }
    .columns { width: 100%; }
    .column { float: left; position: relative; width: 100px; height: 150px; }

    .column .card:nth-child(1), .column .ghost:nth-child(1) { top: 0px; z-index: 11; }
    .column .card:nth-child(2), .column .ghost:nth-child(2) { top: 25px; z-index: 12; }
    .column .card:nth-child(3), .column .ghost:nth-child(3) { top: 50px; z-index: 13; }
    .column .card:nth-child(4), .column .ghost:nth-child(4) { top: 75px; z-index: 14; }
    .column .card:nth-child(5), .column .ghost:nth-child(5) { top: 100px; z-index: 15; }
    .column .card:nth-child(6), .column .ghost:nth-child(6) { top: 125px; z-index: 16; }
    .column .card:nth-child(7), .column .ghost:nth-child(7) { top: 150px; z-index: 17; }
    .column .card:nth-child(8), .column .ghost:nth-child(8) { top: 175px; z-index: 18; }
    .column .card:nth-child(9), .column .ghost:nth-child(9) { top: 200px; z-index: 19; }
    .column .card:nth-child(10), .column .ghost:nth-child(10) { top: 225px; z-index: 20; }
    .column .card:nth-child(11), .column .ghost:nth-child(11) { top: 250px; z-index: 21; }
    .column .card:nth-child(12), .column .ghost:nth-child(12) { top: 275px; z-index: 22; }
    .column .card:nth-child(13), .column .ghost:nth-child(13) { top: 300px; z-index: 23; }
    .column .card:nth-child(14), .column .ghost:nth-child(14) { top: 325px; z-index: 24; }
    .column .card:nth-child(15), .column .ghost:nth-child(15) { top: 350px; z-index: 25; }
    .column .card:nth-child(16), .column .ghost:nth-child(16) { top: 375px; z-index: 26; }
    .column .card:nth-child(17), .column .ghost:nth-child(17) { top: 400px; z-index: 27; }
    .column .card:nth-child(18), .column .ghost:nth-child(18) { top: 425px; z-index: 28; }
    .column .card:nth-child(19), .column .ghost:nth-child(19) { top: 450px; z-index: 29; }
    .column .card:nth-child(20), .column .ghost:nth-child(20) { top: 475px; z-index: 30; }

    .pack, .dealt { position: relative; width: 100px; height: 150px; float: left; }
    .stack { width: 100px; height: 150px; border-radius: 6.25px; display: inline-block; position: relative; box-sizing: border-box; }
    .dealer, .stacks { float: left; }
    .dealer { width: 30%; text-align: left; }
    .stacks { width: 70%; text-align: right; }
    .pack, .dealt, .stack, .column { background-color: rgba(0,0,0,0.3); margin: 0 10px 10px 0; border-radius: 6.25px; }

    /* Cards */
    .card {
      width: 100px; height: 150px; border: 2px solid #2c3e50; border-radius: 6.25px;
      position: relative; display: inline-block; position: absolute; background-color: #fff;
      cursor: pointer; left: 0; top: 0;
      -webkit-transform: rotateY(180deg); transform: rotateY(180deg); z-index: 1;
      -webkit-transform-style: preserve-3d; transform-style: preserve-3d;
      transition: transform 250ms, z-index 250ms step-end;
    }
    .column .card.flipped { box-shadow: 0 0 20px -5px #000; }
    .card, .card * { pointer-events: none; }
    .dealt .card { pointer-events: none; }
    .dealt .card:last-child, .column .card.flipped, .stack .card.flipped:last-child { pointer-events: inherit; }

    .dealer.dealing .card { transition: transform 250ms; }
    .card > div { display:block; height:100%; width:100%; position:absolute; -webkit-backface-visibility:hidden; backface-visibility:hidden; border-radius: 6.25px; }
    .card .rear {
      background-color:#fff; background-image:url("images/solitair-back.png");
      background-position:center center; background-repeat:no-repeat; background-size:82% 88%;
      -webkit-transform: rotateY(180deg); transform: rotateY(180deg);
    }
    .card.flipped { -webkit-transform: rotateY(0deg); transform: rotateY(0deg); z-index: 2; }
    .card::after, .column::after { position:absolute; left:0; top:0; width:100%; height:100%; content:""; opacity:0; transition:opacity 250ms; pointer-events:none; }
    .column.hint { box-shadow: 0 0 0px 5px #fff inset; }
    .card.hint { -webkit-transform: scale(1.05,1.05); transform: scale(1.05,1.05); }
    .column.over.empty::before, .column.over > .card:not(.dragging):last-child::before {
      content:""; width:100%; height:100%; background-color:rgba(255,255,255,0.2); position:absolute; left:0; top:0; border-radius:6.25px; z-index:100; border:2px dashed #fff; box-sizing:border-box;
    }
    .column.over > .card:not(.dragging):last-child::before { top:25px; }
    .card.dragging { z-index:1000 !important; box-shadow:0 0 20px -5px #000; transition:z-index 250ms step-start; -webkit-transform: scale(1.05,1.05); transform: scale(1.05,1.05); }

    .card .value { position:absolute; font-size:19.2307692308px; width:19.2307692308px; height:41.6666666667px; text-align:center; }
    .card .value::after { position:absolute; font-size:20.8333333333px; }
    .card .value:nth-child(1){ top:0px; left:0px; }
    .card .value:nth-child(2){ bottom:0px; right:0px; -webkit-transform: rotate(180deg); transform: rotate(180deg); }
    .card .value:nth-child(1)::after, .card .value:nth-child(2)::after { position:absolute; top:15.625px; left:50%; -webkit-transform: translate3d(-50%,0,0); transform: translate3d(-50%,0,0); }

    .hearts, .diamonds { color:#c0392b; }
    .clubs, .spades { color:#2c3e50; }

    .hearts .value::after, .hearts span::after { content: "♥"; }
    .diamonds .value::after, .diamonds span::after { content: "♦"; }
    .clubs .value::after, .clubs span::after { content: "♣"; }
    .spades .value::after, .spades span::after { content: "♠"; }

    .middle { height:85%; left:7.5%; position:absolute; top:7.5%; width:85%; }
    .middle span { position:absolute; display:block; height:31.25px; width:31.25px; }
    .middle span::after { font-size:50px; display:flex; align-items:center; justify-content:center; width:100%; height:100%; position:absolute; top:-6.25px; }

    .picture .middle {
      height:80%; left:16%; top:10%; width:68%;
      border:1px solid #999; background-image:url(images/solitair-cards.jpg); background-size:256.25px 600px;
    }
    .diamonds.card-J .middle { background-position: 0px -450px; }
    .hearts.card-J .middle   { background-position: 0px -150px; }
    .clubs.card-J .middle    { background-position: 0px 0px; }
    .spades.card-J .middle   { background-position: 0px -300px; }

    .diamonds.card-Q .middle { background-position: -86px -450px; }
    .hearts.card-Q .middle   { background-position: -86px -150px; }
    .clubs.card-Q .middle    { background-position: -86px 0px; }
    .spades.card-Q .middle   { background-position: -86px -300px; }

    .diamonds.card-K .middle { background-position: -170px -450px; }
    .hearts.card-K .middle   { background-position: -170px -150px; }
    .clubs.card-K .middle    { background-position: -170px 0px; }
    .spades.card-K .middle   { background-position: -170px -300px; }

    /* Ace..Ten layouts (ongewijzigd) */
    .card-1 .middle { display:flex; align-items:center; justify-content:center; font-size:62.5px; }
    .card-1 .middle span { position:relative; height:62.5px; width:62.5px; }
    .card-1 .middle span::after { font-size:62.5px; }

    .card-2 .middle span { left:50%; transform: translate3d(-50%,0,0); }
    .card-2 .middle span:nth-child(1){ top:0; }
    .card-2 .middle span:nth-child(2){ bottom:0; transform: rotate(180deg); transform-origin:25% 50% 0; }

    .card-3 .middle span { left:50%; transform: translate3d(-50%,0,0); }
    .card-3 .middle span:nth-child(1){ top:0; }
    .card-3 .middle span:nth-child(2){ top:50%; transform: translate3d(-50%,-50%,0); }
    .card-3 .middle span:nth-child(3){ bottom:0; transform: rotate(180deg); transform-origin:25% 50% 0; }

    .card-4 .middle span:nth-child(1), .card-4 .middle span:nth-child(3){ left:12.5px; }
    .card-4 .middle span:nth-child(2), .card-4 .middle span:nth-child(4){ right:12.5px; }
    .card-4 .middle span:nth-child(1), .card-4 .middle span:nth-child(2){ top:0; }
    .card-4 .middle span:nth-child(3), .card-4 .middle span:nth-child(4){ bottom:0; transform: rotate(180deg); }

    .card-5 .middle span:nth-child(1), .card-5 .middle span:nth-child(3){ left:12.5px; }
    .card-5 .middle span:nth-child(2), .card-5 .middle span:nth-child(4){ right:12.5px; }
    .card-5 .middle span:nth-child(1), .card-5 .middle span:nth-child(2){ top:0; }
    .card-5 .middle span:nth-child(3), .card-5 .middle span:nth-child(4){ bottom:0; transform: rotate(180deg); }
    .card-5 .middle span:nth-child(5){ left:50%; top:50%; transform: translate3d(-50%,-50%,0); }

    .card-6 .middle span:nth-child(1), .card-6 .middle span:nth-child(3), .card-6 .middle span:nth-child(5){ left:12.5px; }
    .card-6 .middle span:nth-child(2), .card-6 .middle span:nth-child(4), .card-6 .middle span:nth-child(6){ right:12.5px; }
    .card-6 .middle span:nth-child(1), .card-6 .middle span:nth-child(2){ top:0; }
    .card-6 .middle span:nth-child(5), .card-6 .middle span:nth-child(6){ bottom:0; transform: rotate(180deg); }
    .card-6 .middle span:nth-child(3), .card-6 .middle span:nth-child(4){ top:50%; transform: translate3d(0,-50%,0); }

    .card-7 .middle span:nth-child(1), .card-7 .middle span:nth-child(3), .card-7 .middle span:nth-child(5){ left:12.5px; }
    .card-7 .middle span:nth-child(2), .card-7 .middle span:nth-child(4), .card-7 .middle span:nth-child(6){ right:12.5px; }
    .card-7 .middle span:nth-child(1), .card-7 .middle span:nth-child(2){ top:0; }
    .card-7 .middle span:nth-child(5), .card-7 .middle span:nth-child(6){ bottom:0; transform: rotate(180deg); }
    .card-7 .middle span:nth-child(3), .card-7 .middle span:nth-child(4){ top:50%; transform: translate3d(0,-50%,0); }
    .card-7 .middle span:nth-child(7){ top:25%; left:50%; transform: translate3d(-50%,-25%,0); }

    .card-8 .middle span:nth-child(1), .card-8 .middle span:nth-child(3), .card-8 .middle span:nth-child(5){ left:12.5px; }
    .card-8 .middle span:nth-child(2), .card-8 .middle span:nth-child(4), .card-8 .middle span:nth-child(6){ right:12.5px; }
    .card-8 .middle span:nth-child(1), .card-8 .middle span:nth-child(2){ top:0; }
    .card-8 .middle span:nth-child(5), .card-8 .middle span:nth-child(6){ bottom:0; transform: rotate(180deg); }
    .card-8 .middle span:nth-child(3), .card-8 .middle span:nth-child(4){ top:50%; transform: translate3d(0,-50%,0); }
    .card-8 .middle span:nth-child(7){ top:25%; left:50%; transform: translate3d(-50%,-25%,0); }
    .card-8 .middle span:nth-child(8){ top:75%; left:50%; transform: translate3d(-50%,-75%,0) rotate(180deg); }

    .card-9 .middle span:nth-child(1), .card-9 .middle span:nth-child(3), .card-9 .middle span:nth-child(5), .card-9 .middle span:nth-child(7){ left:12.5px; }
    .card-9 .middle span:nth-child(2), .card-9 .middle span:nth-child(4), .card-9 .middle span:nth-child(6), .card-9 .middle span:nth-child(8){ right:12.5px; }
    .card-9 .middle span:nth-child(1), .card-9 .middle span:nth-child(2){ top:0; }
    .card-9 .middle span:nth-child(3), .card-9 .middle span:nth-child(4){ top:25%; }
    .card-9 .middle span:nth-child(5), .card-9 .middle span:nth-child(6){ bottom:25%; }
    .card-9 .middle span:nth-child(7), .card-9 .middle span:nth-child(8){ bottom:0; }
    .card-9 .middle span:nth-child(5), .card-9 .middle span:nth-child(6), .card-9 .middle span:nth-child(7), .card-9 .middle span:nth-child(8){ transform: rotate(180deg); }
    .card-9 .middle span:nth-child(9){ left:50%; top:50%; transform: translate3d(-50%,-50%,0); }

    .card-10 .middle span:nth-child(1), .card-10 .middle span:nth-child(3), .card-10 .middle span:nth-child(5), .card-10 .middle span:nth-child(7){ left:12.5px; }
    .card-10 .middle span:nth-child(2), .card-10 .middle span:nth-child(4), .card-10 .middle span:nth-child(6), .card-10 .middle span:nth-child(8){ right:12.5px; }
    .card-10 .middle span:nth-child(1), .card-10 .middle span:nth-child(2){ top:0; }
    .card-10 .middle span:nth-child(3), .card-10 .middle span:nth-child(4){ top:25%; }
    .card-10 .middle span:nth-child(5), .card-10 .middle span:nth-child(6){ bottom:25%; }
    .card-10 .middle span:nth-child(7), .card-10 .middle span:nth-child(8){ bottom:0; }
    .card-10 .middle span:nth-child(5), .card-10 .middle span:nth-child(6), .card-10 .middle span:nth-child(7), .card-10 .middle span:nth-child(8){ transform: rotate(180deg); }
    .card-10 .middle span:nth-child(9){ left:50%; top:16.6667%; transform: translate3d(-50%,-16.6667%,0); }
    .card-10 .middle span:nth-child(10){ left:50%; bottom:16.6667%; transform: translate3d(-50%,16.6667%,0) rotate(180deg); }
  </style>
</head>
<body>

  <div id="page-wrapper">
   
    <!-- Content -->
    <section id="content">
      <div class="container">
        <div class="row">
          <div class="col-12">
            <section>
              <h1>Solitaire - Patience - Kaartspel</h1>
            </section>
          </div>
        </div>
      </div>
    </section>

    <section id="content">
      <div class="container">
        <div class="row">
          <!-- Linker kolom (ads verwijderd) -->
          <div class="col-3 col-12-medium">
            <section></section>
          </div>

          <!-- Spel -->
          <div class="col-7 col-12-medium imp-medium">
            <section style="padding:10px;height:720px;position:relative;">
              <div id="controls">
                <button type="button" data-action="undo">Ongedaan maken</button>
                <button type="button" data-action="hint">Hint</button>
                <button type="button" data-action="start">Herstart</button>
                <div id="score">Score: 0</div>
              </div>
              <div id="spelcontainer"></div>
            </section>
          </div>

          <!-- Rechter kolom (ads verwijderd) -->
          <div class="col-2 col-12-medium">
            <section></section>
          </div>
        </div>

        <div class="row">
          <div class="col-12">
            <!-- Spelregels (gelaten zoals aangeleverd; advertenties en FB-like verwijderd) -->
            <section>
              <h2>Spelregels van het kaartspel patience</h2>
              <p>Het kaartspel patience kan je op je eentje spelen.</p>
              <h3>Het kaartspel patience klaarleggen</h3>
              <p>De computer legt de kaarten als volgt voor je klaar:</p>
              <ol>
                <li>De 52 kaarten (dus geen jokers) worden geschud.</li>
                <li>Horizontaal 7 kaarten, met de achterkant naar boven gericht, naast elkaar leggen. Daarna 6 kaarten op dezelfde manier vanaf de 2de tot de 7de kaart, Vervolgens 5 kaarten vanaf de 3de tot de 7de kaart, steeds met de achterkant naar boven gericht. Daarna 4 kaarten vanaf de 4de kaart tot de 7de kaart, enzovoort. De 7de stapel heeft dus 7 kaarten.</li>
                <li>De bovenste kaart van iedere stapel wordt omgedraaid.</li>
                <li>De overblijvende kaarten zijn de ‘draaikaarten’.</li>
                <li>Boven de 7 stapels zijn vier ruimtes voor de azenstapels, voor elke kleur ( kleuren: schoppen (♠), harten (♥), klaveren (♣), ruiten (♦)).</li>
              </ol>

              <h3>Doel van patience</h3>
              <p>Het doel van het spel patience is om alle kaarten, op de azenstapels te krijgen. Er is een azenstapel voor de harten, de schoppen, de klaveren en de ruiten. De kaarten in deze azenstapels worden in oplopende volgorde naar daar verplaatst, de aas eerst, daar na de 2, de 3, ..., boer, vrouw en bovenaan de heer.</p>

              <h3>Spelregels patience</h3>
              <p>Van zodra je een aas ziet kan je die naar de azenstapel verplaatsen. Zie je een 2 en een reeds een aas van dezelfde kleur in de azenstapel, dan kan je die 2 ook naar de azenstapel verplaatsen, ...</p>

              <h3>Stapels kaarten</h3>
              <p>Om bij de omgedraaide kaarten in de stapels te komen, moet je de bovenste kaart trachten te verplaatsen. Je mag een kaart naar een andere stapel verplaatsen naar een stapel met een kaart van de tegenovergestelde kleur die in waarde één meer heeft. Bijvoorbeeld: een zwarte 3 mag je op een rode 4 plaatsen, een rode boer mag je op een zwarte vrouw leggen.</p>

              <p>De aas heeft in patience de waarde 1, en heeft dus niet de hoogste waarden.</p>

              <p>Als je een kaart van een stapel verplaatst, en daardoor een omgedraaide kaart boven ligt mag je deze omkeren. Zo zie je steeds andere speelkaarten. Een aas verplaats je naar de azenstapel.</p>

              <p>Als je een reeks opeenvolgende kaarten open hebt liggen (bijvoorbeeld rode vrouw, zwarte boer, rode 10 en een zwarte 9), dan kan je deze hele rij verplaatsen naar een zwarte heer.</p>

              <h3>Draaikaarten</h3>
              <p>We hebben nog een stapel 'draaikaarten' liggen. Deze worden de 'stock' genoemd. Als je kaarten uit de stapels meer kan verplaatsen, mag je, per drie tegelijk, kaarten uit de 'stock' omdraaien. De derde kaart mag je verplaatsen naar de stapels als dat mogelijk is. Als de stock helemaal omgedraaid is, mag je deze weer in de beginpositie leggen, en opnieuw per drie omdraaien.</p>

              <h3>Uitgespeeld?</h3>
              <p>Het spel is uitgespeeld als alle kaarten in de azenstapels liggen. Het spel stopt als je geen kaarten meer kan verplaatsen.</p>
            </section>
          </div>
        </div>
      </div>
    </section>

    <!-- Copyright -->
    <div id="copyright">
      Copyright &copy; 2009-<script>document.write(new Date().getFullYear());</script> Computermeester.be comm.v. All rights reserved.
    </div>
  </div>

  <!-- ==== SPEL-JS (ongewijzigd, behalve: domein-lock verwijderd + controls-init toegevoegd) ==== -->
  <script>
  (function (global) {
    'use strict';
    var win = window, doc = document, body = doc.body;

    var defaultConfig = {};
    var extend = function (r, t) { for (var e = Object(r), n = 1; n < arguments.length; n++) { var a = arguments[n]; if (null != a) for (var o in a) Object.prototype.hasOwnProperty.call(a, o) && (e[o] = a[o]); } return e; };
    var on = function (el, e, fn) { el.addEventListener(e, fn, false); };
    var each = function (arr, fn, s) {
      if ("[object Object]" === Object.prototype.toString.call(arr)) {
        for (var d in arr) { if (Object.prototype.hasOwnProperty.call(arr, d)) fn.call(s, d, arr[d]); }
      } else { for (var e = 0, f = arr.length; e < f; e++) fn.call(s, e, arr[e]); }
    };
    var style = function (t, e) {
      var i = t && t.style, n = "[object Object]" === Object.prototype.toString.call(e);
      if (i) { if (!e) return win.getComputedStyle(t);
        n && each(e, function (t, e) { t in i || (t = "-webkit-" + t), i[t] = e + ("string" == typeof e ? "" : "opacity" === t ? "" : "px"); });
      }
    };
    var rect = function (e) {
      var t = win, o = e.getBoundingClientRect(), b = doc.documentElement || body.parentNode || body,
          d = void 0 !== t.pageXOffset ? t.pageXOffset : b.scrollLeft, n = void 0 !== t.pageYOffset ? t.pageYOffset : b.scrollTop;
      return { left: o.left + d, top: o.top + n, height: Math.round(o.height), width: Math.round(o.width) };
    };
    var getRandomInt = function (min, max) { min = Math.ceil(min); max = Math.floor(max); return Math.floor(Math.random() * (max - min)) + min; };

    var Emitter = function () {};
    Emitter.prototype = {
      on: function (event, fct) { this._events = this._events || {}; this._events[event] = this._events[event] || []; this._events[event].push(fct); },
      off: function (event, fct) { this._events = this._events || {}; if (event in this._events === false) return; this._events[event].splice(this._events[event].indexOf(fct), 1); },
      emit: function (event) { this._events = this._events || {}; if (event in this._events === false) return; for (var i = 0; i < this._events[event].length; i++) { this._events[event][i].apply(this, Array.prototype.slice.call(arguments, 1)); } }
    };
    Emitter.mixin = function (obj) { var props = ['on', 'off', 'emit']; for (var i = 0; i < props.length; i++) { if (typeof obj === 'function') { obj.prototype[props[i]] = Emitter.prototype[props[i]]; } else { obj[props[i]] = Emitter.prototype[props[i]]; } } return obj; };

    function Vector(x, y) { this.x = x; this.y = y; }
    Vector.prototype = { add: function (v) { this.x += v.x, this.y += v.y; } };

    function Card(value, suit) {
      this.value = value; this.suit = suit; this.flipped = false; this.picture = this.value > 10;
      switch (this.suit) { case "hearts": case "diamonds": this.color = "red"; break; case "clubs": case "spades": this.color = "black"; break; }
      var cards = ["A", 2, 3, 4, 5, 6, 7, 8, 9, 10, "J", "Q", "K"];
      var template = ["<div class='front'><div class='value'>", cards[this.value - 1], "</div><div class='value'>", cards[this.value - 1], "</div><div class='middle'>"];
      if (!this.picture) { for (var i = 0; i < this.value; i++) { template.push("<span></span>"); } }
      template.push("</div></div><div class='rear'></div>");
      var card = doc.createElement("div");
      card.className = "card " + this.suit + " card-" + (this.picture ? cards[this.value - 1] : this.value);
      card.innerHTML = template.join("");
      if (this.picture) { card.classList.add("picture"); }
      card.card = true; this.el = card;
    }
    Card.prototype.flip = function () { this.el.classList.toggle("flipped", !this.flipped); this.el.draggable = !this.flipped; this.flipped = !this.flipped; if (!this.flipped) { this.el.style.transform = ""; } };

    function Pack() {
      this.cards = []; this.suits = ["hearts", "spades", "diamonds", "clubs"];
      var count = 0;
      each(this.suits, function (i, suit) { for (var i = 1; i < 14; i++) { var card = new Card(i, suit); card.el.idx = count; this.cards.push(card); count++; } }, this);
    }
    Pack.prototype.shuffle = function () {
      var m = this.cards.length, t, i;
      while (m) { i = Math.floor(Math.random() * m--); t = this.cards[m]; this.cards[m] = this.cards[i]; this.cards[i] = t; this.cards[i].el.idx = i; this.cards[m].el.idx = m; }
    };

    function Game(el, options) {
      if (typeof el === "string") { el = document.querySelector(el); }
      this.el = el; this.options = extend(defaultConfig, options); this.score = 0; this.animationInterval = 250; this.stackToColumn = false; this.history = []; this.pack = new Pack(); Emitter.mixin(this); this.render();
    }

    Game.prototype.render = function () {
      var frag = document.createDocumentFragment();
      this.columns = doc.createElement("div"); this.columns.className = "columns";
      this.stacks  = doc.createElement("div"); this.stacks.className  = "stacks";

      for (var i = 0; i < 4; i++) { var stack = doc.createElement("div"); stack.className = "stack"; this.stacks.appendChild(stack); }
      for (var i = 0; i < 7; i++) { var column = doc.createElement("div"); column.className = "column"; this.columns.appendChild(column); }

      this.dealer   = doc.createElement("div"); this.dealer.className   = "dealer";
      this.packArea = doc.createElement("div"); this.packArea.className = "pack";
      this.dealArea = doc.createElement("div"); this.dealArea.className = "dealt";
      this.dealer.appendChild(this.packArea); this.dealer.appendChild(this.dealArea);

      frag.appendChild(this.dealer); frag.appendChild(this.stacks); frag.appendChild(this.columns);
      this.el.appendChild(frag);

      this.mouse = { x: 0, y: 0 };

      var id = "images/solitair-cards-{t}.png";
      this.images = { clubs: id.replace("{t}", "clubs"), spades: id.replace("{t}", "spades"), diamonds: id.replace("{t}", "diamonds"), hearts: id.replace("{t}", "hearts") };
      each(this.images, function (i, src) { var image = new Image(); image.onload = function () {}; image.src = src; this.images[i] = image; }, this);

      this.events = {
        click: this.click.bind(this),
        mousedown: this.mousedown.bind(this),
        keydown: this.keydown.bind(this),
        mouseup: this.mouseup.bind(this),
        dragstart: this.dragstart.bind(this),
        dragenter: this.dragenter.bind(this),
        dragover: this.dragover.bind(this),
        dragend: this.dragend.bind(this)
      };

      on(this.dealer, "click", this.events.click);
      on(this.el,    "mousedown", this.events.mousedown);
      on(doc,        "keydown",   this.events.keydown);
      on(doc,        "mouseup",   this.events.mouseup);
      on(doc,        "dragstart", this.events.dragstart);
      on(doc,        "dragenter", this.events.dragenter);
      on(doc,        "dragover",  this.events.dragover);
      on(doc,        "dragend",   this.events.dragend);
    };

    Game.prototype.click = function (e) { var t = e.target; if (t.classList.contains("pack")) { e.stopImmediatePropagation(); this.deal(); } };

    Game.prototype.keydown = function (e) { var k = e.key; if (e.ctrlKey) { if (k === "z") { this.undo(); } } };

    Game.prototype.mousedown = function (e) {
      var t = e.target.closest(".card");
      if (t && t.card) {
        this.siblings = [];
        var card = this.pack.cards[t.idx];
        var next = card.el.nextElementSibling;
        card.checked = false;
        card.origin = { x: e.pageX, y: e.pageY };
        card.el.classList.add("dragging");
        this.activeCard = card;
        this.startParent = card.el.parentNode;

        if (next) {
          var p = next.parentNode;
          var idx = Array.from(p.children).indexOf(next);
          for (var i = idx; i < p.childElementCount; i++) {
            var c = p.children[i];
            c.classList.add("dragging");
            this.siblings.push(c);
          }
        }
      }
    };

    Game.prototype.dragstart = function (e) {
      e.dataTransfer.effectAllowed = 'copy'; e.dataTransfer.setData('text/html', '');
      var dragIcon = doc.createElement('img'); e.dataTransfer.setDragImage(dragIcon, -10, -10);
      this.dragging = true;
    };

    Game.prototype.dragenter = function (e) {
      var t = e.target; var column = t.classList.contains("column"); var stack = t.classList.contains("stack"); var canDrop = t.card || column || stack;
      if (this.activeColumn) { this.activeColumn.classList.remove("over"); }
      if (canDrop) { this.activeColumn = (column || stack) ? t : t.parentNode; this.activeColumn.classList.add("over"); }
    };

    Game.prototype.dragover = function (e) {
      e.preventDefault(); e.dataTransfer.dropEffect = 'over';
      if (this.activeCard && this.dragging) {
        var c = this.activeCard; var x = e.pageX - c.origin.x; var y = e.pageY - c.origin.y;
        var css = "pointer-events: none; transform: scale(1.05, 1.05) rotateX(0deg) translate3d(" + x + "px, " + y + "px, 0px);";
        this.activeCard.el.style.cssText = css;
        if (this.siblings.length) { each(this.siblings, function (i, card) { card.style.cssText = css; }, this); }
      }
    };

    Game.prototype.dragend = function (e) {
      if (this.activeCard && this.dragging) {
        var c = this.activeCard; c.el.classList.remove("dragging");
        var x = e.pageX - c.origin.x; var y = e.pageY - c.origin.y;
        c.el.style.cssText = "";
        if (this.siblings.length) { each(this.siblings, function (i, card) { card.classList.remove("dragging"); card.style.cssText = ""; }, this); }
        if (this.activeColumn) { this.activeColumn.classList.remove("over"); }

        if (this.isLegalMove()) {
          var prev = c.el.previousElementSibling;
          if (prev) {
            var card = this.pack.cards[prev.idx];
            if (!card.flipped) { card.prevState = card.flipped; card.flip(); this.score += 5; }
          }

          this.stackToColumn = c.el.parentNode.classList.contains("stack");
          this.pickCount = c.el.parentNode.childElementCount;
          this.dropCount = this.activeColumn.childElementCount;
          this.activeColumn.appendChild(c.el);
          this.updateScore();

          if (this.siblings.length) {
            each(this.siblings, function (i, card) {
              if (!(this.activeCard.value === 13 && this.dropCount === 0 && !this.startParent.classList.contains("dealt") && c.el.parentNode.firstElementChild === c.el)) {
                this.score += 5;
              }
              c.el.parentNode.appendChild(card); card.classList.remove("dragging");
            }, this);
          }

          this.updateHistory();
          this.startParent.classList.toggle("empty", !this.startParent.childElementCount);
          this.activeColumn.classList.toggle("empty", !this.activeColumn.childElementCount);
          this.emit("change");
        }
      }

      if (!this.stackToColumn) { this.check(); }
    };

    Game.prototype.mouseup = function () {
      if (this.activeCard) {
        this.activeCard.el.classList.remove("dragging"); this.activeCard = false;
        if (this.siblings.length) { each(this.siblings, function (i, card) { card.classList.remove("dragging"); }, this); }
      }
      this.hinted = false; this.emit("change");
    };

    Game.prototype.updateHistory = function (card, start, end, siblings) {
      var obj = {};
      if (Array.isArray(card)) { obj.deal = true; }
      else {
        card = card || this.activeCard; start = start || this.startParent; end = end || this.activeColumn; siblings = siblings || this.siblings;
        var max = 10; var cards = this.pack.cards; var prev = card.el.previousElementSibling;
        obj = { card: card, start: start, end: end, siblings: siblings };
        if (prev) { obj.prevSibling = { card: cards[prev.idx], flipped: cards[prev.idx].flipped }; }
      }
      this.history.push(obj); if (this.history.length > max) { this.history.splice(0, this.history.length - max); }
    };

    Game.prototype.updateScore = function (start, stop) {
      start = start || this.startParent; stop = stop || this.activeColumn;
      if (this.dropCount === 0 && this.activeCard.value === 13 && !start.classList.contains("dealt") && this.activeCard.el.parentNode.firstElementChild === this.activeCard.el) { return false; }
      if (start.classList.contains("dealt")) { if (stop.classList.contains("column")) { this.score += 5; } }
      else if (start.classList.contains("column")) { if (stop.classList.contains("column")) { this.score += 3; } }
      if (stop.classList.contains("stack")) { this.score += 10; }
      if (start.classList.contains("stack") && stop.classList.contains("column")) { this.score -= 10; }
    };

    Game.prototype.isLegalMove = function (active, column) {
      active = active || this.activeCard; column = column || this.activeColumn;
      var last = false; var legalMove = false;
      var lastEl = column.lastElementChild; var isColumn = column.classList.contains("column"); var isPlaceholder = column.classList.contains("stack");
      if (lastEl) { last = this.pack.cards[lastEl.idx]; }

      if (isColumn) {
        if (!column.childElementCount) { legalMove = active.value === 13; }
        else { legalMove = active.color !== last.color && active.value === last.value - 1; }
      } else if (isPlaceholder) {
        if (!column.childElementCount) { legalMove = active.value === 1; }
        else { legalMove = active.color === last.color && active.suit === last.suit && active.value === last.value + 1; }
      }
      return legalMove;
    };

    Game.prototype.undo = function () {
      var index = this.history.length - 1; if (index > -1) {
        var obj = this.history[index];
        if (obj.deal) {
          var cards = [].slice.call(this.dealArea.children); var diff = this.dealArea.childElementCount - this.dealCount;
          var last = cards.splice(diff, this.dealCount);
          last.forEach(function (el) {
            var card = this.pack.cards[el.idx];
            if (card.flipped) { card.flip(); this.startParent.classList.toggle("empty", !this.startParent.childElementCount); }
            this.packArea.appendChild(el);
          }, this);
        } else {
          var card = obj.card; var last = obj.start.lastElementChild;
          if (last) {
            var lastCard = this.pack.cards[last.idx];
            if (obj.prevSibling) { if (!obj.prevSibling.prevState && lastCard.flipped) { lastCard.flip(); } }
          }
          obj.start.appendChild(card.el);
          if (obj.siblings.length) { obj.siblings.forEach(function (el) { obj.start.appendChild(el); }, this); }
          card.checked = false;
          obj.start.classList.toggle("empty", !obj.start.childElementCount);
          obj.end.classList.toggle("empty", !obj.end.childElementCount);
        }
        this.history.splice(index, 1);
      }
    };

    Game.prototype.deal = function () {
      var frag = document.createDocumentFragment(); var pack = [].slice.call(this.packArea.children); var count = pack.length;
      if (!count) {
        while (this.dealArea.childElementCount) { var card = this.pack.cards[this.dealArea.lastElementChild.idx]; card.flip(); frag.appendChild(card.el); }
        this.packArea.appendChild(frag); return false;
      }
      this.dealer.classList.add("dealing"); this.startParent = this.packArea;
      var items; if (count > 3) { items = pack.slice(Math.max(count - 3, 1)); } else { items = pack; }
      this.dealCount = items.length;

      items.forEach((card, i) => {
        if (card) {
          card = this.pack.cards[card.idx];
          const crect = rect(card.el); const prect = rect(this.dealArea);
          const x = crect.left - prect.left; const y = crect.top - prect.top;
          this.dealArea.appendChild(card.el);
          card.el.style.cssText = `transform: translate3d(${x}px,${y}px,0px) rotateY(180deg);`;
          setTimeout(() => {
            card.el.style.cssText = `transform-origin: 50% 50%;transform: translate3d(0px,0px,0px) rotateY(0deg); transition: transform ${this.animationInterval}ms;`;
            card.flip();
            card.el.style.cssText = "";
            if (i === items.length - 1) { setTimeout(() => { this.dealer.classList.remove("dealing"); }, 250); }
          }, this.animationInterval * i);
        }
      }, this);

      this.updateHistory([]);
    };

    Game.prototype.check = function () {
      this.checked = false;
      var columns = [].slice.call(this.columns.children); var holders = this.stacks.children;
      columns.push(this.dealArea);
      columns.forEach((column) => {
        var c = column.lastElementChild;
        if (c) {
          var card = this.pack.cards[c.idx]; var start = card.el.parentNode;
          each(holders, function (i, holder) {
            if (this.isLegalMove(card, holder) && !card.checked) {
              this.checked = true; card.checked = true;
              var prev = card.el.previousElementSibling;
              if (prev) { var prevCard = this.pack.cards[prev.idx]; if (!prevCard.flipped) { prevCard.flip(); this.score += 5; } }
              this.updateHistory(card, card.el.parentNode, holder);

              var crect = rect(card.el); var prect = rect(holder);
              var x = crect.left - prect.left; var y = crect.top - prect.top;
              this.updateScore(card.el.parentNode, holder);
              holder.appendChild(card.el); start.classList.toggle("empty", !start.childElementCount);
              card.el.style.cssText = "transform: translate3d(" + x + "px," + y + "px,0px);";
              card.el.offsetTop; /* repaint */
              card.el.style.cssText = "transform: translate3d(0px,0px,0px); transition: transform " + this.animationInterval + "ms;";
              setTimeout(() => { card.el.style.transform = ""; }, this.animationInterval);
              this.emit("change");
            }
          }, this);
        }
      }, this);

      var count = 0; each(this.stacks.children, function (i, stack) { count += stack.childElementCount; });
      this.won = false;
      if (count === 52) { setTimeout(() => { this.win(); }, this.animationInterval); return false; }
      if (this.checked) { setTimeout(() => { this.check(); }, this.animationInterval); }
    };

    Game.prototype.start = function () {
      var columns = this.columns; var pack = this.packArea;
      this.reset(); this.pack.shuffle();
      var current = 0, start = 0;
      for (var i = 0; i < 28; i++) {
        var card = this.pack.cards[i];
        columns.children[current].appendChild(card.el);
        if (start === current) { card.flip(); }
        current++; if (current === 7) { start++; current = start; }
      }
      for (var i = 28; i < 52; i++) { pack.appendChild(this.pack.cards[i].el); }
      this.packArea.parentNode.replaceChild(pack, this.packArea);
      this.columns.parentNode.replaceChild(columns, this.columns);
      this.packArea = pack; this.columns = columns;
      this.emit("start");
    };

    Game.prototype.hint = function () {
      this.hinted = false;
      var columns = [].slice.call(this.columns.children); columns.push(this.dealArea);
      each(this.stacks, function (i, stack) { columns.push(stack); });
      each(columns, function (i, column) {
        var c = (column === this.dealArea) ? column.lastElementChild : column.getElementsByClassName("flipped")[0];
        if (c) {
          var card = this.pack.cards[c.idx]; var isLast, siblings = [];
          var nodeIndex = [].slice.call(card.el.parentNode.children).indexOf(card.el);
          if (card.el.previousElementSibling) { if (card.el.parentNode === this.dealArea) { isLast = true; } else { isLast = !card.el.previousElementSibling.classList.contains("flipped"); } }
          if (card.value === 1 || card.el.parentNode.childElementCount === 1) { isLast = true; }
          if (card.value === 13 && card.el.parentNode.classList.contains("column") && card.el.parentNode.childElementCount === 1) { return false; }
          each(card.el.parentNode.children, function (i, node) { if (i > nodeIndex) { siblings.push(node); } });
          each(columns, function (idx, col) {
            if (this.isLegalMove(card, col) && isLast && !this.hinted) {
              var lastCard, last = col.lastElementChild; if (last) { lastCard = this.pack.cards[last.idx].el; } else { if (card.value === 13) { lastCard = col; } }
              card.el.classList.add("hint"); if (siblings.length) { each(siblings, function (i, node) { node.classList.add("hint"); }); }
              setTimeout(function () {
                card.el.classList.remove("hint"); if (siblings.length) { each(siblings, function (i, node) { node.classList.remove("hint"); }); }
                lastCard.classList.add("hint"); setTimeout(function () { lastCard.classList.remove("hint"); }, 500);
              }, 500);
              this.hinted = true; this.score -= 20;
            }
          }, this);
        }
      }, this);
    };

    Game.prototype.reset = function () {
      this.score = 0; this.history = [];
      if (this.won) { this.won = false; document.body.removeChild(this.canvas); }
      this.pack.cards.forEach(function (card) { if (card.flipped) { card.flip(); } card.checked = false; });
      Array.from(this.columns.children).forEach(function (column) { column.classList.remove("empty"); });
      Array.from(this.stacks.children).forEach(function (stack) { stack.classList.remove("empty"); });
    };

    Game.prototype.win = function () {
      if (this.won) { return false; }
      this.won = true;
      var rects = [], suits = [];
      this.pack.cards.forEach(function (card) { card.el.style.transform = ""; });
      each(this.stacks.children, function (i, stack) {
        rects.push(rect(stack));
        var last = stack.lastElementChild; var card = this.pack.cards[last.idx];
        suits.push(card.suit);
      }, this);

      this.canvas = document.createElement("canvas");
      var that = this; var ctx = this.canvas.getContext("2d");
      var w = this.canvas.width = window.innerWidth; var h = this.canvas.height = window.innerHeight;
      var gravity, wind; var pos = new Vector(rects[0].left, rects[0].top); var vel = new Vector(0, -getRandomInt(25, 30));
      var sWidth = 125; var sHeight = 188; var frame = null; var x = 0; var sx = sWidth * 12; var sy = 0;

      var init = function () { document.body.appendChild(that.canvas); setGravity(); setWind(); draw(); };
      var setGravity = function () { gravity = new Vector(0, getRandomInt(1, 9)); };
      var setWind = function () { var a = [-1, 1]; var r = a[Math.floor(Math.random() * a.length)]; var w2 = getRandomInt(5, 15); wind = new Vector(w2 * r, 0); };
      var outline = function (p, w, h) {
        var r = 5;
        var points = [[p.x + r, p.y],[p.x + w - r, p.y],[p.x + w, p.y + r],[p.x + w, p.y + h - r],[p.x + w - r, p.y + h],[p.x + r, p.y + h],[p.x, p.y + h - r],[p.x, p.y + r]];
        ctx.beginPath(); ctx.lineWidth = 2; ctx.strokeStyle = "#333";
        ctx.moveTo(points[0][0], points[0][1]); ctx.lineTo(points[1][0], points[1][1]); ctx.arc(points[1][0], points[2][1], r, 1.5 * Math.PI, 2 * Math.PI);
        ctx.moveTo(points[2][0], points[2][1]); ctx.lineTo(points[3][0], points[3][1]); ctx.arc(points[4][0], points[3][1], r, 2 * Math.PI, 2.5 * Math.PI);
        ctx.moveTo(points[4][0], points[4][1]); ctx.lineTo(points[5][0], points[5][1]); ctx.arc(p.x + r, p.y + h - r, r, 2.5 * Math.PI, 3 * Math.PI);
        ctx.moveTo(points[6][0], points[6][1]); ctx.lineTo(points[7][0], points[7][1]); ctx.arc(points[5][0], points[7][1], r, 3 * Math.PI, 3.5 * Math.PI);
        ctx.stroke();
      };

      var draw = function () {
        frame = requestAnimationFrame(draw);
        var img = that.images[suits[x]];
        var dWidth = sWidth; var dHeight = sHeight;
        vel.add(gravity); pos.add(vel); pos.add(wind);
        if (pos.y >= h - sHeight) { pos.y = h - sHeight; vel.y = -vel.y; }
        ctx.fillStyle = "#FFFFFF";
        ctx.drawImage(img, sx, sy, sWidth, sHeight, pos.x, pos.y, dWidth, dHeight);
        outline(pos, sWidth, sHeight);
        if (pos.x < 0 - sWidth || pos.x > w) {
          if (x < 3) { x++; } else { x = 0; sx -= sWidth; }
          if (sx > 0 - sWidth) { pos = new Vector(rects[x].left, rects[x].top); vel = new Vector(0, -getRandomInt(25, 30)); setGravity(); setWind(); }
        }
      };

      init(); setGravity(); setWind();
    };

    Game.prototype.cheat = function () {
      var that = this; this.checked = false;
      var columns = [].slice.call(this.columns.children); var holders = this.stacks.children;
      columns.push(this.dealArea);
      each(this.pack.suits, function (i, suit) {
        var el, card, s; for (var n = 1; n < 14; n++) {
          s = n; if (n > 10) { if (n===11) s="J"; else if (n===12) s="Q"; else if (n===13) s="K"; }
          el = document.querySelector(".card."+suit+".card-"+s); card = this.pack.cards[el.idx];
          var prev = card.el.previousElementSibling;
          if (!card.flipped && card.el.parentNode !== this.packArea) { card.flip(); }
          if (prev && card.el.parentNode !== this.packArea) { var prevCard = this.pack.cards[prev.idx]; if (!prevCard.flipped) { prevCard.flip(); this.score += 5; } }
          var crect = rect(card.el); var prect = rect(holders[i]); var x = crect.left - prect.left; var y = crect.top - prect.top;
          holders[i].appendChild(card.el);
          card.el.style.cssText = "transform: translate3d(" + x + "px," + y + "px,0px);";
          card.el.offsetTop;
          card.el.style.cssText = "transform: translate3d(0px,0px,0px); transition: transform " + this.animationInterval + "ms;";
          setTimeout(function () { card.el.style.transform = ""; }, this.animationInterval);
        }
      }, this);
      setTimeout(function () { that.win(); }, this.animationInterval);
    };

    global.Game = Game;
  })(this);

  /* ==== INIT: simpele, niet-geobfusceerde bootstrap (vervangt de oude domein-check) ==== */
  (function(){
    var controls = document.getElementById('controls');
    var score    = document.getElementById('score');
    var game     = new Game('#spelcontainer');

    game.start();
    game.on('start',  function(){ score.textContent = 'Score: ' + this.score; });
    game.on('change', function(){ score.textContent = 'Score: ' + this.score; });

    controls.addEventListener('click', function(e){
      var btn = e.target;
      if (btn && btn.nodeName === 'BUTTON') {
        var action = btn.getAttribute('data-action');
        if (action && typeof game[action] === 'function') { game[action](); }
      }
    }, false);
  })();
  </script>
</body>
</html>
