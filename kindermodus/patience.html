<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Patience ‚Äì Orthodoxe Kinderpagina</title>
  <link rel="icon" href="images/kruis.png" />

  <style>
    :root{
      --primair:#7bb235; --donker:#67510C;
      --pastel1:#fff6e5; --pastel2:#fffde6; --pastel3:#ffe8ec; --pastel4:#e7f8ff;
      --pastel5:#e6ffe5; --pastel6:#fff2fb; --pastel7:#f5ffe5; --pastel8:#f5e8ff;
      --pastel9:#fff6fb; --pastel10:#e7fff9; --pastel11:#f3e6ff; --pastel12:#ffeae6;
      --pastel13:#ecffe9; --pastel14:#f7fff3; --pastel15:#eafffa; --pastel16:#fff4ea;
    }
    body{
      margin:0; font-family:'Comic Sans MS', Arial, sans-serif; color:#333;
      min-height:100vh; background:var(--pastel1); transition:background .6s;
    }
    main{ max-width:1300px; margin:20px auto; padding:0 16px; text-align:center }

    #gameWrapper{
      margin:20px auto; padding:16px;
      background:#fffef9; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.2);
    }
    #topRow{
      display:flex; justify-content:space-between; margin-bottom:20px;
    }
    .pileRow{
      display:flex; justify-content:space-between; gap:8px;
    }
    .pile{
      width:100px; height:140px; border:2px dashed #aaa; border-radius:8px;
      position:relative; background:#fafafa; flex-shrink:0;
    }
    .card{
      width:100px; height:140px; border-radius:8px;
      background:#fff; position:absolute; top:0; left:0;
      display:flex; align-items:center; justify-content:center;
      font-size:38px; font-weight:bold; cursor:grab;
      user-select:none; box-shadow:0 2px 6px rgba(0,0,0,0.3);
    }
    .card .corner{
      position:absolute; font-size:16px; font-weight:bold;
    }
    .tl{top:4px; left:6px;}
    .tr{top:4px; right:6px;}
    .bl{bottom:4px; left:6px;}
    .br{bottom:4px; right:6px;}
    .hidden{
      background:var(--primair); color:transparent; cursor:default;
    }
    .dragging{ opacity:0.6; }
    .over{ border:2px solid var(--primair); }

    #rules{
      margin-top:30px; padding:16px;
      background:#fffef9; border:1.5px solid #f1e6c8; border-radius:12px;
      text-align:left; max-width:800px; margin-left:auto; margin-right:auto;
    }
    #status{ margin-top:20px; font-weight:bold; }
    .btn{
      background:var(--primair); color:#fff; border:none; border-radius:8px;
      padding:8px 14px; font-weight:bold; cursor:pointer; margin:4px;
    }
  </style>
  <script defer src="common/layout.js"></script>
</head>
<body>
  <div id="kinder-header" data-header-src="common/header.html"></div>

  <main>
    <h1>Patience (Solitair)</h1>
    <button id="startBtn" class="btn">Nieuw spel starten</button>
    <div id="status"></div>

    <div id="gameWrapper" style="display:none;">
      <div id="topRow">
        <div id="foundations" style="display:flex; gap:8px;">
          <div class="pile" data-foundation="0"></div>
          <div class="pile" data-foundation="1"></div>
          <div class="pile" data-foundation="2"></div>
          <div class="pile" data-foundation="3"></div>
        </div>
        <div id="stockWaste" style="display:flex; gap:8px;">
          <div id="stock" class="pile"></div>
          <div id="waste" class="pile"></div>
        </div>
      </div>

      <div id="tableau" class="pileRow">
        <div class="pile" data-tableau="0"></div>
        <div class="pile" data-tableau="1"></div>
        <div class="pile" data-tableau="2"></div>
        <div class="pile" data-tableau="3"></div>
        <div class="pile" data-tableau="4"></div>
        <div class="pile" data-tableau="5"></div>
        <div class="pile" data-tableau="6"></div>
      </div>
    </div>

    <div id="rules">
      <h2>Spelregels</h2>
      <p>Patience (Solitaire) wordt gespeeld met 52 kaarten.</p>
      <ul>
        <li><b>Doel:</b> alle kaarten naar de vier foundations stapelen per symbool (üòá ‚úùÔ∏è üìñ üôè) van Aas tot Koning.</li>
        <li><b>Tableau:</b> aflopend en afwisselend van kleur neerleggen.</li>
        <li>Een lege tableau mag enkel door een Koning gevuld worden.</li>
        <li><b>Stock:</b> klik om telkens 1 kaart naar de waste te draaien.</li>
        <li>Alleen open kaarten zijn speelbaar.</li>
        <li>Je wint wanneer alle kaarten op de foundations liggen.</li>
      </ul>
    </div>
  </main>

  <script>
    // Achtergrond
    (function(){
      const p=['var(--pastel1)','var(--pastel2)','var(--pastel3)','var(--pastel4)',
               'var(--pastel5)','var(--pastel6)','var(--pastel7)','var(--pastel8)',
               'var(--pastel9)','var(--pastel10)','var(--pastel11)','var(--pastel12)',
               'var(--pastel13)','var(--pastel14)','var(--pastel15)','var(--pastel16)'];
      document.body.style.background=p[Math.floor(Math.random()*p.length)];
    })();
    // Header
    (function boot(){
      if (!(window.KinderLayout)) return setTimeout(boot,120);
      const el=document.getElementById('kinder-header');
      window.KinderLayout.mountHeader({ rootId:'kinder-header', headerSrc:el.dataset.headerSrc, active:'spelletjes' });
    })();

    // SYMBOLEN
    const suits=[
      {icon:"üòá", color:"red"},
      {icon:"‚úùÔ∏è", color:"black"},
      {icon:"üìñ", color:"red"},
      {icon:"üôè", color:"black"}
    ];
    const ranks=["A","2","3","4","5","6","7","8","9","10","J","Q","K"];
    let deck=[], stock=[], waste=[], tableau=[[],[],[],[],[],[],[]], foundations=[[],[],[],[]];

    function createDeck(){
      deck=[];
      for(let s=0;s<4;s++){ for(let r=0;r<13;r++){ deck.push({suit:s,rank:r,faceUp:false}); } }
      deck.sort(()=>Math.random()-0.5);
    }

    function deal(){
      tableau=[[],[],[],[],[],[],[]]; foundations=[[],[],[],[]]; waste=[]; stock=[];
      let index=0;
      for(let i=0;i<7;i++){
        for(let j=0;j<=i;j++){
          const c=deck[index++];
          c.faceUp=(j===i);
          tableau[i].push(c);
        }
      }
      stock=deck.slice(index);
      render();
    }

    function render(){
      document.querySelectorAll(".pile").forEach(p=>p.innerHTML="");
      tableau.forEach((pile,pi)=>{
        const pileEl=document.querySelector(`.pile[data-tableau="${pi}"]`);
        pile.forEach((card,ci)=>{
          const c=renderCard(card);
          c.style.top=(ci*25)+"px";
          c.draggable=card.faceUp;
          addDragEvents(c,pi,ci);
          pileEl.appendChild(c);
        });
      });
      foundations.forEach((pile,pi)=>{
        const pileEl=document.querySelector(`.pile[data-foundation="${pi}"]`);
        if(pile.length){ pileEl.appendChild(renderCard(pile[pile.length-1])); }
      });
      if(waste.length){ 
        const card=waste[waste.length-1];
        const el=renderCard(card);
        el.draggable=true;
        addDragEvents(el,"waste",waste.length-1);
        document.getElementById("waste").appendChild(el);
      }
      if(stock.length){ 
        const back=document.createElement("div"); back.className="card hidden";
        document.getElementById("stock").appendChild(back);
      }
      checkWin();
    }

    function renderCard(card){
      const el=document.createElement("div");
      el.className="card"+(card.faceUp?"":" hidden");
      if(card.faceUp){
        const s=suits[card.suit]; const rank=ranks[card.rank];
        el.innerHTML=`<div class="corner tl" style="color:${s.color}">${rank}${s.icon}</div>
                      <div class="corner tr" style="color:${s.color}">${rank}${s.icon}</div>
                      <div>${s.icon}</div>
                      <div class="corner bl" style="color:${s.color}">${rank}${s.icon}</div>
                      <div class="corner br" style="color:${s.color}">${rank}${s.icon}</div>`;
      }
      return el;
    }

    function drawStock(){
      if(stock.length){ const c=stock.pop(); c.faceUp=true; waste.push(c); render(); }
      else{ stock=waste.reverse().map(c=>{c.faceUp=false; return c;}); waste=[]; render(); }
    }

    function addDragEvents(cardEl,srcPile,ci){
      cardEl.addEventListener("dragstart",e=>{
        e.dataTransfer.setData("text/plain",JSON.stringify({srcPile,ci}));
        setTimeout(()=>cardEl.classList.add("dragging"),0);
      });
      cardEl.addEventListener("dragend",()=>cardEl.classList.remove("dragging"));
    }

    document.querySelectorAll(".pile").forEach(pile=>{
      pile.addEventListener("dragover",e=>{ e.preventDefault(); pile.classList.add("over"); });
      pile.addEventListener("dragleave",()=>pile.classList.remove("over"));
      pile.addEventListener("drop",e=>{
        pile.classList.remove("over");
        const data=JSON.parse(e.dataTransfer.getData("text/plain"));
        moveCard(data,pile);
      });
    });

    function moveCard(data,targetPile){
      let src=data.srcPile, ci=data.ci, moving;
      if(src==="waste"){ moving=waste.splice(ci); }
      else{ moving=tableau[src].splice(ci); if(tableau[src].length && !tableau[src].at(-1).faceUp) tableau[src].at(-1).faceUp=true; }
      // Foundations
      if(targetPile.dataset.foundation!==undefined){
        let idx=parseInt(targetPile.dataset.foundation), pile=foundations[idx];
        if(canPlaceFoundation(moving[0],pile)){ pile.push(...moving); render(); return; }
      }
      // Tableau
      if(targetPile.dataset.tableau!==undefined){
        let idx=parseInt(targetPile.dataset.tableau), pile=tableau[idx];
        if(canPlaceTableau(moving[0],pile)){ pile.push(...moving); render(); return; }
      }
      // Ongeldige zet -> terug
      if(src==="waste") waste.push(...moving);
      else tableau[src].push(...moving);
      render();
    }

    function canPlaceFoundation(card,pile){
      if(!card.faceUp) return false;
      if(!pile.length) return card.rank===0;
      const top=pile.at(-1);
      return card.suit===top.suit && card.rank===top.rank+1;
    }
    function canPlaceTableau(card,pile){
      if(!card.faceUp) return false;
      if(!pile.length) return card.rank===12;
      const top=pile.at(-1);
      return card.rank===top.rank-1 && suits[card.suit].color!==suits[top.suit].color;
    }

    function checkWin(){
      if(foundations.every(p=>p.length===13)){
        document.getElementById("status").textContent="üéâ Je hebt gewonnen!";
      }
    }

    document.getElementById("stock").addEventListener("click",()=>drawStock());
    document.getElementById("startBtn").addEventListener("click",()=>{
      createDeck(); deal();
      document.getElementById("gameWrapper").style.display="block";
      document.getElementById("startBtn").style.display="none";
      document.getElementById("status").textContent="Het spel is gestart!";
    });
  </script>
</body>
</html>
