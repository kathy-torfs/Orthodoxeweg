<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Patience â€“ Orthodoxe Kinderpagina</title>
  <link rel="icon" href="images/kruis.png" />

  <style>
    :root{
      --primair:#7bb235; --donker:#67510C;
      --pastel1:#fff6e5; --pastel2:#fffde6; --pastel3:#ffe8ec; --pastel4:#e7f8ff;
      --pastel5:#e6ffe5; --pastel6:#fff2fb; --pastel7:#f5ffe5; --pastel8:#f5e8ff;
      --pastel9:#fff6fb; --pastel10:#e7fff9; --pastel11:#f3e6ff; --pastel12:#ffeae6;
      --pastel13:#ecffe9; --pastel14:#f7fff3; --pastel15:#eafffa; --pastel16:#fff4ea;
    }
    body{
      margin:0; font-family:'Comic Sans MS', Arial, sans-serif; color:#333;
      min-height:100vh; background:var(--pastel1); transition:background .6s;
    }
    main{ max-width:1200px; margin:20px auto; padding:0 16px; text-align:center }

    h1{ color:var(--primair); }

    #game{
      display:flex;
      flex-direction:column;
      align-items:center;
    }

    .row{
      display:flex;
      justify-content:space-between;
      width:100%;
      max-width:1100px;
      margin-bottom:20px;
    }

    .pile{
      width:90px; height:130px;
      border:2px dashed #ccc;
      border-radius:8px;
      position:relative;
      margin:0 4px;
    }
    .pile.foundation{ background:#fafafa; }
    .pile.stock{ background:#ddd; cursor:pointer; }

    .card{
      width:90px; height:130px;
      border-radius:8px;
      border:1px solid #333;
      position:absolute;
      background:white;
      cursor:pointer;
      user-select:none;
    }
    .card.face-down{
      background:#7bb235;
      border:2px solid #333;
    }

    .card .rank{
      position:absolute;
      font-size:14px;
      font-weight:bold;
    }
    .card .rank.tl{ top:4px; left:6px; }
    .card .rank.tr{ top:4px; right:6px; }
    .card .rank.bl{ bottom:4px; left:6px; }
    .card .rank.br{ bottom:4px; right:6px; }
    .card .icon{
      font-size:36px;
      display:flex;
      align-items:center;
      justify-content:center;
      height:100%;
    }

    /* kleur per soort */
    .hearts, .diamonds{ color:#e53935; }
    .spades, .clubs{ color:#000; }
    .pastel1{ background:var(--pastel3); }
    .pastel2{ background:var(--pastel4); }
    .pastel3{ background:var(--pastel6); }
    .pastel4{ background:var(--pastel10); }
  </style>

  <script defer src="common/layout.js"></script>
</head>
<body>
  <div id="kinder-header" data-header-src="common/header.html"></div>

  <main>
    <h1>Patience (Solitaire)</h1>
    <button id="startBtn" class="btn">Spel starten (20 punten)</button>
    <div id="status"></div>

    <div id="game" style="display:none;">
      <!-- Bovenste rij -->
      <div class="row">
        <div id="foundations" style="display:flex;gap:12px;">
          <div class="pile foundation" data-foundation="0"></div>
          <div class="pile foundation" data-foundation="1"></div>
          <div class="pile foundation" data-foundation="2"></div>
          <div class="pile foundation" data-foundation="3"></div>
        </div>
        <div id="stockWaste" style="display:flex;gap:12px;">
          <div id="stock" class="pile stock"></div>
          <div id="waste" class="pile"></div>
        </div>
      </div>

      <!-- Tableau -->
      <div id="tableau" class="row" style="justify-content:center;">
        <div class="pile tableau" data-tableau="0"></div>
        <div class="pile tableau" data-tableau="1"></div>
        <div class="pile tableau" data-tableau="2"></div>
        <div class="pile tableau" data-tableau="3"></div>
        <div class="pile tableau" data-tableau="4"></div>
        <div class="pile tableau" data-tableau="5"></div>
        <div class="pile tableau" data-tableau="6"></div>
      </div>
    </div>
  </main>

  <script>
    // Achtergrond
    (function(){
      const p=['var(--pastel1)','var(--pastel2)','var(--pastel3)','var(--pastel4)',
               'var(--pastel5)','var(--pastel6)','var(--pastel7)','var(--pastel8)',
               'var(--pastel9)','var(--pastel10)','var(--pastel11)','var(--pastel12)',
               'var(--pastel13)','var(--pastel14)','var(--pastel15)','var(--pastel16)'];
      document.body.style.background=p[Math.floor(Math.random()*p.length)];
    })();

    // Header
    (function boot(){
      if (!(window.KinderLayout)) return setTimeout(boot,120);
      const el=document.getElementById('kinder-header');
      window.KinderLayout.mountHeader({ rootId:'kinder-header', headerSrc:el.dataset.headerSrc, active:'spelletjes' });
    })();

    // Kaartdefinitie
    const suits = [
      {name:"hearts", icon:"ðŸ™", color:"red"},
      {name:"spades", icon:"âœï¸", color:"black"},
      {name:"diamonds", icon:"ðŸ“–", color:"red"},
      {name:"clubs", icon:"ðŸ‘¼", color:"black"}
    ];
    const ranks = ["A","2","3","4","5","6","7","8","9","10","J","Q","K"];

    let stock=[], waste=[], foundations=[[],[],[],[]], tableau=[[],[],[],[],[],[],[]];

    // Maak deck
    function makeDeck(){
      const deck=[];
      suits.forEach((suit,s)=>{
        ranks.forEach((rank,r)=>{
          deck.push({suit:suit.name, icon:suit.icon, rank, value:r+1, color:suit.color});
        });
      });
      for(let i=deck.length-1;i>0;i--){
        const j=Math.floor(Math.random()* (i+1));
        [deck[i],deck[j]]=[deck[j],deck[i]];
      }
      return deck;
    }

    // Bouw bord
    function deal(){
      stock=[]; waste=[]; foundations=[[],[],[],[]]; tableau=[[],[],[],[],[],[],[]];
      const deck=makeDeck();
      for(let i=0;i<7;i++){
        for(let j=0;j<=i;j++){
          const card=deck.pop();
          card.faceUp=(j===i);
          tableau[i].push(card);
        }
      }
      stock=deck;
      render();
    }

    function render(){
      document.querySelectorAll('.pile').forEach(p=>p.innerHTML="");

      // Foundations
      foundations.forEach((f,i)=>{
        if(f.length){
          const c=f[f.length-1];
          document.querySelector(`.pile.foundation[data-foundation="${i}"]`).appendChild(renderCard(c,true));
        }
      });

      // Stock
      const stockEl=document.getElementById("stock");
      if(stock.length){
        const back=document.createElement("div");
        back.className="card face-down";
        stockEl.appendChild(back);
      }

      // Waste
      if(waste.length){
        const c=waste[waste.length-1];
        document.getElementById("waste").appendChild(renderCard(c,true));
      }

      // Tableau
      tableau.forEach((pile,i)=>{
        const pileEl=document.querySelector(`.pile.tableau[data-tableau="${i}"]`);
        pile.forEach((c,idx)=>{
          const el=renderCard(c,c.faceUp);
          el.style.top=(idx*25)+"px";
          pileEl.appendChild(el);
        });
      });
    }

    function renderCard(card,faceUp){
      const el=document.createElement("div");
      el.className="card pastel"+((card.value%4)+1);
      if(!faceUp){ el.classList.add("face-down"); return el; }

      const ranksHTML = `
        <div class="rank tl ${card.suit}">${card.rank}</div>
        <div class="rank tr ${card.suit}">${card.rank}</div>
        <div class="rank bl ${card.suit}">${card.rank}</div>
        <div class="rank br ${card.suit}">${card.rank}</div>
      `;
      const iconHTML = `<div class="icon">${card.icon}</div>`;
      el.innerHTML = ranksHTML + iconHTML;
      return el;
    }

    // Event listeners
    document.getElementById("stock").addEventListener("click",()=>{
      if(!stock.length){
        stock=waste.reverse().map(c=>(c.faceUp=false,c));
        waste=[];
      }else{
        const c=stock.pop();
        c.faceUp=true;
        waste.push(c);
      }
      render();
    });

    document.getElementById("startBtn").addEventListener("click",()=>{
      // 20 punten aftrek (Firestore)
      console.log("20 punten aftrekken!");
      document.getElementById("startBtn").style.display="none";
      document.getElementById("game").style.display="flex";
      deal();
    });
  </script>
</body>
</html>
