<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Patience ‚Äì Orthodoxe Kinderpagina</title>
  <link rel="icon" href="images/kruis.png" />

  <style>
    :root{
      --primair:#7bb235; --donker:#67510C;
      --pastel1:#fff6e5; --pastel2:#fffde6; --pastel3:#ffe8ec; --pastel4:#e7f8ff;
      --pastel5:#e6ffe5; --pastel6:#fff2fb; --pastel7:#f5ffe5; --pastel8:#f5e8ff;
      --pastel9:#fff6fb; --pastel10:#e7fff9; --pastel11:#f3e6ff; --pastel12:#ffeae6;
      --pastel13:#ecffe9; --pastel14:#f7fff3; --pastel15:#eafffa; --pastel16:#fff4ea;
    }
    body{
      margin:0; font-family:'Comic Sans MS', Arial, sans-serif; color:#333;
      background:var(--pastel1); transition:background .6s;
    }
    main{ max-width:1200px; margin:20px auto; padding:0 16px; text-align:center }

    .board{display:flex; flex-direction:column; align-items:center; margin-top:20px}
    .top-row{display:flex; justify-content:space-between; width:100%; max-width:1100px; margin-bottom:40px}
    .foundations, .stock-waste{display:flex; gap:12px}
    .tableau{display:flex; gap:12px; justify-content:center}

    .pile{
      width:90px; min-height:120px;
      border:2px dashed #aaa; border-radius:8px;
      position:relative; background:rgba(255,255,255,0.3);
    }

    .card{
      width:90px; height:120px;
      border-radius:8px; background:#fff;
      position:absolute; cursor:pointer;
      display:flex; align-items:center; justify-content:center;
      font-size:36px; font-weight:bold;
      user-select:none;
    }
    .card.red{color:red;}
    .card.black{color:black;}
    .card span.corner{
      font-size:14px; position:absolute;
    }
    .card .tl{top:4px; left:6px}
    .card .tr{top:4px; right:6px}
    .card .bl{bottom:4px; left:6px}
    .card .br{bottom:4px; right:6px}
    .hidden{background:#7bb235; color:transparent; cursor:default}

    .btn{
      background:var(--primair); color:#fff; border:none; border-radius:8px;
      padding:8px 14px; font-weight:bold; cursor:pointer; margin:4px;
    }

    #status{margin-top:16px; font-weight:bold}
  </style>

  <script defer src="common/layout.js"></script>
</head>
<body>
  <div id="kinder-header" data-header-src="common/header.html"></div>

  <main>
    <h1>Patience üÉèüôè</h1>
    <div>
      Kies level:
      <select id="level">
        <option value="1">Level 1 ‚Äì 1 kaart draaien</option>
        <option value="2">Level 2 ‚Äì 2 kaarten draaien</option>
        <option value="3">Level 3 ‚Äì 3 kaarten draaien</option>
      </select>
      <button id="startBtn" class="btn">Spel starten (20 punten)</button>
      <button id="resetBtn" class="btn" style="display:none;">Opnieuw spelen</button>
    </div>

    <div class="board">
      <div class="top-row">
        <div class="foundations" id="foundations"></div>
        <div class="stock-waste">
          <div class="pile" id="stock"></div>
          <div class="pile" id="waste"></div>
        </div>
      </div>
      <div class="tableau" id="tableau"></div>
    </div>

    <div id="status"></div>

    <section style="margin-top:30px; text-align:left; max-width:800px; margin-left:auto; margin-right:auto">
      <h2>Spelregels</h2>
      <p>Het doel van Patience is om alle kaarten in de <b>vier fundament-stapels</b> linksboven te leggen, oplopend van Aas tot Koning.</p>
      <ul>
        <li>Op de tableau (de 7 rijen onderaan) leg je aflopend en afwisselend rood en zwart.</li>
        <li>Op een lege tableau mag alleen een Koning worden gelegd.</li>
        <li>Uit de stock (rechtsboven) draai je 1, 2 of 3 kaarten per keer, afhankelijk van het gekozen level.</li>
        <li>Je kan kaarten van de waste naar de tableau of naar de fundamenten slepen.</li>
      </ul>
    </section>
  </main>

  <script>
    // Achtergrond wisselen
    (function(){
      const p=['var(--pastel1)','var(--pastel2)','var(--pastel3)','var(--pastel4)',
               'var(--pastel5)','var(--pastel6)','var(--pastel7)','var(--pastel8)',
               'var(--pastel9)','var(--pastel10)','var(--pastel11)','var(--pastel12)',
               'var(--pastel13)','var(--pastel14)','var(--pastel15)','var(--pastel16)'];
      document.body.style.background=p[Math.floor(Math.random()*p.length)];
    })();

    // Header
    (function boot(){
      if (!(window.KinderLayout)) return setTimeout(boot,120);
      const el=document.getElementById('kinder-header');
      window.KinderLayout.mountHeader({ rootId:'kinder-header', headerSrc:el.dataset.headerSrc, active:'spelletjes' });
    })();

    // ICONS
    const icons=["‚úùÔ∏è","üìñ","üôè","üëº"]; // kruis, bijbel, handen, engel
    const suits=[0,1,2,3]; // 4 sets
    const ranks=[1,2,3,4,5,6,7,8,9,10,11,12,13];

    let deck=[], stock=[], waste=[], foundations=[[],[],[],[]], tableau=[];
    let drawCount=1;

    function buildDeck(){
      deck=[];
      suits.forEach(s=>{
        ranks.forEach(r=>{
          deck.push({suit:s, rank:r});
        });
      });
      for(let i=deck.length-1;i>0;i--){
        const j=Math.floor(Math.random()*(i+1));
        [deck[i],deck[j]]=[deck[j],deck[i]];
      }
    }

    function startGame(){
      drawCount=parseInt(document.getElementById("level").value);
      buildDeck();
      stock=[...deck]; waste=[]; foundations=[[],[],[],[]]; tableau=[];
      for(let i=0;i<7;i++){
        tableau[i]=stock.splice(0,i+1);
      }
      render();
      document.getElementById("status").textContent="Spel gestart!";
    }

    function cardColor(card){ return (card.suit===0||card.suit===2)?"red":"black"; }
    function cardSymbol(card){ return icons[card.suit]; }
    function cardRankName(r){
      if(r===1) return "A"; if(r===11) return "J"; if(r===12) return "Q"; if(r===13) return "K"; return r;
    }

    function render(){
      const foundationsEl=document.getElementById("foundations");
      foundationsEl.innerHTML="";
      foundations.forEach(f=>{
        const pile=document.createElement("div");
        pile.className="pile";
        if(f.length){
          pile.appendChild(renderCard(f[f.length-1]));
        }
        foundationsEl.appendChild(pile);
      });

      const stockEl=document.getElementById("stock");
      stockEl.innerHTML="";
      if(stock.length){
        const c=document.createElement("div");
        c.className="card hidden";
        stockEl.appendChild(c);
      }else{
        stockEl.onclick=()=>{stock=waste.reverse();waste=[];render();};
      }

      const wasteEl=document.getElementById("waste");
      wasteEl.innerHTML="";
      waste.slice(-drawCount).forEach((card,i)=>{
        const c=renderCard(card);
        c.style.left=(i*20)+"px";
        wasteEl.appendChild(c);
      });

      const tableauEl=document.getElementById("tableau");
      tableauEl.innerHTML="";
      tableau.forEach((pile,pi)=>{
        const pileEl=document.createElement("div");
        pileEl.className="pile";
        pile.forEach((card,ci)=>{
          const c=renderCard(card);
          c.style.top=(ci*25)+"px";
          pileEl.appendChild(c);
        });
        tableauEl.appendChild(pileEl);
      });
    }

    function renderCard(card){
      const el=document.createElement("div");
      el.className="card "+cardColor(card);
      el.innerHTML=`
        <span class="corner tl">${cardRankName(card.rank)}</span>
        <span class="corner tr">${cardRankName(card.rank)}</span>
        <div>${cardSymbol(card)}</div>
        <span class="corner bl">${cardRankName(card.rank)}</span>
        <span class="corner br">${cardRankName(card.rank)}</span>
      `;
      return el;
    }

    // Start knop
    document.getElementById("startBtn").addEventListener("click",async()=>{
      // punten aftrekken
      const points=20; // demo: zou firestore update doen
      console.log("20 punten afgetrokken");
      document.getElementById("startBtn").style.display="none";
      document.getElementById("resetBtn").style.display="inline-block";
      startGame();
    });
    document.getElementById("resetBtn").addEventListener("click",()=>location.reload());
  </script>
</body>
</html>
