<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Patience ‚Äì Orthodoxe Kinderpagina</title>
  <link rel="icon" href="images/kruis.png" />

  <style>
    :root{
      --primair:#7bb235; --donker:#67510C;
      --pastel1:#fff6e5; --pastel2:#fffde6; --pastel3:#ffe8ec; --pastel4:#e7f8ff;
      --pastel5:#e6ffe5; --pastel6:#fff2fb; --pastel7:#f5ffe5; --pastel8:#f5e8ff;
      --pastel9:#fff6fb; --pastel10:#e7fff9; --pastel11:#f3e6ff; --pastel12:#ffeae6;
      --pastel13:#ecffe9; --pastel14:#f7fff3; --pastel15:#eafffa; --pastel16:#fff4ea;
    }
    body{
      margin:0; font-family:'Comic Sans MS', Arial, sans-serif; color:#333;
      min-height:100vh; background:var(--pastel1); transition:background .6s;
    }
    main{ max-width:1200px; margin:20px auto; padding:0 16px; text-align:center }

    h1{ color:var(--primair); margin-bottom:16px }

    #gameArea{
      margin:20px auto; padding:20px; background:#fffef9;
      border:2px solid #e6d8a5; border-radius:12px;
      box-shadow:0 2px 8px rgba(0,0,0,0.15);
    }
    .board{
      display:flex; justify-content:space-between; margin-bottom:20px;
    }
    .pile{
      width:100px; height:140px; border:1.5px dashed #ccc;
      border-radius:8px; margin:0 4px; position:relative;
    }
    .card{
      width:100px; height:140px;
      border-radius:8px; background:white; border:1px solid #333;
      position:absolute; cursor:pointer;
      display:flex; justify-content:center; align-items:center;
      font-size:32px; font-weight:bold;
      user-select:none;
    }
    .card.red{ color:red }
    .card.black{ color:black }
    .card.back{ background:#7bb235; border:1px solid #333; color:transparent }

    .tableau{ display:flex; justify-content:center }
    .tableau .pile{ margin:0 6px }

    #rules{
      margin-top:30px; padding:16px; background:#fffef2;
      border:2px solid #e6d8a5; border-radius:12px; text-align:left;
    }
    #rules h2{ margin-top:0; color:var(--donker) }
  </style>

  <script defer src="common/layout.js"></script>
</head>
<body>
  <div id="kinder-header" data-header-src="common/header.html"></div>

  <main>
    <h1>Patience (Solitaire) üÉè</h1>
    <button id="newGameBtn" class="btn">Nieuw spel starten</button>

    <div id="gameArea">
      <div class="board">
        <div id="stock" class="pile"></div>
        <div id="waste" class="pile"></div>
        <div style="flex:1"></div>
        <div id="foundations">
          <div id="foundation0" class="pile"></div>
          <div id="foundation1" class="pile"></div>
          <div id="foundation2" class="pile"></div>
          <div id="foundation3" class="pile"></div>
        </div>
      </div>
      <div class="tableau">
        <div id="tableau0" class="pile"></div>
        <div id="tableau1" class="pile"></div>
        <div id="tableau2" class="pile"></div>
        <div id="tableau3" class="pile"></div>
        <div id="tableau4" class="pile"></div>
        <div id="tableau5" class="pile"></div>
        <div id="tableau6" class="pile"></div>
      </div>
    </div>

    <div id="rules">
      <h2>Spelregels</h2>
      <p>üÇ° Doel: bouw vier stapels op in de foundations, oplopend van Aas tot Koning per soort.</p>
      <p>üÇ° Je mag in de tableau aflopende reeksen vormen, waarbij rood en zwart elkaar afwisselen.</p>
      <p>üÇ° Alleen een Koning of een reeks die met een Koning begint mag in een lege stapel geplaatst worden.</p>
      <p>üÇ° Klik op de stock om √©√©n kaart naar de waste te draaien.</p>
      <p>üÇ° Je kan kaarten van de waste naar de tableau of foundations verplaatsen.</p>
      <p>üÇ° Het spel is gewonnen zodra alle vier de foundations compleet zijn van Aas tot Koning.</p>
    </div>
  </main>

  <script>
    // Achtergrond wisselen
    (function(){
      const p=['var(--pastel1)','var(--pastel2)','var(--pastel3)','var(--pastel4)',
               'var(--pastel5)','var(--pastel6)','var(--pastel7)','var(--pastel8)',
               'var(--pastel9)','var(--pastel10)','var(--pastel11)','var(--pastel12)',
               'var(--pastel13)','var(--pastel14)','var(--pastel15)','var(--pastel16)'];
      document.body.style.background=p[Math.floor(Math.random()*p.length)];
    })();

    // Header laden
    (function boot(){
      if (!(window.KinderLayout)) return setTimeout(boot,120);
      const el=document.getElementById('kinder-header');
      window.KinderLayout.mountHeader({ rootId:'kinder-header', headerSrc:el.dataset.headerSrc, active:'spelletjes' });
    })();

    // Solitaire logica
    const suits = ["‚ô†","‚ô•","‚ô£","‚ô¶"];
    const colors = {"‚ô†":"black","‚ô£":"black","‚ô•":"red","‚ô¶":"red"};
    let deck=[], stock=[], waste=[], foundations=[[],[],[],[]], tableaus=[[],[],[],[],[],[],[]];

    function createDeck(){
      deck=[];
      for(const s of suits){
        for(let v=1; v<=13; v++){
          deck.push({suit:s, value:v, color:colors[s], faceUp:false});
        }
      }
      deck.sort(()=>Math.random()-0.5);
    }

    function setup(){
      createDeck();
      waste=[]; foundations=[[],[],[],[]]; tableaus=[[],[],[],[],[],[],[]];
      for(let i=0;i<7;i++){
        for(let j=0;j<=i;j++){
          const card=deck.pop();
          if(j===i) card.faceUp=true;
          tableaus[i].push(card);
        }
      }
      stock=deck; deck=[];
      render();
    }

    function render(){
      renderPile("stock", stock, false);
      renderPile("waste", waste, true);
      for(let i=0;i<4;i++) renderPile("foundation"+i, foundations[i], true);
      for(let i=0;i<7;i++) renderTableau("tableau"+i, tableaus[i]);
    }

    function renderPile(id, pile, showTop){
      const el=document.getElementById(id);
      el.innerHTML="";
      if(pile.length===0) return;
      if(showTop){
        const card=pile[pile.length-1];
        el.appendChild(createCardElement(card,pile.length-1,id));
      }else{
        const back=document.createElement("div");
        back.className="card back";
        back.addEventListener("click",dealFromStock);
        el.appendChild(back);
      }
    }

    function renderTableau(id,pile){
      const el=document.getElementById(id);
      el.innerHTML="";
      pile.forEach((card,i)=>{
        const c=createCardElement(card,i,id);
        c.style.top=(i*25)+"px";
        el.appendChild(c);
      });
    }

    function createCardElement(card,index,from){
      const div=document.createElement("div");
      div.className="card "+card.color+(card.faceUp?"":" back");
      if(card.faceUp){
        const label = cardLabel(card.value);
        div.textContent=label+card.suit;
      }
      div.draggable=card.faceUp;
      div.dataset.index=index;
      div.dataset.from=from;
      div.addEventListener("dragstart",drag);
      return div;
    }

    function cardLabel(v){
      if(v===1) return "A";
      if(v===11) return "J";
      if(v===12) return "Q";
      if(v===13) return "K";
      return v;
    }

    function dealFromStock(){
      if(stock.length===0){
        stock=waste.reverse().map(c=>{c.faceUp=false; return c;});
        waste=[];
      }else{
        const card=stock.pop();
        card.faceUp=true;
        waste.push(card);
      }
      render();
    }

    function drag(e){
      e.dataTransfer.setData("from", e.target.dataset.from);
      e.dataTransfer.setData("index", e.target.dataset.index);
    }

    document.querySelectorAll(".pile").forEach(p=>{
      p.addEventListener("dragover",e=>e.preventDefault());
      p.addEventListener("drop",drop);
    });

    function drop(e){
      const from=e.dataTransfer.getData("from");
      const index=parseInt(e.dataTransfer.getData("index"));
      const pile=getPile(from);
      if(!pile) return;
      const moving=pile.slice(index);
      const targetId=e.currentTarget.id;
      const targetPile=getPile(targetId);
      if(!targetPile) return;

      if(validMove(moving,targetPile,targetId)){
        pile.splice(index);
        targetPile.push(...moving);
        if(from.startsWith("tableau") && pile.length>0)
          pile[pile.length-1].faceUp=true;
      }
      render();
      checkWin();
    }

    function getPile(id){
      if(id==="stock") return stock;
      if(id==="waste") return waste;
      if(id.startsWith("foundation")) return foundations[parseInt(id.slice(-1))];
      if(id.startsWith("tableau")) return tableaus[parseInt(id.slice(-1))];
      return null;
    }

    function validMove(moving,target,targetId){
      const first=moving[0];
      if(targetId.startsWith("foundation")){
        if(moving.length>1) return false;
        if(target.length===0) return first.value===1;
        const top=target[target.length-1];
        return first.suit===top.suit && first.value===top.value+1;
      }
      if(targetId.startsWith("tableau")){
        if(target.length===0) return first.value===13;
        const top=target[target.length-1];
        return top.faceUp && first.color!==top.color && first.value===top.value-1;
      }
      return false;
    }

    function checkWin(){
      if(foundations.every(f=>f.length===13)){
        alert("Proficiat! Je hebt gewonnen üéâ");
      }
    }

    document.getElementById("newGameBtn").addEventListener("click",setup);
    setup();
  </script>
</body>
</html>
