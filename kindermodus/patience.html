<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Patience – Orthodoxe Kinderpagina</title>
  <link rel="icon" href="images/kruis.png" />

  <style>
    :root{
      --primair:#7bb235; --donker:#67510C;
      --pastel1:#fff6e5; --pastel2:#fffde6; --pastel3:#ffe8ec; --pastel4:#e7f8ff;
      --pastel5:#e6ffe5; --pastel6:#fff2fb; --pastel7:#f5ffe5; --pastel8:#f5e8ff;
      --pastel9:#fff6fb; --pastel10:#e7fff9; --pastel11:#f3e6ff; --pastel12:#ffeae6;
      --pastel13:#ecffe9; --pastel14:#f7fff3; --pastel15:#eafffa; --pastel16:#fff4ea;
    }

    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: var(--pastel1);
      color: #333;
      min-height: 100vh;
      transition: background .6s;
    }

    main { 
      max-width: 1200px; 
      margin: 20px auto; 
      padding: 0 16px; 
      text-align: center;
    }

    h1 { margin: 10px; color: var(--donker); }

    /* Game area */
    #gameWrapper{
      background: #2e8b57;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      margin-bottom: 20px;
    }

    #game {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    #top {
      display: flex;
      justify-content: space-between;
      width: 100%;
      max-width: 1200px;
      margin-bottom: 20px;
    }

    #stock, #waste, .foundation {
      width: 90px;
      height: 130px;
      border: 2px dashed #fff;
      border-radius: 8px;
      background: rgba(255,255,255,0.1);
      position: relative;
      margin: 0 5px;
    }

    #foundations {
      display: flex;
    }

    #tableau {
      display: flex;
      justify-content: center;
      width: 100%;
      max-width: 1200px;
    }

    .pile {
      width: 90px;
      min-height: 130px;
      border: 2px dashed rgba(255,255,255,0.2);
      border-radius: 8px;
      margin: 0 5px;
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
    }

    .card {
      width: 90px;
      height: 130px;
      border-radius: 8px;
      background: #fff;
      color: #000;
      cursor: pointer;
      font-weight: bold;
      font-size: 22px;
      user-select: none;
      box-shadow: 0 2px 6px rgba(0,0,0,0.4);
      transition: transform 0.2s;
      margin-top: -25px; /* kleinere overlap */
      position: relative;
    }

    .pile .card:first-child {
      margin-top: 0;
    }

    .card.red { color: red; }
    .card.black { color: black; }

    .card.back {
      background: linear-gradient(45deg, #7bb235, #67510C);
      color: transparent;
      cursor: pointer;
    }

    /* Hoekjes en symbool */
    .card .corner {
      position: absolute;
      font-size: 14px;
      font-weight: bold;
    }
    .card .tl { top: 4px; left: 4px; text-align: left; }
    .card .tr { top: 4px; right: 4px; text-align: right; }
    .card .bl { bottom: 4px; left: 4px; text-align: left; transform: rotate(180deg); }
    .card .br { bottom: 4px; right: 4px; text-align: right; transform: rotate(180deg); }

    .card .center {
      font-size: 32px;
      line-height: 130px;
      text-align: center;
      width: 100%;
      height: 100%;
    }

    #message {
      margin-top: 20px;
      font-size: 22px;
      font-weight: bold;
      color: #fff;
    }
  </style>

  <script defer src="common/layout.js"></script>
</head>
<body>
  <!-- Header -->
  <div id="kinder-header" data-header-src="common/header.html"></div>

  <main>
    <h1>Patience – Klondike</h1>

    <!-- Spel in kader -->
    <div id="gameWrapper">
      <div id="game">
        <div id="top">
          <div style="display:flex;">
            <div id="stock"></div>
            <div id="waste"></div>
          </div>
          <div id="foundations">
            <div class="foundation" data-suit="♠"></div>
            <div class="foundation" data-suit="♥"></div>
            <div class="foundation" data-suit="♦"></div>
            <div class="foundation" data-suit="♣"></div>
          </div>
        </div>
        <div id="tableau">
          <div class="pile" data-index="0"></div>
          <div class="pile" data-index="1"></div>
          <div class="pile" data-index="2"></div>
          <div class="pile" data-index="3"></div>
          <div class="pile" data-index="4"></div>
          <div class="pile" data-index="5"></div>
          <div class="pile" data-index="6"></div>
        </div>
      </div>
      <div id="message"></div>
    </div>
  </main>

  <script>
    const suits = ["♠","♥","♦","♣"];
    const values = ["A","2","3","4","5","6","7","8","9","10","J","Q","K"];
    let deck = [];
    let stock = [], waste = [];
    let foundations = { "♠":[], "♥":[], "♦":[], "♣":[] };
    let tableau = [[],[],[],[],[],[],[]];

    function createDeck(){
      deck = [];
      for(let s of suits){
        for(let v of values){
          deck.push({suit:s,value:v,faceUp:false});
        }
      }
      shuffle(deck);
    }
    function shuffle(a){
      for(let i=a.length-1;i>0;i--){
        const j=Math.floor(Math.random()*(i+1));
        [a[i],a[j]]=[a[j],a[i]];
      }
    }
    function deal(){
      for(let i=0;i<7;i++){
        for(let j=0;j<=i;j++){
          const card=deck.pop();
          if(j===i) card.faceUp=true;
          tableau[i].push(card);
        }
      }
      stock=deck;
      deck=[];
      render();
    }
    function render(){
      document.querySelectorAll(".pile").forEach((p,i)=>{
        p.innerHTML="";
        tableau[i].forEach((card,j)=>{
          const div=document.createElement("div");
          div.classList.add("card");
          if(!card.faceUp) div.classList.add("back");
          else{
            if(card.suit==="♥"||card.suit==="♦") div.classList.add("red");
            else div.classList.add("black");
            div.innerHTML = `
              <div class="corner tl">${card.value}${card.suit}</div>
              <div class="corner tr">${card.value}${card.suit}</div>
              <div class="corner bl">${card.value}${card.suit}</div>
              <div class="corner br">${card.value}${card.suit}</div>
              <div class="center">${card.suit}</div>
            `;
          }
          div.dataset.pile=i;
          div.dataset.index=j;
          p.appendChild(div);
        });
      });
      // stock
      const stockDiv=document.getElementById("stock");
      stockDiv.innerHTML="";
      if(stock.length){
        const div=document.createElement("div");
        div.classList.add("card","back");
        stockDiv.appendChild(div);
      }
      // waste
      const wasteDiv=document.getElementById("waste");
      wasteDiv.innerHTML="";
      if(waste.length){
        const top=waste[waste.length-1];
        const div=document.createElement("div");
        div.classList.add("card");
        if(top.suit==="♥"||top.suit==="♦") div.classList.add("red");
        else div.classList.add("black");
        div.innerHTML = `
          <div class="corner tl">${top.value}${top.suit}</div>
          <div class="corner tr">${top.value}${top.suit}</div>
          <div class="corner bl">${top.value}${top.suit}</div>
          <div class="corner br">${top.value}${top.suit}</div>
          <div class="center">${top.suit}</div>
        `;
        wasteDiv.appendChild(div);
      }
      // foundations
      document.querySelectorAll(".foundation").forEach(f=>{
        f.innerHTML="";
        const suit=f.dataset.suit;
        if(foundations[suit].length){
          const top=foundations[suit][foundations[suit].length-1];
          const div=document.createElement("div");
          div.classList.add("card");
          if(top.suit==="♥"||top.suit==="♦") div.classList.add("red");
          else div.classList.add("black");
          div.innerHTML = `
            <div class="corner tl">${top.value}${top.suit}</div>
            <div class="corner tr">${top.value}${top.suit}</div>
            <div class="corner bl">${top.value}${top.suit}</div>
            <div class="corner br">${top.value}${top.suit}</div>
            <div class="center">${top.suit}</div>
          `;
          f.appendChild(div);
        }
      });
      checkWin();
    }
    function valueIndex(v){ return values.indexOf(v); }

    function canPlaceOn(card,target){
      if(!target) return card.value==="K";
      if(!target.faceUp) return false;
      const diff=valueIndex(target.value)-valueIndex(card.value);
      const redSuits=["♥","♦"];
      const blackSuits=["♠","♣"];
      const opposite= (redSuits.includes(card.suit)&&blackSuits.includes(target.suit)) ||
                      (blackSuits.includes(card.suit)&&redSuits.includes(target.suit));
      return diff===1 && opposite;
    }
    function canPlaceFoundation(card,suit){
      const pile=foundations[suit];
      if(pile.length===0) return card.value==="A";
      const last=pile[pile.length-1];
      return last.suit===card.suit && valueIndex(card.value)===valueIndex(last.value)+1;
    }

    function setupEvents(){
      document.getElementById("stock").onclick=()=>{
        if(stock.length){
          const card=stock.pop();
          card.faceUp=true;
          waste.push(card);
        }else{
          while(waste.length){
            const card=waste.pop();
            card.faceUp=false;
            stock.push(card);
          }
        }
        render();
      };
      document.getElementById("waste").onclick=()=>{
        if(!waste.length) return;
        const card=waste[waste.length-1];
        moveCard(card,"waste");
      };
      document.querySelectorAll(".foundation").forEach(f=>{
        f.onclick=()=>{
          if(!waste.length) return;
          const card=waste[waste.length-1];
          if(canPlaceFoundation(card,f.dataset.suit)){
            waste.pop();
            foundations[f.dataset.suit].push(card);
            render();
          }
        };
      });
      document.addEventListener("click",e=>{
        if(e.target.closest(".card") && e.target.closest(".pile")){
          const div=e.target.closest(".card");
          const pileIndex=parseInt(div.dataset.pile);
          const cardIndex=parseInt(div.dataset.index);
          const card=tableau[pileIndex][cardIndex];
          // Alleen bovenste kaart mag omgedraaid worden
          if(!card.faceUp && cardIndex === tableau[pileIndex].length-1){
            card.faceUp=true;
            render();
            return;
          }
          moveCard(card,"tableau",pileIndex,cardIndex);
        }
      });
    }
    function moveCard(card,from,pileIndex,cardIndex){
      if(canPlaceFoundation(card,card.suit)){
        if(from==="waste") waste.pop();
        else tableau[pileIndex].splice(cardIndex);
        foundations[card.suit].push(card);
        render();
        return;
      }
      document.querySelectorAll(".pile").forEach((p,i)=>{
        if(i!==pileIndex){
          const target=tableau[i][tableau[i].length-1];
          if(canPlaceOn(card,target)){
            const moving=from==="waste" ? [waste.pop()] : tableau[pileIndex].splice(cardIndex);
            tableau[i]=tableau[i].concat(moving);
            render();
          }
        }
      });
    }
    function checkWin(){
      if(Object.values(foundations).every(p=>p.length===13)){
        document.getElementById("message").textContent="🎉 Je hebt gewonnen!";
      }
    }

    createDeck();
    deal();
    setupEvents();
  </script>
</body>
</html>
