<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Springspel â€“ Orthodoxe Kinderpagina</title>
  <link rel="icon" href="images/kruis.png" />

  <style>
    :root{
      --primair:#7bb235; --donker:#67510C;
      --pastel1:#fff6e5; --pastel2:#fffde6; --pastel3:#ffe8ec; --pastel4:#e7f8ff;
      --pastel5:#e6ffe5; --pastel6:#fff2fb; --pastel7:#f5ffe5; --pastel8:#f5e8ff;
      --pastel9:#fff6fb; --pastel10:#e7fff9; --pastel11:#f3e6ff; --pastel12:#ffeae6;
      --pastel13:#ecffe9; --pastel14:#f7fff3; --pastel15:#eafffa; --pastel16:#fff4ea;
    }
    body{
      margin:0; font-family:'Comic Sans MS', Arial, sans-serif; color:#333;
      min-height:100vh; background:var(--pastel1); transition:background .6s;
    }
    #controls {
      box-sizing: border-box;
      background-color: #3B96E5;
      padding: 6px;
      position: fixed;
      bottom: 0; left: 0; width: 100vw;
      z-index: 10;
    }
    #controls button {
      color: #fff;
      font-family: inherit;
      font-weight: 500;
      padding: 6px 12px;
      font-size: 16px;
      cursor: pointer;
      background-color: transparent;
      border: none;
    }
    #controls button:hover {
      background-color: rgba(0, 0, 0, 0.3);
      border-color: rgba(0, 0, 0, 0.3);
    }
    #score {
      color: #fff;
      float: right;
      padding: 6px 12px;
    }
    #spelkaart {
      max-width: 600px; 
      margin: 40px auto;
      padding: 32px 20px 16px 20px;
      background: #f7fff3;
      border-radius: 20px;
      box-shadow: 0 6px 30px #bfd6b2a8;
      text-align: center;
    }
    #spelcanvas {
      display: block;
      margin: 20px auto 0 auto;
      box-shadow: 0 8px 18px #b7e2e2b4;
      border-radius: 8px;
      background: #ffffff;
    }
    h1 { color: #2276b9; font-weight: bold; font-size: 2.3rem; margin-bottom: .3em;}
    h2 { font-size: 1.2rem; font-weight: normal; color: #29518c; margin-top:0;}
    #gameover {
      font-size: 2rem;
      color: #e53935;
      margin-top: 30px;
      font-weight: bold;
    }
    #herstartBtn {
      background: #7bb235; color:#fff; padding:10px 22px;
      border-radius: 8px; font-size:1.2rem; border:none; margin-top:16px;
      cursor:pointer; font-family:inherit;
    }
  </style>

  <!-- Header + menubalk + beveiliging -->
  <script defer src="common/layout.js"></script>
  <!-- Phaser.js library -->
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.70.0/dist/phaser.min.js"></script>
</head>
<body>
  <div id="kinder-header" data-header-src="common/header.html"></div>

  <div id="spelkaart">
    <h1>Photeinos Springspel</h1>
    <h2>Spring om vleugeltjes te pakken, ontwijk de doodskoppen!</h2>
    <div id="spelcontainer"></div>
    <div id="gameover" style="display:none;"></div>
    <button id="herstartBtn" style="display:none;">Opnieuw spelen</button>
  </div>

  <div id="controls">
    <button id="jumpBtn">Spring!</button>
    <span id="score">Score: 0</span>
  </div>

  <script>
    // Spelconfiguratie
    const SPEL_BREEDTE = 500, SPEL_HOOGTE = 350;
    let score = 0;
    let game, sceneRef;

    const config = {
      type: Phaser.AUTO,
      width: SPEL_BREEDTE,
      height: SPEL_HOOGTE,
      backgroundColor: "#b8e4fa",
      parent: 'spelcontainer',
      physics: { default: 'arcade', arcade: { gravity: { y: 0 }, debug: false } },
      scene: {
        preload: preload,
        create: create,
        update: update
      }
    };

    let photeinos, cursors;
    let jumpRequested = false;
    let obstacles;
    let gameOver = false;
    let herstartBtn = document.getElementById('herstartBtn');
    let gameoverMsg = document.getElementById('gameover');

    function preload() {
      // Gebruik testster voor zichtbaarheid
      this.load.image('photeinos', 'https://upload.wikimedia.org/wikipedia/commons/thumb/4/44/Plain_Yellow_Star.png/256px-Plain_Yellow_Star.png');
      this.load.image('vleugel', 'https://upload.wikimedia.org/wikipedia/commons/thumb/f/fa/Emoji_u1fab6.svg/48px-Emoji_u1fab6.svg.png');
      this.load.image('doodskop', 'https://upload.wikimedia.org/wikipedia/commons/thumb/0/05/Skull_and_crossbones.svg/48px-Skull_and_crossbones.svg.png');
    }

    function create() {
      sceneRef = this;
      gameOver = false;
      gameoverMsg.style.display = 'none';
      herstartBtn.style.display = 'none';
      score = 0;

      // Lucht (bovenste helft)
      this.add.rectangle(SPEL_BREEDTE/2, SPEL_HOOGTE/4, SPEL_BREEDTE, SPEL_HOOGTE/2, 0xaee7ff);
      // Gras (onderste helft)
      this.add.rectangle(SPEL_BREEDTE/2, SPEL_HOOGTE*0.75, SPEL_BREEDTE, SPEL_HOOGTE/2, 0x8bc34a);

      // Photeinos grootte = 40% van hoogte
      const photeinosGrootte = Math.round(SPEL_HOOGTE * 0.4);
      const startY = SPEL_HOOGTE / 2 - photeinosGrootte / 2 + 8;
      photeinos = this.physics.add.image(80, startY, 'photeinos')
        .setDisplaySize(photeinosGrootte, photeinosGrootte)
        .setCollideWorldBounds(true);
      photeinos.body.setGravityY(980);

      cursors = this.input.keyboard.createCursorKeys();

      // Obstakelgroep
      obstacles = this.physics.add.group();

      // Obstakels aanmaken
      addObstacles(this);

      // Botsingen
      this.physics.add.overlap(photeinos, obstacles, handleCollision, null, this);

      // Spring controls
      document.getElementById("jumpBtn").onclick = () => { if (!gameOver) jumpRequested = true; };
      this.input.keyboard.on('keydown-SPACE', () => { if (!gameOver) jumpRequested = true; });
      this.input.on('pointerdown', () => { if (!gameOver) jumpRequested = true; });

      // Herstartknop
      herstartBtn.onclick = () => {
        game.destroy(true);
        setTimeout(() => { game = new Phaser.Game(config); }, 100);
      };
    }

    function addObstacles(scene) {
      // Zorg dat er max 2 obstakels zijn (per keer)
      while (obstacles.countActive(true) < 2) {
        // Random: 0 = doodskop, 1 = vleugel
        let soort = Math.random() < 0.5 ? "doodskop" : "vleugel";
        let x = SPEL_BREEDTE + 40 + Math.random()*100;
        let y;
        if (soort === "doodskop") {
          // Graszone: 70-90% van schermhoogte
          y = Phaser.Math.Between(SPEL_HOOGTE*0.70, SPEL_HOOGTE*0.90);
        } else {
          // Luchtzone: 10-40% van schermhoogte
          y = Phaser.Math.Between(SPEL_HOOGTE*0.10, SPEL_HOOGTE*0.40);
        }
        let sprite = obstacles.create(x, y, soort);
        sprite.setDisplaySize(42, 42);
        sprite.setVelocityX(-80); // Rustige snelheid
        sprite.sojrt = soort;
        sprite.body.allowGravity = false;
      }
    }

    function handleCollision(photeinos, obstacle) {
      if (gameOver) return;
      if (obstacle.texture.key === "doodskop") {
        // GAME OVER
        gameOver = true;
        photeinos.setTint(0xe53935);
        obstacle.setTint(0xe53935);
        gameoverMsg.innerHTML = "Oei! Je raakte een doodskop!<br>Score: "+score;
        gameoverMsg.style.display = 'block';
        herstartBtn.style.display = 'block';
        sceneRef.physics.pause();
      } else if (obstacle.texture.key === "vleugel") {
        // Score +1, vleugel weg
        obstacle.destroy();
        score++;
      }
    }

    function update() {
      if (gameOver) return;

      // Springfunctie: altijd mogelijk, zolang je niet bovenin zit
      if (jumpRequested && photeinos.y > 0.2 * SPEL_HOOGTE) {
        photeinos.setVelocityY(-photeinos.displayHeight * 2.4);
        jumpRequested = false;
      }

      // Verwijder obstakels die buiten beeld zijn, voeg zo nodig nieuwe toe
      obstacles.getChildren().forEach(ob => {
        if (ob.x < -40) ob.destroy();
      });
      addObstacles(this);

      // Score live updaten
      document.getElementById("score").textContent = "Score: " + score;
    }

    // Ook springen bij touch
    document.addEventListener('touchstart', function(e){
      jumpRequested = true;
    });

    // Start het spel
    window.onload = () => { game = new Phaser.Game(config); };
  </script>
</body>
</html>
