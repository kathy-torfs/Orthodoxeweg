<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Springspel ‚Äì Orthodoxe Kinderpagina</title>
  <link rel="icon" href="images/kruis.png" />
  <style>
    body { margin:0; font-family:'Comic Sans MS', Arial, sans-serif; background:#fff6e5;}
    #spelkaart {
      max-width: 600px; margin: 40px auto; padding: 32px 20px 16px 20px;
      background: #f7fff3; border-radius: 20px; box-shadow: 0 6px 30px #bfd6b2a8;
      text-align: center;
    }
    #spelcontainer {
      position: relative; margin: 0 auto; width: 500px; height: 350px;
      background: linear-gradient(to bottom, #aee7ff 0% 55%, #8bc34a 55% 100%);
      border-radius: 8px; box-shadow: 0 8px 18px #b7e2e2b4; overflow: hidden;
      touch-action: none;
    }
    .emoji { position: absolute; user-select: none; pointer-events: none; }
    #controls {
      box-sizing: border-box; background-color: #3B96E5; padding: 6px;
      position: fixed; bottom: 0; left: 0; width: 100vw; z-index: 10;
    }
    #controls button { color: #fff; font-family: inherit; font-weight: 500;
      padding: 6px 12px; font-size: 16px; cursor: pointer; background-color: transparent;
      border: none; }
    #controls button:hover { background-color: rgba(0,0,0,0.2);}
    #score { color: #fff; float: right; padding: 6px 12px; }
    #gameover { font-size: 2rem; color: #e53935; margin-top: 20px; font-weight: bold; }
    #herstartBtn {
      background: #7bb235; color:#fff; padding:10px 22px;
      border-radius: 8px; font-size:1.2rem; border:none; margin-top:16px;
      cursor:pointer; font-family:inherit;
    }
  </style>
  <script defer src="common/layout.js"></script>
</head>
<body>
  <div id="kinder-header" data-header-src="common/header.html"></div>

  <div id="spelkaart">
    <h1>Photeinos Springspel</h1>
    <h2>Spring om vleugeltjes te pakken, ontwijk de doodskoppen!</h2>
    <div id="spelcontainer"></div>
    <div id="gameover" style="display:none;"></div>
    <button id="herstartBtn" style="display:none;">Opnieuw spelen</button>
  </div>

  <div id="controls">
    <button id="jumpBtn">Spring!</button>
    <span id="score">Score: 0</span>
  </div>

  <script>
    // --- Instellingen ---
    const SPEL_BREEDTE = 500, SPEL_HOOGTE = 350;
    const GRONDLijn = Math.round(SPEL_HOOGTE * 0.71); // waar de ster op staat
    const STER_EMOJI = "‚≠ê";
    const VLEUGEL_EMOJI = "ü™Ω";
    const DOODSKOP_EMOJI = "üíÄ";
    const FPS = 60;

    let spelcontainer = document.getElementById('spelcontainer');
    let score = 0, gameOver = false;
    let photeinos, velY = 0, springKracht = 13.7, zwaartekracht = 0.85;
    let obstacles = [];
    let obstakelSpeed = 1.5; // langzaam
    let obstacleTimer = 0;
    let minObstacleDelay = 110, maxObstacleDelay = 200;
    let gameLoop;

    let gameoverMsg = document.getElementById('gameover');
    let herstartBtn = document.getElementById('herstartBtn');

    function resetGame() {
      spelcontainer.innerHTML = "";
      score = 0; gameOver = false; obstacles = [];
      velY = 0; obstacleTimer = 0;
      document.getElementById('score').textContent = "Score: " + score;
      gameoverMsg.style.display = 'none';
      herstartBtn.style.display = 'none';

      // Photeinos maken
      photeinos = document.createElement('span');
      photeinos.className = "emoji";
      photeinos.style.fontSize = (SPEL_HOOGTE*0.38) + "px";
      photeinos.textContent = STER_EMOJI;
      spelcontainer.appendChild(photeinos);
      photeinos.x = 50;
      photeinos.y = GRONDLijn;
      plaatsPhoteinos();

      // Start loop
      if(gameLoop) clearInterval(gameLoop);
      gameLoop = setInterval(updateGame, 1000/FPS);
    }

    function plaatsPhoteinos() {
      photeinos.style.left = photeinos.x + "px";
      photeinos.style.top = photeinos.y + "px";
    }

    function addObstacle() {
      let soort = Math.random() < 0.5 ? "doodskop" : "vleugel";
      let el = document.createElement('span');
      el.className = "emoji";
      el.textContent = soort==="vleugel" ? VLEUGEL_EMOJI : DOODSKOP_EMOJI;
      el.soort = soort;
      el.style.fontSize = (SPEL_HOOGTE*0.14) + "px";
      el.x = SPEL_BREEDTE + 20;
      // Doodskop altijd op grondlijn, vleugel altijd in de lucht
      el.y = soort==="doodskop"
        ? GRONDLijn + 8 // net boven de grond
        : Math.round(SPEL_HOOGTE * 0.32); // vaste hoogte, lucht
      el.style.left = el.x+"px";
      el.style.top = el.y+"px";
      spelcontainer.appendChild(el);
      obstacles.push(el);
    }

    function updateGame() {
      if(gameOver) return;

      // Springen
      if(jumpRequested && photeinos.y >= GRONDLijn) {
        velY = -springKracht;
        jumpRequested = false;
      }

      // Zwaartekracht
      velY += zwaartekracht;
      photeinos.y += velY;

      // Grond
      if(photeinos.y > GRONDLijn) {
        photeinos.y = GRONDLijn;
        velY = 0;
      }
      // Bovenkant (limiet)
      if(photeinos.y < 5) {
        photeinos.y = 5;
        velY = 0.2;
      }
      plaatsPhoteinos();

      // Obstakels bewegen & botsen
      for(let i=obstacles.length-1;i>=0;i--) {
        let ob = obstacles[i];
        ob.x -= obstakelSpeed;
        ob.style.left = ob.x+"px";
        // Botscontrole (makkelijk: rechthoekjes)
        let raak = Math.abs(photeinos.x-ob.x)<44 && Math.abs(photeinos.y-ob.y)<38;
        if(raak) {
          if(ob.soort==="vleugel") {
            score++; ob.remove(); obstacles.splice(i,1);
            document.getElementById('score').textContent = "Score: " + score;
          }
          else if(ob.soort==="doodskop") {
            endGame();
            return;
          }
        }
        if(ob.x < -30) {
          ob.remove(); obstacles.splice(i,1);
        }
      }

      // Obstakels spawnen langzaam (1-2 tegelijk, niet meer)
      obstacleTimer--;
      if(obstacleTimer<=0 && obstacles.length<2) {
        addObstacle();
        obstacleTimer = Math.round(minObstacleDelay + Math.random()*(maxObstacleDelay-minObstacleDelay));
      }
    }

    function endGame() {
      gameOver = true;
      clearInterval(gameLoop);
      gameoverMsg.innerHTML = "Oei! Je raakte een doodskop!<br>Score: "+score;
      gameoverMsg.style.display = 'block';
      herstartBtn.style.display = 'block';
      setTimeout(()=>{ window.scrollTo({top:0,behavior:'smooth'}); },250);
    }

    let jumpRequested = false;
    document.getElementById("jumpBtn").onclick = () => { if (!gameOver) jumpRequested = true; };
    document.addEventListener('keydown', (e) => { if (e.code === "Space" && !gameOver) jumpRequested = true; });
    spelcontainer.addEventListener('pointerdown', (e) => { if (!gameOver) jumpRequested = true; });
    document.addEventListener('touchstart', function(e){
      if (!gameOver) jumpRequested = true;
    });

    herstartBtn.onclick = resetGame;

    window.onload = resetGame;
  </script>
</body>
</html>
