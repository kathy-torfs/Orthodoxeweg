<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Springspel ‚Äì Orthodoxe Kinderpagina</title>
  <link rel="icon" href="images/kruis.png" />
  <script defer src="common/layout.js"></script>
  <style>
    :root{
      --pastel1:#fff6e5; --pastel2:#fffde6; --pastel3:#ffe8ec; --pastel4:#e7f8ff;
      --primair:#7bb235;
    }
    body{
      margin:0; font-family:'Comic Sans MS', Arial, sans-serif; color:#333;
      min-height:100vh; background:var(--pastel1); transition:background .6s;
    }
    main{ max-width:1450px; margin:36px auto; padding:0 2vw; text-align:center }
    #game-container { position:relative; width:1280px; height:480px; background:#fffde6; margin:54px auto 0 auto; border-radius:34px; box-shadow:0 4px 32px #bedbe888; overflow:hidden; }
    #score { font-size:38px; font-weight:bold; background:rgba(255,255,255,0.93); border-radius:14px; padding:12px 46px; position:absolute; left:46px; top:18px; box-shadow:0 2px 8px #dbecc299; }
    #restartBtn, #startBtn { position:absolute; left:50%; top:55%; transform:translate(-50%,-50%); background:#7bb235; color:white; font-size:34px; border:none; border-radius:18px; padding:22px 80px; box-shadow:0 2px 12px #a9dea670; cursor:pointer; font-family:'Comic Sans MS',Arial,sans-serif; }
    #restartBtn { display:none; }
    #startBtn { display:block; }
  </style>
</head>
<body>
  <div id="kinder-header" data-header-src="common/header.html"></div>
  <main>
    <h1>Springspel ‚≠êÔ∏è</h1>
    <div id="game-container">
      <div id="score" style="display:none">Score: 0</div>
      <button id="restartBtn">Opnieuw</button>
      <button id="startBtn">Start Springspel</button>
    </div>
    <div style="margin-top:38px;font-size:28px;color:#888">Druk op spatie of tik/klik om te springen!</div>
  </main>
  <script>
    // ===== Achtergrond wisselen =====
    (function(){
      const p=[
        'var(--pastel1)','var(--pastel2)','var(--pastel3)','var(--pastel4)'];
      document.body.style.background = p[Math.floor(Math.random()*p.length)];
    })();
    // ===== Header/menubalk laden, active-tab is 'spelletjes' =====
    (function boot(){
      if (!(window.KinderLayout)) return setTimeout(boot,120);
      const el=document.getElementById('kinder-header');
      window.KinderLayout.mountHeader({ rootId:'kinder-header', headerSrc:el.dataset.headerSrc, active:'spelletjes' });
    })();

    // ===== Gamecode =====
    const EMOJI_OBSTACLES = ["üåµ","ü™®","üöß","‚ö°Ô∏è","üí£"];
    const STAR = "‚≠êÔ∏è";
    let canvas, ctx, W=1280, H=480;
    let star = { x:190, y:410, vy:0, size:120, jumping:false };
    let obstacles = [];
    let score = 0, alive = true, gravity=1.48, jumpVel=-34;
    let speed = 2.12; // rustig
    let groundY = 410;
    let bgFrame=0;
    let running = false;
    let requestId = null;

    function resetGameVars() {
      obstacles = [];
      score = 0;
      alive = true;
      star.y = groundY;
      star.vy = 0;
      star.jumping = false;
      speed = 2.12;
      document.getElementById("score").textContent = "Score: 0";
    }

    function startGame() {
      resetGameVars();
      document.getElementById("score").style.display = "";
      document.getElementById("restartBtn").style.display = "none";
      document.getElementById("startBtn").style.display = "none";
      if(!canvas){
        canvas = document.createElement("canvas");
        canvas.width = W;
        canvas.height = H;
        canvas.style.display = "block";
        canvas.style.margin = "0 auto";
        canvas.style.background = "#f2faf5";
        document.getElementById("game-container").appendChild(canvas);
        ctx = canvas.getContext("2d");
      }
      running = true;
      loop();
    }
    function addObstacle() {
      const size = 120 + Math.random()*18;
      obstacles.push({
        x: W+38,
        y: groundY,
        size: size,
        emoji: EMOJI_OBSTACLES[Math.floor(Math.random()*EMOJI_OBSTACLES.length)]
      });
    }
    function loop() {
      ctx.clearRect(0,0,W,H);
      ctx.fillStyle = ["#cfe8ff","#f2faf5","#ffe8ec","#e0ffe3"][bgFrame%4];
      ctx.fillRect(0,0,W,H);
      ctx.fillStyle = "#c2e3b5";
      ctx.fillRect(0,groundY+star.size/2,W, H-groundY);

      ctx.font = star.size + "px Segoe UI Emoji, Arial";
      ctx.textAlign = "center";
      ctx.textBaseline = "bottom";
      ctx.fillText(STAR, star.x, star.y);

      for(let obs of obstacles){
        ctx.font = obs.size+"px Segoe UI Emoji, Arial";
        ctx.textAlign = "center";
        ctx.textBaseline = "bottom";
        ctx.fillText(obs.emoji, obs.x, obs.y);
      }

      if(alive){
        star.vy += gravity;
        star.y += star.vy;
        if(star.y > groundY){ star.y=groundY; star.vy=0; star.jumping=false; }
        for(let obs of obstacles){ obs.x -= speed; }
        // Obstakels: meer ruimte tussen, max 2 tegelijk
        if(obstacles.length===0 || (obstacles[obstacles.length-1].x < W-470 && obstacles.length<2)){
          if(Math.random()>0.945 || obstacles.length===0) addObstacle();
        }
        // Botsing
        for(let obs of obstacles){
          // Aangepaste box zodat ster veilig volledig over obstakel kan
          if(
            star.x + star.size*0.22 > obs.x - obs.size*0.35 &&
            star.x - star.size*0.22 < obs.x + obs.size*0.38 &&
            star.y > obs.y - obs.size*0.86
          ){
            alive=false;
            document.getElementById("restartBtn").style.display = "block";
            running = false;
          }
        }
        obstacles = obstacles.filter(obs=>obs.x > -200);
        score++;
        document.getElementById("score").textContent = "Score: "+score;
        // Versnel nog langzamer (pas na 1000 punten)
        if(score%1000===0 && speed<7.5){ speed+=0.35; }
      } else {
        ctx.font = "58px Comic Sans MS, Arial";
        ctx.fillStyle = "#e84040";
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";
        ctx.fillText("Game Over!", W/2, H/2-22);
      }
      bgFrame++;
      if(running) requestId = requestAnimationFrame(loop);
    }
    function jump(){
      if(!alive) return;
      if(!star.jumping){
        star.vy = jumpVel;
        star.jumping = true;
      }
    }
    window.addEventListener('keydown', e=>{
      if(e.code==='Space') jump();
    });
    document.getElementById('game-container').addEventListener('pointerdown', jump);
    document.getElementById('restartBtn').onclick = ()=>{
      running = true;
      alive = true;
      startGame();
    };
    document.getElementById('startBtn').onclick = startGame;
    window.onload = ()=>{
      resetGameVars();
      document.getElementById("score").style.display = "none";
      document.getElementById("restartBtn").style.display = "none";
      document.getElementById("startBtn").style.display = "block";
    }
  </script>
</body>
</html>
