<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Noach's Ark Memory â€“ Orthodoxe Kinderpagina</title>
  <link rel="icon" href="images/kruis.png" />

  <style>
    :root{
      --primair:#7bb235; --donker:#67510C;
      --pastel1:#fff6e5; --pastel2:#fffde6; --pastel3:#ffe8ec; --pastel4:#e7f8ff;
      --pastel5:#e6ffe5; --pastel6:#fff2fb; --pastel7:#f5ffe5; --pastel8:#f5e8ff;
      --pastel9:#fff6fb; --pastel10:#e7fff9; --pastel11:#f3e6ff; --pastel12:#ffeae6;
      --pastel13:#ecffe9; --pastel14:#f7fff3; --pastel15:#eafffa; --pastel16:#fff4ea;
    }
    body{
      margin:0; font-family:'Comic Sans MS', Arial, sans-serif; color:#333;
      min-height:100vh; background:var(--pastel1); transition:background .6s;
    }
    main{ max-width:1000px; margin:20px auto; padding:0 16px; text-align:center }

    #boardWrapper{
      position:relative;
      display:none;
      margin:20px auto 60px auto;
      width:600px; height:600px;
      overflow:hidden;
    }
    #ark{
      width:100%; height:100%; object-fit:contain;
      display:block;
    }
    #gameBoard{
      display:grid; grid-gap:12px; justify-content:center;
      position:absolute; top:120px; left:0; right:0; margin:auto;
      z-index:3;
    }
    .card{
      width:80px; height:80px; background:#7bb235; border-radius:8px;
      cursor:pointer; display:flex; align-items:center; justify-content:center;
      font-size:42px; font-weight:bold; color:#fff; transition:transform 0.3s;
    }
    .flipped{ background:#fff; color:#000; cursor:default; }

    #status{ margin-top:20px; font-weight:bold }
    #timer{ margin-top:10px; font-weight:bold }

    .btn{
      background:var(--primair); color:#fff; border:none; border-radius:8px;
      padding:8px 14px; font-weight:bold; cursor:pointer; margin:4px;
    }

    /* Regen */
    #regen{
      position:absolute; top:0; left:0; width:100%; height:100%;
      pointer-events:none; overflow:hidden; z-index:2;
    }
    .druppel{
      position:absolute;
      width:2px;
      background:rgba(0,0,255,0.4);
      border-radius:1px;
      animation: vallen linear infinite;
      transform: rotate(15deg);
    }
    @keyframes vallen{
      from{ transform: translateY(-20%) translateX(0) rotate(15deg); opacity:0.9; }
      to{ transform: translateY(120%) translateX(20px) rotate(15deg); opacity:0.2; }
    }

    /* Water */
    #water{
      position:absolute; left:0; bottom:0; width:100%; height:0;
      background:rgba(0,150,255,0.6);
      z-index:1; transition:height 3s linear;
      overflow:hidden;
    }
    #water::before{
      content:"";
      position:absolute; left:0; top:-20px; width:200%; height:40px;
      background:rgba(0,120,220,0.7);
      border-radius:50%;
      animation: golf 4s linear infinite;
    }
    @keyframes golf{
      from{ transform:translateX(0); }
      to{ transform:translateX(-50%); }
    }
  </style>

  <script defer src="common/layout.js"></script>
</head>
<body>
  <div id="kinder-header" data-header-src="common/header.html"></div>

  <main>
    <h1>Noach's Ark Memory ğŸ›¶ğŸŒˆ</h1>
    <div>
      <button id="startBtn" class="btn">Spel starten (20 punten)</button>
      <button id="resetBtn" class="btn" style="display:none;">Opnieuw spelen</button>
      <button id="pauseBtn" class="btn" style="display:none;">Pauze</button>
    </div>
    <div id="timer"></div>

    <div id="boardWrapper">
      <img id="ark" src="../images/arkvannoah.png" alt="Ark van Noach">
      <div id="gameBoard"></div>
      <div id="regen"></div>
      <div id="water"></div>
    </div>

    <div id="status"></div>
  </main>

  <script>
    // Achtergrond wisselen
    (function(){
      const p=['var(--pastel1)','var(--pastel2)','var(--pastel3)','var(--pastel4)',
               'var(--pastel5)','var(--pastel6)','var(--pastel7)','var(--pastel8)',
               'var(--pastel9)','var(--pastel10)','var(--pastel11)','var(--pastel12)',
               'var(--pastel13)','var(--pastel14)','var(--pastel15)','var(--pastel16)'];
      document.body.style.background=p[Math.floor(Math.random()*p.length)];
    })();

    // Header
    (function boot(){
      if (!(window.KinderLayout)) return setTimeout(boot,120);
      const el=document.getElementById('kinder-header');
      window.KinderLayout.mountHeader({ rootId:'kinder-header', headerSrc:el.dataset.headerSrc, active:'spelletjes' });
    })();

    const animals=["ğŸ¶","ğŸ±","ğŸ­","ğŸ°","ğŸ¦Š","ğŸ»","ğŸ¼","ğŸ¨","ğŸ¦","ğŸ¯","ğŸ®","ğŸ·","ğŸ¸","ğŸµ","ğŸ”"];
    const levels=[
      {pairs:2,time:40},{pairs:4,time:60},{pairs:6,time:90},
      {pairs:8,time:120},{pairs:10,time:150},{pairs:15,time:180}
    ];

    let currentLevel=0, matches=0, totalPairs=0;
    let firstCard=null, lock=false;
    let timerId=null, timeLeft=0, paused=false;

    // Regen
    function startRain(hevig=false){
      const regen=document.getElementById("regen");
      regen.innerHTML="";
      const druppels=hevig?120:60;
      for(let i=0;i<druppels;i++){
        const d=document.createElement("div");
        d.className="druppel";
        d.style.left=Math.random()*100+"%";
        d.style.top=Math.random()*100+"%"; // start overal in het vak
        d.style.height=(8+Math.random()*14)+"px";
        d.style.animationDuration=(Math.random()*2+1)+"s";
        d.style.animationDelay=(Math.random()*2)+"s";
        d.style.background=`rgba(0,0,255,${0.2+Math.random()*0.5})`;
        regen.appendChild(d);
      }
    }
    function stopRain(){ document.getElementById("regen").innerHTML=""; }
    function fillWater(percent){ document.getElementById("water").style.height=percent+"%"; }

    function startLevel(){
      const {pairs,time}=levels[currentLevel];
      createBoard(pairs);
      timeLeft=time; updateTimer(); fillWater(0);
      timerId=setInterval(()=>{
        if(!paused){
          timeLeft--; updateTimer();
          if(timeLeft===Math.floor(time/2)) startRain(false); // regen in de helft
          if(timeLeft<=0){
            clearInterval(timerId);
            startRain(true);
            fillWater(100);
            status("De ark liep vol waterâ€¦ probeer opnieuw! ğŸŒŠ");
            lock=true;
          }
        }
      },1000);
    }

    function createBoard(pairs){
      const gameBoard=document.getElementById("gameBoard");
      gameBoard.innerHTML="";
      totalPairs=pairs; matches=0; firstCard=null; lock=false;
      stopRain(); fillWater(0);

      const deck=[...animals.slice(0,pairs),...animals.slice(0,pairs)].sort(()=>Math.random()-0.5);
      const cols=pairs<=4?4:pairs<=8?5:6;
      gameBoard.style.gridTemplateColumns=`repeat(${cols},80px)`;

      deck.forEach(animal=>{
        const card=document.createElement("div");
        card.className="card"; card.dataset.symbol=animal;
        card.addEventListener("click",()=>flipCard(card));
        gameBoard.appendChild(card);
      });
      status(`Level ${currentLevel+1} â€“ Zoek de paren!`);
    }

    function flipCard(card){
      if(lock || paused || card.classList.contains("flipped")) return;
      card.textContent=card.dataset.symbol;
      card.classList.add("flipped");
      if(!firstCard){
        firstCard=card;
      }else{
        if(firstCard.dataset.symbol===card.dataset.symbol){
          firstCard=null; matches++;
          if(matches===totalPairs){
            clearInterval(timerId); stopRain(); fillWater(0);
            if(currentLevel<levels.length-1){
              currentLevel++; status("Goed gedaan! Op naar level "+(currentLevel+1));
              setTimeout(startLevel,2000);
            }else{ status("Fantastisch! Alle dieren zijn veilig in de Ark ğŸ‰"); }
          }
        }else{
          lock=true;
          setTimeout(()=>{
            firstCard.textContent=""; firstCard.classList.remove("flipped");
            card.textContent=""; card.classList.remove("flipped");
            firstCard=null; lock=false;
          },800);
        }
      }
    }

    function status(msg){ document.getElementById("status").textContent=msg; }
    function updateTimer(){ document.getElementById("timer").textContent="â³ Tijd: "+timeLeft+"s"; }

    // Start & Reset & Pauze
    document.getElementById("startBtn").addEventListener("click",()=>{
      document.getElementById("startBtn").style.display="none";
      document.getElementById("resetBtn").style.display="inline-block";
      document.getElementById("pauseBtn").style.display="inline-block";
      document.getElementById("boardWrapper").style.display="block";
      currentLevel=0; startLevel();
    });
    document.getElementById("resetBtn").addEventListener("click",()=>location.reload());
    document.getElementById("pauseBtn").addEventListener("click",()=>{
      paused=!paused;
      document.getElementById("pauseBtn").textContent=paused?"Hervatten":"Pauze";
      status(paused?"Pauze â€“ neem even rust":"Ga verder met spelen!");
    });
  </script>
</body>
</html>
