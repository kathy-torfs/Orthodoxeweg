<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Spelletjes – Orthodoxe Kinderpagina</title>
  <link rel="icon" href="https://kathy-torfs.github.io/Orthodoxeweg/images/kruis.png" />
  <style>
    :root{
      --primair:#7bb235; --donker:#67510C;
      --pastel1:#fff6e5; --pastel2:#fffde6; --pastel3:#ffe8ec; --pastel4:#e7f8ff;
      --pastel5:#e6ffe5; --pastel6:#fff2fb; --pastel7:#f5ffe5; --pastel8:#f5e8ff;
      --pastel9:#fff6fb; --pastel10:#e7fff9; --pastel11:#f3e6ff; --pastel12:#ffeae6;
      --pastel13:#ecffe9; --pastel14:#f7fff3; --pastel15:#eafffa; --pastel16:#fff4ea;
    }
    body{
      margin:0; font-family:'Comic Sans MS', Arial, sans-serif; color:#333;
      min-height:100vh; background:var(--pastel1); transition:background .6s; overflow-x:hidden;
    }

    /* Bovenste rij */
    .bovenrij{
      width:100%; max-width:1280px; margin:0 auto;
      display:flex; align-items:center; justify-content:space-between; gap:0;
      padding:22px 2vw 8px 2vw; box-sizing:border-box;
    }
    .bovenrij .links{ display:flex; align-items:center; gap:18px; }
    .photeinos-wave-img{
      width:120px; min-width:54px; max-width:26vw; height:120px; border-radius:50%;
      background:#fff; border:2.2px solid #dab97a; box-shadow:0 2px 12px #dab97a2a;
      object-fit:cover; user-drag:none; -webkit-user-drag:none; display:block;
    }
    .begroeting{
      font-size:2.2em; font-weight:bold; color:var(--primair);
      text-shadow:0 2px 8px #b3d9ff44; letter-spacing:.01em; line-height:1.04;
      margin:0; white-space:nowrap;
    }
    .bovenrij .rechts{ display:flex; align-items:center; gap:18px; margin-left:24px; }
    .uitlog-kind-btn{
      background:#e24343; color:#fff; border:none; padding:11px 24px; border-radius:9px;
      font-weight:bold; font-size:1.1em; cursor:pointer; box-shadow:0 2px 10px #b04141ab;
      transition:background .2s; z-index:10; margin-left:12px;
    }
    .uitlog-kind-btn:hover{ background:#b72828; }

    /* Kleine vlam met punten in rechterbovenhoek */
    .puntenvlam-balk{
      display:flex; flex-direction:column; align-items:center; position:relative;
      width:58px; min-width:44px; height:74px; margin-left:22px;
    }
    .puntenvlam-img{ width:58px; height:74px; display:block; user-drag:none; -webkit-user-drag:none; }
    .punten-teller-balk{
      position:absolute; left:0; right:0; top:63%; text-align:center;
      font-family:'Comic Sans MS', Arial, sans-serif; font-size:1.33em; color:#bf5300; font-weight:bold;
      text-shadow:0 2px 10px #fffef9, 0 1px 0 #ffecb3; pointer-events:none; letter-spacing:.03em;
      filter:drop-shadow(0 2px 2px #fffef9); transition:transform .14s;
    }

    /* Menubalk (consistent met andere pagina’s) */
    nav.kinder-menu{
      width:100vw; max-width:1280px; margin:0 auto;
      display:flex; justify-content:center; align-items:center; gap:32px;
      padding:36px 0 25px 0; min-height:88px; flex-wrap:wrap; transition:gap .2s;
    }
    nav.kinder-menu a{ display:flex; align-items:center; justify-content:center; border-radius:12px; transition:transform .13s; }
    nav.kinder-menu a:focus, nav.kinder-menu a:hover{ transform:scale(1.12); }
    .menu-icoon{
      width:72px; height:72px; object-fit:contain; border-radius:16px; background:#fff9d5;
      box-shadow:0 2px 7px #ffe17e25; border:2.2px solid #ffe05e; transition:box-shadow .13s, border-color .13s;
      display:block;
    }
    nav.kinder-menu a:focus .menu-icoon, nav.kinder-menu a:hover .menu-icoon{
      box-shadow:0 5px 16px #ffe17e55; border-color:#ffbe23;
    }

    .spacer-begroeting-menu{ height:38px; }

    /* Container spelkaarten */
    .container-spellen{
      max-width:850px; margin:0 auto; padding:0 12px 44px 12px;
    }
    .intro-titel{
      color:#67510C; font-size:1.6em; font-weight:bold; margin:18px 0 6px 0; text-align:center;
    }
    .spel-card{
      background:#fff6e2; border-radius:22px; box-shadow:0 2px 8px #0002;
      margin: 16px 0; padding:18px; display:grid; grid-template-columns:88px 1fr auto; gap:14px; align-items:center;
    }
    .spel-card .icoon{
      width:72px; height:72px; border-radius:16px; object-fit:contain; background:#fff; border:1px solid #ffe0b5;
      display:block;
    }
    .spel-card .titel{
      color:#4A3B20; font-size:1.15em; font-weight:bold; margin-bottom:6px;
    }
    .badge{
      display:inline-block; background:#d8ffdf; color:#20641e; border-radius:8px; padding:3px 10px; font-size:.95em; margin-right:8px;
    }
    .badge.kost{ background:#fff1c7; color:#7a4d00; }
    .actie{
      display:flex; flex-direction:column; gap:8px; align-items:flex-end;
    }
    .btn{
      appearance:none; border:0; border-radius:13px; padding:11px 16px; font-weight:bold; cursor:pointer; color:#fff; background:#7bb235;
      min-width:180px; box-shadow:0 2px 6px #0001;
    }
    .btn:disabled{ background:#d8ffdf; color:#888; cursor:default; }
    .note{ font-size:.9em; color:#6b7280; }

    /* Pop-up (eenvoudig) */
    .modal{ position:fixed; inset:0; background:rgba(0,0,0,.35); display:none; align-items:center; justify-content:center; z-index:9999; }
    .modal .card{
      background:#fff; border-radius:16px; padding:18px 18px 14px 18px; max-width:min(92vw,420px); box-shadow:0 10px 30px rgba(0,0,0,.25);
    }
    .modal .title{ font-weight:700; font-size:1.2em; margin:0 0 8px 0; display:flex; align-items:center; gap:10px; color:#1f2937; }
    .modal .text{ color:#374151; margin-bottom:12px; }
    .modal .row{ display:flex; gap:10px; justify-content:flex-end; }
    .ghost{ background:#eff6ff; color:#1e40af; }

    /* Photeinos GIF */
    .photeinos-gif{
      position:fixed; left:0; bottom:50px; width:110px; height:110px; z-index:1000; display:none; pointer-events:none;
      animation:photeinosInOut 2.2s linear forwards;
    }
    @keyframes photeinosInOut{
      0%{transform:translateX(-120%);} 15%{transform:translateX(12%);} 80%{transform:translateX(10%);} 100%{transform:translateX(-120%);}
    }

    /* Responsief */
    @media (max-width:1100px){ .photeinos-wave-img{width:17vw;height:17vw;min-width:60px;max-width:120px} .puntenvlam-balk,.puntenvlam-img{width:44px;height:60px} }
    @media (max-width:900px){
      .bovenrij{padding-top:10px} .photeinos-wave-img{width:16vw;height:16vw;min-width:44px}
      .begroeting{font-size:1.2em} .puntenvlam-balk,.puntenvlam-img{width:36px;height:48px}
      .spel-card{ grid-template-columns:70px 1fr; grid-auto-rows:auto; }
      .actie{ align-items:stretch; }
      .btn{ min-width:unset; width:100%; }
    }
    @media (max-width:600px){ .photeinos-wave-img{width:24vw;height:24vw;min-width:28px} .puntenvlam-balk,.puntenvlam-img{width:27px;height:35px} }
  </style>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore-compat.js"></script>
</head>
<body>
  <!-- Bovenste rij -->
  <div class="bovenrij">
    <div class="links">
      <img src="https://kathy-torfs.github.io/Orthodoxeweg/images/photeinos_wave.gif" alt="Photeinos zwaait" class="photeinos-wave-img" draggable="false" />
      <span class="begroeting" id="groet-tekst">Hallo, kind!</span>
    </div>
    <div class="rechts">
      <div class="puntenvlam-balk">
        <img src="https://kathy-torfs.github.io/Orthodoxeweg/images/photeinos_vlam.png" alt="Vlam" class="puntenvlam-img" draggable="false" />
        <div id="punten-teller" class="punten-teller-balk">…</div>
      </div>
      <button class="uitlog-kind-btn" id="uitlogBtn">Uitloggen</button>
    </div>
  </div>

  <div class="spacer-begroeting-menu"></div>

  <!-- Menubalk -->
  <nav class="kinder-menu">
    <a href="startpagina.html" title="Startpagina">
      <img src="https://kathy-torfs.github.io/Orthodoxeweg/images/photeinos_home.png" class="menu-icoon" alt="Startpagina" />
    </a>
    <a href="gebeden.html" title="Ik bid">
      <img src="https://kathy-torfs.github.io/Orthodoxeweg/images/photeinos_bid.png" class="menu-icoon" alt="Ik bid" />
    </a>
    <a href="catechese.html" title="Catechese">
      <img src="https://kathy-torfs.github.io/Orthodoxeweg/images/catechese.png" class="menu-icoon" alt="Catechese" />
    </a>
    <a href="heiligen.html" title="Heiligen">
      <img src="https://kathy-torfs.github.io/Orthodoxeweg/images/photeinos_heiligen.png" class="menu-icoon" alt="Heiligen" />
    </a>
    <a href="bijbelverhalen.html" title="Bijbelverhalen">
      <img src="https://kathy-torfs.github.io/Orthodoxeweg/images/photeinos_bijbel.png" class="menu-icoon" alt="Bijbelverhalen" />
    </a>
    <a href="spelletjes.html" title="Spelletjes">
      <img src="https://kathy-torfs.github.io/Orthodoxeweg/images/photeinos_spelletjes.png" class="menu-icoon" alt="Spelletjes" />
    </a>
    <a href="school.html" title="School">
      <img src="https://kathy-torfs.github.io/Orthodoxeweg/images/photeinos_school.png" class="menu-icoon" alt="School" />
    </a>
  </nav>

  <!-- Spellen -->
  <div class="container-spellen">
    <div class="intro-titel">Kies een spelletje om te spelen:</div>
    <div id="spellenLijst"></div>
  </div>

  <!-- Photeinos GIF -->
  <img id="photeinosGif" class="photeinos-gif" src="https://kathy-torfs.github.io/Orthodoxeweg/images/photeinos_kiekeboeduim.gif" alt="Photeinos duim" />

  <!-- Popup -->
  <div class="modal" id="popup">
    <div class="card">
      <div class="title">
        <img src="https://kathy-torfs.github.io/Orthodoxeweg/images/photeinos_klok.png" alt="" style="width:34px;height:34px" />
        <span>Niet genoeg punten</span>
      </div>
      <div class="text" id="popupText">Je hebt niet genoeg lichtjes voor dit spel. Kom later terug!</div>
      <div class="row">
        <button class="btn ghost" id="popupOk">Oké</button>
      </div>
    </div>
  </div>

  <script>
    // Pastel achtergrond random
    (function(){
      const p = ['var(--pastel1)','var(--pastel2)','var(--pastel3)','var(--pastel4)','var(--pastel5)','var(--pastel6)','var(--pastel7)','var(--pastel8)','var(--pastel9)','var(--pastel10)','var(--pastel11)','var(--pastel12)','var(--pastel13)','var(--pastel14)','var(--pastel15)','var(--pastel16)'];
      document.body.style.background = p[Math.floor(Math.random()*p.length)];
    })();

    // Begroeting
    const kindNaam = localStorage.getItem("ingelogdKindVoornaam") || "Kind";
    function welkomstGroet(){
      const u = new Date().getHours();
      if (u>=6 && u<=11) return "Goeiemorgen";
      if (u>=12 && u<=16) return "Goeiemiddag";
      if (u>=17 && u<=22) return "Goeieavond";
      return "Hallo";
    }
    document.getElementById("groet-tekst").textContent = `${welkomstGroet()}, ${kindNaam}!`;

    // Uitloggen
    document.getElementById("uitlogBtn").onclick = function(){
      localStorage.removeItem("kindIngelogd");
      localStorage.removeItem("ingelogdKindId");
      localStorage.removeItem("ingelogdKindVoornaam");
      localStorage.removeItem("kindAvatarURL");
      localStorage.removeItem("kindPunten");
      window.location.href = "https://kathy-torfs.github.io/Orthodoxeweg/volwassenmodus/parochie.html";
    };

    // Firebase
    const firebaseConfig = {
      apiKey:"AIzaSyBG1iQBmruHUZI1OeW8RgbJ_TPit_7a2LQ",
      authDomain:"orthodoxeweg.firebaseapp.com",
      projectId:"orthodoxeweg",
      storageBucket:"orthodoxeweg.appspot.com",
      messagingSenderId:"408582263618",
      appId:"1:408582263618:web:0a20f4bf0704989d3ceedb"
    };
    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const parochieId = localStorage.getItem("ingelogdeParochie");
    const ouderLogin = localStorage.getItem("loginKeuze");
    const kindId     = localStorage.getItem("ingelogdKindId");

    // Spellenlijst (zelfde logica als in de app)
    const spellen = [
      // betaalde
      { id:"vierop1rij",  titel:"Vier op een rij", kost:20, icon:"https://kathy-torfs.github.io/Orthodoxeweg/images/vier.png",        link:"vierop1rij.html" },
      { id:"molenspel",   titel:"Molenspel",      kost:20, icon:"https://kathy-torfs.github.io/Orthodoxeweg/images/molenspel.png", link:"molenspel.html" },
      { id:"memory",      titel:"Noah’s Ark",     kost:20, icon:"https://kathy-torfs.github.io/Orthodoxeweg/images/noah.png",       link:"memory.html" },
      { id:"patience",    titel:"Patience",       kost:20, icon:"https://kathy-torfs.github.io/Orthodoxeweg/images/patience.png",   link:"patience.html" },
      { id:"kerk",        titel:"Kerk bouwen",    kost:20, icon:"https://kathy-torfs.github.io/Orthodoxeweg/images/kerk.png",       link:"kerkbouwen.html" },
      { id:"photeinos",   titel:"Springspel",     kost:20, icon:"https://kathy-torfs.github.io/Orthodoxeweg/images/photeinos.png",  link:"springspel.html" },
      // educatief (gratis)
      { id:"catechesequiz", titel:"Catechesequiz", kost:0, icon:"https://kathy-torfs.github.io/Orthodoxeweg/images/catechese.png",  link:"catechesequiz.html" },
      { id:"trivia",        titel:"Bijbeltrivia",  kost:0, icon:"https://kathy-torfs.github.io/Orthodoxeweg/images/trivia.png",     link:"bijbeltrivia.html" },
      { id:"leesschat",     titel:"Lees-schat",    kost:0, icon:"https://kathy-torfs.github.io/Orthodoxeweg/images/boek.png",       link:"leesschat.html" },
      { id:"wiskunde",      titel:"Wiskundespel",  kost:0, icon:"https://kathy-torfs.github.io/Orthodoxeweg/images/wiskunde.png",   link:"wiskunde.html" },
    ];

    // punten laden
    let puntenCache = 0;
    async function laadPunten(){
      const teller = document.getElementById("punten-teller");
      if (!parochieId || !ouderLogin || !kindId){ teller.textContent = "…"; return; }
      try{
        const doc = await db.collection("parochies").doc(parochieId)
          .collection("leden").doc(ouderLogin)
          .collection("kinderen").doc(kindId).get();
        puntenCache = (doc.exists && doc.data().punten) ? doc.data().punten : 0;
        teller.textContent = puntenCache;
        teller.style.transform = 'scale(1.18)'; setTimeout(()=>teller.style.transform='scale(1)', 180);
        tekenSpellen(); // update knoppen enabled/disabled
      }catch(e){
        teller.textContent = "…";
      }
    }

    // auto refresh punten
    laadPunten();
    const puntenAutoRefresh = setInterval(laadPunten, 10000);
    document.addEventListener('visibilitychange', ()=>{ if(!document.hidden) laadPunten(); });
    window.addEventListener('beforeunload', ()=> clearInterval(puntenAutoRefresh));

    // teken kaarten
    function tekenSpellen(){
      const root = document.getElementById('spellenLijst');
      root.innerHTML = '';
      for(const s of spellen){
        const kaart = document.createElement('div');
        kaart.className = 'spel-card';

        const img = document.createElement('img');
        img.className = 'icoon';
        img.src = s.icon;
        img.alt = s.titel;

        const midden = document.createElement('div');
        const titel = document.createElement('div');
        titel.className = 'titel';
        titel.textContent = s.titel;

        const badges = document.createElement('div');
        const badgeKost = document.createElement('span');
        badgeKost.className = 'badge kost';
        badgeKost.textContent = s.kost ? `Kost: ${s.kost} lichtjes` : 'Gratis';
        badges.appendChild(badgeKost);

        midden.appendChild(titel);
        midden.appendChild(badges);

        const rechts = document.createElement('div');
        rechts.className = 'actie';
        const btn = document.createElement('button');
        btn.className = 'btn';
        const genoeg = puntenCache >= s.kost;
        btn.disabled = !genoeg;
        btn.textContent = genoeg ? 'Ik speel dit!' : 'Niet genoeg lichtjes';
        btn.onclick = () => startSpelOfPopup(s);
        const note = document.createElement('div');
        note.className = 'note';
        note.textContent = genoeg ? '' : 'Verdien eerst wat lichtjes met bidden/catechese.';

        rechts.appendChild(btn);
        if(!genoeg) rechts.appendChild(note);

        kaart.appendChild(img);
        kaart.appendChild(midden);
        kaart.appendChild(rechts);
        root.appendChild(kaart);
      }
    }

    // gif helper
    function toonPhoteinosGif(){
      const gif = document.getElementById('photeinosGif');
      gif.style.display='block'; gif.style.animation='none'; void gif.offsetWidth;
      gif.style.animation='photeinosInOut 2.2s linear forwards';
      setTimeout(()=> gif.style.display='none', 2200);
    }

    // popup helper
    const popup = document.getElementById('popup');
    const popupText = document.getElementById('popupText');
    document.getElementById('popupOk').onclick = ()=> popup.style.display='none';

    // start / popup
    function startSpelOfPopup(spel){
      if (puntenCache >= spel.kost){
        toonPhoteinosGif();
        // Navigeren naar spelpagina (puntenaftrek gebeurt in het spel zelf of bij start van het spel)
        setTimeout(()=>{ window.location.href = spel.link; }, 350);
      } else {
        popupText.textContent = "Je hebt niet genoeg lichtjes voor dit spel. Kom later terug!";
        popup.style.display = 'flex';
      }
    }

    // init
    tekenSpellen();
  </script>
</body>
</html>
