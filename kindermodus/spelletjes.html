<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Spelletjes – Orthodoxe Kinderpagina</title>
  <link rel="icon" href="https://kathy-torfs.github.io/Orthodoxeweg/images/kruis.png" />
  <style>
    body{
      margin:0; font-family:'Comic Sans MS', Arial, sans-serif; color:#333;
      min-height:100vh; background:var(--pastel1); transition:background .6s; overflow-x:hidden;
    }
    .container-spellen{ max-width:850px; margin:0 auto; padding:0 12px 44px 12px; }
    .intro-titel{ color:#67510C; font-size:1.6em; font-weight:bold; margin:18px 0 6px 0; text-align:center; }
    .spel-card{
      background:#fff6e2; border-radius:22px; box-shadow:0 2px 8px #0002;
      margin:16px 0; padding:18px; display:grid; grid-template-columns:88px 1fr auto; gap:14px; align-items:center;
    }
    .spel-card .icoon{
      width:72px; height:72px; border-radius:16px; object-fit:contain; background:#fff; border:1px solid #ffe0b5;
      display:block;
    }
    .spel-card .titel{ color:#4A3B20; font-size:1.15em; font-weight:bold; margin-bottom:6px; }
    .badge{ display:inline-block; background:#d8ffdf; color:#20641e; border-radius:8px; padding:3px 10px; font-size:.95em; margin-right:8px; }
    .badge.kost{ background:#fff1c7; color:#7a4d00; }
    .actie{ display:flex; flex-direction:column; gap:8px; align-items:flex-end; }
    .btn{ appearance:none; border:0; border-radius:13px; padding:11px 16px; font-weight:bold; cursor:pointer; color:#fff; background:#7bb235; min-width:180px; box-shadow:0 2px 6px #0001; }
    .btn:disabled{ background:#d8ffdf; color:#888; cursor:default; }
    .note{ font-size:.9em; color:#6b7280; }

    /* Popup */
    .modal{ position:fixed; inset:0; background:rgba(0,0,0,.35); display:none; align-items:center; justify-content:center; z-index:9999; }
    .modal .card{ background:#fff; border-radius:16px; padding:18px 18px 14px 18px; max-width:min(92vw,420px); box-shadow:0 10px 30px rgba(0,0,0,.25); }
    .modal .title{ font-weight:700; font-size:1.2em; margin:0 0 8px 0; display:flex; align-items:center; gap:10px; color:#1f2937; }
    .modal .text{ color:#374151; margin-bottom:12px; }
    .modal .row{ display:flex; gap:10px; justify-content:flex-end; }
    .ghost{ background:#eff6ff; color:#1e40af; }

    /* Photeinos GIF */
    .photeinos-gif{
      position:fixed; left:0; bottom:50px; width:110px; height:110px; z-index:1000; display:none; pointer-events:none;
      animation:photeinosInOut 2.2s linear forwards;
    }
    @keyframes photeinosInOut{
      0%{transform:translateX(-120%);} 15%{transform:translateX(12%);} 80%{transform:translateX(10%);} 100%{transform:translateX(-120%);}
    }
  </style>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore-compat.js"></script>
</head>
<body>
  <!-- Header wordt hier ingeladen -->
  <div id="header"></div>

  <!-- Inhoud -->
  <main>
    <div class="container-spellen">
      <div class="intro-titel">Kies een spelletje om te spelen:</div>
      <div id="spellenLijst"></div>
    </div>
  </main>

  <!-- Photeinos GIF -->
  <img id="photeinosGif" class="photeinos-gif" src="https://kathy-torfs.github.io/Orthodoxeweg/images/photeinos_kiekeboeduim.gif" alt="Photeinos duim" />

  <!-- Popup -->
  <div class="modal" id="popup">
    <div class="card">
      <div class="title">
        <img src="https://kathy-torfs.github.io/Orthodoxeweg/images/photeinos_klok.png" alt="" style="width:34px;height:34px" />
        <span>Niet genoeg punten</span>
      </div>
      <div class="text" id="popupText">Je hebt niet genoeg lichtjes voor dit spel. Kom later terug!</div>
      <div class="row">
        <button class="btn ghost" id="popupOk">Oké</button>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="../layout.js"></script>
  <script>
    // Firebase config
    const firebaseConfig = {
      apiKey:"AIzaSyBG1iQBmruHUZI1OeW8RgbJ_TPit_7a2LQ",
      authDomain:"orthodoxeweg.firebaseapp.com",
      projectId:"orthodoxeweg",
      storageBucket:"orthodoxeweg.appspot.com",
      messagingSenderId:"408582263618",
      appId:"1:408582263618:web:0a20f4bf0704989d3ceedb"
    };
    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const parochieId = localStorage.getItem("ingelogdeParochie");
    const ouderLogin = localStorage.getItem("loginKeuze");
    const kindId     = localStorage.getItem("ingelogdKindId");

    // Spellenlijst
    const spellen = [
      { id:"vierop1rij",  titel:"Vier op een rij", kost:20, icon:"https://kathy-torfs.github.io/Orthodoxeweg/images/vier.png",        link:"vierop1rij.html" },
      { id:"molenspel",   titel:"Molenspel",      kost:20, icon:"https://kathy-torfs.github.io/Orthodoxeweg/images/molenspel.png", link:"molenspel.html" },
      { id:"memory",      titel:"Noah’s Ark",     kost:20, icon:"https://kathy-torfs.github.io/Orthodoxeweg/images/noah.png",       link:"memory.html" },
      { id:"patience",    titel:"Patience",       kost:20, icon:"https://kathy-torfs.github.io/Orthodoxeweg/images/patience.png",   link:"patience.html" },
      { id:"kerk",        titel:"Kerk bouwen",    kost:20, icon:"https://kathy-torfs.github.io/Orthodoxeweg/images/kerk.png",       link:"kerkbouwen.html" },
      { id:"photeinos",   titel:"Springspel",     kost:20, icon:"https://kathy-torfs.github.io/Orthodoxeweg/images/photeinos.png",  link:"springspel.html" },
      // educatief
      { id:"catechesequiz", titel:"Catechesequiz", kost:0, icon:"https://kathy-torfs.github.io/Orthodoxeweg/images/catechese.png",  link:"catechesequiz.html" },
      { id:"trivia",        titel:"Bijbeltrivia",  kost:0, icon:"https://kathy-torfs.github.io/Orthodoxeweg/images/trivia.png",     link:"bijbeltrivia.html" },
      { id:"leesschat",     titel:"Lees-schat",    kost:0, icon:"https://kathy-torfs.github.io/Orthodoxeweg/images/boek.png",       link:"leesschat.html" },
      { id:"wiskunde",      titel:"Wiskundespel",  kost:0, icon:"https://kathy-torfs.github.io/Orthodoxeweg/images/wiskunde.png",   link:"wiskunde.html" },
    ];

    let puntenCache = 0;
    async function laadPunten(){
      const teller = document.getElementById("punten-teller");
      if (!parochieId || !ouderLogin || !kindId){ teller.textContent = "…"; return; }
      try{
        const doc = await db.collection("parochies").doc(parochieId)
          .collection("leden").doc(ouderLogin)
          .collection("kinderen").doc(kindId).get();
        puntenCache = (doc.exists && doc.data().punten) ? doc.data().punten : 0;
        teller.textContent = puntenCache;
        teller.style.transform = 'scale(1.18)'; setTimeout(()=>teller.style.transform='scale(1)', 180);
        tekenSpellen();
      }catch(e){ teller.textContent = "…"; }
    }

    laadPunten();
    const puntenAutoRefresh = setInterval(laadPunten, 10000);
    document.addEventListener('visibilitychange', ()=>{ if(!document.hidden) laadPunten(); });
    window.addEventListener('beforeunload', ()=> clearInterval(puntenAutoRefresh));

    function tekenSpellen(){
      const root = document.getElementById('spellenLijst');
      root.innerHTML = '';
      for(const s of spellen){
        const kaart = document.createElement('div');
        kaart.className = 'spel-card';

        const img = document.createElement('img');
        img.className = 'icoon'; img.src = s.icon; img.alt = s.titel;

        const midden = document.createElement('div');
        const titel = document.createElement('div');
        titel.className = 'titel'; titel.textContent = s.titel;

        const badges = document.createElement('div');
        const badgeKost = document.createElement('span');
        badgeKost.className = 'badge kost';
        badgeKost.textContent = s.kost ? `Kost: ${s.kost} lichtjes` : 'Gratis';
        badges.appendChild(badgeKost);

        midden.appendChild(titel); midden.appendChild(badges);

        const rechts = document.createElement('div');
        rechts.className = 'actie';
        const btn = document.createElement('button');
        btn.className = 'btn';
        const genoeg = puntenCache >= s.kost;
        btn.disabled = !genoeg;
        btn.textContent = genoeg ? 'Ik speel dit!' : 'Niet genoeg lichtjes';
        btn.onclick = () => startSpelOfPopup(s);
        const note = document.createElement('div');
        note.className = 'note';
        note.textContent = genoeg ? '' : 'Verdien eerst wat lichtjes met bidden/catechese.';

        rechts.appendChild(btn); if(!genoeg) rechts.appendChild(note);

        kaart.appendChild(img); kaart.appendChild(midden); kaart.appendChild(rechts);
        root.appendChild(kaart);
      }
    }

    function toonPhoteinosGif(){
      const gif = document.getElementById('photeinosGif');
      gif.style.display='block'; gif.style.animation='none'; void gif.offsetWidth;
      gif.style.animation='photeinosInOut 2.2s linear forwards';
      setTimeout(()=> gif.style.display='none', 2200);
    }

    const popup = document.getElementById('popup');
    const popupText = document.getElementById('popupText');
    document.getElementById('popupOk').onclick = ()=> popup.style.display='none';

    function startSpelOfPopup(spel){
      if (puntenCache >= spel.kost){
        toonPhoteinosGif();
        setTimeout(()=>{ window.location.href = spel.link; }, 350);
      } else {
        popupText.textContent = "Je hebt niet genoeg lichtjes voor dit spel. Kom later terug!";
        popup.style.display = 'flex';
      }
    }

    tekenSpellen();
  </script>
</body>
</html>
