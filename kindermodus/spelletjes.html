<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Spelletjes – Orthodoxe Kinderpagina</title>
  <link rel="icon" href="https://kathy-torfs.github.io/Orthodoxeweg/images/kruis.png" />
  <link href="https://fonts.googleapis.com/css2?family=Patrick+Hand&display=swap" rel="stylesheet">

  <style>
    :root{
      --primair:#7bb235; --donker:#67510C;
      --pastel1:#fff6e5; --pastel2:#fffde6; --pastel3:#ffe8ec; --pastel4:#e7f8ff;
      --pastel5:#e6ffe5; --pastel6:#fff2fb; --pastel7:#f5ffe5; --pastel8:#f5e8ff;
      --pastel9:#fff6fb; --pastel10:#e7fff9; --pastel11:#f3e6ff; --pastel12:#ffeae6;
      --pastel13:#ecffe9; --pastel14:#f7fff3; --pastel15:#eafffa; --pastel16:#fff4ea;
    }
    body{
      margin:0; font-family:'Patrick Hand', cursive;
      min-height:100vh; background:var(--pastel1); transition:background .6s;
      display:flex; flex-direction:column;
    }
    main{ flex:1; width:95%; max-width:1200px; margin:20px auto; }

    .intro-titel{ color:#67510C; font-size:1.6em; font-weight:bold; margin:18px 0 6px 0; text-align:center; }
    .spel-card{
      background:#fff6e2; border-radius:22px; box-shadow:0 2px 8px #0002;
      margin:16px 0; padding:18px; display:grid; grid-template-columns:88px 1fr auto; gap:14px; align-items:center;
    }
    .spel-card .icoon{
      width:72px; height:72px; border-radius:16px; object-fit:contain; background:#fff; border:1px solid #ffe0b5;
      display:block;
    }
    .spel-card .titel{ color:#4A3B20; font-size:1.15em; font-weight:bold; margin-bottom:6px; }
    .badge{ display:inline-block; background:#d8ffdf; color:#20641e; border-radius:8px; padding:3px 10px; font-size:.95em; margin-right:8px; }
    .badge.kost{ background:#fff1c7; color:#7a4d00; }
    .actie{ display:flex; flex-direction:column; gap:8px; align-items:flex-end; }
    .btn{ appearance:none; border:0; border-radius:13px; padding:11px 16px; font-weight:bold; cursor:pointer; color:#fff; background:#7bb235; min-width:180px; box-shadow:0 2px 6px #0001; }
    .btn:disabled{ background:#d8ffdf; color:#888; cursor:default; }
    .note{ font-size:.9em; color:#6b7280; }

    /* Popup */
    .modal{ position:fixed; inset:0; background:rgba(0,0,0,.35); display:none; align-items:center; justify-content:center; z-index:9999; }
    .modal .card{ background:#fff; border-radius:16px; padding:18px 18px 14px 18px; max-width:min(92vw,420px); box-shadow:0 10px 30px rgba(0,0,0,.25); }
    .modal .title{ font-weight:700; font-size:1.2em; margin:0 0 8px 0; display:flex; align-items:center; gap:10px; color:#1f2937; }
    .modal .text{ color:#374151; margin-bottom:12px; }
    .modal .row{ display:flex; gap:10px; justify-content:flex-end; }
    .ghost{ background:#eff6ff; color:#1e40af; }

    /* Photeinos GIF */
    .photeinos-gif{
      position:fixed; left:0; bottom:50px; width:110px; height:110px; z-index:1000; display:none; pointer-events:none;
      animation:photeinosInOut 2.2s linear forwards;
    }
    @keyframes photeinosInOut{
      0%{transform:translateX(-120%);} 15%{transform:translateX(12%);} 80%{transform:translateX(10%);} 100%{transform:translateX(-120%);}
    }
  </style>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore-compat.js"></script>
  <script defer src="../layout.js"></script>
</head>
<body>
  <!-- Header + menubalk -->
  <div id="kinder-header" data-header-src="common/header.html"></div>

  <!-- Inhoud -->
  <main>
    <div class="intro-titel">Kies een spelletje om te spelen:</div>
    <div id="spellenLijst"></div>
  </main>

  <!-- Photeinos GIF -->
  <img id="photeinosGif" class="photeinos-gif" src="https://kathy-torfs.github.io/Orthodoxeweg/images/photeinos_kiekeboeduim.gif" alt="Photeinos duim" />

  <!-- Popup -->
  <div class="modal" id="popup">
    <div class="card">
      <div class="title">
        <img src="https://kathy-torfs.github.io/Orthodoxeweg/images/photeinos_klok.png" alt="" style="width:34px;height:34px" />
        <span>Niet genoeg punten</span>
      </div>
      <div class="text" id="popupText">Je hebt niet genoeg lichtjes voor dit spel. Kom later terug!</div>
      <div class="row">
        <button class="btn ghost" id="popupOk">Oké</button>
      </div>
    </div>
  </div>

  <script>
    // pastel achtergrond random
    (function(){
      const p=['var(--pastel1)','var(--pastel2)','var(--pastel3)','var(--pastel4)',
               'var(--pastel5)','var(--pastel6)','var(--pastel7)','var(--pastel8)',
               'var(--pastel9)','var(--pastel10)','var(--pastel11)','var(--pastel12)',
               'var(--pastel13)','var(--pastel14)','var(--pastel15)','var(--pastel16)'];
      document.body.style.background = p[Math.floor(Math.random()*p.length)];
    })();

    // Firebase init
    const firebaseConfig = {
      apiKey:"AIzaSyBG1iQBmruHUZI1OeW8RgbJ_TPit_7a2LQ",
      authDomain:"orthodoxeweg.firebaseapp.com",
      projectId:"orthodoxeweg",
      storageBucket:"orthodoxeweg.appspot.com",
      messagingSenderId:"408582263618",
      appId:"1:408582263618:web:0a20f4bf0704989d3ceedb"
    };
    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const parochieId = localStorage.getItem("ingelogdeParochie");
    const ouderLogin = localStorage.getItem("loginKeuze");
    const kindId     = localStorage.getItem("ingelogdKindId");

    const spellen = [
      { id:"vierop1rij",  titel:"Vier op een rij", kost:20, icon:"https://kathy-torfs.github.io/Orthodoxeweg/images/vier.png",        link:"vierop1rij.html" },
      { id:"molenspel",   titel:"Molenspel",      kost:20, icon:"https://kathy-torfs.github.io/Orthodoxeweg/images/molenspel.png", link:"molenspel.html" },
      { id:"memory",      titel:"Noah’s Ark",     kost:20, icon:"https://kathy-torfs.github.io/Orthodoxeweg/images/noah.png",       link:"memory.html" },
      { id:"patience",    titel:"Patience",       kost:20, icon:"https://kathy-torfs.github.io/Orthodoxeweg/images/patience.png",   link:"patience.html" },
      { id:"kerk",        titel:"Kerk bouwen",    kost:20, icon:"https://kathy-torfs.github.io/Orthodoxeweg/images/kerk.png",       link:"kerkbouwen.html" },
      { id:"photeinos",   titel:"Springspel",     kost:20, icon:"https://kathy-torfs.github.io/Orthodoxeweg/images/photeinos.png",  link:"springspel.html" },
      { id:"catechesequiz", titel:"Catechesequiz", kost:0, icon:"https://kathy-torfs.github.io/Orthodoxeweg/images/catechese.png",  link:"catechesequiz.html" },
      { id:"trivia",        titel:"Bijbeltrivia",  kost:0, icon:"https://kathy-torfs.github.io/Orthodoxeweg/images/trivia.png",     link:"bijbeltrivia.html" },
      { id:"leesschat",     titel:"Lees-schat",    kost:0, icon:"https://kathy-torfs.github.io/Orthodoxeweg/images/boek.png",       link:"leesschat.html" },
      { id:"wiskunde",      titel:"Wiskundespel",  kost:0, icon:"https://kathy-torfs.github.io/Orthodoxeweg/images/wiskunde.png",   link:"wiskunde.html" },
    ];

    let puntenCache = 0;
    async function laadPunten(){
      const teller = document.getElementById("punten-teller");
      if (!parochieId || !ouderLogin || !kindId){ teller.textContent = "…"; return; }
      try{
        const doc = await db.collection("parochies").doc(parochieId)
          .collection("leden").doc(ouderLogin)
          .collection("kinderen").doc(kindId).get();
        puntenCache = (doc.exists && doc.data().punten) ? doc.data().punten : 0;
        teller.textContent = puntenCache;
        tekenSpellen();
      }catch(e){ teller.textContent = "…"; }
    }

    laadPunten();
    setInterval(laadPunten, 10000);

    function tekenSpellen(){
      const root = document.getElementById('spellenLijst');
      root.innerHTML = '';
      for(const s of spellen){
        const kaart = document.createElement('div');
        kaart.className = 'spel-card';

        const img = document.createElement('img');
        img.className = 'icoon'; img.src = s.icon; img.alt = s.titel;

        const midden = document.createElement('div');
        const titel = document.createElement('div');
        titel.className = 'titel'; titel.textContent = s.titel;

        const badges = document.createElement('div');
        const badgeKost = document.createElement('span');
        badgeKost.className = 'badge kost';
        badgeKost.textContent = s.kost ? `Kost: ${s.kost} lichtjes` : 'Gratis';
        badges.appendChild(badgeKost);

        midden.appendChild(titel); midden.appendChild(badges);

        const rechts = document.createElement('div');
        rechts.className = 'actie';
        const btn = document.createElement('button');
        btn.className = 'btn';
        const genoeg = puntenCache >= s.kost;
        btn.disabled = !genoeg;
        btn.textContent = genoeg ? 'Ik speel dit!' : 'Niet genoeg lichtjes';
        btn.onclick = () => startSpelOfPopup(s);
        const note = document.createElement('div');
        note.className = 'note';
        note.textContent = genoeg ? '' : 'Verdien eerst wat lichtjes met bidden/catechese.';

        rechts.appendChild(btn); if(!genoeg) rechts.appendChild(note);

        kaart.appendChild(img); kaart.appendChild(midden); kaart.appendChild(rechts);
        root.appendChild(kaart);
      }
    }

    function toonPhoteinosGif(){
      const gif = document.getElementById('photeinosGif');
      gif.style.display='block'; gif.style.animation='none'; void gif.offsetWidth;
      gif.style.animation='photeinosInOut 2.2s linear forwards';
      setTimeout(()=> gif.style.display='none', 2200);
    }

    const popup = document.getElementById('popup');
    const popupText = document.getElementById('popupText');
    document.getElementById('popupOk').onclick = ()=> popup.style.display='none';

    function startSpelOfPopup(spel){
      if (puntenCache >= spel.kost){
        toonPhoteinosGif();
        setTimeout(()=>{ window.location.href = spel.link; }, 350);
      } else {
        popupText.textContent = "Je hebt niet genoeg lichtjes voor dit spel. Kom later terug!";
        popup.style.display = 'flex';
      }
    }

    // Header inladen
    (function boot(){
      if(!(window.KinderLayout)) return setTimeout(boot,120);
      const el=document.getElementById('kinder-header');
      window.KinderLayout.mountHeader({
        rootId:'kinder-header',
        headerSrc:el.dataset.headerSrc
      });
    })();
  </script>
</body>
</html>
