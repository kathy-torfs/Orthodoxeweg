<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Horologion - Orthodoxeweg</title>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
  <style>
    html, body { height: 100%; margin: 0; padding: 0; width: 100vw; }
    body { display: flex; align-items: center; justify-content: center; background: #222; min-height: 100vh;}
    .img-container { position: relative; width: 98vw; max-width: 700px; aspect-ratio: 4/5; background: #444;
      border-radius: 16px; box-shadow: 0 0 48px #000a; display: flex; align-items: center; justify-content: center; }
    .img-container img { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; z-index: 1;
      filter: brightness(0.98); }
    .overlay { position: relative; z-index: 2; width: 100%; height: 100%; display: flex; flex-direction: column;
      justify-content: space-between; align-items: stretch; color: #fff; text-shadow: 0 3px 12px #000b;
      font-family: 'Segoe UI', Georgia, serif; box-sizing: border-box; padding: 0 0.5em; }
    .bovenrij {
      display: flex; flex-direction: row; align-items: flex-start; justify-content: space-between;
      width: 100%; margin-top: 1em; position: relative; min-height: 2.8em;
    }
    .bovenrij .links, .bovenrij .links2 {
      background: rgba(35,35,35,0.33); border-radius: 8px; padding: 0.28em 1em; min-width: 110px; 
      text-align: left; font-size: 1.08em; margin-left: 2vw;
    }
    .bovenrij .links2 { margin-top: 0.08em;}
    .bovenrij .rechts {
      background: rgba(35,35,35,0.33); border-radius: 8px; padding: 0.28em 1em; min-width: 80px;
      text-align: center; font-size: 1.08em; margin-right: 2vw;
    }
    .bovenrij .datumrij {
      position: absolute; left: 50%; top: 0; transform: translateX(-50%);
      font-size: 1.17em; font-weight: 600; letter-spacing: 0.04em;
      background: rgba(38,38,38,0.47); border-radius: 8px; padding: 0.28em 1.2em; text-align: center;
    }
    .tijd {
      position: absolute; left: 50%; top: 2.7em; transform: translateX(-50%);
      font-size: 2.2em; font-weight: 700; letter-spacing: 0.06em; 
      text-align: center; background: rgba(35,35,35,0.30); border-radius: 12px;
      box-shadow: 0 1px 8px #0005; padding: 0.13em 0.13em; width: 220px; z-index: 10;
    }
    .horologion-midden { width: 92%; margin: 0 auto; background: rgba(35,35,35,0.45); border-radius: 10px; box-shadow: 0 2px 12px #0007; padding: 1.1em 0.7em 1.15em 0.7em; font-size: 1.09em; text-align: center; min-height: 2.5em; display: flex; align-items: center; justify-content: center; flex-direction: column;}
    .onder {
      width: 100%; display: flex; flex-direction: row; align-items: center; justify-content: center; margin-bottom: 0.7em;
      gap: 1em;
    }
    .vastenregel { background: rgba(40,40,40,0.42); border-radius: 10px; box-shadow: 0 1px 9px #0005; padding: 0.65em 1em; font-size: 1.02em; font-weight: 500; text-align: center; color: #ffecb3; max-width: 70vw; word-break: break-word; margin: 0 auto;}
    .taal-select-wrap { background: rgba(40,40,40,0.54); border-radius: 8px; padding: 0.22em 0.75em 0.22em 0.45em; box-shadow: 0 2px 12px #0007; font-size: 1.08em; opacity: 0.96; display: flex; align-items: center; gap: 0.4em;}
    .taal-select-wrap select { font-size: 1em; border: none; background: rgba(60,60,60,0.31); color: #fff; border-radius: 4px; padding: 0.18em 0.3em;}
    blockquote {
      background: rgba(60,60,60,0.31);
      border-left: 5px solid #ffdba2;
      border-radius: 8px;
      margin: 1em auto 0.5em auto;
      padding: 0.7em 1.1em;
      font-size: 1.09em;
      max-width: 600px;
      color: #ffe;
      text-align: center;
      box-shadow: 0 2px 12px #0004;
    }
    @media (max-width: 650px) {
      .img-container { max-width: 100vw;}
      .bovenrij { font-size: 0.95em; margin-top: 0.7em;}
      .bovenrij .links, .bovenrij .links2, .bovenrij .rechts { min-width: 80px; font-size: 0.91em;}
      .bovenrij .datumrij { font-size: 1em;}
      .tijd { font-size: 1.23em; width: 128px;}
      .horologion-midden { font-size: 1em; padding: 0.7em 0.2em 0.9em 0.2em;}
      .vastenregel { font-size: 0.90em; max-width: 58vw;}
      .taal-select-wrap { font-size: 0.97em;}
    }
    @media (max-width: 430px) {
      .bovenrij { font-size: 0.83em; }
      .bovenrij .rechts, .bovenrij .links, .bovenrij .links2 { min-width: 42px; font-size: 0.79em;}
      .bovenrij .datumrij { font-size: 0.85em;}
      .tijd { font-size: 0.91em; width: 98px;}
      .horologion-midden { font-size: 0.90em; }
      .vastenregel { font-size: 0.80em; padding: 0.42em 0.38em;}
      .taal-select-wrap { font-size: 0.85em; }
      blockquote { font-size: 0.91em; }
    }
  </style>
</head>
<body>
  <div class="img-container">
    <img src="images/moeder_gods.jpg" alt="Moeder Gods icoon" />
    <div class="overlay">
      <div class="bovenrij">
        <span class="links" id="zonsopgang">zonsopgang ...</span>
        <span class="links2" id="zonsondergang">zonsondergang ...</span>
        <span class="datumrij" id="datum">12 juli 2025</span>
        <span class="rechts" id="temperatuur">...</span>
        <div class="tijd" id="tijd">09:29</div>
      </div>
      <div class="horologion-midden" id="horologion"></div>
      <div class="onder">
        <div class="vastenregel" id="vastenregel"></div>
        <div class="taal-select-wrap">
          <select id="taalkeuze">
            <option value="VL">Vlaams</option>
            <option value="FR">Frans</option>
            <option value="DE">Duits</option>
            <option value="EN">Engels</option>
            <option value="GR">Grieks</option>
            <option value="AR">Arabisch</option>
            <option value="RU">Russisch</option>
            <option value="UA">Oekraïens</option>
          </select>
        </div>
      </div>
    </div>
  </div>
  <script>
    // --- Vertalingen
    const vertalingen = {
      "zonsopgang": { "VL": "zonsopgang", "EN": "sunrise", "FR": "lever du soleil", "DE": "Sonnenaufgang", "GR": "ανατολή ηλίου", "AR": "شروق الشمس", "RU": "восход солнца", "UA": "схід сонця" },
      "zonsondergang": { "VL": "zonsondergang", "EN": "sunset", "FR": "coucher du soleil", "DE": "Sonnenuntergang", "GR": "δύση ηλίου", "AR": "غروب الشمس", "RU": "закат", "UA": "захід сонця" },
      "taal": { "VL": "Vlaams", "EN": "Engels", "FR": "Frans", "DE": "Duits", "GR": "Grieks", "AR": "Arabisch", "RU": "Russisch", "UA": "Oekraïens" },
      "maand": {
        "VL": ["januari", "februari", "maart", "april", "mei", "juni", "juli", "augustus", "september", "oktober", "november", "december"],
        "FR": ["janvier", "février", "mars", "avril", "mai", "juin", "juillet", "août", "septembre", "octobre", "novembre", "décembre"],
        "DE": ["Januar", "Februar", "März", "April", "Mai", "Juni", "Juli", "August", "September", "Oktober", "November", "Dezember"],
        "EN": ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"],
        "GR": ["Ιανουάριος","Φεβρουάριος","Μάρτιος","Απρίλιος","Μάιος","Ιούνιος","Ιούλιος","Αύγουστος","Σεπτέμβριος","Οκτώβριος","Νοέμβριος","Δεκέμβριος"],
        "AR": ["يناير","فبراير","مارس","أبريل","مايو","يونيو","يوليو","أغسطس","سبتمبر","أكتوبر","نوفمبر","ديسمبر"],
        "RU": ["января","февраля","марта","апреля","мая","июня","июля","августа","сентября","октября","ноября","декабря"],
        "UA": ["січня","лютого","березня","квітня","травня","червня","липня","серпня","вересня","жовтня","листопада","грудня"]
      }
    };

    // --- Fallback gebeden (volledig)
    const moederGodGebed = { ... }; // vul volledig in zoals eerder, hier ivm limiet afgekort!
    const jezusGebed = { ... };

    // --- Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyBG1iQBmruHUZI1OeW8RgbJ_TPit_7a2LQ",
      authDomain: "orthodoxeweg.firebaseapp.com",
      projectId: "orthodoxeweg",
      storageBucket: "orthodoxeweg.firebasestorage.app",
      messagingSenderId: "408582263618",
      appId: "1:408582263618:web:0a20f4bf0704989d3ceedb",
      measurementId: "G-C942F2NYQV"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    let geselecteerdeTaal = "VL";
    let zonsopgangMinuten = null;
    let zonsondergangMinuten = null;

    document.getElementById('taalkeuze').addEventListener('change', function() {
      geselecteerdeTaal = this.value;
      updateZonsLabels();
      updateDatum();
      updateHorologionEnVastenregel();
    });

    document.addEventListener("DOMContentLoaded", () => {
      updateDatum();
    });

    function updateDatum() {
      const nu = new Date();
      const dag = nu.getDate().toString().padStart(2, "0");
      const maandIndex = nu.getMonth();
      const jaar = nu.getFullYear();
      const maandNaam = (vertalingen["maand"][geselecteerdeTaal] || vertalingen["maand"]["VL"])[maandIndex];
      document.getElementById('datum').textContent = `${dag} ${maandNaam} ${jaar}`;
    }

    function updateWidget() {
      const nu = new Date();
      let hh = nu.getHours().toString().padStart(2,"0");
      let mm = nu.getMinutes().toString().padStart(2,"0");
      document.getElementById('tijd').textContent = `${hh}:${mm}`;
    }
    setInterval(updateWidget, 1000);
    updateWidget();

    async function updateWeather(lat, lon) {
      try {
        const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&daily=sunrise,sunset&timezone=Europe%2FBerlin`;
        const response = await fetch(url);
        const data = await response.json();

        if (data.current_weather && data.current_weather.temperature !== undefined)
          document.getElementById('temperatuur').textContent = `${Math.round(data.current_weather.temperature)}°C`;
        else
          document.getElementById('temperatuur').textContent = '...';

        if (data.daily && data.daily.sunrise && data.daily.sunset) {
          const sUp = new Date(data.daily.sunrise[0]);
          const sDown = new Date(data.daily.sunset[0]);
          zonsopgangMinuten = sUp.getHours()*60 + sUp.getMinutes();
          zonsondergangMinuten = sDown.getHours()*60 + sDown.getMinutes();

          document.getElementById('zonsopgang').textContent = `${vertalingen["zonsopgang"][geselecteerdeTaal]} ${sUp.getHours().toString().padStart(2,'0')}:${sUp.getMinutes().toString().padStart(2,'0')}`;
          document.getElementById('zonsondergang').textContent = `${vertalingen["zonsondergang"][geselecteerdeTaal]} ${sDown.getHours().toString().padStart(2,'0')}:${sDown.getMinutes().toString().padStart(2,'0')}`;
          updateHorologionEnVastenregel();
        }
      } catch(e){
        document.getElementById('temperatuur').textContent = '...';
      }
    }

    function initWeather() {
      if ('geolocation' in navigator) {
        navigator.geolocation.getCurrentPosition(
          pos => { updateWeather(pos.coords.latitude, pos.coords.longitude); setInterval(() => updateWeather(pos.coords.latitude, pos.coords.longitude),600000); },
          () => { updateWeather(50.85,4.35); setInterval(() => updateWeather(50.85,4.35),600000); },
          { enableHighAccuracy: false, timeout: 7000, maximumAge: 360000 }
        );
      } else {
        updateWeather(50.85,4.35);
        setInterval(() => updateWeather(50.85,4.35),600000);
      }
    }
    initWeather();

    function updateZonsLabels(){
      let zo = document.getElementById('zonsopgang').textContent.match(/\d{2}:\d{2}/)||["..."];
      let zs = document.getElementById('zonsondergang').textContent.match(/\d{2}:\d{2}/)||["..."];
      document.getElementById('zonsopgang').textContent = `${vertalingen["zonsopgang"][geselecteerdeTaal]} ${zo[0]}`;
      document.getElementById('zonsondergang').textContent = `${vertalingen["zonsondergang"][geselecteerdeTaal]} ${zs[0]}`;
    }

    function bepaalGebedsmoment() {
      const nu = new Date();
      const nuMin = nu.getHours()*60 + nu.getMinutes();
      if (zonsopgangMinuten==null||zonsondergangMinuten==null) return 6;
      if (nuMin < zonsopgangMinuten) return 6; // middernacht
      if (nuMin < zonsopgangMinuten+180) return 0; // eerste uur
      if (nuMin < zonsopgangMinuten+360) return 1; // derde uur
      if (nuMin < zonsopgangMinuten+540) return 2; // zesde uur
      if (nuMin < zonsondergangMinuten) return 3;  // negende uur
      if (nuMin < zonsondergangMinuten+60) return 4; // vesper
      return 5; // completen
    }

    function zoekTekst(doc, lijst) {
      for(let key of lijst) if(doc.data()[key]) return doc.data()[key];
      return "";
    }

    function updateHorologionEnVastenregel() {
      const datum = (new Date()).toISOString().slice(0,10).replace(/-/g,"");
      const moment = bepaalGebedsmoment();
      const uur = new Date().getHours();

      db.collection("Horologion").doc(Object.keys(momentNames)[moment]).get().then(doc=>{
        let tekst = "";
        let kort = "";
        if (doc.exists) {
          const prio = {
            "DE":["DE","VL","EN"], "FR":["FR","EN","VL"], "GR":["GR","EN","VL"], "AR":["AR","EN","VL"],
            "RU":["RU","UA","EN","VL"], "UA":["UA","RU","EN","VL"], "EN":["EN","VL"], "VL":["VL","EN"]
          };
          tekst = zoekTekst(doc, prio[geselecteerdeTaal]||["VL","EN"]);
          kort = zoekTekst(doc, [prio[geselecteerdeTaal].map(x=>x+"_KORT"), Object.keys(doc.data()).filter(k=>k.endsWith("_KORT"))].flat());
        }
        let html = "";
        if(tekst && tekst.trim()!==""){
          html = `<blockquote>${tekst}</blockquote>`;
        } else if (kort) {
          html = `<blockquote>${kort}</blockquote><blockquote>${uur%2===0?moederGodGebed[geselecteerdeTaal]:jezusGebed[geselecteerdeTaal]}</blockquote>`;
        } else {
          html = `<blockquote>${uur%2===0?moederGodGebed[geselecteerdeTaal]:jezusGebed[geselecteerdeTaal]}</blockquote>`;
        }
        document.getElementById('horologion').innerHTML = html;
      });

      db.collection("kalender2025").doc(datum).get().then(doc=>{
        let tekst = "";
        if(doc.exists){
          const prio = {
            "DE":["Vastenregel DE","Vastenregel NL","Vastenregel EN"], "FR":["Vastenregel FR","Vastenregel EN","Vastenregel NL"],
            "GR":["Vastenregel GR","Vastenregel EN","Vastenregel NL"], "AR":["Vastenregel AR","Vastenregel EN","Vastenregel NL"],
            "RU":["Vastenregel RU","Vastenregel UA","Vastenregel EN","Vastenregel NL"], "UA":["Vastenregel UA","Vastenregel RU","Vastenregel EN","Vastenregel NL"],
            "EN":["Vastenregel EN","Vastenregel NL"], "VL":["Vastenregel NL","Vastenregel EN"]
          };
          tekst = zoekTekst(doc, prio[geselecteerdeTaal]||["Vastenregel NL","Vastenregel EN"]);
        }
        if(!tekst) tekst = getVastenvrijTekst(geselecteerdeTaal);
        document.getElementById('vastenregel').textContent=tekst;
      });
    }
    // Voor de juiste documentnaam in Horologion
    const momentNames = ["eerste_uur", "derde_uur", "zesde_uur", "negende_uur", "vesper", "complet", "middernacht"];

    setInterval(updateHorologionEnVastenregel,60000);
    updateHorologionEnVastenregel();

    function getVastenvrijTekst(taal){
      return {
        "EN":"No fasting","FR":"Jour sans jeûne","DE":"Fastenfrei","GR":"Ἀπολυτή. Ἀργία.","AR":"يوم بدون صوم","RU":"Поста нет","UA":"Без посту","VL":"Vastenvrij"
      }[taal]||"Vastenvrij";
    }
  </script>
</body>
</html>
