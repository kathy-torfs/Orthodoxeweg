<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kathisma ‚Äì Psalmen (Priestermodus)</title>
  <style>
    body {
      background-color: #f5e9b8;
      color: #6f4e1a;
      font-family: Arial, sans-serif;
      margin: 0; padding: 0;
    }
    .statusbar {
      background: #7a5f35;
      color: #fff;
      padding: 10px 24px;
      text-align: left;
      font-size: 1.07em;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .uitlog-link {
      color: #fff;
      background: #9a2617;
      padding: 6px 16px;
      border-radius: 8px;
      font-size: 1em;
      text-decoration: none;
      font-weight: bold;
      margin-left: 20px;
      transition: background 0.18s;
      cursor: pointer;
      border: none;
      outline: none;
    }
    .uitlog-link:hover {
      background: #bd2e23;
    }
    nav.menu {
      background-color: #7a5f35;
      padding: 10px 15px;
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      justify-content: center;
    }
    nav.menu a {
      color: #f5e9b8;
      text-decoration: none;
      font-weight: 600;
      font-size: 16px;
      padding: 6px 12px;
      border-radius: 8px;
      transition: background-color 0.3s;
    }
    nav.menu a:hover {
      background-color: #5d4726;
      text-decoration: underline;
    }
    main {
      max-width: 900px;
      margin: 32px auto 50px auto;
      padding: 0 14px;
    }
    h1 {
      text-align: center;
      font-size: 28px;
      font-weight: bold;
      text-decoration: underline;
      margin-bottom: 30px;
    }
    .psalmlijst {
      margin: 22px 0 50px 0;
      display: flex;
      flex-direction: column;
      gap: 36px;
    }
    .psalm-blok {
      background: #fff8dc;
      border: 2px solid #c2a357;
      border-radius: 12px;
      box-shadow: 0 4px 16px #d98f5d22;
      padding: 18px 22px 15px 22px;
      margin-bottom: 0;
      font-size: 1.11em;
    }
    .psalm-titel {
      font-weight: bold;
      color: #ad831c;
      font-size: 1.18em;
      margin-bottom: 7px;
    }
    .terug-btn {
      background-color: #7a5f35;
      color: #f5e9b8;
      padding: 11px 38px;
      border-radius: 9px;
      text-decoration: none;
      font-weight: bold;
      font-size: 18px;
      box-shadow: 0 4px 4px rgb(0 0 0 / 0.20);
      border: none;
      cursor: pointer;
      min-width: 160px;
      text-align: center;
      transition: background 0.2s;
      display: block;
      margin: 40px auto 0 auto;
    }
    .terug-btn:hover { background-color: #5d4726; }
    .error {
      color: #fff;
      background: #b42c25;
      border-radius: 8px;
      padding: 14px;
      margin: 40px auto 0 auto;
      max-width: 400px;
      font-size: 1.13em;
      text-align: center;
      box-shadow: 0 4px 16px #d98f5d26;
    }
    @media (max-width: 700px) {
      main { padding: 0 2vw; }
      .psalm-blok { padding: 14px 8px 12px 10px; font-size: 1em;}
    }
  </style>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>
<body>
  <!-- Statusbalk -->
  <div class="statusbar">
    <span>
      U bent ingelogd in: <span id="parochieNaam">...</span>
    </span>
    <button class="uitlog-link" id="uitlogKnop">üö™ Uitloggen</button>
  </div>

  <nav class="menu">
    <a href="https://kathy-torfs.github.io/Orthodoxeweg/priestermodus/startpagina.html">üè† Home</a>
    <a href="https://kathy-torfs.github.io/Orthodoxeweg/priestermodus/parochie.html">üõê Mijn parochie</a>
    <a href="https://kathy-torfs.github.io/Orthodoxeweg/priestermodus/psalmen/psalmen.html">üìú Psalmen</a>
    <a href="https://kathy-torfs.github.io/Orthodoxeweg/priestermodus/gebeden/gebeden.html">üôè Gebeden</a>
    <a href="https://kathy-torfs.github.io/Orthodoxeweg/priestermodus/gebeden/geloofsbelijdenis.html">‚úù Geloofsbelijdenis</a>
    <a href="https://kathy-torfs.github.io/Orthodoxeweg/priestermodus/catechese/catechese.html">üìñ Catechese</a>
    <a href="https://kathy-torfs.github.io/Orthodoxeweg/priestermodus/layout.html">üß∞ Bewerk parochie</a>
  </nav>

  <main>
    <h1 id="kathismaTitel">Kathisma</h1>
    <div id="psalmlijst" class="psalmlijst"></div>
    <div id="error" class="error" style="display:none;"></div>
    <a href="psalmen.html" class="terug-btn">‚Üê Terug naar overzicht</a>
  </main>

  <script>
    // Parochie in statusbar
    let parochieNaam = localStorage.getItem("ingelogdeParochie");
    if (parochieNaam) {
      document.getElementById("parochieNaam").textContent = parochieNaam;
    } else {
      document.getElementById("parochieNaam").textContent = "(niet ingelogd)";
    }
    document.getElementById("uitlogKnop").onclick = function() {
      localStorage.removeItem("ingelogdeParochie");
      localStorage.removeItem("ingelogdeParochieId");
      window.location.href = "https://kathy-torfs.github.io/Orthodoxeweg/index.html";
    };

    // Firebase setup
    const firebaseConfig = {
      apiKey: "AIzaSyBKEakRzmnPZ3DY8NUkZrZr_YtqBbNVHL4",
      authDomain: "orthodoxeweg.firebaseapp.com",
      projectId: "orthodoxeweg",
      storageBucket: "orthodoxeweg.appspot.com",
      messagingSenderId: "408582263618",
      appId: "1:408582263618:web:2e02833fa0d4d8903ceedb"
    };
    if (!firebase.apps.length) { firebase.initializeApp(firebaseConfig); }
    const db = firebase.firestore();

    // Query parameter uitlezen
    function getQueryParam(param) {
      let url = new URL(window.location.href);
      return url.searchParams.get(param);
    }

    // Ophalen en tonen van kathisma en psalmen
    async function laadKathisma() {
      const nr = parseInt(getQueryParam("nr"), 10);
      if (isNaN(nr) || nr < 1 || nr > 20) {
        document.getElementById("error").textContent = "Ongeldig kathismanummer.";
        document.getElementById("error").style.display = "";
        document.getElementById("psalmlijst").style.display = "none";
        document.getElementById("kathismaTitel").textContent = "Fout";
        return;
      }
      const docId = "kathisma_" + nr;
      let doc;
      try {
        doc = await db.collection("kathismata_xxl").doc(docId).get();
      } catch(e) {
        document.getElementById("error").textContent = "Fout bij het ophalen van deze kathisma.";
        document.getElementById("error").style.display = "";
        document.getElementById("psalmlijst").style.display = "none";
        document.getElementById("kathismaTitel").textContent = "Fout";
        return;
      }
      if(!doc.exists) {
        document.getElementById("error").textContent = "Deze kathisma bestaat niet.";
        document.getElementById("error").style.display = "";
        document.getElementById("psalmlijst").style.display = "none";
        document.getElementById("kathismaTitel").textContent = "Niet gevonden";
        return;
      }
      const data = doc.data();
      document.getElementById("kathismaTitel").textContent = data.kathisma || ("Kathisma " + nr);
      const lijst = document.getElementById("psalmlijst");
      lijst.innerHTML = "";

      // Elke psalm weergeven als apart blokje
      if(Array.isArray(data.psalmen)) {
        data.psalmen.forEach((ps, idx) => {
          let blok = document.createElement("div");
          blok.className = "psalm-blok";
          blok.innerHTML = `
            <div class="psalm-titel">${ps.psalm || `Psalm ${idx+1}`}</div>
            <div class="psalm-tekst">${(ps.tekst||"").replace(/\n/g,"<br>")}</div>
          `;
          lijst.appendChild(blok);
        });
      } else {
        lijst.innerHTML = "<div class='psalm-blok'>Geen psalmen gevonden in deze kathisma.</div>";
      }
    }

    laadKathisma();
  </script>
</body>
</html>
