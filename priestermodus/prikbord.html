<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <title>Prikbordbeheer ‚Äì Priester</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { margin: 0; padding: 0; font-family: Arial, sans-serif; background: #d8ecf9; color: #5b4320; }
    header { background-color: #e6d6b8; padding: 2rem 1rem 0.7rem 1rem; text-align: center; }
    h1 { margin:0; font-size:2rem; color:#5d4c2f; }
    #parochieLabel {
      background: #fcf6e2; color: #7a5f35; padding: 10px 0 8px 0; text-align: center;
      font-weight: bold; letter-spacing: 1px; font-size: 1.08em;
      box-shadow: 0 2px 8px #cbb96d44; margin-bottom: 10px;
    }
    nav.menu {
      background-color: #7a5f35; padding: 12px 20px;
      display: flex; flex-wrap: wrap; gap: 14px; justify-content: center;
    }
    nav.menu a {
      color: #f8f5e9; text-decoration: none; font-weight: bold; font-size: 16px;
      padding: 6px 14px; border-radius: 8px; transition: background-color 0.3s;
    }
    nav.menu a:hover { background-color: #5e4724; }
    .uitlog-link {
      color: #fff; background: #9a2617; padding: 6px 16px; border-radius: 8px;
      font-size: 1em; text-decoration: none; font-weight: bold;
      margin-left: 14px; margin-right: 14px; transition: background 0.18s;
      cursor: pointer; border: none; float: right;
    }
    .formblok {
      padding: 20px; width: 100%; min-height: 190px; border-radius: 12px;
      box-shadow: 2px 4px 8px #0001; display: flex; flex-direction: column;
      justify-content: space-between; color: #222; font-weight: bold;
      margin-bottom: 16px;
    }
    .kleur1 { background: #fff980; border: 2px solid #ebd700; }
    .formblok textarea, .formblok input {
      width: 100%; margin-bottom: 12px; padding: 10px; border-radius: 8px;
      border: 1.5px solid #ccc; font-size: 1em;
    }
    .formblok button {
      background: #7a5f35; color: #fff; font-weight: bold; padding: 10px 20px;
      border: none; border-radius: 8px; cursor: pointer;
    }
    .formcontainer {
      max-width: 600px; margin: 30px auto;
    }
    #feedback { color:#B90000; text-align:center; font-size:1.09em; margin-bottom:20px;}
    .berichtenlijst {max-width:600px;margin:0 auto 20px auto;}
    .bericht-blok {background:#fffef9;border-radius:8px;box-shadow:0 2px 10px #e7dbad55;padding:14px 18px;margin-bottom:12px;}
    .bericht-titel {font-weight:bold;font-size:1.16em;color:#755600;margin-bottom:4px;}
    .bericht-tekst {color:#333;margin-bottom:6px;}
    .bericht-tijd {color:#a78c4f;font-size:0.98em;}
  </style>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
</head>
<body>
  <header>
    <button class="uitlog-link" id="uitlogKnop">üö™ Uitloggen</button>
    <h1 id="welkom-tekst">Welkom vader, ik wens u een gezegende dag.</h1>
    <div id="parochieLabel"></div>
  </header>
  <nav class="menu">
    <a href="https://kathy-torfs.github.io/Orthodoxeweg/priestermodus/startpagina.html">üè† Startpagina</a>
    <a href="https://kathy-torfs.github.io/Orthodoxeweg/priestermodus/parochie.html">üõê Mijn parochie</a>
    <a href="https://kathy-torfs.github.io/Orthodoxeweg/priestermodus/psalmen/psalmen.html">üìú Psalmen</a>
    <a href="https://kathy-torfs.github.io/Orthodoxeweg/priestermodus/gebeden/gebeden.html">üôè Gebeden</a>
    <a href="https://kathy-torfs.github.io/Orthodoxeweg/priestermodus/gebeden/geloofsbelijdenis.html">‚úù Geloofsbelijdenis</a>
    <a href="https://kathy-torfs.github.io/Orthodoxeweg/priestermodus/catechese/catechese.html">üìñ Catechese</a>
    <a href="https://kathy-torfs.github.io/Orthodoxeweg/priestermodus/heiligen/heiligen.html">üëº Heiligen</a>
    <a href="https://kathy-torfs.github.io/Orthodoxeweg/priestermodus/layout.html">üß∞ Bewerk parochie</a>
  </nav>
  <div class="formcontainer">
    <div id="feedback"></div>
    <div class="formblok kleur1">
      <input id="titel" placeholder="Titel">
      <textarea id="tekst" placeholder="Tekst"></textarea>
      <button onclick="opslaan()">Plaatsen</button>
    </div>
  </div>
  <div class="berichtenlijst" id="berichtenLijst"></div>
  <script>
    // AUTH & LABELS
    const parochieNaam = localStorage.getItem("ingelogdeParochie") || "(onbekend)";
    const parochieId   = localStorage.getItem("ingelogdeParochieId") || "";
    document.getElementById("parochieLabel").textContent = `U bent ingelogd in de parochie van ${parochieNaam}`;
    document.getElementById("uitlogKnop").onclick = function() {
      localStorage.clear();
      window.location.href = "https://kathy-torfs.github.io/Orthodoxeweg/index.html";
    };

    // WELKOMTEKST op dagdeel
    const welkomTekst = document.getElementById("welkom-tekst");
    const uur = new Date().getHours();
    let moment = "dag";
    if (uur >= 5 && uur < 10) moment = "goeiemorgen";
    else if (uur >= 10 && uur < 11) moment = "goedendag";
    else if (uur >= 11 && uur < 13) moment = "goedemiddag";
    else if (uur >= 13 && uur < 17) moment = "goedendag";
    else if (uur >= 17 && uur < 22) moment = "goedeavond";
    else moment = "goede nacht";
    welkomTekst.textContent = `${moment} vader, ik wens u een gezegende dag.`;

    // FIREBASE INIT
    const firebaseConfig = {
      apiKey: "AIzaSyBG1iQBmruHUZI1OeW8RgbJ_TPit_7a2LQ",
      authDomain: "orthodoxeweg.firebaseapp.com",
      projectId: "orthodoxeweg",
      storageBucket: "orthodoxeweg.appspot.com",
      messagingSenderId: "408582263618",
      appId: "1:408582263618:web:0a20f4bf0704989d3ceedb"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // OPSLAAN
    function opslaan() {
      const titel = document.getElementById('titel').value.trim();
      const tekst = document.getElementById('tekst').value.trim();
      const feedback = document.getElementById("feedback");
      feedback.textContent = "";
      if (!parochieId) {
        feedback.textContent = "‚ö†Ô∏è Kan niet opslaan: er is geen geldige parochie geselecteerd!";
        return;
      }
      if (!titel && !tekst) {
        feedback.textContent = "Vul minstens het titel- of tekstveld in.";
        return;
      }
      const data = {
        titel: titel,
        tekst: tekst,
        tijd: firebase.firestore.Timestamp.now()
      };
      db.collection("parochies")
        .doc(parochieId)
        .collection("prikbord_priesters")
        .add(data)
        .then(() => {
          feedback.style.color = "#3a8011";
          feedback.textContent = "Post-it opgeslagen!";
          document.getElementById('titel').value = "";
          document.getElementById('tekst').value = "";
          laadBerichten();
          setTimeout(() => { feedback.textContent = ""; }, 1800);
        })
        .catch((error) => {
          feedback.style.color = "#B90000";
          feedback.textContent = "Fout bij opslaan: " + error;
          console.error("Fout bij opslaan:", error);
        });
    }

    // LAAD EN TOON PRIKBORD
    function laadBerichten() {
      const lijst = document.getElementById("berichtenLijst");
      lijst.innerHTML = "<em>Berichten worden geladen...</em>";
      if (!parochieId) {
        lijst.innerHTML = "<em>Geen geldige parochie geselecteerd.</em>";
        return;
      }
      db.collection("parochies")
        .doc(parochieId)
        .collection("prikbord_priesters")
        .orderBy("tijd", "desc")
        .get()
        .then(snapshot => {
          if (snapshot.empty) {
            lijst.innerHTML = "<em>Geen prikbordberichten gevonden.</em>";
            return;
          }
          let html = "";
          snapshot.forEach(doc => {
            const d = doc.data();
            const tijd = d.tijd && d.tijd.toDate
              ? d.tijd.toDate()
              : new Date();
            const datumTekst = tijd.toLocaleString("nl-BE", {
              year: "numeric", month: "2-digit", day: "2-digit",
              hour: "2-digit", minute: "2-digit"
            });
            html += `
              <div class="bericht-blok">
                <div class="bericht-titel">${d.titel || "(zonder titel)"}</div>
                <div class="bericht-tekst">${d.tekst || ""}</div>
                <div class="bericht-tijd">üïì ${datumTekst}</div>
              </div>
            `;
          });
          lijst.innerHTML = html;
        })
        .catch(err => {
          lijst.innerHTML = "<em>Fout bij laden van berichten.</em>";
        });
    }
    // INIT
    window.onload = laadBerichten;
  </script>
</body>
</html>
