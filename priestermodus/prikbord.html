<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <title>Prikbord voor priesters</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    /* Jouw CSS hier ‚Äì kan dezelfde zijn als bij kaarsjes, desnoods kopi√´ren */
    body { font-family: Arial, sans-serif; margin:0; padding:0; background-color:#f8f5e9;}
    nav.menu { background-color: #7a5f35; padding: 12px 20px; display: flex; flex-wrap: wrap; gap: 14px; justify-content: center; }
    nav.menu a { color: #f8f5e9; text-decoration: none; font-weight: bold; font-size: 16px; padding: 6px 14px; border-radius: 8px; transition: background-color 0.3s;}
    nav.menu a:hover { background-color: #5e4724; }
    header { background-color: #e6d6b8; padding: 2rem 1rem 0.7rem 1rem; text-align: center; }
    h1 { margin:0; font-size:2rem; color:#5d4c2f;}
    #parochieLabel { background: #fcf6e2; color: #7a5f35; padding: 10px 0 8px 0; text-align: center; font-weight: bold; letter-spacing: 1px; font-size: 1.08em; box-shadow: 0 2px 8px #cbb96d44; margin-bottom: 10px; }
    .uitlog-link { color: #fff; background: #9a2617; padding: 6px 16px; border-radius: 8px; font-size: 1em; text-decoration: none; font-weight: bold; margin-top: 14px; margin-bottom: 12px; margin-left: 6px; transition: background 0.18s; cursor: pointer; border: none; outline: none; float: right; }
    .container { max-width: 780px; margin: 30px auto 40px auto; background:#fffef9; border-radius:14px; box-shadow:0 4px 16px #cbb96d32; padding:2rem; }
    .nieuw-bericht-blok { background: #f5efdd; border-radius: 12px; padding:1.1rem 1.4rem 1.2rem 1.4rem; margin-bottom:2.2rem; box-shadow: 0 2px 10px #e7dbad25;}
    .nieuw-bericht-blok h2 { font-size:1.16rem; color:#76580c; margin:0 0 0.7rem 0;}
    .nieuw-bericht-blok input, .nieuw-bericht-blok textarea { width:100%; font-size:1.06rem; border-radius:8px; border:1.2px solid #dbc592; padding:8px; margin-bottom:8px;}
    .nieuw-bericht-blok button { background:#7a5f35; color:#fff; font-weight:bold; border:none; border-radius:8px; padding:8px 20px; margin-top:1rem; font-size:1em; cursor:pointer;}
    .nieuw-bericht-blok button:hover { background: #b09765; }
    .berichten-lijst { display: flex; flex-direction: column; gap: 1.6rem;}
    .bericht-item { background: #f7ecd8; border-radius: 12px; box-shadow: 0 2px 6px #d7cbb1aa; padding: 1.1rem 1.5rem; position: relative;}
    .bericht-titel { font-weight: bold; color: #775d21; font-size: 1.15em; margin-bottom: 6px;}
    .bericht-tekst { color: #5d4c2f; font-size: 1.07rem; margin-bottom:0.6rem; }
    .bericht-tijd { font-size:0.95em; color: #bba354;}
    @media (max-width:700px){ .container {padding:0.7rem;} .berichten-lijst{gap:0.8rem;} .bericht-item{padding:0.7rem;} }
  </style>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
</head>
<body>
  <header>
    <button class="uitlog-link" id="uitlogKnop">üö™ Uitloggen</button>
    <h1 id="welkom-tekst">Prikbord voor priesters</h1>
    <div id="parochieLabel"></div>
  </header>
  <nav class="menu">
    <a href="https://kathy-torfs.github.io/Orthodoxeweg/priestermodus/startpagina.html">üè† Startpagina</a>
    <a href="https://kathy-torfs.github.io/Orthodoxeweg/priestermodus/parochie.html">üõê Mijn parochie</a>
    <a href="https://kathy-torfs.github.io/Orthodoxeweg/priestermodus/psalmen/psalmen.html">üìú Psalmen</a>
    <a href="https://kathy-torfs.github.io/Orthodoxeweg/priestermodus/gebeden/gebeden.html">üôè Gebeden</a>
    <a href="https://kathy-torfs.github.io/Orthodoxeweg/priestermodus/gebeden/geloofsbelijdenis.html">‚úù Geloofsbelijdenis</a>
    <a href="https://kathy-torfs.github.io/Orthodoxeweg/priestermodus/catechese/catechese.html">üìñ Catechese</a>
    <a href="https://kathy-torfs.github.io/Orthodoxeweg/priestermodus/heiligen/heiligen.html">üëº Heiligen</a>
    <a href="https://kathy-torfs.github.io/Orthodoxeweg/priestermodus/layout.html">üß∞ Bewerk parochie</a>
  </nav>
  <div class="container">
    <div class="nieuw-bericht-blok">
      <h2>Nieuw prikbordbericht toevoegen</h2>
      <form id="nieuwBerichtForm">
        <input id="nieuwBerichtTitel" placeholder="Titel" maxlength="60" required>
        <textarea id="nieuwBerichtTekst" required maxlength="400" placeholder="Schrijf hier uw bericht..."></textarea>
        <button type="submit">Prikbordbericht plaatsen</button>
      </form>
      <div id="nieuwBerichtFeedback"></div>
    </div>
    <div class="berichten-lijst" id="berichtenLijst">
      <!-- Prikbordberichten komen hier dynamisch -->
    </div>
  </div>
  <script>
    // Beveiliging
    if (!localStorage.getItem("ingelogdeParochie") || localStorage.getItem("modus") !== "priester") {
      window.location.href = "https://kathy-torfs.github.io/Orthodoxeweg/index.html";
    }
    let parochieNaam = localStorage.getItem("ingelogdeParochie");
    document.getElementById("parochieLabel").textContent = `U bent ingelogd in de parochie van ${parochieNaam}`;
    // Uitloggen
    document.getElementById("uitlogKnop").onclick = function() {
      localStorage.removeItem("ingelogdeParochie");
      localStorage.removeItem("ingelogdeParochieId");
      localStorage.removeItem("userId");
      localStorage.removeItem("modus");
      window.location.href = "https://kathy-torfs.github.io/Orthodoxeweg/index.html";
    };

    // FIREBASE INIT
    const firebaseConfig = {
      apiKey: "AIzaSyBG1iQBmruHUZI1OeW8RgbJ_TPit_7a2LQ",
      authDomain: "orthodoxeweg.firebaseapp.com",
      projectId: "orthodoxeweg",
      storageBucket: "orthodoxeweg.appspot.com",
      messagingSenderId: "408582263618",
      appId: "1:408582263618:web:0a20f4bf0704989d3ceedb"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Helper: parochieId uit localStorage
    const parochieId = localStorage.getItem("ingelogdeParochieId");

    // Laad alle prikbordberichten
    function laadPrikbordBerichten() {
      const lijst = document.getElementById("berichtenLijst");
      lijst.innerHTML = "<em>Prikbordberichten worden geladen...</em>";
      db.collection("parochies")
        .doc(parochieId)
        .collection("prikbord_priester")
        .orderBy("tijd", "desc")
        .get()
        .then(snapshot => {
          if (snapshot.empty) {
            lijst.innerHTML = "<em>Er zijn nog geen prikbordberichten geplaatst.</em>";
            return;
          }
          lijst.innerHTML = "";
          snapshot.forEach(doc => {
            const d = doc.data();
            let tijd = "";
            if (d.tijd && d.tijd.toDate) {
              const t = d.tijd.toDate();
              tijd = t.toLocaleDateString("nl-BE", { day:"2-digit", month:"2-digit", year:"numeric" }) + " " +
                     t.toLocaleTimeString("nl-BE", { hour:"2-digit", minute:"2-digit" });
            }
            let html = `
              <div class="bericht-item">
                <div class="bericht-titel">${d.titel || "(geen titel)"}</div>
                <div class="bericht-tekst">${d.tekst || "(geen tekst)"}</div>
                <div class="bericht-tijd">${tijd ? "Geplaatst op: " + tijd : ""}</div>
              </div>`;
            lijst.innerHTML += html;
          });
        });
    }

    // Nieuw bericht indienen
    document.getElementById("nieuwBerichtForm").onsubmit = function(e) {
      e.preventDefault();
      const titel = document.getElementById("nieuwBerichtTitel").value.trim();
      const tekst = document.getElementById("nieuwBerichtTekst").value.trim();
      if (titel.length === 0 && tekst.length === 0) return;
      document.getElementById("nieuwBerichtFeedback").textContent = "Uw prikbordbericht wordt verstuurd...";
      db.collection("parochies")
        .doc(parochieId)
        .collection("prikbord_priester")
        .add({
          titel: titel,
          tekst: tekst,
          tijd: firebase.firestore.Timestamp.now()
        })
        .then(() => {
          document.getElementById("nieuwBerichtFeedback").textContent = "Uw prikbordbericht is geplaatst.";
          document.getElementById("nieuwBerichtTitel").value = "";
          document.getElementById("nieuwBerichtTekst").value = "";
          laadPrikbordBerichten();
          setTimeout(() => { document.getElementById("nieuwBerichtFeedback").textContent = ""; }, 2000);
        })
        .catch(() => {
          document.getElementById("nieuwBerichtFeedback").textContent = "Fout: uw bericht kon niet worden verstuurd.";
        });
    };

    window.onload = laadPrikbordBerichten;
  </script>
</body>
</html>
