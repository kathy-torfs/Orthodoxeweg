<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <title>Media delen â€“ Priester</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" href="https://kathy-torfs.github.io/Orthodoxeweg/images/kruis.png" />

  <style>
    body { margin:0; font-family:Arial,sans-serif; background:#f5e9b8; color:#4e3a15; }
    main { max-width:800px; margin:30px auto; padding:0 2vw; }

    h1 { text-align:center; color:#5d4c2f; margin-bottom:22px; }

    .formblok {
      background:#fffdf5; border:2px dashed #e0c46c;
      border-radius:14px; padding:20px;
      box-shadow:0 4px 10px rgba(0,0,0,.08);
      margin-bottom:26px;
    }
    label { display:block; margin:10px 0 4px; font-weight:bold; }
    input[type=text] {
      width:100%; padding:10px; border-radius:8px;
      border:1.5px solid #dcbf60; font-size:1em;
    }
    button {
      background:#7bb235; color:#fff; border:none; border-radius:8px;
      padding:10px 18px; font-weight:bold; cursor:pointer;
      margin-top:12px;
    }
    button:hover { background:#5e8e29; }

    .lijst { display:flex; flex-direction:column; gap:14px; }
    .item {
      background:#fffef9; border:1.5px solid #e6d6b8; border-radius:12px;
      padding:12px; box-shadow:0 2px 6px rgba(0,0,0,.06);
    }
    .item strong { color:#7bb235; }
    .verwijder {
      background:#b42c25; color:#fff; border:none; border-radius:8px;
      padding:6px 12px; font-size:.9em; margin-top:8px; cursor:pointer;
    }
    .verwijder:hover { background:#8a1e18; }
  </style>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
</head>
<body>
  <!-- Gedeelde header/layout -->
  <div id="priester-header"></div>

  <main>
    <h1>ðŸŽµ Deel media met je parochie</h1>

    <form class="formblok" onsubmit="voegMediaToe(event)">
      <label for="titel">Titel:</label>
      <input type="text" id="titel" required />

      <label for="link">Link (YouTube, Vimeo, MP3...):</label>
      <input type="text" id="link" required placeholder="https://..." />

      <button type="submit">âž• Plaatsen</button>
    </form>

    <h2 style="color:#5d4c2f;">ðŸ“‚ Reeds geplaatste media</h2>
    <div id="mediaLijst" class="lijst"></div>
  </main>

  <script>
    // Toegang controleren
    if (!localStorage.getItem("ingelogdeParochie") || localStorage.getItem("modus") !== "priester") {
      window.location.href="https://kathy-torfs.github.io/Orthodoxeweg/index.html";
    }
    const eigenParochie = localStorage.getItem("ingelogdeParochie");

    // Firebase init
    const firebaseConfig = {
      apiKey: "AIzaSyBG1iQBmruHUZI1OeW8RgbJ_TPit_7a2LQ",
      authDomain: "orthodoxeweg.firebaseapp.com",
      projectId: "orthodoxeweg",
      storageBucket: "orthodoxeweg.appspot.com",
      messagingSenderId: "408582263618",
      appId: "1:408582263618:web:0a20f4bf0704989d3ceedb"
    };
    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    async function laadMedia(){
      const lijst=document.getElementById("mediaLijst");
      lijst.innerHTML="<em>Laden...</em>";
      const snap=await db.collection("parochies").doc(eigenParochie)
        .collection("uploads").orderBy("datum","desc").get();
      lijst.innerHTML="";
      if(snap.empty){ lijst.innerHTML="<em>Nog geen media gedeeld.</em>"; return; }
      snap.forEach(doc=>{
        const d=doc.data();
        const div=document.createElement("div"); div.className="item";
        div.innerHTML=`<strong>${d.titel||"Zonder titel"}</strong><br>
          <a href="${d.link}" target="_blank">${d.link}</a><br>
          <small>${d.datum?.toDate?d.datum.toDate().toLocaleString():""}</small>`;
        const btn=document.createElement("button"); btn.className="verwijder"; btn.textContent="ðŸ—‘ Verwijder";
        btn.onclick=()=>verwijderMedia(doc.id);
        div.appendChild(btn);
        lijst.appendChild(div);
      });
    }

    async function voegMediaToe(e){
      e.preventDefault();
      const titel=document.getElementById("titel").value.trim();
      const link=document.getElementById("link").value.trim();
      if(!link){ alert("Voer een link in."); return; }
      await db.collection("parochies").doc(eigenParochie).collection("uploads").add({
        titel, link, datum:firebase.firestore.Timestamp.now()
      });
      document.getElementById("titel").value="";
      document.getElementById("link").value="";
      laadMedia();
    }

    async function verwijderMedia(id){
      await db.collection("parochies").doc(eigenParochie).collection("uploads").doc(id).delete();
      laadMedia();
    }

    laadMedia();
  </script>

  <!-- Layout script -->
  <script src="https://kathy-torfs.github.io/Orthodoxeweg/priestermodus/common/layout.js"></script>
</body>
</html>
