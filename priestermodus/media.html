<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <title>ðŸŽµ Media â€“ Priester</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    body {
      margin:0; font-family: Arial, sans-serif;
      background:#f5e9b8; color:#4e3a15;
    }
    main { max-width:900px; margin:30px auto; padding:0 2vw; }

    h1 { color:#7a5f35; text-align:center; margin-bottom:22px; }

    form {
      background:#fffdf5; border:2px dashed #e0c46c;
      border-radius:14px; padding:18px; box-shadow:0 4px 10px rgba(0,0,0,.08);
      margin-bottom:28px;
    }
    label { display:block; margin:10px 0 4px; font-weight:bold; }
    input[type="text"], textarea, input[type="file"] {
      width:100%; border-radius:8px; border:1.5px solid #dcbf60;
      padding:8px; font-family:inherit; font-size:1em;
    }
    textarea { min-height:70px; resize:vertical; }

    button {
      background:#7bb235; color:#fff; border:none; border-radius:8px;
      padding:8px 16px; font-weight:bold; cursor:pointer; margin-top:10px;
    }
    button:hover { background:#5e8e29; }

    .media-lijst { display:flex; flex-direction:column; gap:18px; }
    .media-item {
      background:#fff9de; border:2px solid #eed989;
      border-radius:14px; padding:14px;
      box-shadow:0 2px 10px #0002;
    }
    .media-item h3 { margin:0 0 6px; color:#7bb235; font-size:1.1em; }
    .media-item p { margin:0 0 8px; }
    .verwijder-btn {
      background:#b6322c; color:#fff; border:none; border-radius:6px;
      padding:6px 12px; cursor:pointer; font-size:.9em;
    }
    .verwijder-btn:hover { background:#911f19; }
  </style>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-storage-compat.js"></script>
</head>
<body>
  <!-- Gedeelde header/layout -->
  <div id="priester-header"></div>

  <main>
    <h1>ðŸŽµ Media beheren</h1>

    <form id="mediaForm">
      <label for="titel">Titel:</label>
      <input type="text" id="titel" required>

      <label for="omschrijving">Omschrijving:</label>
      <textarea id="omschrijving"></textarea>

      <label for="bestand">Upload MP3-bestand:</label>
      <input type="file" id="bestand" accept="audio/mpeg">

      <label for="link">of voeg een YouTube-link toe:</label>
      <input type="text" id="link" placeholder="https://youtube.com/...">

      <button type="submit">âž• Toevoegen</button>
    </form>

    <div class="media-lijst" id="mediaLijst"></div>
  </main>

  <!-- Layout.js laadt header.html -->
  <script src="https://kathy-torfs.github.io/Orthodoxeweg/priestermodus/common/layout.js"></script>

  <script>
    // Toegang: enkel priestermodus
    if (!localStorage.getItem("ingelogdeParochie") || localStorage.getItem("modus") !== "priester") {
      window.location.href = "https://kathy-torfs.github.io/Orthodoxeweg/index.html";
    }
    const parochieId = localStorage.getItem("ingelogdeParochie");

    // Firebase init
    const firebaseConfig = {
      apiKey: "AIzaSyBG1iQBmruHUZI1OeW8RgbJ_TPit_7a2LQ",
      authDomain: "orthodoxeweg.firebaseapp.com",
      projectId: "orthodoxeweg",
      storageBucket: "orthodoxeweg.appspot.com",
      messagingSenderId: "408582263618",
      appId: "1:408582263618:web:0a20f4bf0704989d3ceedb"
    };
    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const storage = firebase.storage();

    const lijst = document.getElementById("mediaLijst");

    // Media laden
    async function laadMedia(){
      lijst.innerHTML = "<em>Media wordt geladen...</em>";
      const snap = await db.collection("parochies").doc(parochieId).collection("uploads")
        .orderBy("datum","desc").get();
      if(snap.empty){
        lijst.innerHTML = "<em>Nog geen media toegevoegd.</em>";
        return;
      }
      lijst.innerHTML = "";
      snap.forEach(doc=>{
        const d = doc.data();
        const div = document.createElement("div");
        div.className="media-item";
        div.innerHTML = `
          <h3>${d.titel||"Zonder titel"}</h3>
          <p>${d.omschrijving||""}</p>
        `;
        if(d.type==="mp3" && d.url){
          const audio = document.createElement("audio");
          audio.controls = true;
          audio.src = d.url;
          div.appendChild(audio);
        } else if(d.type==="youtube" && d.url){
          const iframe = document.createElement("iframe");
          iframe.width="100%"; iframe.height="200";
          iframe.src = d.url.replace("watch?v=","embed/");
          iframe.allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture";
          iframe.allowFullscreen = true;
          div.appendChild(iframe);
        } else if(d.url){
          const a=document.createElement("a");
          a.href=d.url; a.textContent="Open media"; a.target="_blank";
          div.appendChild(a);
        }
        const btn=document.createElement("button");
        btn.className="verwijder-btn"; btn.textContent="ðŸ—‘ Verwijder";
        btn.onclick=()=>verwijderMedia(doc.id,d);
        div.appendChild(btn);
        lijst.appendChild(div);
      });
    }

    // Media toevoegen
    document.getElementById("mediaForm").onsubmit=async e=>{
      e.preventDefault();
      const titel=document.getElementById("titel").value.trim();
      const omschrijving=document.getElementById("omschrijving").value.trim();
      const bestand=document.getElementById("bestand").files[0];
      const link=document.getElementById("link").value.trim();
      if(!titel){alert("Geef een titel op");return;}
      let url=null, type=null;

      if(bestand){
        const opslagPad=`uploads/${parochieId}/${Date.now()}_${bestand.name}`;
        const ref=storage.ref(opslagPad);
        await ref.put(bestand);
        url=await ref.getDownloadURL();
        type="mp3";
      } else if(link){
        url=link; type="youtube";
      } else {
        alert("Upload een bestand of voeg een link toe.");
        return;
      }
      await db.collection("parochies").doc(parochieId).collection("uploads").add({
        titel,omschrijving,url,type,datum:new Date()
      });
      e.target.reset();
      laadMedia();
    };

    // Media verwijderen
    async function verwijderMedia(id,data){
      if(confirm("Weet u zeker dat u dit item wilt verwijderen?")){
        await db.collection("parochies").doc(parochieId).collection("uploads").doc(id).delete();
        laadMedia();
      }
    }

    laadMedia();
  </script>
</body>
</html>
