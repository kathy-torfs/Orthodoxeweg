async function goedkeurAanvraag(id) {
  const regRef = db.collection("parochies").doc(parochieId).collection("registraties").doc(id);
  const doc = await regRef.get();
  if (!doc.exists) return alert("Registratie niet gevonden!");
  const data = doc.data();

  const wachtwoord = genereerWachtwoord();

  await db.collection("parochies").doc(parochieId).collection("leden")
    .doc(data.loginKeuze)
    .set({
      voornaam: data.voornaam,
      achternaam: data.achternaam,
      doopnaam: data.doopnaam,
      email: data.email,
      geboortedatum: data.geboortedatum,
      loginKeuze: data.loginKeuze,
      wachtwoord: wachtwoord,
      status: "actief",
      avatarURL: data.avatarURL || "https://cdn-icons-png.flaticon.com/512/4140/4140048.png",
      verjaardagToevoegen: data.verjaardagToevoegen === undefined ? false : data.verjaardagToevoegen
    });

  let mailOk = false;
  let mailError = "";

  try {
    const response = await fetch("https://us-central1-orthodoxeweg.cloudfunctions.net/sendTestMail", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        to: data.email,
        subject: "Welkom bij Orthodoxeweg!",
        text: `Beste ${data.voornaam},

Met grote vreugde verwelkomen wij u op onze website.

Wij hopen dat dit voor u een geweldige reis zal zijn. 
We vragen u alvast wat geduld uit te oefenen, daar we nog volop bezig zijn met de juiste vertalingen waardoor sommige onderdelen niet 100% volledig zijn.

U kan vanaf nu inloggen door uw parochie te kiezen, uw gekozen gebruikersnaam en het automatisch gegenereerde wachtwoord:

Login: ${data.loginKeuze}
Wachtwoord: ${wachtwoord}

U kan al uw gegevens eigenhandig aanpassen in uw profiel. Mochten er nog vragen zijn, twijfel dan niet om ons te contacteren.

Met vriendelijke groeten,  
Orthodoxeweg.be`
      })
    });

    const result = await response.json().catch(() => ({}));
    mailOk = response.ok && result.success;
    mailError = result.error || (!response.ok ? "Onbekende fout in response" : "");
  } catch (e) {
    mailOk = false;
    mailError = e.message;
  }

  await regRef.delete();

  if (mailOk) {
    alert("✅ Registratie goedgekeurd, toegevoegd aan ledenlijst én mail verzonden!");
  } else {
    alert("⚠️ Registratie goedgekeurd, toegevoegd aan ledenlijst, MAAR mail is NIET verzonden!\n\nFout: " + mailError);
  }
  laadAanvragen();
}
