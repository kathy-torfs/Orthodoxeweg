<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tradities â€“ Priestermodus</title>
  <link rel="icon" href="https://kathy-torfs.github.io/Orthodoxeweg/images/kruis.png" />

  <!-- Priester layout -->
  <script defer src="common/layout.js"></script>

  <!-- FIREBASE -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBKEakRzmnPZ3DY8NUkZrZr_YtqBbNVHL4",
      authDomain: "orthodoxeweg.firebaseapp.com",
      projectId: "orthodoxeweg",
      storageBucket: "orthodoxeweg.appspot.com",
      messagingSenderId: "408582263618",
      appId: "1:408582263618:web:2e02833fa0d4d8903ceedb"
    };
    if (!firebase.apps.length) { firebase.initializeApp(firebaseConfig); }
    const db = firebase.firestore();
  </script>

  <style>
    :root{
      --bg:#fff6e5; --ink:#5b3a00; --brand:#7bb235;
      --accent:#67510C; --soft:#ffe7a8;
      --card:#ffffff; --line:#ead9b4;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;line-height:1.5}
    main{display:flex;max-width:1200px;margin:20px auto;padding:0 14px 40px;gap:20px}
    /* Links: index */
    #traditie-index{flex:1;max-width:280px}
    #traditie-index h2{font-size:1.2rem;color:var(--accent);margin-bottom:10px;display:flex;justify-content:space-between;align-items:center}
    #traditie-index button{background:var(--brand);color:#fff;border:0;border-radius:6px;padding:4px 8px;cursor:pointer}
    details{border:1px solid var(--line);border-radius:8px;margin-bottom:8px;background:var(--card)}
    summary{cursor:pointer;padding:8px 10px;font-weight:600;color:var(--accent)}
    ul{list-style:none;padding:0;margin:0}
    ul li{padding:6px 10px;cursor:pointer;border-top:1px solid var(--line);transition:.2s}
    ul li:hover{background:#fdf7e5}
    ul li.active{background:var(--brand);color:#fff}
    /* Rechts: detail */
    #traditie-detail{flex:3}
    .card{background:var(--card);border:1px solid var(--line);border-radius:16px;
      padding:16px;margin:12px 0;box-shadow:0 6px 18px rgba(0,0,0,.05)}
    h1{margin:0;font-size:1.5rem;color:var(--accent)}
  </style>
</head>
<body>

  <!-- Priester-header -->
  <div id="priester-header" data-header-src="common/header.html"></div>

  <main>
    <!-- INDEX -->
    <aside id="traditie-index">
      <h2>
        Tradities
        <button onclick="nieuweTraditie()">+</button>
      </h2>
      <details open>
        <summary>Sacramenten</summary>
        <ul id="sacramenten-list"><li>Laden...</li></ul>
      </details>
      <details>
        <summary>Kerkelijke feesten</summary>
        <ul id="feesten-list"><li>Laden...</li></ul>
      </details>
      <details>
        <summary>Heiligen</summary>
        <ul id="heiligen-list"><li>Laden...</li></ul>
      </details>
      <details>
        <summary>Eigen tradities</summary>
        <ul id="eigen-list"><li>Laden...</li></ul>
      </details>
    </aside>

    <!-- DETAIL -->
    <section id="traditie-detail">
      <h1>Kies een traditie</h1>
      <div id="traditie-content" class="card">
        <p style="opacity:.8">Selecteer links een titel om de inhoud te bekijken.</p>
      </div>
    </section>
  </main>

  <script>
    const parochieId = localStorage.getItem("ingelogdeParochie"); 
    const content = document.getElementById("traditie-content");

    async function laadLijst(type, ulId, path) {
      const ul = document.getElementById(ulId);
      ul.innerHTML = "<li>Laden...</li>";
      try {
        const snap = await db.collection(path).get();
        if(snap.empty){
          ul.innerHTML = "<li>Geen tradities</li>";
          return;
        }
        ul.innerHTML = "";
        snap.forEach(doc=>{
          const li = document.createElement("li");
          li.textContent = doc.data().titel || "(zonder titel)";
          li.addEventListener("click",()=>toonTraditie(path, doc.id, li));
          ul.appendChild(li);
        });
      } catch(e){ console.error(e); ul.innerHTML="<li>Fout bij laden</li>"; }
    }

    async function toonTraditie(path, docId, liEl) {
      document.querySelectorAll("ul li").forEach(li=>li.classList.remove("active"));
      liEl.classList.add("active");

      const ref = db.collection(path).doc(docId);
      const snap = await ref.get();
      if(snap.exists){
        const data = snap.data();
        content.innerHTML = data.html || "<p>Geen inhoud beschikbaar.</p>";
      } else {
        content.innerHTML = "<p>Niet gevonden.</p>";
      }
    }

    function nieuweTraditie(){
      alert("Hier kan je logica toevoegen om een nieuwe traditie aan te maken.");
    }

    // Laden
    laadLijst("sacramenten","sacramenten-list","tradities/sacramenten");
    laadLijst("feesten","feesten-list","tradities/kerkelijke_feesten");
    laadLijst("heiligen","heiligen-list","tradities/heiligen");
    if(parochieId){
      laadLijst("eigen","eigen-list",`parochies/${parochieId}/tradities`);
    }
  </script>
</body>
</html>
