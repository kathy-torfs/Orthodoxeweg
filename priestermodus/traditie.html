<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tradities â€“ Priestermodus</title>
  <link rel="icon" href="https://kathy-torfs.github.io/Orthodoxeweg/images/kruis.png" />

  <!-- Priester layout -->
  <script defer src="common/layout.js"></script>

  <!-- FIREBASE -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBKEakRzmnPZ3DY8NUkZrZr_YtqBbNVHL4",
      authDomain: "orthodoxeweg.firebaseapp.com",
      projectId: "orthodoxeweg",
      storageBucket: "orthodoxeweg.appspot.com",
      messagingSenderId: "408582263618",
      appId: "1:408582263618:web:2e02833fa0d4d8903ceedb"
    };
    if (!firebase.apps.length) { firebase.initializeApp(firebaseConfig); }
    const db = firebase.firestore();
  </script>

  <style>
    :root{
      --bg:#fff6e5; --ink:#5b3a00; --brand:#7bb235; --accent:#67510C; --soft:#ffe7a8;
      --card:#ffffff; --line:#ead9b4;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;line-height:1.5}
    main{display:flex;max-width:1200px;margin:20px auto;padding:0 14px 40px;gap:20px}
    /* Links: index */
    #traditie-index{flex:1;max-width:280px}
    #traditie-index h2{font-size:1.2rem;color:var(--accent);margin-bottom:10px}
    #traditie-list{list-style:none;padding:0;margin:0;display:flex;flex-direction:column;gap:6px}
    #traditie-list li{background:var(--card);border:1px solid var(--line);border-radius:8px;
      padding:8px 10px;cursor:pointer;transition:.2s}
    #traditie-list li:hover{background:#fdf7e5}
    #traditie-list li.active{background:var(--brand);color:#fff}
    /* Rechts: detail */
    #traditie-detail{flex:3}
    .card{background:var(--card);border:1px solid var(--line);border-radius:16px;
      padding:16px;margin:12px 0;box-shadow:0 6px 18px rgba(0,0,0,.05)}
    h1{margin:0;font-size:1.5rem;color:var(--accent)}
  </style>
</head>
<body>

  <!-- Priester-header -->
  <div id="priester-header" data-header-src="common/header.html"></div>

  <main>
    <!-- INDEX -->
    <aside id="traditie-index">
      <h2>Tradities</h2>
      <ul id="traditie-list">
        <li>Laden...</li>
      </ul>
    </aside>

    <!-- DETAIL -->
    <section id="traditie-detail">
      <h1>Kies een traditie</h1>
      <div id="traditie-content" class="card">
        <p style="opacity:.8">Selecteer links een titel om de inhoud te bekijken.</p>
      </div>
    </section>
  </main>

  <script>
    const parochieId = localStorage.getItem("ingelogdeParochie"); // opgehaald uit login
    const list = document.getElementById("traditie-list");
    const content = document.getElementById("traditie-content");

    async function laadIndex() {
      list.innerHTML = "<li>Laden...</li>";
      try {
        const snap = await db.collection("parochies")
          .doc(parochieId)
          .collection("tradities")
          .get();

        if(snap.empty){
          list.innerHTML = "<li>Geen tradities</li>";
          return;
        }
        list.innerHTML = "";
        snap.forEach(doc=>{
          const li = document.createElement("li");
          li.textContent = doc.data().titel || "(zonder titel)";
          li.addEventListener("click",()=>toonTraditie(doc.id, li));
          list.appendChild(li);
        });
      } catch(e){ console.error(e); }
    }

    async function toonTraditie(docId, liEl) {
      document.querySelectorAll("#traditie-list li").forEach(li=>li.classList.remove("active"));
      liEl.classList.add("active");

      const ref = db.collection("parochies").doc(parochieId).collection("tradities").doc(docId);
      const snap = await ref.get();
      if(snap.exists){
        const data = snap.data();
        content.innerHTML = data.html || "<p>Geen inhoud beschikbaar.</p>";
      } else {
        content.innerHTML = "<p>Niet gevonden.</p>";
      }
    }

    laadIndex();
  </script>
</body>
</html>
