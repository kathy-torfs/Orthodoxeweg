<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Tradities beheren â€“ Priestermodus</title>
  <link rel="icon" href="https://kathy-torfs.github.io/Orthodoxeweg/images/kruis.png">
  <style>
    body {margin:0;font-family:Arial,sans-serif;background:#f5e9b8;color:#5b3a00;}
    .container {display:flex; height:100vh;}
    .sidebar {
      width:280px; background:#fffbe7; border-right:2px solid #d9c38f;
      padding:12px; overflow-y:auto;
    }
    .sidebar h2 {margin-top:0;color:#7a5f35;}
    .traditie-item {padding:8px; margin:4px 0; cursor:pointer; border-radius:6px;}
    .traditie-item:hover {background:#f1e5c8;}
    .traditie-item.active {background:#d9c38f;color:white;}

    .editor {flex:1; padding:20px; overflow-y:auto;}
    .editor h2 {margin-top:0;color:#7a5f35;}
    label {display:block; margin-top:10px; font-weight:bold;}
    input,textarea {width:100%;padding:8px;border:1px solid #d9c38f;border-radius:6px;margin-top:4px;}
    textarea {min-height:80px;}
    .btnrow {margin-top:14px; display:flex; gap:10px;}
    button {
      padding:8px 14px; border:none; border-radius:6px; cursor:pointer;
      font-weight:bold; background:#7a5f35; color:white;
    }
    button.secondary {background:#b09765;}
    button.danger {background:#a33;}
  </style>
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBG1iQBmruHUZI1OeW8RgbJ_TPit_7a2LQ",
      authDomain: "orthodoxeweg.firebaseapp.com",
      projectId: "orthodoxeweg",
      storageBucket: "orthodoxeweg.appspot.com",
      messagingSenderId: "408582263618",
      appId: "1:408582263618:web:0a20f4bf0704989d3ceedb"
    };
    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
  </script>
</head>
<body>
  <div class="container">
    <!-- Sidebar -->
    <div class="sidebar">
      <h2>Tradities</h2>
      <div id="traditieList"></div>
      <button onclick="nieuwTraditie()">+ Nieuwe traditie</button>
    </div>

    <!-- Editor -->
    <div class="editor">
      <h2 id="editorTitle">Geen traditie geselecteerd</h2>
      <form id="traditieForm" style="display:none;">
        <label>Titel</label>
        <input type="text" id="titel">

        <label>Datum (YYYY-MM-DD)</label>
        <input type="date" id="datum">

        <label>Uitleg / Intro</label>
        <textarea id="uitleg"></textarea>

        <label>Stappen (JSON)</label>
        <textarea id="stappen" placeholder='[{"titel":"Aanvang","tekst":"..."}]'></textarea>

        <label>Gebeden (JSON)</label>
        <textarea id="gebeden" placeholder='[{"titel":"Inleidend gebed","tekst":"..."}]'></textarea>

        <div class="btnrow">
          <button type="button" onclick="bewaarTraditie()">Bewaren</button>
          <button type="button" class="secondary" onclick="annuleer()">Annuleren</button>
          <button type="button" class="danger" onclick="verwijderTraditie()">Verwijderen</button>
        </div>
      </form>
    </div>
  </div>

<script>
  let huidigeId = null;

  async function laadTradities() {
    const snap = await db.collection("tradities").orderBy("datum","asc").get();
    const list = document.getElementById("traditieList");
    list.innerHTML = "";
    snap.forEach(doc => {
      const d = doc.data();
      const div = document.createElement("div");
      div.textContent = d.titel || "(zonder titel)";
      div.className = "traditie-item";
      div.onclick = ()=>selecteerTraditie(doc.id, d);
      list.appendChild(div);
    });
  }

  function selecteerTraditie(id, data) {
    huidigeId = id;
    document.getElementById("editorTitle").textContent = "Traditie bewerken";
    document.getElementById("traditieForm").style.display = "block";
    document.getElementById("titel").value = data.titel||"";
    document.getElementById("datum").value = data.datum||"";
    document.getElementById("uitleg").value = data.uitleg||"";
    document.getElementById("stappen").value = JSON.stringify(data.stappen||[], null,2);
    document.getElementById("gebeden").value = JSON.stringify(data.gebeden||[], null,2);
  }

  function nieuwTraditie() {
    huidigeId = null;
    document.getElementById("editorTitle").textContent = "Nieuwe traditie";
    document.getElementById("traditieForm").style.display = "block";
    document.getElementById("titel").value = "";
    document.getElementById("datum").value = "";
    document.getElementById("uitleg").value = "";
    document.getElementById("stappen").value = "[]";
    document.getElementById("gebeden").value = "[]";
  }

  async function bewaarTraditie() {
    const data = {
      titel: document.getElementById("titel").value.trim(),
      datum: document.getElementById("datum").value,
      uitleg: document.getElementById("uitleg").value.trim(),
      stappen: JSON.parse(document.getElementById("stappen").value || "[]"),
      gebeden: JSON.parse(document.getElementById("gebeden").value || "[]")
    };
    if (huidigeId) {
      await db.collection("tradities").doc(huidigeId).set(data,{merge:true});
    } else {
      await db.collection("tradities").add(data);
    }
    laadTradities();
    annuleer();
  }

  async function verwijderTraditie() {
    if (huidigeId && confirm("Zeker weten?")) {
      await db.collection("tradities").doc(huidigeId).delete();
      laadTradities();
      annuleer();
    }
  }

  function annuleer() {
    huidigeId = null;
    document.getElementById("editorTitle").textContent = "Geen traditie geselecteerd";
    document.getElementById("traditieForm").style.display = "none";
  }

  laadTradities();
</script>
</body>
</html>
