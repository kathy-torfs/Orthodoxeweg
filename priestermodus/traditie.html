<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tradities â€“ Priestermodus</title>
  <link rel="icon" href="https://kathy-torfs.github.io/Orthodoxeweg/images/kruis.png" />

  <!-- Priester layout -->
  <script defer src="common/layout.js"></script>

  <!-- FIREBASE -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBKEakRzmnPZ3DY8NUkZrZr_YtqBbNVHL4",
      authDomain: "orthodoxeweg.firebaseapp.com",
      projectId: "orthodoxeweg",
      storageBucket: "orthodoxeweg.appspot.com",
      messagingSenderId: "408582263618",
      appId: "1:408582263618:web:2e02833fa0d4d8903ceedb"
    };
    if (!firebase.apps.length) { firebase.initializeApp(firebaseConfig); }
    const db = firebase.firestore();
  </script>

  <style>
    :root{
      --bg:#fff6e5; --ink:#5b3a00; --brand:#7bb235; --accent:#67510C; --soft:#ffe7a8;
      --card:#ffffff; --line:#ead9b4;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;line-height:1.5}
    main{display:flex;max-width:1200px;margin:20px auto;padding:0 14px 40px;gap:20px}
    /* Links */
    #traditie-index{flex:1;max-width:300px}
    #traditie-index h2{font-size:1.2rem;color:var(--accent);margin-bottom:10px}
    #traditie-index ul{list-style:none;padding:0;margin:0;display:flex;flex-direction:column;gap:6px}
    #traditie-index li{background:var(--card);border:1px solid var(--line);border-radius:8px;
      padding:8px 10px;cursor:pointer;transition:.2s}
    #traditie-index li:hover{background:#fdf7e5}
    #traditie-index li.active{background:var(--brand);color:#fff}
    button.add{margin:8px 0;padding:6px 10px;border:1px solid var(--line);border-radius:6px;
      cursor:pointer;background:var(--brand);color:#fff}
    /* Rechts */
    #traditie-detail{flex:3}
    .tabs{display:flex;gap:8px;margin-bottom:10px}
    .tabs button{padding:6px 12px;border:1px solid var(--line);border-radius:6px;
      cursor:pointer;background:#fff}
    .tabs button.active{background:var(--brand);color:#fff}
    .tab-content{display:none}
    .tab-content.active{display:block}
    .card{background:var(--card);border:1px solid var(--line);border-radius:16px;
      padding:16px;margin:12px 0;box-shadow:0 6px 18px rgba(0,0,0,.05)}
  </style>
</head>
<body>
  <div id="priester-header" data-header-src="common/header.html"></div>

  <main>
    <!-- INDEX -->
    <aside id="traditie-index">
      <h2>Algemene tradities</h2>
      <ul id="sacramenten-list"></ul>
      <ul id="feesten-list"></ul>
      <ul id="heiligen-list"></ul>
      <h2>Eigen tradities</h2>
      <button class="add" onclick="nieuweTraditie()">+ Nieuwe traditie</button>
      <ul id="eigen-list"></ul>
    </aside>

    <!-- DETAIL -->
    <section id="traditie-detail">
      <h1>Kies een traditie</h1>
      <div class="tabs hidden">
        <button data-tab="voorbereiding">Voorbereiding</button>
        <button data-tab="tijdens">Tijdens</button>
        <button data-tab="na">Na</button>
      </div>
      <div id="voorbereiding" class="tab-content card"></div>
      <div id="tijdens" class="tab-content card"></div>
      <div id="na" class="tab-content card"></div>
    </section>
  </main>

  <script>
    const parochieId = localStorage.getItem("ingelogdeParochie") || "demoParochie";

    async function laadLijst(ulId, path) {
      const ul = document.getElementById(ulId);
      ul.innerHTML = "<li>Laden...</li>";
      try {
        const snap = await db.collection(path).get();
        ul.innerHTML = "";
        snap.forEach(doc=>{
          const li = document.createElement("li");
          li.textContent = doc.data().titel || doc.id;
          li.onclick = ()=>toonTraditie(path, doc.id, li);
          ul.appendChild(li);
        });
      } catch(e){ console.error(e); ul.innerHTML="<li>Fout bij laden</li>"; }
    }

    async function toonTraditie(path, docId, li) {
      document.querySelectorAll("#traditie-index li").forEach(el=>el.classList.remove("active"));
      if(li) li.classList.add("active");

      const snap = await db.collection(path).doc(docId).get();
      if(!snap.exists){ return; }
      const data = snap.data();

      document.querySelector("#traditie-detail h1").textContent = data.titel || docId;
      document.querySelector(".tabs").classList.remove("hidden");

      ["voorbereiding","tijdens","na"].forEach(k=>{
        document.getElementById(k).innerHTML =
          data[k] ? "<ul>"+data[k].map(t=>"<li>"+t+"</li>").join("")+"</ul>" : "<p>-</p>";
      });

      switchTab("voorbereiding");
    }

    function switchTab(tab){
      document.querySelectorAll(".tabs button").forEach(btn=>{
        btn.classList.toggle("active", btn.dataset.tab===tab);
      });
      document.querySelectorAll(".tab-content").forEach(div=>{
        div.classList.toggle("active", div.id===tab);
      });
    }
    document.querySelectorAll(".tabs button").forEach(btn=>{
      btn.addEventListener("click",()=>switchTab(btn.dataset.tab));
    });

    async function nieuweTraditie(){
      const type = prompt("Type traditie (sacrament, feest, heilige, ander):");
      const titel = prompt("Titel:");
      const datum = prompt("Datum (optioneel):");
      if(!titel) return;

      const voorbereidingen = prompt("Voorbereiding (komma gescheiden):","").split(",").map(t=>t.trim()).filter(Boolean);
      const tijdens = prompt("Tijdens (komma gescheiden):","").split(",").map(t=>t.trim()).filter(Boolean);
      const na = prompt("Na (komma gescheiden):","").split(",").map(t=>t.trim()).filter(Boolean);

      await db.collection("parochies").doc(parochieId).collection("tradities").add({
        type, titel, datum,
        voorbereiding: voorbereidingen,
        tijdens: tijdens,
        na: na,
        aangemaakt: new Date()
      });
      alert("Toegevoegd!");
      laadLijst("eigen-list",`parochies/${parochieId}/tradities`);
    }

    // Init laden
    laadLijst("sacramenten-list","tradities/sacramenten/sacramenten");
    laadLijst("feesten-list","tradities/kerkelijke_feesten/kerkelijke_feesten");
    laadLijst("heiligen-list","tradities/heiligen/heiligen");
    laadLijst("eigen-list",`parochies/${parochieId}/tradities`);
  </script>
</body>
</html>
