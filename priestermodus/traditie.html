<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tradities â€“ Priestermodus</title>
  <link rel="icon" href="https://kathy-torfs.github.io/Orthodoxeweg/images/kruis.png" />

  <!-- Priester layout -->
  <script defer src="common/layout.js"></script>

  <!-- FIREBASE -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBKEakRzmnPZ3DY8NUkZrZr_YtqBbNVHL4",
      authDomain: "orthodoxeweg.firebaseapp.com",
      projectId: "orthodoxeweg",
      storageBucket: "orthodoxeweg.appspot.com",
      messagingSenderId: "408582263618",
      appId: "1:408582263618:web:2e02833fa0d4d8903ceedb"
    };
    if (!firebase.apps.length) { firebase.initializeApp(firebaseConfig); }
    const db = firebase.firestore();
  </script>

  <style>
    :root{
      --bg:#fff6e5; --ink:#5b3a00; --brand:#7bb235; --accent:#67510C; --soft:#ffe7a8;
      --card:#ffffff; --line:#ead9b4;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;line-height:1.5}
    main{display:flex;max-width:1200px;margin:20px auto;padding:0 14px 40px;gap:20px}
    /* Links: index */
    #traditie-index{flex:1;max-width:280px}
    #traditie-index h2{font-size:1.2rem;color:var(--accent);margin-bottom:10px;display:flex;justify-content:space-between;align-items:center}
    #traditie-list{list-style:none;padding:0;margin:0;display:flex;flex-direction:column;gap:6px}
    #traditie-list li{background:var(--card);border:1px solid var(--line);border-radius:8px;
      padding:8px 10px;cursor:pointer;transition:.2s}
    #traditie-list li:hover{background:#fdf7e5}
    #traditie-list li.active{background:var(--brand);color:#fff}
    button#addTraditie{background:var(--brand);color:#fff;border:0;border-radius:6px;
      padding:4px 8px;cursor:pointer;font-size:.9rem}
    /* Rechts: detail */
    #traditie-detail{flex:3;display:flex;flex-direction:column;gap:10px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:16px;
      padding:16px;margin:0;box-shadow:0 6px 18px rgba(0,0,0,.05)}
    h1{margin:0;font-size:1.5rem;color:var(--accent)}
    textarea{width:100%;min-height:300px;padding:10px;border:1px solid var(--line);
      border-radius:8px;font-family:inherit;font-size:1rem}
    #saveBtn{background:var(--brand);color:#fff;border:0;border-radius:6px;padding:10px;cursor:pointer;align-self:flex-end}
  </style>
</head>
<body>

  <!-- Priester-header -->
  <div id="priester-header" data-header-src="common/header.html"></div>

  <main>
    <!-- INDEX -->
    <aside id="traditie-index">
      <h2>
        Tradities
        <button id="addTraditie">+ Toevoegen</button>
      </h2>
      <ul id="traditie-list">
        <li>Laden...</li>
      </ul>
    </aside>

    <!-- DETAIL -->
    <section id="traditie-detail">
      <h1 id="traditie-title">Kies een traditie</h1>
      <div class="card">
        <textarea id="traditie-editor" placeholder="Selecteer of voeg een traditie toe..."></textarea>
        <button id="saveBtn">Opslaan</button>
      </div>
    </section>
  </main>

  <script>
    const parochieId = localStorage.getItem("ingelogdeParochie");
    const list = document.getElementById("traditie-list");
    const editor = document.getElementById("traditie-editor");
    const title = document.getElementById("traditie-title");
    const saveBtn = document.getElementById("saveBtn");
    const addBtn = document.getElementById("addTraditie");

    let huidigeId = null;

    async function laadIndex() {
      list.innerHTML = "<li>Laden...</li>";
      try {
        const snap = await db.collection("parochies")
          .doc(parochieId)
          .collection("tradities")
          .get();

        if(snap.empty){
          list.innerHTML = "<li>Geen tradities</li>";
          return;
        }
        list.innerHTML = "";
        snap.forEach(doc=>{
          const li = document.createElement("li");
          li.textContent = doc.data().titel || "(zonder titel)";
          li.addEventListener("click",()=>toonTraditie(doc.id, li));
          list.appendChild(li);
        });
      } catch(e){ console.error(e); }
    }

    async function toonTraditie(docId, liEl) {
      document.querySelectorAll("#traditie-list li").forEach(li=>li.classList.remove("active"));
      liEl.classList.add("active");

      const ref = db.collection("parochies").doc(parochieId).collection("tradities").doc(docId);
      const snap = await ref.get();
      if(snap.exists){
        const data = snap.data();
        huidigeId = docId;
        title.textContent = data.titel || "(zonder titel)";
        editor.value = data.html || "";
      } else {
        title.textContent = "Niet gevonden";
        editor.value = "";
        huidigeId = null;
      }
    }

    saveBtn.addEventListener("click", async ()=>{
      if(!huidigeId){ alert("Geen traditie geselecteerd."); return; }
      try {
        await db.collection("parochies").doc(parochieId).collection("tradities").doc(huidigeId)
          .update({ html: editor.value });
        alert("Traditie opgeslagen!");
      } catch(e){ console.error(e); alert("Fout bij opslaan."); }
    });

    addBtn.addEventListener("click", async ()=>{
      const titel = prompt("Geef een titel voor de nieuwe traditie:");
      if(!titel) return;
      const ref = db.collection("parochies").doc(parochieId).collection("tradities").doc();
      await ref.set({ titel, html:"" });
      laadIndex();
    });

    laadIndex();
  </script>
</body>
</html>
