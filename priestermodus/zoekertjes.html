<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <title>Zoekertjes ‚Äì Priester</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: Arial, sans-serif; margin:0; padding:0; background-color:#f8f5e9;}
    header { background-color: #e6d6b8; padding: 2rem 1rem 0.7rem 1rem; text-align: center; }
    h1 { margin:0; font-size:2rem; color:#5d4c2f; }
    #parochieLabel {
      background: #fcf6e2; color: #7a5f35; padding: 10px 0 8px 0; text-align: center;
      font-weight: bold; letter-spacing: 1px; font-size: 1.08em;
      box-shadow: 0 2px 8px #cbb96d44; margin-bottom: 10px;
    }
    nav.menu {
      background-color: #7a5f35; padding: 12px 20px;
      display: flex; flex-wrap: wrap; gap: 14px; justify-content: center;
    }
    nav.menu a {
      color: #f8f5e9; text-decoration: none; font-weight: bold; font-size: 16px;
      padding: 6px 14px; border-radius: 8px; transition: background-color 0.3s;
    }
    nav.menu a:hover { background-color: #5e4724; }
    .uitlog-link {
      color: #fff; background: #9a2617; padding: 6px 16px; border-radius: 8px;
      font-size: 1em; text-decoration: none; font-weight: bold;
      margin-left: 14px; margin-right: 14px; transition: background 0.18s;
      cursor: pointer; border: none; float: right;
    }
    .container { max-width: 650px; margin: 36px auto 40px auto; background:#fffef9; border-radius:16px; box-shadow:0 4px 16px #cbb96d32; padding:2.2rem; }
    .nieuw-zoekertje-blok { background: #f5efdd; border-radius: 12px; padding:1.1rem 1.4rem 1.2rem 1.4rem; margin-bottom:2.2rem; box-shadow: 0 2px 10px #e7dbad25;}
    .nieuw-zoekertje-blok textarea { width:100%; min-height:54px; font-size:1.06rem; border-radius:8px; border:1.2px solid #dbc592; padding:8px;}
    .nieuw-zoekertje-blok button { background:#7a5f35; color:#fff; font-weight:bold; border:none; border-radius:8px; padding:8px 20px; margin-top:1rem; font-size:1em; cursor:pointer;}
    .nieuw-zoekertje-blok button:hover { background: #b09765; }
    .zoekertjes-lijst { display: flex; flex-direction: column; gap: 1.2rem;}
    .zoekertje-item {
      background: #f7ecd8;
      border-radius: 10px;
      box-shadow: 0 2px 8px #d7cbb1aa;
      padding: 1.05rem 1.4rem 0.9rem 1.4rem;
      position: relative;
      display: flex;
      align-items: flex-start;
      gap: 16px;
    }
    .zoekertekst { color: #4a391c; font-size: 1.11rem; flex:1;}
    .zoekertje-info { font-size:0.93em; color: #968043; margin-top:3px;}
    .verwijder-btn {
      background: #b6322c;
      color: #fff;
      border: none;
      border-radius: 7px;
      font-size: 1.4em;
      cursor: pointer;
      padding: 4px 10px 4px 10px;
      align-self: flex-start;
      margin-left: 8px;
      transition: background 0.2s;
    }
    .verwijder-btn:hover { background: #ef1616; }
    #feedbackNieuw { text-align:center; color: #9a2617; font-size: 1em; margin-bottom:8px;}
    @media (max-width:700px){
      .container {padding:0.7rem;}
      .zoekertje-item{flex-direction:column;gap:7px;}
    }
  </style>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
</head>
<body>
  <header>
    <button class="uitlog-link" id="uitlogKnop">üö™ Uitloggen</button>
    <h1 id="welkom-tekst">Zoekertjes beheer ‚Äì Priester</h1>
    <div id="parochieLabel"></div>
  </header>
  <nav class="menu">
    <a href="https://kathy-torfs.github.io/Orthodoxeweg/priestermodus/startpagina.html">üè† Startpagina</a>
    <a href="https://kathy-torfs.github.io/Orthodoxeweg/priestermodus/parochie.html">üõê Mijn parochie</a>
    <a href="https://kathy-torfs.github.io/Orthodoxeweg/priestermodus/psalmen/psalmen.html">üìú Psalmen</a>
    <a href="https://kathy-torfs.github.io/Orthodoxeweg/priestermodus/gebeden/gebeden.html">üôè Gebeden</a>
    <a href="https://kathy-torfs.github.io/Orthodoxeweg/priestermodus/gebeden/geloofsbelijdenis.html">‚úù Geloofsbelijdenis</a>
    <a href="https://kathy-torfs.github.io/Orthodoxeweg/priestermodus/catechese/catechese.html">üìñ Catechese</a>
    <a href="https://kathy-torfs.github.io/Orthodoxeweg/priestermodus/heiligen/heiligen.html">üëº Heiligen</a>
    <a href="https://kathy-torfs.github.io/Orthodoxeweg/priestermodus/layout.html">üß∞ Bewerk parochie</a>
  </nav>
  <div class="container">
    <div class="nieuw-zoekertje-blok">
      <form id="nieuwZoekertjeForm">
        <textarea id="nieuwZoekertjeTekst" required maxlength="300" placeholder="Typ uw zoekertje (max. 300 tekens)..."></textarea>
        <button type="submit">Plaats zoekertje</button>
      </form>
      <div id="feedbackNieuw"></div>
    </div>
    <div class="zoekertjes-lijst" id="zoekertjesLijst">
      <!-- Zoekertjes komen hier -->
    </div>
  </div>
  <script>
    // Beveiliging: Alleen priester mag deze pagina
    if (!localStorage.getItem("ingelogdeParochie") || !["priester", "volwassene"].includes(localStorage.getItem("modus"))) {
      window.location.href = "https://kathy-torfs.github.io/Orthodoxeweg/index.html";
    }
    let parochieNaam = localStorage.getItem("ingelogdeParochie");
    document.getElementById("parochieLabel").textContent = parochieNaam
      ? `U bent ingelogd in de parochie van ${parochieNaam}`
      : "‚ö†Ô∏è Geen geldige parochie geselecteerd!";
    document.getElementById("uitlogKnop").onclick = function() {
      localStorage.clear();
      window.location.href = "https://kathy-torfs.github.io/Orthodoxeweg/index.html";
    };

    // Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyBG1iQBmruHUZI1OeW8RgbJ_TPit_7a2LQ",
      authDomain: "orthodoxeweg.firebaseapp.com",
      projectId: "orthodoxeweg",
      storageBucket: "orthodoxeweg.appspot.com",
      messagingSenderId: "408582263618",
      appId: "1:408582263618:web:0a20f4bf0704989d3ceedb"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const userId = localStorage.getItem("userId") || ""; // unieke gebruiker
    let parochieIdPromise = db.collection("parochies")
      .where("naam", "==", parochieNaam)
      .limit(1)
      .get()
      .then(snap => snap.empty ? null : snap.docs[0].id);

    // Zoekertjes laden
    async function laadZoekertjes() {
      const lijst = document.getElementById("zoekertjesLijst");
      lijst.innerHTML = "<em>Zoekertjes worden geladen...</em>";
      const parochieId = await parochieIdPromise;
      if (!parochieId) {
        lijst.innerHTML = "<em>Parochie niet gevonden!</em>";
        return;
      }
      db.collection("parochies").doc(parochieId).collection("zoekertjes")
        .orderBy("createdAt", "desc")
        .get()
        .then(snapshot => {
          if (snapshot.empty) {
            lijst.innerHTML = "<em>Er zijn nog geen zoekertjes.</em>";
            return;
          }
          lijst.innerHTML = "";
          snapshot.forEach(doc => {
            const d = doc.data();
            const magVerwijderen = (d.userId === userId);
            let html = `
              <div class="zoekertje-item">
                <div class="zoekertekst">${d.text || "(geen tekst)"}</div>
                <div>
                  <div class="zoekertje-info">
                    Geplaatst op: ${(d.createdAt && d.createdAt.toDate) ? d.createdAt.toDate().toLocaleDateString("nl-BE") : "onbekend"}
                  </div>
                  ${magVerwijderen ? `<button class="verwijder-btn" onclick="verwijderZoekertje('${doc.id}')">&#10060;</button>` : ""}
                </div>
              </div>
            `;
            lijst.innerHTML += html;
          });
        });
    }

    // Zoekertje plaatsen
    document.getElementById("nieuwZoekertjeForm").onsubmit = async function(e) {
      e.preventDefault();
      const tekst = document.getElementById("nieuwZoekertjeTekst").value.trim();
      if (tekst.length === 0) return;
      const parochieId = await parochieIdPromise;
      document.getElementById("feedbackNieuw").textContent = "Verzenden...";
      db.collection("parochies").doc(parochieId).collection("zoekertjes")
        .add({
          userId: userId,
          text: tekst,
          createdAt: firebase.firestore.Timestamp.now()
        })
        .then(() => {
          document.getElementById("feedbackNieuw").textContent = "Zoekertje geplaatst.";
          document.getElementById("nieuwZoekertjeTekst").value = "";
          laadZoekertjes();
          setTimeout(() => { document.getElementById("feedbackNieuw").textContent = ""; }, 1400);
        })
        .catch(() => {
          document.getElementById("feedbackNieuw").textContent = "Fout: niet opgeslagen.";
        });
    };

    // Zoekertje verwijderen (alleen je eigen)
    async function verwijderZoekertje(id) {
      const parochieId = await parochieIdPromise;
      db.collection("parochies").doc(parochieId).collection("zoekertjes").doc(id).delete()
        .then(() => laadZoekertjes());
    }

    window.onload = laadZoekertjes;
    window.verwijderZoekertje = verwijderZoekertje;
  </script>
</body>
</html>
