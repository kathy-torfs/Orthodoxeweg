<!-- ==== SCRIPT DAGKALENDER ==== -->
<script>
window.addEventListener("DOMContentLoaded", () => {

  const pad = n => (n<10 ? '0'+n : ''+n);
  const heiligeEl = document.getElementById('heilige-inhoud');
  const dagEl     = document.getElementById('dagkalender-inhoud');
  const tipEl     = document.getElementById('dagkalender-tip');
  const btnPrev   = document.getElementById('vorigeDag');
  const btnNext   = document.getElementById('volgendeDag');

  function ids(d){
    const y=d.getFullYear(), m=pad(d.getMonth()+1), dd=pad(d.getDate());
    return { kalenderId:`${y}${m}${dd}`, feestdag:`${dd}-${m}`, datumTekst:`${dd}-${m}-${y}` };
  }
  function toggleButtons(disabled){
    [btnPrev, btnNext].forEach(b=>{
      b.disabled = disabled;
      b.classList.toggle('hoek-btn-disabled', disabled);
    });
  }
  function fadeOutAll(){
    heiligeEl.classList.add('is-fading');
    dagEl.classList.add('is-fading');
    tipEl.classList.add('is-fading');
  }
  function fadeInAll(){
    heiligeEl.classList.remove('is-fading');
    dagEl.classList.remove('is-fading');
    tipEl.classList.remove('is-fading');
  }

  async function bouwHTMLVoorDatum(datum, taal){
    const { kalenderId, feestdag, datumTekst } = ids(datum);
    let leftHTML = `<div style="color:#a6a5a4;text-align:center;">Bezig met laden...</div>`;
    let rightMain = `<div style="color:#a6a5a4;text-align:center;">Bezig met laden...</div>`;
    let rightTip  = ``;

    const pHeilige = db.collection("heiligen").where("feestdag","==",feestdag).get().then(snap=>{
      if (snap.empty){
        leftHTML = `<div style="color:#b8b7b4;text-align:center;margin-top:22px;font-size:1.15em"><br>Geen heilige van de dag gevonden.<br><div style="font-size:4em;text-align:center;margin-top:16px;">✝️</div></div>`;
        return;
      }
      const data = snap.docs[Math.floor(Math.random()*snap.docs.length)].data();
      const fotoUrl = data.icoon || data.foto_url || "https://upload.wikimedia.org/wikipedia/commons/1/12/Orthodox_Cross.svg";
      let naam="", levensverhaal="";
      if (taal==="engels"){ naam=data.naam_en||""; levensverhaal=data.levensverhaal_en||""; }
      else if (taal==="grieks"){ naam=data.naam_el||""; levensverhaal=data.levensverhaal_el||""; }
      else { naam=data.naam_nl||data.naam||data.id||"Heilige"; levensverhaal=data.levensverhaal_nl||data.levensverhaal_volwassenen||""; }
      if (!naam) naam = "Nog geen vertaling beschikbaar.";
      if (!levensverhaal) levensverhaal = "Nog geen vertaling beschikbaar.";
      leftHTML = `<div class="heilige-naam">${naam}</div><img src="${fotoUrl}" class="heilige-foto" alt="Heilige icoon"><div class="heilige-levensverhaal">${levensverhaal}</div>`;
    });

    const pKal = db.collection("kalender2025").doc(kalenderId).get().then(doc=>{
      if (!doc.exists){
        rightMain = `<div style="color:#b8b7b4;text-align:center;margin-top:60px;font-size:1.1em">Geen kalenderinfo gevonden.</div>`;
        rightTip = "";
        return;
      }
      const data = doc.data();

      let vasten = data[`Vastenregel NL (netjes NL)`] || data[`Vastenregel NL`] || "";
      if (taal==="engels") vasten = data[`Vastenregel EN`] || (vasten ? "Fasting Free" : "");
      if (taal==="grieks") vasten = data[`Vastenregel EL`] || (vasten ? "Νηστεία ελεύθερη" : "");
      if (!vasten){
        if (taal==="vlaams") vasten="Vastenvrij";
        else if (taal==="engels") vasten="Fasting Free";
        else vasten="Νηστεία ελεύθερη";
      }
      const symb = data["Symbool"] || "";
      let vastenRegelBlok = `<span>${vasten}</span>`;
      if (symb) vastenRegelBlok += `<span class="vastenregel-symbool">${symb}</span>`;

      // Heiligenrij verwijderd aan rechterzijde
      let ep="", ev="";
      if (taal==="vlaams"){
        ep = data[`Epistel Ref NL (netjes NL)`] || data[`Epistel Ref NL`] || "Nog geen vertaling beschikbaar.";
        ev = data[`Evangelie Ref NL (netjes NL)`] || data[`Evangelie Ref NL`] || "Nog geen vertaling beschikbaar.";
      }
      else if (taal==="engels"){
        ep = data[`Epistel Ref EN`] || "No translation available yet.";
        ev = data[`Evangelie Ref EN`] || "No translation available yet.";
      }
      else {
        ep = data[`Epistel Ref EL`] || "Δεν υπάρχει ακόμη μετάφραση.";
        ev = data[`Evangelie Ref EL`] || "Δεν υπάρχει ακόμη μετάφραση.";
      }

      let epL="Apostellezing", evL="Evangelielezing";
      if (taal==="engels"){ epL="Epistle Reading"; evL="Gospel Reading"; }
      if (taal==="grieks"){ epL="Απόστολος"; evL="Ευαγγέλιο"; }

      const tip = (taal==="vlaams") ? (data[`Tip/Wens NL (netjes NL)`] || data[`Tip/Wens NL`] || "")
               : (taal==="engels") ? (data[`Tip/Wens EN`] || "")
               : (data[`Tip/Wens EL`] || "");

      rightMain = `
        <div class="dagkalender-datum">${datumTekst}</div>
        <div class="vastenregel-regel">${vastenRegelBlok}</div>
        <div class="lezingblok"><b>${epL}:</b> ${ep}</div>
        <div class="lezingblok"><b>${evL}:</b> ${ev}</div>
      `;
      rightTip = tip || "";
    });

    await Promise.all([pHeilige, pKal]);
    return { leftHTML, rightMain, rightTip };
  }

  let huidigeTaal = "vlaams";
  let actieveDatum = new Date();
  let isBusy = false;

  document.getElementById("btn-vlaams").onclick = () => { huidigeTaal="vlaams"; setTaal(); };
  document.getElementById("btn-engels").onclick = () => { huidigeTaal="engels"; setTaal(); };
  document.getElementById("btn-grieks").onclick = () => { huidigeTaal="grieks"; setTaal(); };

  function setTaal(){
    laadDag(actieveDatum);
    document.querySelectorAll(".taalkeuze button").forEach(btn=>btn.classList.remove("selected"));
    document.getElementById("btn-"+huidigeTaal).classList.add("selected");
  }

  async function laadDag(datum){
    if (isBusy) return;
    isBusy = true;
    fadeOutAll();
    toggleButtons(true);
    const html = await bouwHTMLVoorDatum(datum, huidigeTaal);
    if (html){
      heiligeEl.innerHTML = html.leftHTML;
      dagEl.innerHTML     = html.rightMain;
      tipEl.innerHTML     = html.rightTip;
    }
    fadeInAll();
    toggleButtons(false);
    isBusy = false;
  }

  laadDag(actieveDatum);
  btnPrev.onclick = ()=>{ actieveDatum.setDate(actieveDatum.getDate()-1); laadDag(actieveDatum); };
  btnNext.onclick = ()=>{ actieveDatum.setDate(actieveDatum.getDate()+1); laadDag(actieveDatum); };

}); // wacht tot DOM klaar is
</script>
<!-- ==== EINDE SCRIPT DAGKALENDER ==== -->
