<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <title>Mijn profiel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(to bottom right, #fff8ec, #f7f0d8);
      margin: 0;
      padding: 0;
      color: #3f3f3f;
    }
    .statusbar {
      background: #7a5f35;
      color: #fff;
      padding: 10px 24px;
      font-size: 1.07em;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    nav.menu {
      background-color: #7a5f35;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      padding: 10px;
    }
    nav.menu a {
      color: #fffef4;
      text-decoration: none;
      margin: 6px 12px;
      font-size: 1em;
      padding: 8px 12px;
      border-radius: 12px;
      background-color: #9c7c4c;
    }
    nav.menu a:hover {
      background-color: #b69466;
    }
    h1 {
      text-align: center;
      color: #5d4c2f;
      margin-top: 24px;
    }
    .container {
      max-width: 800px;
      margin: 20px auto;
      background: #fffef9;
      padding: 24px;
      border-radius: 18px;
      box-shadow: 0 8px 32px #d7cbb142;
    }
    label {
      display: block;
      margin-top: 14px;
      font-weight: bold;
      color: #5a4a2d;
    }
    input, select {
      width: 100%;
      padding: 10px;
      margin-top: 6px;
      border: 1px solid #ccc;
      border-radius: 8px;
      background-color: #fefdf9;
    }
    .kindblok, .kindlijstweergave {
      background: #f2eee1;
      padding: 10px;
      border-radius: 10px;
      margin-top: 12px;
      box-shadow: inset 0 0 6px #ccc8b3;
    }
    .parochielijst, .kindlijst {
      margin-top: 12px;
      padding-left: 20px;
    }
    button {
      margin-top: 20px;
      background: #7a5f35;
      color: white;
      padding: 10px 18px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1em;
    }
    button:hover {
      background: #604926;
    }
    .info {
      margin-top: 20px;
      font-size: 0.9em;
      color: #6a5e3c;
      background: #f8f2da;
      padding: 12px;
      border-radius: 8px;
    }
    #loading {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: #fff8ec;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 1.5em;
      color: #7a5f35;
      z-index: 9999;
    }
  </style>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore-compat.js"></script>
</head>
<body>
<div id="loading">Laden...</div>
<div class="statusbar">
  <span>U bent ingelogd in: <span id="parochieNaam">...</span></span>
</div>
<nav class="menu">
  <a href="https://kathy-torfs.github.io/Orthodoxeweg/volwassenmodus/startpagina.html">üè† Home</a>
  <a href="https://kathy-torfs.github.io/Orthodoxeweg/volwassenmodus/parochie.html">üõê Mijn parochie</a>
  <a href="https://kathy-torfs.github.io/Orthodoxeweg/volwassenmodus/psalmen/psalmen.html">üìú Psalmen</a>
  <a href="https://kathy-torfs.github.io/Orthodoxeweg/volwassenmodus/gebeden/gebeden.html">üôè Gebeden</a>
  <a href="https://kathy-torfs.github.io/Orthodoxeweg/volwassenmodus/gebeden/geloofsbelijdenis.html">‚úù Geloofsbelijdenis</a>
  <a href="https://kathy-torfs.github.io/Orthodoxeweg/volwassenmodus/catechese/catechese.html">üìñ Catechese</a>
  <a href="https://kathy-torfs.github.io/Orthodoxeweg/volwassenmodus/profiel.html">üß∞ Mijn profiel</a>
</nav>
<h1>Mijn profiel</h1>
<div class="container" style="display:none">
  <p class="info">Gebruik steeds je eigen unieke e-mailadres. Het dagboek is hieraan gekoppeld. Kinderen worden beheerd via het profiel van een volwassene.</p>

  <label for="voornaam">Voornaam:</label>
  <input type="text" id="voornaam">

  <label for="achternaam">Achternaam:</label>
  <input type="text" id="achternaam">

  <button onclick="opslaanProfiel()">üíæ Opslaan</button>

  <hr>
  <h2>Kind toevoegen</h2>
  <div class="kindblok">
    <label for="kvoornaam">Voornaam kind:</label>
    <input type="text" id="kvoornaam">

    <label for="kachternaam">Achternaam kind:</label>
    <input type="text" id="kachternaam">

    <label for="kgeboortedatum">Geboortedatum:</label>
    <input type="date" id="kgeboortedatum">

    <label for="toegang">Toegang tot kinderportaal?</label>
    <select id="toegang">
      <option value="ja">Ja</option>
      <option value="nee">Nee</option>
    </select>

    <button onclick="voegKindToe()">‚ûï Kind toevoegen</button>
  </div>

  <div class="kindlijstweergave" id="kindlijst"></div>

  <button onclick="verwijderAccount()" style="background:#c7372f">üóëÔ∏è Verwijder mijn account</button>
</div>
<script>
  const firebaseConfig = {
    apiKey: "AIzaSyBG1iQBmruHUZI1OeW8RgbJ_TPit_7a2LQ",
    authDomain: "orthodoxeweg.firebaseapp.com",
    projectId: "orthodoxeweg",
    storageBucket: "orthodoxeweg.appspot.com",
    messagingSenderId: "408582263618",
    appId: "1:408582263618:web:0a20f4bf0704989d3ceedb"
  };
  if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  const parochieNaam = localStorage.getItem("ingelogdeParochie");
  document.getElementById("parochieNaam").textContent = parochieNaam || "[niet ingelogd]";

  let email = "";

  auth.onAuthStateChanged(async user => {
    if (!user) {
      window.location.replace("https://www.orthodoxeweg.be/");
      return;
    }

    document.getElementById("loading").style.display = "none";
    document.querySelector(".container").style.display = "block";
    email = user.email;

    const query = await db.collectionGroup("leden").where("email", "==", email).get();
    if (query.empty) return;
    const doc = query.docs[0];
    const data = doc.data();
    document.getElementById("voornaam").value = data.voornaam || "";
    document.getElementById("achternaam").value = data.achternaam || "";
    laadKinderen(doc.ref);
  });

  async function laadKinderen(ref) {
    const container = document.getElementById("kindlijst");
    const snap = await ref.collection("kinderen").get();
    if (snap.empty) {
      container.innerHTML = "<p><em>Geen kinderen toegevoegd.</em></p>";
    } else {
      container.innerHTML = "<h3>Geregistreerde kinderen:</h3><ul>" +
        snap.docs.map(d => {
          const k = d.data();
          return `<li><strong>${k.voornaam} ${k.achternaam}</strong> ‚Äì Geboren: ${k.geboortedatum || "?"} ‚Äì Kinderportaal: ${k.toegang}</li>`;
        }).join("") + "</ul>";
    }
  }

  async function opslaanProfiel() {
    const voornaam = document.getElementById("voornaam").value;
    const achternaam = document.getElementById("achternaam").value;
    const query = await db.collectionGroup("leden").where("email", "==", email).get();
    query.forEach(doc => doc.ref.update({ voornaam, achternaam }));
    alert("Gegevens opgeslagen!");
  }

  async function voegKindToe() {
    const kvoornaam = document.getElementById("kvoornaam").value;
    const kachternaam = document.getElementById("kachternaam").value;
    const kgeboortedatum = document.getElementById("kgeboortedatum").value;
    const toegang = document.getElementById("toegang").value;

    const query = await db.collectionGroup("leden").where("email", "==", email).get();
    for (const doc of query.docs) {
      await doc.ref.collection("kinderen").add({ voornaam: kvoornaam, achternaam: kachternaam, geboortedatum: kgeboortedatum, toegang });
      await laadKinderen(doc.ref);
    }
    alert("Kind toegevoegd!");
  }

  async function verwijderAccount() {
    if (!confirm("Ben je zeker dat je je account wil verwijderen?")) return;
    const user = auth.currentUser;
    const query = await db.collectionGroup("leden").where("email", "==", email).get();
    for (const doc of query.docs) {
      await doc.ref.delete();
    }
    await user.delete();
    alert("Account verwijderd.");
    window.location.href = "https://www.orthodoxeweg.be/";
  }
</script>
</body>
</html>
