<!DOCTYPE html> 
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Mijn profiel ‚Äì Orthodoxeweg</title>
  <link rel="icon" href="https://kathy-torfs.github.io/Orthodoxeweg/images/kruis.png">
  <style>
    body { background-color: #f5e9b8; color: #6f4e1a; font-family: Arial, sans-serif; margin: 0; padding: 0; }
    main { max-width: 900px; margin: 38px auto 40px auto; background: #fffef9; padding: 30px 22px 22px 22px;
      border-radius: 20px; box-shadow: 0 6px 32px #d7cbb142; display: flex; gap: 36px;}
    .profiel-links, .profiel-rechts { flex: 1 1 0; min-width: 320px; }
    h1 { text-align: center; margin-bottom: 12px; font-size: 2.1em; }
    .avatar-groot { width: 92px; height: 92px; border-radius: 50%; border: 3.2px solid #dab97a; background: #fff8eb;
      margin: 0 auto 12px auto; display: block; }
    .avatar-selectie { display: flex; gap: 13px; justify-content: center; margin: 14px 0 22px 0;}
    .avatar-selectie img { width: 54px; height: 54px; border-radius: 50%; border: 2.2px solid #bba868; cursor: pointer;
      background: #fcfaf5; transition: border 0.2s, box-shadow 0.2s;}
    .avatar-selectie img.selected, .avatar-selectie img:hover { border: 3px solid #8722aa; box-shadow: 0 2px 8px #dab97a77;}
    label { display: block; margin-top: 18px; font-weight: bold; }
    input[type="text"], input[type="date"], input[type="email"], input[type="password"], select {
      width: 100%; padding: 9px 12px; border: 1px solid #bba868; border-radius: 7px; margin-top: 6px;
      font-size: 1em; background: #fcfaf5; }
    input[readonly] { background: #f6f6f6; color: #998a5f; }
    .pw-row { position: relative; }
    .pw-toggle { position: absolute; right: 12px; top: 50%; transform: translateY(-50%); cursor: pointer; font-size: 1.15em; }
    .formrow-inline { display: flex; align-items: center; gap: 12px; margin-top: 0; }
    #profielForm button { background: #7a5f35; color: #fff; border: none; border-radius: 9px; padding: 12px 22px;
      font-size: 1em; font-weight: bold; margin-top: 30px; cursor: pointer; transition: background 0.16s;
      box-shadow: 0 2px 10px #e3e3b588; }
    #profielForm button:hover { background: #604926; }
    #melding { color: #a05213; margin: 18px 0 0 0; min-height: 32px; text-align: center;}
    .kindblok { background: #f8f6e1; border-radius: 11px; padding: 13px 17px 11px 17px; margin-bottom: 17px;
      border: 1.2px solid #e0d3a0; position: relative; }
    .kindblok label { margin-top: 7px; font-weight: normal;}
    .kind-acties { display: flex; gap: 13px; margin-top: 12px;}
    .kind-acties button { background: #dab97a; color: #654321; border-radius: 8px; padding: 7px 15px; border: none;
      cursor: pointer; font-weight: bold;}
    .kind-acties button:hover { background: #e8c370;}
    #kinderen-lijst { margin-bottom: 24px;}
    .kind-wachtwoord, .kind-punten { width: 100%; border-radius: 7px; padding: 6px 10px; margin-top: 5px; }
    .kind-wachtwoord { font-size: 0.97em; background: #f6f6f6; color: #a9985f; border: 1px solid #bbb; }
    .kind-punten { font-size: 1em; background: #f6f6f6; color: #498615; border: 1px solid #bbb; font-weight: bold; }
    .verwijder-profiel-knop { background: #e24343; color: #fff; border: none; padding: 11px 26px; border-radius: 8px;
      font-weight: bold; margin-top: 45px; cursor: pointer; float: right;}
    .verwijder-profiel-knop:hover { background: #b72828; }
  </style>
  <!-- FIREBASE -->
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore-compat.js"></script>
</head>
<body>

  <!-- ==== GEMEENSCHAPPELIJKE HEADER ==== -->
  <div id="volwassen-header" data-header-src="../common/header.html"></div>
  <script src="../common/layout.js"></script>

  <main>
    <!-- PROFIEL LINKS -->
    <div class="profiel-links">
      <h1>Mijn profiel</h1>
      <img id="avatarGroot" class="avatar-groot" src="https://cdn-icons-png.flaticon.com/512/4140/4140048.png" alt="Avatar">
      <div class="avatar-selectie" id="avatarSelectieVolw"></div>
      <form id="profielForm" autocomplete="off">
        <label>Voornaam: <input type="text" id="voornaam"></label>
        <label>Achternaam: <input type="text" id="achternaam"></label>
        <label>Doopnaam: <input type="text" id="doopnaam"></label>
        <label>E-mailadres: <input type="email" id="email"></label>
        <label>Geboortedatum: <input type="date" id="geboortedatum">
          <span class="formrow-inline">
            <input type="checkbox" id="toonVerjaardag" style="width:auto;margin-left:8px;">
            <span style="font-weight:normal;font-size:0.98em;">Zichtbaar op verjaardagskalender</span>
          </span>
        </label>
        <label>Gezinssituatie:
          <select id="gezinSituatie">
            <option value="">-- Kies --</option>
            <option value="vrouw">üå∑ Vrouw (single)</option>
            <option value="man">ü™ª Man (single)</option>
            <option value="koppel">üå∑ + ü™ª Koppel</option>
            <option value="gezin">üå∑ + ü™ª + üå± Gezin</option>
            <option value="alleenstaande_ouder">üå∑/ü™ª + üå± Alleenstaande ouder</option>
          </select>
        </label>
        <label>Loginnaam: <input type="text" id="loginKeuze" readonly></label>
        <label>Wachtwoord:
          <div class="pw-row">
            <input type="password" id="wachtwoord" autocomplete="off">
            <span class="pw-toggle" id="pwToggle" title="Toon/verberg wachtwoord">üëÅÔ∏è</span>
          </div>
        </label>
        <button type="button" onclick="opslaanProfiel()">üíæ Wijzigingen opslaan</button>
      </form>
      <button class="verwijder-profiel-knop" onclick="verwijderProfiel()">Verwijder profiel</button>
      <div id="melding"></div>
    </div>

    <!-- PROFIEL RECHTS: KINDEREN -->
    <div class="profiel-rechts">
      <h2>Kinderen</h2>
      <div id="kinderen-lijst"></div>
      <button id="voeg-kind-btn" type="button">+ Kind toevoegen</button>
    </div>
  </main>

  <script>
    const firebaseConfig = { /* je config blijft identiek */ };
    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const volwassenAvatars = [ /* ... */ ];
    const avatarSelectieVolw = document.getElementById('avatarSelectieVolw');
    const avatarGroot = document.getElementById('avatarGroot');
    volwassenAvatars.forEach(url => {
      const img = document.createElement('img');
      img.src = url;
      img.onclick = function() {
        avatarGroot.src = url;
        document.querySelectorAll('#avatarSelectieVolw img').forEach(i => i.classList.remove('selected'));
        img.classList.add('selected');
        if(window.saveAvatarVolwassene) saveAvatarVolwassene(url);
      }
      avatarSelectieVolw.appendChild(img);
    });

    const parochieId = localStorage.getItem("ingelogdeParochie");
    const loginKeuze = localStorage.getItem("loginKeuze");
    const profielForm = document.getElementById("profielForm");
    let kinderenData = [];

    async function laadProfiel() {
      try {
        let docRef = db.collection("parochies").doc(parochieId).collection("leden").doc(loginKeuze);
        let doc = await docRef.get();
        if (!doc.exists) { profielForm.style.display = "none"; document.getElementById("melding").textContent = "Profiel niet gevonden!"; return; }
        let d = doc.data();
        document.getElementById("voornaam").value = d.voornaam || "";
        document.getElementById("achternaam").value = d.achternaam || "";
        document.getElementById("doopnaam").value = d.doopnaam || "";
        document.getElementById("email").value = d.email || "";
        document.getElementById("geboortedatum").value = d.geboortedatum || "";
        document.getElementById("loginKeuze").value = d.loginKeuze || "";
        document.getElementById("wachtwoord").value = d.wachtwoord || "";
        document.getElementById("toonVerjaardag").checked = !!d.verjaardagToevoegen;
        document.getElementById("gezinSituatie").value = d.gezinSituatie || ""; // ‚úÖ toegevoegd
        avatarGroot.src = d.avatarURL || volwassenAvatars[0];
      } catch (e) { document.getElementById("melding").textContent = "Fout bij laden profiel."; }
    }
    window.addEventListener('DOMContentLoaded', laadProfiel);

    async function opslaanProfiel() {
      const melding = document.getElementById("melding");
      melding.textContent = "Bezig met opslaan...";
      try {
        await db.collection("parochies").doc(parochieId).collection("leden").doc(loginKeuze).update({
          voornaam: document.getElementById("voornaam").value,
          achternaam: document.getElementById("achternaam").value,
          doopnaam: document.getElementById("doopnaam").value,
          email: document.getElementById("email").value,
          geboortedatum: document.getElementById("geboortedatum").value,
          wachtwoord: document.getElementById("wachtwoord").value,
          verjaardagToevoegen: document.getElementById("toonVerjaardag").checked,
          gezinSituatie: document.getElementById("gezinSituatie").value // ‚úÖ toegevoegd
        });
        melding.textContent = "Wijzigingen opgeslagen!";
      } catch (e) { melding.textContent = "Fout bij opslaan!"; }
    }
  </script>
</body>
</html>
