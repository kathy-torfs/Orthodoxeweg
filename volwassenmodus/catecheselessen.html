<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Catecheselessen â€“ Orthodoxeweg</title>
  <link rel="icon" href="https://www.orthodoxeweg.be/images/kruis.png" />
  <style>
    body {
      margin:0;
      font-family:Arial,sans-serif;
      background:#f5e9b8;
      color:#6f4e1a;
    }
    .container {
      max-width:1000px;
      margin:30px auto;
      padding:0 20px;
      text-align:center;
    }
    h1 {
      color:#4e2710;
      margin-bottom:20px;
    }
    .les {
      background:#fffdf4;
      border:2px solid #ceb27d;
      border-radius:12px;
      padding:16px;
      margin:16px auto;
      text-align:left;
      box-shadow:0 2px 10px #dac79e55;
    }
    .les h2 { margin-top:0; color:#5a3617; }
    .plaat img {
      max-width:160px;  /* thumbnails in editor */
      max-height:120px;
      border-radius:8px;
      object-fit:cover;
      box-shadow:0 2px 8px #0002;
      margin:6px;
    }
    .controls {
      margin-top:12px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }
    button {
      background:#7a5f35;
      color:#fff;
      border:none;
      border-radius:8px;
      padding:8px 16px;
      cursor:pointer;
    }
    button:hover { background:#5d4726; }
    .nieuwLesForm {
      background:#fffef9;
      border:2px dashed #ceb27d;
      border-radius:12px;
      padding:16px;
      margin:30px auto;
      text-align:left;
    }
    .nieuwLesForm h2 { margin-top:0; }
    .nieuwLesForm input, .nieuwLesForm select, .nieuwLesForm textarea {
      width:100%;
      padding:8px;
      margin:6px 0;
      border:1px solid #ccc;
      border-radius:6px;
      font-size:1em;
    }
    .nieuwLesForm textarea { min-height:120px; resize:vertical; }
  </style>
</head>
<body>
  <!-- Header -->
  <div id="volwassen-header"></div>

  <div class="container">
    <h1 id="paginaTitel">ðŸ“– Catecheselessen</h1>
    <div>
      <label for="doelgroepFilter"><b>Toon lessen voor:</b></label>
      <select id="doelgroepFilter">
        <option value="alle">Alle</option>
        <option value="kleuters">Kleuters</option>
        <option value="lagere">Lagere school</option>
      </select>
    </div>
    <div id="lessenContainer"></div>

    <div class="nieuwLesForm">
      <h2>âž• Nieuwe les toevoegen</h2>
      <label>Titel:</label>
      <input type="text" id="nieuweTitel" placeholder="Titel van de les" />
      <label>Doelgroep:</label>
      <select id="nieuweDoelgroep">
        <option value="kleuters">Kleuters</option>
        <option value="lagere">Lagere school</option>
      </select>
      <label>Tekst:</label>
      <textarea id="nieuweTekst" placeholder="Schrijf hier de lesâ€¦"></textarea>
      <label>Plaat URL:</label>
      <input type="text" id="nieuwePlaat" placeholder="https://â€¦" />
      <button onclick="lesOpslaan()">Opslaan</button>
    </div>
  </div>

  <!-- Firebase SDK's -->
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-auth-compat.js"></script>

  <!-- Layout script -->
  <script src="https://www.orthodoxeweg.be/volwassenmodus/common/layout.js" defer></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBKEakRzmnPZ3DY8NUkZrZr_YtqBbNVHL4",
      authDomain: "orthodoxeweg.firebaseapp.com",
      projectId: "orthodoxeweg",
      storageBucket: "orthodoxeweg.appspot.com",
      messagingSenderId: "408582263618",
      appId: "1:408582263618:web:2e02833fa0d4d8903ceedb"
    };
    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const parochieId = localStorage.getItem("ingelogdeParochie");
    const titelEl = document.getElementById("paginaTitel");
    const container = document.getElementById("lessenContainer");
    const doelgroepFilter = document.getElementById("doelgroepFilter");

    if (parochieId) {
      titelEl.textContent = "ðŸ“– Catecheselessen van de parochie " + parochieId;
      laadLessen();
    } else {
      titelEl.textContent = "ðŸ“– Catecheselessen (geen parochie gevonden)";
    }

    doelgroepFilter.addEventListener("change", laadLessen);

    function laadLessen() {
      if (!parochieId) return;
      container.innerHTML = "<p>Lessen ladenâ€¦</p>";
      let query = db.collection("parochies").doc(parochieId).collection("catecheselessen");
      const filter = doelgroepFilter.value;
      if (filter !== "alle") {
        query = query.where("doelgroep", "==", filter);
      }
      query.get().then(snapshot => {
        if (snapshot.empty) {
          container.innerHTML = "<p>Geen lessen gevonden.</p>";
          return;
        }
        container.innerHTML = "";
        snapshot.forEach(doc => {
          const data = doc.data();
          const div = document.createElement("div");
          div.className = "les";
          div.innerHTML = `
            <h2>${data.titel || "(zonder titel)"}</h2>
            <div><b>Doelgroep:</b> ${data.doelgroep || "-"}</div>
            <div>${data.tekst || ""}</div>
            <div class="plaat">${data.plaat ? `<img src="${data.plaat}" alt="Plaat">` : ""}</div>
            <div class="controls">
              <button onclick="lesVerwijderen('${doc.id}')">Verwijderen</button>
            </div>
          `;
          container.appendChild(div);
        });
      });
    }

    function lesOpslaan() {
      if (!parochieId) return alert("Geen parochie gevonden.");
      const titel = document.getElementById("nieuweTitel").value.trim();
      const doelgroep = document.getElementById("nieuweDoelgroep").value;
      const tekst = document.getElementById("nieuweTekst").value.trim();
      const plaat = document.getElementById("nieuwePlaat").value.trim();
      db.collection("parochies").doc(parochieId).collection("catecheselessen").add({
        titel, doelgroep, tekst, plaat,
        aangemaakt: new Date()
      }).then(() => {
        document.getElementById("nieuweTitel").value = "";
        document.getElementById("nieuweTekst").value = "";
        document.getElementById("nieuwePlaat").value = "";
        laadLessen();
      });
    }

    function lesVerwijderen(id) {
      if (!parochieId) return;
      if (!confirm("Weet je zeker dat je deze les wil verwijderen?")) return;
      db.collection("parochies").doc(parochieId).collection("catecheselessen").doc(id).delete().then(laadLessen);
    }
  </script>
</body>
</html>
