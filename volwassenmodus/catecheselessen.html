<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Catecheselessen ‚Äì Orthodoxeweg</title>
  <link rel="icon" href="https://kathy-torfs.github.io/Orthodoxeweg/images/kruis.png">
  <style>
    body {
      margin:0;
      font-family:Arial,sans-serif;
      background:#f5e9b8;
      color:#6f4e1a;
    }
    .container {
      max-width:1000px;
      margin:30px auto;
      padding:0 20px;
    }
    h1 { color:#4e2710; text-align:center; }
    form {
      background:#fff8eb; border:2px solid #dab97a; border-radius:12px;
      padding:16px; box-shadow:0 2px 8px rgba(0,0,0,0.12); margin-bottom:30px;
    }
    form h2{margin-top:0;color:#7a5f35}
    label{display:block;margin:10px 0 4px}
    input[type=text], textarea, select {
      width:100%; padding:8px; border:1px solid #dab97a; border-radius:6px;
      background:#fffdf6; font-family:inherit;
    }
    textarea{min-height:100px; resize:vertical}
    button {
      background:#7bb235; color:#fff; border:none; padding:8px 16px;
      border-radius:8px; cursor:pointer; font-weight:bold;
    }
    button:hover { background:#5e8e29; }
    .les-lijst{display:flex;flex-direction:column;gap:14px}
    .les-kaart{background:#fff;border:2px solid #dab97a;border-radius:10px;
      padding:14px;box-shadow:0 2px 6px rgba(0,0,0,0.1)}
    .les-kaart h3{margin:0;color:#7a5f35}
    .les-kaart small{color:#8f7437}
    .les-kaart .acties{margin-top:10px;display:flex;gap:8px;flex-wrap:wrap}
    .les-kaart button{padding:6px 10px;font-size:0.9em}
  </style>
</head>
<body>
  <!-- Header -->
  <div id="volwassen-header"></div>

  <div class="container">
    <h1 id="paginaTitel">üìñ Catecheselessen</h1>

    <form id="nieuweLesForm">
      <h2>Nieuwe les toevoegen</h2>
      <label for="lesTitel">Titel</label>
      <input type="text" id="lesTitel" required>

      <label for="doelgroep">Doelgroep</label>
      <select id="doelgroep">
        <option value="kleuters">üë∂ Kleuters</option>
        <option value="lagere">üìö Lagere school</option>
      </select>

      <label for="lesInhoud">Lesinhoud</label>
      <textarea id="lesInhoud" placeholder="Schrijf hier je verhaal of uitleg..."></textarea>

      <div>
        <button type="submit">üìå Opslaan</button>
      </div>
    </form>

    <div id="lessenOverzicht" class="les-lijst">Laden‚Ä¶</div>
  </div>

  <!-- Firebase SDK's -->
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore-compat.js"></script>

  <script>
    // ‚úÖ Firebase init
    const firebaseConfig = {
      apiKey: "AIzaSyBKEakRzmnPZ3DY8NUkZrZr_YtqBbNVHL4",
      authDomain: "orthodoxeweg.firebaseapp.com",
      projectId: "orthodoxeweg",
      storageBucket: "orthodoxeweg.appspot.com",
      messagingSenderId: "408582263618",
      appId: "1:408582263618:web:2e02833fa0d4d8903ceedb"
    };
    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // ‚úÖ parochieId ophalen uit login
    const parochieId = localStorage.getItem("ingelogdeParochie");
    const parochieNaam = localStorage.getItem("ingelogdeParochieNaam");
    const titel = document.getElementById("paginaTitel");
    const overzicht = document.getElementById("lessenOverzicht");
    const form = document.getElementById("nieuweLesForm");

    if (parochieId) {
      titel.textContent = "üìñ Catecheselessen van " + parochieNaam;
      laadLessen();
    } else {
      titel.textContent = "üìñ Catecheselessen (geen parochie gevonden)";
      overzicht.innerHTML = "<p style='color:#a33'>‚ùå Geen parochie gevonden. Log eerst in.</p>";
    }

    // ‚úÖ nieuwe les opslaan
    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      if (!parochieId) {
        alert("Geen parochie gevonden.");
        return;
      }
      const titel = document.getElementById("lesTitel").value.trim();
      const doelgroep = document.getElementById("doelgroep").value;
      const inhoud = document.getElementById("lesInhoud").value.trim();
      if (!titel) { alert("Titel is verplicht."); return; }

      try {
        await db.collection("parochies").doc(parochieId).collection("catecheselessen").add({
          titel, doelgroep, inhoud, aangemaaktOp: new Date()
        });
        form.reset();
        laadLessen();
      } catch (err) {
        console.error(err);
        alert("‚ùå Fout bij opslaan: " + err.message);
      }
    });

    // ‚úÖ lessen ophalen
    async function laadLessen() {
      overzicht.innerHTML = "Laden‚Ä¶";
      try {
        const snap = await db.collection("parochies").doc(parochieId).collection("catecheselessen")
          .orderBy("aangemaaktOp", "desc").get();
        overzicht.innerHTML = "";
        if (snap.empty) {
          overzicht.innerHTML = "<p>Geen lessen gevonden.</p>";
          return;
        }
        snap.forEach(doc => {
          const d = doc.data();
          const when = d.aangemaaktOp?.toDate ? d.aangemaaktOp.toDate().toLocaleString() : "";
          const kaart = document.createElement("div");
          kaart.className = "les-kaart";
          kaart.innerHTML = `
            <h3>${d.titel}</h3>
            <small>${when}</small><br>
            <b>Doelgroep:</b> ${d.doelgroep || "-"}<br>
            <p>${d.inhoud || ""}</p>
            <div class="acties">
              <button onclick="verwijderLes('${doc.id}')">üóë Verwijderen</button>
            </div>
          `;
          overzicht.appendChild(kaart);
        });
      } catch (e) {
        console.error(e);
        overzicht.innerHTML = "<p style='color:#a33'>‚ùå Fout bij laden van lessen.</p>";
      }
    }

    // ‚úÖ les verwijderen
    async function verwijderLes(id) {
      if (!confirm("Weet je zeker dat je deze les wil verwijderen?")) return;
      await db.collection("parochies").doc(parochieId).collection("catecheselessen").doc(id).delete();
      laadLessen();
    }
  </script>

  <!-- Header script NA Firebase -->
  <script src="common/layout.js" defer></script>
</body>
</html>
