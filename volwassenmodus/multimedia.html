<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <title>üì∫ Multimedia ‚Äì Orthodoxeweg Volwassenmodus</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" href="https://kathy-torfs.github.io/Orthodoxeweg/images/kruis.png">

  <style>
    body { margin:0; font-family:Arial,sans-serif; background:#f5e9b8; color:#4e3a15; }
    main { max-width:1000px; margin:30px auto; padding:0 2vw; }

    h1 { text-align:center; color:#7a5f35; margin-bottom:20px; }

    /* Grid met tv-icoontjes */
    .media-grid {
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(160px,1fr));
      gap:24px;
      margin-top:20px;
    }
    .media-item {
      text-align:center;
      cursor:pointer;
    }
    .media-item .tv {
      font-size:4em;
      display:block;
      transition:transform .2s;
    }
    .media-item:hover .tv { transform:scale(1.15); }
    .media-item .titel { margin-top:8px; font-weight:bold; font-size:1em; }

    /* Speler blok */
    #player {
      margin-top:40px;
      background:#fffdf5;
      border:2px solid #d8c287;
      border-radius:14px;
      padding:20px;
      box-shadow:0 4px 14px rgba(0,0,0,.15);
      display:none;
    }
    #player h2 { margin-top:0; color:#7a5f35; text-align:center; }
    #player-content { text-align:center; margin-top:15px; }
    #player-content audio,
    #player-content video,
    #player-content iframe,
    #player-content img {
      max-width:100%;
      border-radius:12px;
    }
    #player-content audio, #player-content video { width:100%; }
  </style>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  <script defer src="../common/layout.js"></script>
</head>
<body>
  <!-- Header -->
  <div id="volwassen-header" data-header-src="../common/header.html"></div>

  <main>
    <h1>üì∫ Multimedia</h1>

    <div class="media-grid" id="mediaGrid">‚è≥ Laden...</div>

    <div id="player">
      <h2 id="player-title">Afspelen</h2>
      <div id="player-content"></div>
    </div>
  </main>

  <script>
    if (!firebase.apps.length) {
      firebase.initializeApp({
        apiKey:"AIzaSyBG1iQBmruHUZI1OeW8RgbJ_TPit_7a2LQ",
        authDomain:"orthodoxeweg.firebaseapp.com",
        projectId:"orthodoxeweg",
        storageBucket:"orthodoxeweg.appspot.com",
        messagingSenderId:"408582263618",
        appId:"1:408582263618:web:0a20f4bf0704989d3ceedb"
      });
    }
    const db = firebase.firestore();

    const parochieId = localStorage.getItem("ingelogdeParochie");

    async function laadMedia() {
      const grid = document.getElementById("mediaGrid");
      grid.innerHTML = "‚è≥ Laden...";

      if (!parochieId) {
        grid.innerHTML = "<p>‚ö†Ô∏è Geen parochie geselecteerd.</p>";
        return;
      }

      const snap = await db.collection("parochies").doc(parochieId).collection("uploads").get();
      if (snap.empty) {
        grid.innerHTML = "<p>Geen media gevonden.</p>";
        return;
      }

      grid.innerHTML = "";
      snap.forEach(doc => {
        const d = doc.data();
        const div = document.createElement("div");
        div.className = "media-item";
        div.innerHTML = `
          <span class="tv">üì∫</span>
          <div class="titel">${d.titel || "Onbekend"}</div>
        `;
        div.onclick = () => toonPlayer(d);
        grid.appendChild(div);
      });
    }

    function toonPlayer(data) {
      const player = document.getElementById("player");
      const content = document.getElementById("player-content");
      const title = document.getElementById("player-title");

      title.textContent = data.titel || "Afspelen";
      content.innerHTML = "";

      if (data.link) {
        if (data.link.includes("youtube.com") || data.link.includes("youtu.be")) {
          // YouTube embed
          let videoId = "";
          if (data.link.includes("youtu.be")) {
            videoId = data.link.split("youtu.be/")[1].split("?")[0];
          } else {
            const urlParams = new URLSearchParams(new URL(data.link).search);
            videoId = urlParams.get("v");
          }
          content.innerHTML = `<iframe width="560" height="315" src="https://www.youtube.com/embed/${videoId}" frameborder="0" allowfullscreen></iframe>`;
        } else if (data.link.endsWith(".mp3")) {
          content.innerHTML = `<audio controls autoplay src="${data.link}"></audio>`;
        } else if (data.link.endsWith(".mp4")) {
          content.innerHTML = `<video controls autoplay src="${data.link}"></video>`;
        } else if (data.link.match(/\.(jpg|jpeg|png|gif)$/i)) {
          content.innerHTML = `<img src="${data.link}" alt="media">`;
        } else {
          content.innerHTML = `<a href="${data.link}" target="_blank">Open link</a>`;
        }
      }

      player.style.display = "block";
      player.scrollIntoView({ behavior: "smooth" });
    }

    laadMedia();
  </script>
</body>
</html>
