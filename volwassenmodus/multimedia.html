<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>üì∫ Multimedia ‚Äì Orthodoxeweg</title>
  <link rel="icon" href="https://kathy-torfs.github.io/Orthodoxeweg/images/kruis.png">
  <style>
    body { background:#f5e9b8; color:#6f4e1a; font-family:Arial,sans-serif; margin:0; padding:0; }

    h1 { text-align:center; margin:20px 0; color:#4e2710; }

    .lijst { max-width:800px; margin:20px auto; background:#fffef9; border:2px solid #e2d1a5;
             border-radius:12px; padding:20px; box-shadow:0 6px 18px rgba(0,0,0,0.12); }
    .item { display:flex; justify-content:space-between; align-items:center; padding:12px;
            border-bottom:1px solid #e2d1a5; }
    .item:last-child { border-bottom:none; }
    .item span.titel { font-weight:bold; color:#5b4320; }
    .item button { font-size:1.6em; background:none; border:none; cursor:pointer; }
    .item button:hover { transform:scale(1.2); }

    /* Modaal */
    .modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%;
             background:rgba(0,0,0,0.6); justify-content:center; align-items:center; z-index:1000; }
    .modal-content { background:#fff; padding:20px; border-radius:12px; max-width:90%; max-height:80%;
                     display:flex; flex-direction:column; align-items:center; }
    .modal-content h2 { margin:0 0 12px; font-size:1.2em; color:#4e2710; }
    .modal-content audio, .modal-content video { width:100%; max-height:70vh; }
    .modal-content img { max-width:100%; max-height:70vh; border-radius:8px; }
    .close-btn { margin-top:12px; padding:6px 14px; background:#9a2617; color:#fff; border:none;
                 border-radius:6px; cursor:pointer; font-weight:bold; }
    .close-btn:hover { background:#bd2e23; }
  </style>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-storage-compat.js"></script>
  <script defer src="../common/layout.js"></script>
</head>
<body>
  <!-- Header -->
  <div id="volwassen-header" data-header-src="../common/header.html"></div>

  <h1>üì∫ Multimedia</h1>

  <div class="lijst" id="mediaLijst">‚è≥ Laden...</div>

  <!-- Popup -->
  <div class="modal" id="mediaModal">
    <div class="modal-content" id="modalContent">
      <!-- Dynamische inhoud -->
      <button class="close-btn" onclick="sluitModal()">‚ùå Sluiten</button>
    </div>
  </div>

  <script>
    // Firebase init
    if (!firebase.apps.length) {
      firebase.initializeApp({
        apiKey: "AIzaSyBG1iQBmruHUZI1OeW8RgbJ_TPit_7a2LQ",
        authDomain: "orthodoxeweg.firebaseapp.com",
        projectId: "orthodoxeweg",
        storageBucket: "orthodoxeweg.appspot.com",
      });
    }
    const db = firebase.firestore();

    const parochieId = localStorage.getItem("ingelogdeParochie") || "hasselt-drie-hierarchen";

    const lijstEl = document.getElementById("mediaLijst");
    const modal = document.getElementById("mediaModal");
    const modalContent = document.getElementById("modalContent");

    async function laadMedia() {
      lijstEl.innerHTML = "‚è≥ Laden...";
      const snap = await db.collection("parochies").doc(parochieId).collection("uploads")
        .orderBy("datum", "desc").get();

      if (snap.empty) {
        lijstEl.innerHTML = "<p style='text-align:center;color:#7a5f35'>Geen multimedia gevonden.</p>";
        return;
      }

      lijstEl.innerHTML = "";
      snap.forEach(doc => {
        const d = doc.data();
        const div = document.createElement("div");
        div.className = "item";
        div.innerHTML = `
          <span class="titel">${d.titel || "Zonder titel"}</span>
          <button title="Afspelen">üì∫</button>
        `;
        div.querySelector("button").onclick = () => openModal(d);
        lijstEl.appendChild(div);
      });
    }

    function openModal(data) {
      let html = `<h2>${data.titel || "Multimedia"}</h2>`;
      if (data.type && data.type.startsWith("audio")) {
        html += `<audio src="${data.url}" controls autoplay></audio>`;
      } else if (data.type && data.type.startsWith("video")) {
        html += `<video src="${data.url}" controls autoplay></video>`;
      } else if (data.type && data.type.startsWith("image")) {
        html += `<img src="${data.url}" alt="${data.titel}">`;
      } else {
        html += `<p><a href="${data.url}" target="_blank">Open bestand</a></p>`;
      }
      modalContent.innerHTML = html + '<button class="close-btn" onclick="sluitModal()">‚ùå Sluiten</button>';
      modal.style.display = "flex";
    }

    function sluitModal() {
      modal.style.display = "none";
      modalContent.innerHTML = "";
    }

    window.onclick = function(e) {
      if (e.target === modal) sluitModal();
    }

    laadMedia();
  </script>
</body>
</html>
