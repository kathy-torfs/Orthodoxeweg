<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Orthodoxe Tuin</title>
  <link rel="icon" href="https://kathy-torfs.github.io/Orthodoxeweg/images/kruis.png">
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #d9f2d0;
    }
    #map {
      height: calc(100vh - 80px);
      width: 100%;
    }
    .leaflet-popup-content {
      font-size: 0.95em;
    }
  </style>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
</head>
<body>
  <!-- ==== GEMEENSCHAPPELIJKE HEADER ==== -->
  <div id="volwassen-header"></div>
  <script src="https://kathy-torfs.github.io/Orthodoxeweg/volwassenmodus/common/layout.js"></script>

  <div id="map"></div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <!-- FIREBASE -->
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore-compat.js"></script>

  <script>
    // === Firebase Config ===
    const firebaseConfig = {
      apiKey: "AIzaSyBG1iQBmruHUZI1OeW8RgbJ_TPit_7a2LQ",
      authDomain: "orthodoxeweg.firebaseapp.com",
      projectId: "orthodoxeweg",
      storageBucket: "orthodoxeweg.appspot.com",
      messagingSenderId: "408582263618",
      appId: "1:408582263618:web:0a20f4bf0704989d3ceedb"
    };
    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Maak een custom emoji-icoon voor Leaflet
    function emojiIcon(emoji) {
      return L.divIcon({
        html: `<span style="font-size:28px;">${emoji}</span>`,
        className: "",
        iconSize: [30, 30],
        iconAnchor: [15, 30],
        popupAnchor: [0, -28]
      });
    }

    // === Kaart ===
    const map = L.map('map').setView([50.85, 4.35], 8); // BelgiÃ« centrum
    L.tileLayer('https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png', {
      attribution: 'Kaartgegevens Â© OpenStreetMap-bijdragers'
    }).addTo(map);

    // === Data laden uit Firestore ===
    async function laadLeden() {
      try {
        const parochies = await db.collection("parochies").get();
        for (let paroDoc of parochies.docs) {
          const leden = await paroDoc.ref.collection("leden").get();
          leden.forEach(lidDoc => {
            const lid = lidDoc.data();

            // enkel tonen als er een locatie is
            if (!lid.locatie || !lid.locatie.lat || !lid.locatie.lng) return;

            // bloemen rechtstreeks uit Firestore
            const bloemen = lid.bloemen || "ðŸŒ·";

            // marker toevoegen
            L.marker([lid.locatie.lat, lid.locatie.lng], { icon: emojiIcon(bloemen) })
              .addTo(map)
              .bindPopup(`<strong>${lid.voornaam} ${lid.achternaam}</strong><br>Parochie: ${paroDoc.id}<br>${bloemen}`);
          });
        }
      } catch (err) {
        console.error("Fout bij laden leden:", err);
      }
    }

    laadLeden();
  </script>
</body>
</html>
