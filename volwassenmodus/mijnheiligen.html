<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>üìñ Mijn heiligen ‚Äì Orthodoxeweg</title>
  <link rel="icon" href="https://kathy-torfs.github.io/Orthodoxeweg/images/kruis.png">

  <style>
    body { margin:0; font-family:Arial,sans-serif; background:#f5e9b8; color:#6f4e1a; }
    main { max-width:1000px; margin:30px auto; padding:0 20px; }

    h1 { text-align:center; color:#4e2710; margin-bottom:20px; }

    .lijst { display:flex; flex-direction:column; gap:14px; }

    .kaart {
      background:#fffdf5; border:2px solid #dab97a;
      border-radius:10px; padding:14px;
      box-shadow:0 2px 6px rgba(0,0,0,0.12);
    }
    .kaart h3 { margin:0; color:#7a5f35; }
    .kaart small { display:block; margin-bottom:6px; color:#8f7437; }

    .acties { margin-top:10px; display:flex; gap:8px; flex-wrap:wrap; }
    .acties button { padding:6px 10px; font-size:0.9em; cursor:pointer; }

    form {
      background:#fff8eb; border:2px dashed #dab97a;
      border-radius:12px; padding:16px; margin-bottom:20px;
    }
    label { display:block; margin:10px 0 4px; font-weight:bold; }
    input, textarea {
      width:100%; padding:8px; border:1px solid #dab97a; border-radius:6px;
      background:#fffdf6; font-family:inherit;
    }
    textarea { min-height:120px; }
    .btn { background:#7bb235; color:#fff; border:none; border-radius:8px; padding:8px 16px; font-weight:bold; }
    .btn:hover { background:#5e8e29; }
  </style>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  <script defer src="common/layout.js"></script>
</head>
<body>
  <div id="volwassen-header" data-header-src="../common/header.html"></div>

  <main>
    <h1>üìñ Mijn heiligen</h1>

    <h2>‚ûï Nieuwe heilige toevoegen</h2>
    <form id="nieuweHeiligeForm">
      <label>Titel</label>
      <input type="text" id="titel" required>
      <label>Icoon-URL</label>
      <input type="text" id="icoon" placeholder="https://...">
      <label>Verhaal</label>
      <textarea id="inhoud" required></textarea>
      <button type="submit" class="btn">Opslaan</button>
    </form>

    <h2>üìú Standaardheiligen</h2>
    <div id="standaardLijst" class="lijst">Laden‚Ä¶</div>

    <h2>üôè Parochieheiligen</h2>
    <div id="parochieLijst" class="lijst">Laden‚Ä¶</div>
  </main>

  <script>
    // Firebase init
    const firebaseConfig = {
      apiKey:"AIzaSyBG1iQBmruHUZI1OeW8RgbJ_TPit_7a2LQ",
      authDomain:"orthodoxeweg.firebaseapp.com",
      projectId:"orthodoxeweg"
    };
    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db=firebase.firestore();

    const parochieId = localStorage.getItem("ingelogdeParochie");

    const standaardLijst=document.getElementById("standaardLijst");
    const parochieLijst=document.getElementById("parochieLijst");
    const form=document.getElementById("nieuweHeiligeForm");

    // Laad standaardheiligen
    async function laadStandaard() {
      standaardLijst.innerHTML="Laden‚Ä¶";
      const snap=await db.collection("heiligen_kinderen").get();
      standaardLijst.innerHTML="";
      snap.forEach(doc=>{
        const d=doc.data();
        const div=document.createElement("div");
        div.className="kaart";
        div.innerHTML=`
          <label>
            <input type="checkbox" onchange="toggleHeilige('${doc.id}', this.checked)">
            ${d.titel}
          </label>
        `;
        standaardLijst.appendChild(div);
      });
    }

    // Toggle heilige zichtbaar
    async function toggleHeilige(id, aan) {
      const ref=db.collection("parochies").doc(parochieId).collection("heiligen").doc(id);
      const snap=await ref.get();
      if(snap.exists){
        await ref.update({ zichtbaar: aan });
      } else if(aan) {
        // Kopieer vanuit standaard
        const standaard=await db.collection("heiligen_kinderen").doc(id).get();
        if(standaard.exists){
          await ref.set({...standaard.data(), zichtbaar:true, aangemaakt:new Date()});
        }
      }
      laadParochie();
    }

    // Laad parochieheiligen
    async function laadParochie(){
      parochieLijst.innerHTML="Laden‚Ä¶";
      const snap=await db.collection("parochies").doc(parochieId).collection("heiligen").get();
      parochieLijst.innerHTML="";
      snap.forEach(doc=>{
        const d=doc.data();
        const div=document.createElement("div");
        div.className="kaart";
        div.innerHTML=`
          <h3>${d.icoon ? `<img src="${d.icoon}" style="height:24px;vertical-align:middle">` : ""} ${d.titel}</h3>
          <small>${d.zichtbaar?"üëÅ Zichtbaar":"üôà Verborgen"}</small>
          <p>${(d.verhaal||"").substring(0,200)}...</p>
          <div class="acties">
            <button onclick="bewerkHeilige('${doc.id}')">‚úèÔ∏è Bewerken</button>
          </div>
        `;
        parochieLijst.appendChild(div);
      });
    }

    // Nieuwe heilige opslaan
    form.addEventListener("submit", async(e)=>{
      e.preventDefault();
      const titel=document.getElementById("titel").value.trim();
      const icoon=document.getElementById("icoon").value.trim();
      const inhoud=document.getElementById("inhoud").value.trim();
      if(!titel||!inhoud) return alert("Titel en verhaal verplicht!");

      const id=titel.toLowerCase().replace(/[^a-z0-9]+/g,"_");
      await db.collection("parochies").doc(parochieId).collection("heiligen").doc(id).set({
        titel, icoon, verhaal:inhoud, zichtbaar:true, aangemaakt:new Date()
      });
      form.reset();
      laadParochie();
    });

    async function bewerkHeilige(id){
      const docu=await db.collection("parochies").doc(parochieId).collection("heiligen").doc(id).get();
      if(!docu.exists) return;
      const d=docu.data();
      document.getElementById("titel").value=d.titel;
      document.getElementById("icoon").value=d.icoon||"";
      document.getElementById("inhoud").value=d.verhaal||"";
      form.onsubmit=async(e)=>{
        e.preventDefault();
        await db.collection("parochies").doc(parochieId).collection("heiligen").doc(id).update({
          titel:document.getElementById("titel").value.trim(),
          icoon:document.getElementById("icoon").value.trim(),
          verhaal:document.getElementById("inhoud").value.trim()
        });
        form.reset();
        form.onsubmit=defaultSubmit;
        laadParochie();
      };
    }

    async function defaultSubmit(e){
      e.preventDefault();
      const titel=document.getElementById("titel").value.trim();
      const icoon=document.getElementById("icoon").value.trim();
      const inhoud=document.getElementById("inhoud").value.trim();
      if(!titel||!inhoud) return;
      const id=titel.toLowerCase().replace(/[^a-z0-9]+/g,"_");
      await db.collection("parochies").doc(parochieId).collection("heiligen").doc(id).set({
        titel, icoon, verhaal:inhoud, zichtbaar:true, aangemaakt:new Date()
      });
      form.reset();
      laadParochie();
    }
    form.onsubmit=defaultSubmit;

    laadStandaard();
    laadParochie();
  </script>
</body>
</html>

