<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>üìñ Heiligen ‚Äì Orthodoxeweg</title>
  <link rel="icon" href="https://kathy-torfs.github.io/Orthodoxeweg/images/kruis.png">

  <style>
    body {
      margin:0; font-family:Arial,sans-serif;
      background:#f5e9b8; color:#6f4e1a;
    }
    main { max-width:1000px; margin:30px auto; padding:0 20px; }

    h1 { text-align:center; color:#4e2710; margin-bottom:20px; }

    .heiligen-lijst { display:flex; flex-direction:column; gap:16px; }
    .heilige-kaart {
      background:#fffdf5; border:2px solid #dab97a;
      border-radius:10px; padding:14px;
      box-shadow:0 2px 8px rgba(0,0,0,0.12);
    }
    .heilige-kaart h3 { margin:0; color:#7a5f35; }
    .heilige-kaart small { color:#8f7437; display:block; margin-bottom:8px; }
    .heilige-kaart .acties { margin-top:10px; display:flex; gap:8px; flex-wrap:wrap; }
    .heilige-kaart button { padding:6px 10px; font-size:0.9em; cursor:pointer; }

    form {
      background:#fff8eb; border:2px dashed #dab97a;
      border-radius:12px; padding:16px; margin-bottom:20px;
    }
    label { display:block; margin:10px 0 4px; font-weight:bold; }
    input, textarea {
      width:100%; padding:8px; border:1px solid #dab97a; border-radius:6px;
      background:#fffdf6; font-family:inherit;
    }
    textarea { min-height:120px; }
    .btn { background:#7bb235; color:#fff; border:none; border-radius:8px; padding:8px 16px; font-weight:bold; }
    .btn:hover { background:#5e8e29; }
  </style>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  <script defer src="common/layout.js"></script>
</head>
<body>
  <!-- Header volwassenen -->
  <div id="volwassen-header" data-header-src="common/header.html"></div>

  <main>
    <h1>üìñ Heiligen</h1>

    <form id="nieuweHeiligeForm">
      <h2>Nieuwe heilige toevoegen</h2>
      <label>Titel</label>
      <input type="text" id="titel" required>

      <label>Icoon (emoji)</label>
      <input type="text" id="icoon" placeholder="‚ú® üåπ üéÅ">

      <label>Verhaal</label>
      <textarea id="inhoud" required></textarea>

      <button type="submit" class="btn">Opslaan</button>
    </form>

    <div id="heiligenLijst" class="heiligen-lijst">Laden‚Ä¶</div>
  </main>

  <script>
    // Firebase init
    const firebaseConfig = {
      apiKey: "AIzaSyBG1iQBmruHUZI1OeW8RgbJ_TPit_7a2LQ",
      authDomain: "orthodoxeweg.firebaseapp.com",
      projectId: "orthodoxeweg"
    };
    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db=firebase.firestore();

    c
    const parochieId = localStorage.getItem("ingelogdeParochie");
    let standaardGekopieerd = false; // voorkomt eindeloze lus

    // ‚ûï Opslaan nieuwe heilige
    form.addEventListener("submit", async(e)=>{
      e.preventDefault();
      const titel=document.getElementById("titel").value.trim();
      const icoon=document.getElementById("icoon").value.trim();
      const inhoud=document.getElementById("inhoud").value.trim();
      if(!titel||!inhoud) return alert("Titel en verhaal zijn verplicht!");

      await db.collection("parochies").doc(parochieId).collection("heiligen")
        .add({titel,icoon,inhoud,datum:new Date()});
      form.reset();
      laadHeiligen();
    });

    // üì• Lijst tonen
    async function laadHeiligen(){
      lijst.innerHTML="Laden‚Ä¶";
      const snap=await db.collection("parochies").doc(parochieId).collection("heiligen").orderBy("titel").get();

      if (snap.empty && !standaardGekopieerd) {
        console.log("‚ö†Ô∏è Geen heiligen in parochie ‚Üí kopieer standaardheiligen...");
        await kopieerStandaardHeiligen();
        standaardGekopieerd = true;
        return laadHeiligen();
      }

      if (snap.empty) {
        lijst.innerHTML="<p>Geen heiligen beschikbaar.</p>";
        return;
      }

      lijst.innerHTML="";
      snap.forEach(doc=>{
        const d=doc.data();
        const div=document.createElement("div");
        div.className="heilige-kaart";
        const datum=d.datum?.toDate?d.datum.toDate().toLocaleDateString():"";
        div.innerHTML=`
          <h3>${d.icoon||""} ${d.titel}</h3>
          <small>${datum}</small>
          <p>${(d.inhoud||"").substring(0,200)}...</p>
          <div class="acties">
            <button onclick="bewerkHeilige('${doc.id}')">‚úèÔ∏è Bewerken</button>
            <button onclick="verwijderHeilige('${doc.id}')">üóë Verwijderen</button>
          </div>
        `;
        lijst.appendChild(div);
      });
    }

    // ‚úÖ Kopieer standaardheiligen
    async function kopieerStandaardHeiligen() {
      const standaard = await db.collection("heiligen_kinderen").get();
      if (standaard.empty) {
        console.error("‚ùå Geen standaardheiligen gevonden!");
        return;
      }
      const batch = db.batch();
      standaard.forEach(doc=>{
        const ref = db.collection("parochies").doc(parochieId).collection("heiligen").doc();
        batch.set(ref, doc.data());
      });
      await batch.commit();
      console.log("‚úÖ Standaardheiligen gekopieerd!");
    }

    async function verwijderHeilige(id){
      if(!confirm("Weet je zeker dat je deze heilige wil verwijderen?")) return;
      await db.collection("parochies").doc(parochieId).collection("heiligen").doc(id).delete();
      laadHeiligen();
    }

    async function bewerkHeilige(id){
      const docu=await db.collection("parochies").doc(parochieId).collection("heiligen").doc(id).get();
      if(!docu.exists) return;
      const d=docu.data();
      document.getElementById("titel").value=d.titel;
      document.getElementById("icoon").value=d.icoon;
      document.getElementById("inhoud").value=d.inhoud;
      form.onsubmit=async(e)=>{
        e.preventDefault();
        await db.collection("parochies").doc(parochieId).collection("heiligen").doc(id).update({
          titel:document.getElementById("titel").value.trim(),
          icoon:document.getElementById("icoon").value.trim(),
          inhoud:document.getElementById("inhoud").value.trim()
        });
        form.reset();
        form.onsubmit=defaultSubmit;
        laadHeiligen();
      };
    }

    // Reset naar nieuw toevoegen
    async function defaultSubmit(e){
      e.preventDefault();
      const titel=document.getElementById("titel").value.trim();
      const icoon=document.getElementById("icoon").value.trim();
      const inhoud=document.getElementById("inhoud").value.trim();
      await db.collection("parochies").doc(parochieId).collection("heiligen")
        .add({titel,icoon,inhoud,datum:new Date()});
      form.reset();
      laadHeiligen();
    }
    form.onsubmit=defaultSubmit;

    laadHeiligen();
  </script>
</body>
</html>
