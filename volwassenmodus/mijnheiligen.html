<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>üìñ Mijn Heiligen ‚Äì Orthodoxeweg</title>
  <link rel="icon" href="https://kathy-torfs.github.io/Orthodoxeweg/images/kruis.png">

  <style>
    body {
      margin:0; font-family:Arial,sans-serif;
      background:#f5e9b8; color:#6f4e1a;
    }
    h1 { text-align:center; color:#4e2710; margin:20px 0; }

    .container {
      display:grid; grid-template-columns:280px 1fr;
      gap:20px; max-width:1200px; margin:0 auto; padding:20px;
    }

    /* Sidebar */
    .sidebar {
      background:#fff9e2; border:2px solid #d6c290;
      border-radius:12px; padding:12px;
      display:flex; flex-direction:column; gap:10px;
      max-height:80vh; overflow-y:auto;
    }
    .sidebar h3 { text-align:center; margin:0 0 8px; }
    .heilige-link {
      padding:8px; border-radius:8px; cursor:pointer;
      background:#fff; border:1px solid #dbc592;
      font-weight:600; transition:background .2s;
    }
    .heilige-link:hover { background:#f7eecb; }
    .heilige-link.active { background:#e9dba9; }
    .plus-btn {
      padding:10px; text-align:center;
      border:2px dashed #c7b177; border-radius:8px;
      cursor:pointer; background:#fff9e2;
      font-size:1.2em; font-weight:bold;
    }
    .plus-btn:hover { background:#fff5cc; }

    /* Detail */
    .detail {
      background:#fffef9; border:2px solid #e2d1a5;
      border-radius:12px; box-shadow:0 6px 18px rgba(0,0,0,.12);
      padding:20px; min-height:500px;
    }
    .detail h2 {
      margin:0 0 15px; text-align:center;
      border-bottom:2px solid #d6c290; padding-bottom:6px;
    }
    label { display:block; margin:10px 0 4px; font-weight:bold; }
    input, textarea {
      width:100%; border:1px solid #dbc592; border-radius:8px;
      padding:8px; font-family:inherit; font-size:1em;
      background:#fffdf5;
    }
    textarea { min-height:150px; resize:vertical; }
    .btn-row { margin-top:12px; display:flex; gap:10px; justify-content:flex-end; }
    .btn {
      background:#7bb235; color:#fff; border:none;
      border-radius:8px; padding:8px 16px; cursor:pointer;
      font-size:1em; font-weight:bold;
    }
    .btn.secondary { background:#b09765; }
    .btn:hover { background:#5e8e29; }
    .btn.secondary:hover { background:#8a754e; }

    @media(max-width:900px){
      .container { grid-template-columns:1fr; }
    }
  </style>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
</head>
<body>
  <!-- Header -->
  <div id="volwassen-header" data-header-src="../common/header.html"></div>
  <script src="../common/layout.js"></script>

  <h1>üìñ Mijn Heiligen</h1>

  <div class="container">
    <!-- Index -->
    <div class="sidebar">
      <h3>üìã Heiligenlijst</h3>
      <div id="heiligenIndex"></div>
      <div class="plus-btn" onclick="nieuwHeilige()">Ôºã Nieuwe heilige</div>
    </div>

    <!-- Detail -->
    <div class="detail" id="heiligeDetail">
      <p style="text-align:center;color:#888;margin-top:200px;">‚¨ÖÔ∏è Kies links een heilige of voeg er een toe</p>
    </div>
  </div>

  <script>
    // Firebase init
    const firebaseConfig = {
      apiKey: "AIzaSyBG1iQBmruHUZI1OeW8RgbJ_TPit_7a2LQ",
      authDomain: "orthodoxeweg.firebaseapp.com",
      projectId: "orthodoxeweg"
    };
    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db=firebase.firestore();

    const parochieId = localStorage.getItem("ingelogdeParochie");
    const indexEl = document.getElementById("heiligenIndex");

    // Index laden (parochie + standaard)
    async function laadIndex(){
      indexEl.innerHTML="‚è≥ Laden...";
      let html="";

      // Parochieheiligen
      const snapPar = await db.collection("parochies").doc(parochieId).collection("heiligen").get();
      if(!snapPar.empty){
        snapPar.forEach(doc=>{
          const d=doc.data();
          html+=`<div class="heilige-link" onclick="toonHeilige('${doc.id}', false)">${d.icoonurl||"‚ú®"} ${doc.id}</div>`;
        });
      }

      // Standaardheiligen (optioneel te kopi√´ren)
      const snapStd = await db.collection("heiligen_kinderen").get();
      snapStd.forEach(doc=>{
        if(!snapPar.docs.find(p=>p.id===doc.id)){ // alleen tonen als nog niet in parochie
          html+=`<div class="heilige-link" onclick="toonHeilige('${doc.id}', true)">üìñ ${doc.id} (standaard)</div>`;
        }
      });

      indexEl.innerHTML = html || "<p>Geen heiligen gevonden.</p>";
    }

    // Detail tonen
    async function toonHeilige(id, isStd){
      let d={};
      if(isStd){
        const doc=await db.collection("heiligen_kinderen").doc(id).get();
        d=doc.data();
      } else {
        const doc=await db.collection("parochies").doc(parochieId).collection("heiligen").doc(id).get();
        d=doc.data();
      }

      const detail=document.getElementById("heiligeDetail");
      detail.innerHTML=`
        <h2>${d.icoonurl||""} ${id}</h2>
        <label>Icoon URL</label>
        <input id="editIcoon" value="${d.icoonurl||""}">
        <label>Verhaal</label>
        <textarea id="editVerhaal">${(d.verhaal||"").replace(/<br>/g,"\n")}</textarea>
        <label>
          <input type="checkbox" id="editZichtbaar" ${d.zichtbaarVoorKinderen ? "checked" : ""}>
          Tonen bij de kinderen
        </label>
        <div class="btn-row">
          <button class="btn" onclick="opslaanHeilige('${id}')">Opslaan</button>
          <button class="btn secondary" onclick="verwijderHeilige('${id}')">Verwijderen</button>
        </div>
      `;
    }

    // Nieuwe heilige toevoegen
    function nieuwHeilige(){
      document.getElementById("heiligeDetail").innerHTML=`
        <h2>Ôºã Nieuwe heilige</h2>
        <label>Naam</label>
        <input id="newNaam">
        <label>Icoon URL</label>
        <input id="newIcoon">
        <label>Verhaal</label>
        <textarea id="newVerhaal"></textarea>
        <label><input type="checkbox" id="newZichtbaar"> Tonen bij de kinderen</label>
        <div class="btn-row">
          <button class="btn" onclick="opslaanHeilige()">Opslaan</button>
        </div>
      `;
    }

    // Opslaan of bijwerken
    async function opslaanHeilige(id){
      const naam=id||document.getElementById("newNaam").value.trim();
      if(!naam) return alert("Naam verplicht!");
      const icoon=document.getElementById(id?"editIcoon":"newIcoon").value.trim();
      const verhaal=document.getElementById(id?"editVerhaal":"newVerhaal").value.trim().replace(/\n/g,"<br>");
      const zichtbaar=document.getElementById(id?"editZichtbaar":"newZichtbaar").checked;

      await db.collection("parochies").doc(parochieId).collection("heiligen").doc(naam).set({
        icoonurl: icoon,
        verhaal: verhaal,
        zichtbaarVoorKinderen: zichtbaar,
        laatstAangepast: new Date()
      }, {merge:true});

      alert("‚úÖ Heilige opgeslagen!");
      laadIndex();
    }

    // Verwijderen
    async function verwijderHeilige(id){
      if(!confirm("Heilige verwijderen uit parochie?")) return;
      await db.collection("parochies").doc(parochieId).collection("heiligen").doc(id).delete();
      alert("üóë Verwijderd!");
      laadIndex();
      document.getElementById("heiligeDetail").innerHTML="<p style='text-align:center;color:#888;margin-top:200px;'>‚¨ÖÔ∏è Kies links een heilige of voeg er een toe</p>";
    }

    laadIndex();
  </script>
</body>
</html>
