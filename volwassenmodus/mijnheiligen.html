<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>üìñ Mijn heiligen ‚Äì Orthodoxeweg</title>
  <link rel="icon" href="https://kathy-torfs.github.io/Orthodoxeweg/images/kruis.png">

  <style>
    body { margin:0; font-family:Arial,sans-serif; background:#f5e9b8; color:#6f4e1a; }
    main { max-width:1000px; margin:30px auto; padding:0 20px; }
    h1 { text-align:center; color:#4e2710; margin-bottom:20px; }

    .kaart { background:#fffdf5; border:2px solid #dab97a; border-radius:10px;
             padding:14px; margin-bottom:16px; box-shadow:0 2px 8px rgba(0,0,0,0.12); }
    .kaart h3 { margin:0; color:#7a5f35; }
    .kaart small { color:#8f7437; display:block; margin-bottom:8px; }
    .kaart .acties { margin-top:10px; display:flex; gap:8px; flex-wrap:wrap; }
    .kaart button { padding:6px 10px; font-size:0.9em; cursor:pointer; }

    form { background:#fff8eb; border:2px dashed #dab97a; border-radius:12px;
           padding:16px; margin-bottom:20px; }
    label { display:block; margin:10px 0 4px; font-weight:bold; }
    input, textarea {
      width:100%; padding:8px; border:1px solid #dab97a; border-radius:6px;
      background:#fffdf6; font-family:inherit;
    }
    textarea { min-height:120px; }
    .btn { background:#7bb235; color:#fff; border:none; border-radius:8px;
           padding:8px 16px; font-weight:bold; }
    .btn:hover { background:#5e8e29; }

    .standaard-lijst { background:#fff9e2; border:2px solid #dab97a;
                       border-radius:10px; padding:14px; margin-top:30px; }
    .standaard-item { padding:6px; border-bottom:1px solid #e2d1a5; }
    .standaard-item:last-child { border-bottom:none; }
  </style>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  <script defer src="common/layout.js"></script>
</head>
<body>
  <!-- Header -->
  <div id="volwassen-header" data-header-src="common/header.html"></div>

  <main>
    <h1>üìñ Mijn parochieheiligen</h1>

    <form id="heiligeForm">
      <h2>Nieuwe heilige toevoegen</h2>
      <label>Titel</label>
      <input type="text" id="titel" required>
      <label>Icoon-URL</label>
      <input type="url" id="icoonurl" placeholder="https://...">
      <label>Verhaal</label>
      <textarea id="verhaal" required></textarea>
      <button type="submit" class="btn">Opslaan</button>
    </form>

    <div id="parochieLijst"></div>

    <div class="standaard-lijst">
      <h2>üìú Standaardheiligen</h2>
      <div id="standaardLijst"></div>
    </div>
  </main>

  <script>
    // Firebase init
    const firebaseConfig = {
      apiKey: "AIzaSyBG1iQBmruHUZI1OeW8RgbJ_TPit_7a2LQ",
      authDomain: "orthodoxeweg.firebaseapp.com",
      projectId: "orthodoxeweg"
    };
    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const parochieId = localStorage.getItem("ingelogdeParochie");
    const form = document.getElementById("heiligeForm");
    const parochieLijst = document.getElementById("parochieLijst");
    const standaardLijst = document.getElementById("standaardLijst");

    // ‚ûï Opslaan of bijwerken
    let bewerkId=null;
    form.addEventListener("submit", async(e)=>{
      e.preventDefault();
      const titel=document.getElementById("titel").value.trim();
      const icoonurl=document.getElementById("icoonurl").value.trim();
      const verhaal=document.getElementById("verhaal").value.trim();
      if(!titel||!verhaal) return alert("Titel en verhaal zijn verplicht!");

      const ref=db.collection("parochies").doc(parochieId).collection("heiligen").doc(titel);
      await ref.set({titel, icoonurl, verhaal, zichtbaar:true}, {merge:true});

      form.reset(); bewerkId=null;
      laadParochieHeiligen(); laadStandaardHeiligen();
    });

    // üì• Parochieheiligen tonen
    async function laadParochieHeiligen(){
      const snap=await db.collection("parochies").doc(parochieId).collection("heiligen").get();
      parochieLijst.innerHTML="";
      if(snap.empty){ parochieLijst.innerHTML="<p>Geen heiligen in deze parochie.</p>"; return; }
      snap.forEach(doc=>{
        const d=doc.data();
        const div=document.createElement("div");
        div.className="kaart";
        div.innerHTML=`
          <h3>${d.icoonurl?`<img src="${d.icoonurl}" style="max-height:24px;vertical-align:middle"> `:""}${d.titel}</h3>
          <small>${d.zichtbaar?"zichtbaar":"verborgen"}</small>
          <p>${(d.verhaal||"").substring(0,150)}...</p>
          <div class="acties">
            <button onclick="bewerkHeilige('${doc.id}')">‚úèÔ∏è Bewerken</button>
            <button onclick="toggleZichtbaar('${doc.id}',${d.zichtbaar})">${d.zichtbaar?"üôà Verbergen":"üëÅ Zichtbaar maken"}</button>
          </div>
        `;
        parochieLijst.appendChild(div);
      });
    }

    // üìú Standaardheiligen tonen
    async function laadStandaardHeiligen(){
      const snap=await db.collection("heiligen_kinderen").get();
      standaardLijst.innerHTML="";
      snap.forEach(doc=>{
        const naam=doc.id;
        const div=document.createElement("div");
        div.className="standaard-item";
        div.innerHTML=`
          <label>
            <input type="checkbox" onchange="toggleHeilige('${naam}', this.checked)" id="chk-${naam}">
            ${naam}
          </label>
        `;
        standaardLijst.appendChild(div);
      });

      // sync met parochie
      const parSnap=await db.collection("parochies").doc(parochieId).collection("heiligen").get();
      parSnap.forEach(doc=>{
        const chk=document.getElementById("chk-"+doc.id);
        if(chk) chk.checked=doc.data().zichtbaar!==false;
      });
    }

    // ‚úÖ Toggle heilige
    async function toggleHeilige(naam, checked){
      const ref=db.collection("parochies").doc(parochieId).collection("heiligen").doc(naam);
      if(checked){
        const snap=await ref.get();
        if(!snap.exists){
          const std=await db.collection("heiligen_kinderen").doc(naam).get();
          const verhaal=std.exists?std.data().verhaal:"";
          await ref.set({titel:naam, icoonurl:"", verhaal, zichtbaar:true});
        }else{
          await ref.update({zichtbaar:true});
        }
      }else{
        await ref.update({zichtbaar:false});
      }
      laadParochieHeiligen();
    }

    // ‚úèÔ∏è Bewerken
    async function bewerkHeilige(id){
      const docu=await db.collection("parochies").doc(parochieId).collection("heiligen").doc(id).get();
      if(!docu.exists) return;
      const d=docu.data();
      document.getElementById("titel").value=d.titel;
      document.getElementById("icoonurl").value=d.icoonurl||"";
      document.getElementById("verhaal").value=d.verhaal||"";
      bewerkId=id;
    }

    // üëÅ toggle zichtbaar/verborgen
    async function toggleZichtbaar(id,huidig){
      await db.collection("parochies").doc(parochieId).collection("heiligen").doc(id).update({zichtbaar:!huidig});
      laadParochieHeiligen(); laadStandaardHeiligen();
    }

    laadParochieHeiligen();
    laadStandaardHeiligen();
  </script>
</body>
</html>
