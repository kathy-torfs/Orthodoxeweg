<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>üìñ Mijn heiligen ‚Äì Orthodoxeweg</title>
  <link rel="icon" href="https://kathy-torfs.github.io/Orthodoxeweg/images/kruis.png">

  <style>
    body {
      margin:0; font-family:Arial,sans-serif;
      background:#f5e9b8; color:#6f4e1a;
    }
    main { max-width:1200px; margin:20px auto; padding:0 20px; display:flex; gap:20px; }

    .sidebar {
      flex:1;
      background:#fff9e2; border:2px solid #d6c290;
      border-radius:12px; padding:12px;
      max-height:80vh; overflow-y:auto;
    }
    .sidebar h2 { margin:0 0 10px; font-size:1.2em; text-align:center; }
    .heilige-item {
      padding:8px; border-radius:6px; margin:4px 0;
      cursor:pointer; background:#fff;
      border:1px solid #dbc592;
    }
    .heilige-item:hover { background:#f7eecb; }
    .heilige-item.active { background:#e9dba9; font-weight:bold; }
    .plus-btn {
      display:block; text-align:center; margin:10px auto;
      padding:8px; width:100%; border:2px dashed #c7b177; border-radius:8px;
      background:#fff9e2; cursor:pointer; font-size:1.1em;
    }
    .plus-btn:hover { background:#fff5cc; }

    .detail {
      flex:2;
      background:#fffef9; border:2px solid #e2d1a5;
      border-radius:12px; box-shadow:0 6px 18px rgba(0,0,0,0.12);
      padding:20px; min-height:500px;
    }
    .detail h2 { margin:0 0 15px; color:#7a5f35; }
    label { display:block; margin:10px 0 4px; font-weight:bold; }
    input, textarea { width:100%; border:1px solid #dbc592; border-radius:6px;
      padding:8px; font-family:inherit; font-size:1em; background:#fffdf5; }
    textarea { min-height:250px; resize:vertical; }
    .checkbox-row { margin-top:10px; }

    .btn {
      background:#7bb235; color:#fff; border:none;
      border-radius:8px; padding:10px 16px; font-weight:bold; cursor:pointer;
      margin-top:12px;
    }
    .btn:hover { background:#5e8e29; }
    .btn.danger { background:#c0392b; }
    .btn.danger:hover { background:#962d22; }
  </style>

  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  <script defer src="common/layout.js"></script>
</head>
<body>
  <div id="volwassen-header" data-header-src="common/header.html"></div>

  <main>
    <div class="sidebar">
      <h2>üìë Heiligenlijst</h2>
      <div id="heiligenIndex"></div>
      <div class="plus-btn" onclick="nieuwHeilige()">Ôºã Nieuwe heilige</div>
    </div>

    <div class="detail" id="detailVlak">
      <p style="text-align:center;color:#888;margin-top:200px;">‚¨ÖÔ∏è Kies links een heilige of voeg er een toe</p>
    </div>
  </main>

  <script>
    const firebaseConfig = {
      apiKey:"AIzaSyBG1iQBmruHUZI1OeW8RgbJ_TPit_7a2LQ",
      authDomain:"orthodoxeweg.firebaseapp.com",
      projectId:"orthodoxeweg"
    };
    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db=firebase.firestore();

    const parochieId = localStorage.getItem("ingelogdeParochie");
    const indexDiv=document.getElementById("heiligenIndex");
    const detailDiv=document.getElementById("detailVlak");

    let actieveId=null;

    async function laadHeiligen(){
      indexDiv.innerHTML="‚è≥ Laden...";
      const lijst=[];

      const snapP=await db.collection("parochies").doc(parochieId).collection("heiligen").get();
      snapP.forEach(doc=>{ lijst.push({id:doc.id, ...doc.data(), bron:"parochie"}); });

      const snapS=await db.collection("heiligen_kinderen").get();
      snapS.forEach(doc=>{
        if(!lijst.find(h=>h.id===doc.id)){
          lijst.push({id:doc.id, ...doc.data(), bron:"standaard"});
        }
      });

      indexDiv.innerHTML="";
      lijst.forEach(h=>{
        const div=document.createElement("div");
        div.className="heilige-item";
        div.textContent=h.titel || h.id;
        div.onclick=()=>toonHeilige(h);
        indexDiv.appendChild(div);
      });
    }

    function toonHeilige(h){
      actieveId=h.id;
      const verhaalText=(h.verhaal||"").replace(/<br\s*\/?>/gi,"\n");
      const zichtbaar=h.zichtbaarVoorKinderen===true;

      detailDiv.innerHTML=`
        <h2>${h.titel||h.id}</h2>
        <label>Titel</label>
        <input id="heiligeTitel" value="${h.titel||""}">
        <label>Icoon-URL</label>
        <input id="heiligeIcoon" value="${h.icoonUrl||""}" placeholder="https://...">
        <label>Verhaal</label>
        <textarea id="heiligeVerhaal">${verhaalText}</textarea>
        <div class="checkbox-row">
          <label><input type="checkbox" id="heiligeZichtbaar" ${zichtbaar?"checked":""}> Tonen bij kinderen</label>
        </div>
        <button class="btn" onclick="opslaanHeilige()">üíæ Opslaan</button>
        <button class="btn danger" onclick="verwijderHeilige()">‚ùå Verwijderen</button>
      `;
    }

    function nieuwHeilige(){
      actieveId=null;
      detailDiv.innerHTML=`
        <h2>Nieuwe heilige</h2>
        <label>Titel</label>
        <input id="heiligeTitel">
        <label>Icoon-URL</label>
        <input id="heiligeIcoon" placeholder="https://...">
        <label>Verhaal</label>
        <textarea id="heiligeVerhaal"></textarea>
        <div class="checkbox-row">
          <label><input type="checkbox" id="heiligeZichtbaar"> Tonen bij kinderen</label>
        </div>
        <button class="btn" onclick="opslaanHeilige()">üíæ Opslaan</button>
      `;
    }

    async function opslaanHeilige(){
      const titel=document.getElementById("heiligeTitel").value.trim();
      const icoonUrl=document.getElementById("heiligeIcoon").value.trim();
      const verhaal=document.getElementById("heiligeVerhaal").value.trim().replace(/\n/g,"<br>");
      const zichtbaar=document.getElementById("heiligeZichtbaar").checked;
      if(!titel||!verhaal){ alert("Titel en verhaal zijn verplicht!"); return; }

      const id=titel.toLowerCase().replace(/\s+/g,"_").replace(/[^a-z0-9_]/g,"");

      await db.collection("parochies").doc(parochieId).collection("heiligen")
        .doc(id).set({titel,icoonUrl,verhaal,zichtbaarVoorKinderen:zichtbaar,datum:new Date()});

      alert("‚úÖ Heilige opgeslagen!");
      laadHeiligen();
    }

    async function verwijderHeilige(){
      if(!actieveId){ alert("Geen heilige geselecteerd."); return; }
      if(!confirm("Weet je zeker dat je deze heilige wil verwijderen?")) return;

      await db.collection("parochies").doc(parochieId).collection("heiligen").doc(actieveId).delete();

      alert("üóë Heilige verwijderd!");
      actieveId=null;
      detailDiv.innerHTML="<p style='text-align:center;color:#888;margin-top:200px;'>‚¨ÖÔ∏è Kies links een heilige of voeg er een toe</p>";
      laadHeiligen();
    }

    laadHeiligen();
  </script>
</body>
</html>
