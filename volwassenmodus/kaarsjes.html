<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Orthodoxeweg ‚Äì Kaarsjes</title>
  <link rel="icon" href="https://kathy-torfs.github.io/Orthodoxeweg/images/kruis.png">
  <style>
    /* ==== TEMPLATE BASIS: BEGIN ==== */
    body { background-color: #f5e9b8; color: #6f4e1a; font-family: Arial, sans-serif; margin: 0; padding: 0; }
    .topbar {
      background-color: #6f4e1a;
      color: white;
      padding: 12px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-weight: bold;
      flex-wrap: wrap;
    }
    #welkom-tekst {
      font-size: 1.07em;
      font-weight: normal;
    }
    .uitlog-link {
      background-color: #8722aa;
      color: white;
      border: none;
      padding: 8px 18px;
      border-radius: 18px;
      cursor: pointer;
      font-weight: bold;
      margin-left: 12px;
    }
    nav.menu {
      background-color: #7a5f35;
      padding: 10px 15px;
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      justify-content: center;
      align-items: center;
    }
    nav.menu a,
    nav.menu button {
      color: #f5e9b8;
      text-decoration: none;
      font-weight: 600;
      font-size: 16px;
      padding: 6px 12px;
      border-radius: 8px;
      transition: background-color 0.3s;
      background: none;
      border: none;
      display: flex;
      align-items: center;
      cursor: pointer;
    }
    nav.menu a:hover, nav.menu button:hover {
      background-color: #5d4726;
      text-decoration: underline;
    }
    .menu-avatar {
      padding: 0 !important;
      background: none !important;
      border: none !important;
      margin-left: 2px;
    }
    .menu-avatar img {
      height: 2.1em;
      width: 2.1em;
      border-radius: 50%;
      border: 2.2px solid #dab97a;
      background: #fff8eb;
      transition: box-shadow 0.2s, border 0.2s;
      box-shadow: 0 1px 4px rgba(160,140,80,0.13);
      display: block;
    }
    .menu-avatar img:hover {
      border: 2.2px solid #a06a19;
      box-shadow: 0 2px 8px rgba(160,140,80,0.23);
    }
    @media (max-width: 650px) {
      nav.menu { flex-wrap: wrap; gap: 8px;}
      nav.menu a, nav.menu button { font-size: 1em; padding: 6px 6px;}
      .menu-avatar img { height: 1.75em; width: 1.75em;}
    }
    /* ==== TEMPLATE BASIS: EINDE ==== */

    /* ==== VLAMNOTES: BEGIN ==== */
    .container {
      max-width: 1200px; margin: 30px auto 40px auto;
      background:#fffef9; border-radius:14px; box-shadow:0 4px 16px #cbb96d32; padding:2rem;
      min-height: 510px;
    }
    .vlammen-tafel {
      display: flex; flex-wrap: wrap; justify-content: center;
      gap: 38px 28px; margin-top: 20px;
    }
    .vlam-note {
      width: 145px; min-height: 215px; background: none;
      display: flex; flex-direction: column; align-items: center;
      position: relative; margin-bottom: 16px;
    }
    .vlam-svg-bg {
      position: absolute; left:0; top:0; z-index: 0; width:145px; height:210px;
      pointer-events: none;
      filter: drop-shadow(0 6px 16px #e0c46775);
    }
    .note-content {
      position: absolute; top:34px; left:17px; right:17px; bottom:20px;
      z-index:1; display:flex; flex-direction:column;
      align-items: stretch; justify-content: flex-start;
    }
    .note-content textarea, .note-content .antwoord-blok {
      width:100%; font-size:1em; border:none; background:transparent;
      color:#64421e; font-family:inherit; resize:none; outline:none;
      margin-bottom:7px;
    }
    .note-content textarea { min-height:55px; background:rgba(255,255,255,0.67); border-radius:9px; padding:8px 7px;}
    .note-content .antwoord-blok { background:#fffbe9d4; border-radius:8px; padding:6px 7px; margin-top:7px;}
    .note-title { font-weight:bold; color:#a1731b; text-align:center; margin-bottom:4px; font-size:1.03em;}
    .note-btns {
      position:absolute; top:9px; right:9px; z-index:2; display:flex; gap:6px;
    }
    .note-btn {
      background: #fff9c9; border: 1px solid #deb53a; border-radius: 50%; width: 28px; height: 28px;
      display:flex; align-items:center; justify-content:center; font-size:1.19em; cursor:pointer; transition: background 0.16s;
      box-shadow:0 1px 2px #deb53a4c;
    }
    .note-btn:hover { background: #ffe7a1;}
    @media (max-width:1100px){ .container{max-width:99vw;} .vlam-note{width:110px;min-height:175px;}.vlam-svg-bg{width:110px;height:175px;} .note-content{top:22px;left:8px;right:8px;bottom:10px;}}
    @media (max-width:700px){ .vlammen-tafel{gap:18px 8px;} .container{padding:0.7rem;}}
    /* ==== VLAMNOTES: EINDE ==== */
  </style>
  <!-- ==== FIREBASE ==== -->
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore-compat.js"></script>
  <script>
    // ==== VOLWASSENENBESCHERMING ====
    if (!localStorage.getItem("ingelogdeParochie") || localStorage.getItem("modus") !== "volwassene") {
      window.location.href = "https://kathy-torfs.github.io/Orthodoxeweg/index.html";
    }
    // ==== FIREBASE CONFIGURATIE ====
    const firebaseConfig = {
      apiKey: "AIzaSyBG1iQBmruHUZI1OeW8RgbJ_TPit_7a2LQ",
      authDomain: "orthodoxeweg.firebaseapp.com",
      projectId: "orthodoxeweg",
      storageBucket: "orthodoxeweg.appspot.com",
      messagingSenderId: "408582263618",
      appId: "1:408582263618:web:0a20f4bf0704989d3ceedb",
      measurementId: "G-C942F2NYQV"
    };
    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
  </script>
</head>
<body>
  <!-- ==== TOPBAR + BEGROETING: BEGIN ==== -->
  <div class="topbar">
    <div id="welkom-tekst"></div>
    <button class="uitlog-link" id="uitlogKnop">üö™ Uitloggen</button>
  </div>
  <!-- ==== TOPBAR + BEGROETING: EINDE ==== -->

  <!-- ==== MENUBALK: BEGIN ==== -->
  <nav class="menu">
    <a href="https://kathy-torfs.github.io/Orthodoxeweg/volwassenmodus/startpagina.html" title="Home">üè†</a>
    <a href="https://kathy-torfs.github.io/Orthodoxeweg/volwassenmodus/parochie.html">üõê Mijn parochie</a>
    <a href="https://kathy-torfs.github.io/Orthodoxeweg/volwassenmodus/catechese/catechese.html">üìñ Catechese</a>
    <a href="https://kathy-torfs.github.io/Orthodoxeweg/volwassenmodus/gebeden/gebeden.html">üôè Gebeden</a>
    <a href="https://kathy-torfs.github.io/Orthodoxeweg/volwassenmodus/gebeden/geloofsbelijdenis.html">‚úù Geloofsbelijdenis</a>
    <a href="https://kathy-torfs.github.io/Orthodoxeweg/volwassenmodus/psalmen/psalmen.html">üìú Psalmen</a>
    <a href="https://kathy-torfs.github.io/Orthodoxeweg/volwassenmodus/heiligen.html">üëº Heiligen</a>
    <a href="https://kathy-torfs.github.io/Orthodoxeweg/volwassenmodus/bijbeldagboek.html">üìî Bijbeldagboek</a>
    <a href="https://kathy-torfs.github.io/Orthodoxeweg/volwassenmodus/verjaardagskalender.html">üéÇ Verjaardagskalender</a>
    <!-- Avatar-profiel -->
    <a href="https://kathy-torfs.github.io/Orthodoxeweg/volwassenmodus/profiel.html" class="menu-avatar" title="Mijn profiel">
      <img id="menu-avatar-img" src="https://cdn-icons-png.flaticon.com/512/4140/4140048.png" alt="Mijn profiel">
    </a>
  </nav>
  <!-- ==== MENUBALK: EINDE ==== -->

  <!-- ==== KAARSJES VUUR NOTES: BEGIN ==== -->
  <div class="container">
    <h2 style="text-align:center;color:#b0860e;letter-spacing:1px;">Gebedsintenties & priesterreactie</h2>
    <div class="vlammen-tafel" id="vlammenTafel"></div>
  </div>
  <!-- ==== KAARSJES VUUR NOTES: EINDE ==== -->

  <script>
    // BEGROETING & AVATAR
    const welkomTekst = document.getElementById("welkom-tekst");
    const loginNaam = localStorage.getItem("loginKeuze") || "gebruiker";
    const parochie = localStorage.getItem("ingelogdeParochie") || "(onbekend)";
    const uur = new Date().getHours();
    let moment = "Goeiedag";
    if (uur >= 5 && uur <= 10) moment = "Goeiemorgend";
    else if (uur >= 11 && uur <= 13) moment = "Goeiemiddag";
    else if (uur >= 17 && uur <= 22) moment = "Goeienavond";
    else if (uur > 22 || uur < 5) moment = "Goedenacht";
    welkomTekst.textContent = `Welkom, ${loginNaam}! U bent ingelogd in de ${parochie}.`;
    // Avatar dynamisch tonen
    const avatarImg = document.getElementById("menu-avatar-img");
    const opgeslagenAvatar = localStorage.getItem("avatarURL");
    if (opgeslagenAvatar) avatarImg.src = opgeslagenAvatar;
    document.getElementById("uitlogKnop").onclick = () => {
      localStorage.clear();
      window.location.href = "https://kathy-torfs.github.io/Orthodoxeweg/index.html";
    };

    // SVG vlamvorm
    function vlamSVG(vlamkleur="#ffc71a") {
      return `<svg class="vlam-svg-bg" viewBox="0 0 145 210"><defs>
      <radialGradient id="vlamG" cx="50%" cy="60%" r="90%">
        <stop offset="0%" stop-color="#fff8cc" stop-opacity="1"/>
        <stop offset="57%" stop-color="${vlamkleur}" stop-opacity="1"/>
        <stop offset="100%" stop-color="#f8d662" stop-opacity="0.65"/>
      </radialGradient></defs>
      <path d="M72 10 Q120 80 130 130 Q142 175 72 200 Q6 177 18 130 Q30 85 72 10Z"
        fill="url(#vlamG)" stroke="#edb232" stroke-width="3"/>
      </svg>`;
    }
    // Laad 12 kaarsnotes met Firebase-content
    function laadVlammenNotes() {
      const parochieId = localStorage.getItem("ingelogdeParochieId");
      const tafel = document.getElementById("vlammenTafel");
      tafel.innerHTML = `<em>Gebedsintenties laden...</em>`;
      db.collection("parochies").doc(parochieId).collection("kaarsjes")
        .orderBy("createdAt","desc").limit(12).get()
        .then(snapshot => {
          tafel.innerHTML = "";
          if(snapshot.empty) {
            tafel.innerHTML = "<em>Er zijn nog geen gebedsintenties.</em>";
            return;
          }
          let i=0;
          snapshot.forEach(doc => {
            const d = doc.data();
            const docId = doc.id;
            let vlamkleur = "#ffc71a";
            if(d.status==="beantwoord") vlamkleur="#ffe585";
            if(d.status==="gelezen") vlamkleur="#ffd147";
            tafel.innerHTML += `
              <div class="vlam-note" style="margin-top:${Math.random()*20}px; margin-left:${(i%4===2)?12:0}px;">
                ${vlamSVG(vlamkleur)}
                <div class="note-btns">
                  <span class="note-btn" title="Verwijder" onclick="verwijderKaarsje('${docId}')">&#10060;</span>
                  <span class="note-btn" title="Opslaan" onclick="opslaanKaarsje('${docId}', ${i})">&#10004;</span>
                </div>
                <div class="note-content">
                  <div class="note-title">Gebedsintentie</div>
                  <textarea id="intentie_${i}" maxlength="200">${d.text||""}</textarea>
                  <div class="note-title" style="margin-top:8px;">Antwoord priester</div>
                  <textarea id="antwoord_${i}" maxlength="280">${d.answer||""}</textarea>
                </div>
              </div>`;
            i++;
          });
        });
    }
    // Verwijderen
    window.verwijderKaarsje = function(docId){
      const parochieId = localStorage.getItem("ingelogdeParochieId");
      if(confirm("Weet je zeker dat je deze intentie wil verwijderen?")) {
        db.collection("parochies").doc(parochieId).collection("kaarsjes").doc(docId).delete().then(laadVlammenNotes);
      }
    }
    // Opslaan (intentie of antwoord)
    window.opslaanKaarsje = function(docId, idx){
      const parochieId = localStorage.getItem("ingelogdeParochieId");
      const intentie = document.getElementById("intentie_"+idx).value.trim();
      const antwoord = document.getElementById("antwoord_"+idx).value.trim();
      db.collection("parochies").doc(parochieId).collection("kaarsjes").doc(docId).update({
        text: intentie, answer: antwoord, status: antwoord ? "beantwoord" : "gelezen"
      }).then(laadVlammenNotes);
    }
    document.addEventListener("DOMContentLoaded", laadVlammenNotes);
  </script>
</body>
</html>
