<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <title>Zoekertjesbeheer ‚Äì Parochie</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { margin:0; padding:0; font-family: Georgia, 'Times New Roman', serif; background:#f4f3ee; color:#3b2c1a; }
    .topbar {
      background: #ede9dd;
      color: #3b2c1a;
      padding: 10px 24px;
      font-size: 1.07em;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .topbar .avatar {
      display: flex;
      align-items: center;
      gap: 9px;
    }
    .topbar .avatar img {
      height: 28px;
      border-radius: 50%;
      border: 1.2px solid #b2a997;
    }
    .uitlog-link {
      color: #fff; background: #9a2617; padding: 7px 18px; border-radius: 8px;
      font-size: 1em; text-decoration: none; font-weight: bold;
      margin-left: 14px; transition: background 0.18s; cursor: pointer; border: none;
      outline: none;
    }
    #parochieLabel {
      background: #f7f6f4; color: #3b2c1a; padding: 10px 0 8px 0; text-align: center;
      font-weight: bold; letter-spacing: 1px; font-size: 1.08em;
      box-shadow: 0 2px 8px #cbb96d22; margin-bottom: 10px;
      border-bottom: 1.5px solid #d3cfc6;
    }
    nav.menu {
      background-color: #a79577; padding: 12px 20px;
      display: flex; flex-wrap: wrap; gap: 14px; justify-content: center;
    }
    nav.menu a {
      color: #ede9dd; text-decoration: none; font-weight: bold; font-size: 16px;
      padding: 6px 14px; border-radius: 8px; transition: background-color 0.3s;
    }
    nav.menu a:hover { background-color: #7d6b53; }
    .krantencontainer {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 34px;
      max-width: 1200px;
      margin: 44px auto 40px auto;
      justify-items: center;
    }
    .krantblok {
      background: #fcfbf9;
      border-radius: 7px;
      box-shadow: 0 2px 14px #cec8b04c, 0 0.7px 0 #a59d8d;
      border: 1.8px solid #beb7a8;
      display: flex; flex-direction: column;
      align-items: stretch;
      min-width: 265px;
      min-height: 218px;
      padding: 20px 18px 18px 18px;
      justify-content: flex-end;
      position: relative;
      overflow: hidden;
      font-family: Georgia, 'Times New Roman', serif;
    }
    .krantblok input[type="text"] {
      width: 100%;
      margin-bottom: 10px;
      padding: 7px 8px;
      font-size: 1.09em;
      border-radius: 5px;
      border: 1px solid #d6d2ca;
      background: #f5f4f3;
      color: #392e21;
      font-weight: bold;
      outline: none;
      box-sizing: border-box;
      font-family: inherit;
    }
    .krantblok textarea {
      width: 100%;
      margin-bottom: 13px;
      padding: 8px 8px;
      border-radius: 5px;
      border: 1px solid #d6d2ca;
      background: #f7f6f4;
      color: #392e21;
      font-size: 1.07em;
      min-height: 56px;
      resize: vertical;
      box-sizing: border-box;
      font-family: inherit;
    }
    .krantblok .postit-buttons {
      display: flex;
      gap: 10px;
      align-items: center;
      margin-bottom: 5px;
    }
    .krantblok button {
      background: #7a5f35; color: #fff; font-weight: bold; padding: 7px 18px;
      border: none; border-radius: 7px; cursor: pointer; font-size: 1em;
      margin-right: 6px; margin-top: 0;
      transition: background 0.18s;
      font-family: inherit;
      letter-spacing: 0.4px;
    }
    .krantblok button:hover { background: #b09765; }
    .feedback { color:#943838; font-size: 0.98em; text-align:left; min-height: 18px;}
    .vervalt-datum {
      font-size: 0.96em;
      color: #70653d;
      margin-bottom: 6px;
      display: block;
      font-style: italic;
    }
    .zoeker-titel {
      font-size: 1.13em; font-weight: bold;
      color: #31291d; margin-bottom: 7px;
      letter-spacing: 0.3px;
      font-family: inherit;
      text-shadow: 0 1.5px 0 #e4dfd7;
    }
    .zoeker-tekst {
      font-size: 1.04em; color: #3b2c1a; margin-bottom: 10px;
      font-family: inherit;
    }
    @media (max-width: 1100px) { .krantencontainer { grid-template-columns: repeat(2, 1fr);} }
    @media (max-width: 700px)  { .krantencontainer { grid-template-columns: 1fr; gap:15px;} }
  </style>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
</head>
<body>
  <div class="topbar">
    <div class="avatar">
      <span id="welkom-tekst"></span>
      <img id="menu-avatar-img" src="https://cdn-icons-png.flaticon.com/512/4140/4140048.png" alt="Mijn profiel">
    </div>
    <button class="uitlog-link" id="uitlogKnop">üö™ Uitloggen</button>
  </div>
  <div id="parochieLabel"></div>
  <nav class="menu">
    <a href="https://kathy-torfs.github.io/Orthodoxeweg/volwassenmodus/startpagina.html" title="Home">üè†</a>
    <a href="https://kathy-torfs.github.io/Orthodoxeweg/volwassenmodus/parochie.html">üõê Mijn parochie</a>
    <a href="https://kathy-torfs.github.io/Orthodoxeweg/volwassenmodus/catechese/catechese.html">üìñ Catechese</a>
    <a href="https://kathy-torfs.github.io/Orthodoxeweg/volwassenmodus/gebeden/gebeden.html">üôè Gebeden</a>
    <a href="https://kathy-torfs.github.io/Orthodoxeweg/volwassenmodus/gebeden/geloofsbelijdenis.html">‚úù Geloofsbelijdenis</a>
    <a href="https://kathy-torfs.github.io/Orthodoxeweg/volwassenmodus/psalmen/psalmen.html">üìú Psalmen</a>
    <a href="https://kathy-torfs.github.io/Orthodoxeweg/volwassenmodus/heiligen.html">üëº Heiligen</a>
    <a href="https://kathy-torfs.github.io/Orthodoxeweg/volwassenmodus/bijbeldagboek.html">üìî Bijbeldagboek</a>
    <a href="https://kathy-torfs.github.io/Orthodoxeweg/volwassenmodus/verjaardagskalender.html">üéÇ Verjaardagskalender</a>
    <a href="https://kathy-torfs.github.io/Orthodoxeweg/volwassenmodus/profiel.html" class="menu-avatar" title="Mijn profiel">
      <img id="menu-avatar-img" src="https://cdn-icons-png.flaticon.com/512/4140/4140048.png" alt="Mijn profiel">
    </a>
  </nav>
  <div class="krantencontainer" id="krantBlokken"></div>
  <script>
    // --- BEVEILIGING EN WELKOMST ---
    const modus = localStorage.getItem("modus");
    if (!localStorage.getItem("ingelogdeParochie") || !(modus === "priester" || modus === "volwassene")) {
      window.location.href = "https://kathy-torfs.github.io/Orthodoxeweg/index.html";
    }
    const parochieNaam = localStorage.getItem("ingelogdeParochie");
    const parochieId = localStorage.getItem("ingelogdeParochieId");
    document.getElementById("parochieLabel").textContent = parochieNaam
      ? `U bent ingelogd in de parochie van ${parochieNaam}`
      : "‚ö†Ô∏è Geen geldige parochie geselecteerd!";

    // Welkomtekst + avatar
    const welkomTekst = document.getElementById("welkom-tekst");
    const loginNaam = localStorage.getItem("loginKeuze") || "gebruiker";
    welkomTekst.textContent = `${loginNaam}`;
    const avatarImg = document.getElementById("menu-avatar-img");
    const opgeslagenAvatar = localStorage.getItem("avatarURL");
    if (opgeslagenAvatar) avatarImg.src = opgeslagenAvatar;

    document.getElementById("uitlogKnop").onclick = function() {
      localStorage.clear();
      window.location.href = "https://kathy-torfs.github.io/Orthodoxeweg/index.html";
    };

    // --- FIREBASE INIT ---
    const firebaseConfig = {
      apiKey: "AIzaSyBG1iQBmruHUZI1OeW8RgbJ_TPit_7a2LQ",
      authDomain: "orthodoxeweg.firebaseapp.com",
      projectId: "orthodoxeweg",
      storageBucket: "orthodoxeweg.appspot.com",
      messagingSenderId: "408582263618",
      appId: "1:408582263618:web:0a20f4bf0704989d3ceedb"
    };
    if (!firebase.apps.length) { firebase.initializeApp(firebaseConfig); }
    const db = firebase.firestore();

    // --- KRANTENLOGICA ---
    function maakKrantHTML(i, data, vervalTijd, editable) {
      let feedbackId = `feedbackKrant${i}`;
      // Actief zoekertje aanwezig (en niet vervallen)
      if (data && data.titel && data.tekst && !editable) {
        return `
        <div class="krantblok">
          <div class="zoeker-titel">${data.titel}</div>
          <div class="zoeker-tekst">${data.tekst}</div>
          <span class="vervalt-datum">Vervalt: ${vervalTijd}</span>
        </div>
        `;
      } else {
        // Bewerkbare lege knipsel
        let titel = data && data.titel ? data.titel : "";
        let tekst = data && data.tekst ? data.tekst : "";
        return `
        <div class="krantblok">
          <input type="text" id="titel${i}" maxlength="45" placeholder="Titel..." value="${titel.replace(/"/g,"&quot;")}" />
          <textarea id="tekst${i}" maxlength="300" placeholder="Tekst...">${tekst}</textarea>
          <div class="postit-buttons">
            <select id="duur${i}" style="margin-right:10px;">
              <option value="1">1 dag</option>
              <option value="3">3 dagen</option>
              <option value="7">7 dagen</option>
              <option value="14">14 dagen</option>
            </select>
            <button onclick="opslaanKrant(${i})">Plaatsen</button>
          </div>
          <div class="feedback" id="${feedbackId}"></div>
        </div>
        `;
      }
    }

    async function laadKranten() {
      const lijst = document.getElementById("krantBlokken");
      lijst.innerHTML = "...laden...";
      let html = "";
      const nu = new Date();
      for (let i = 0; i < 12; i++) {
        let doc = await db.collection("parochies").doc(parochieId).collection("zoekertjes").doc("krant"+i).get();
        let data = doc.exists ? doc.data() : {};
        let editable = true;
        let verval = "";
        if (data.vervalDatum && data.vervalDatum.toDate) {
          let ver = data.vervalDatum.toDate();
          if (ver > nu) {
            verval = ver.toLocaleDateString("nl-BE", {day:"2-digit", month:"short", year:"numeric"});
            editable = false;
          }
        }
        html += maakKrantHTML(i, data, verval, editable);
      }
      lijst.innerHTML = html;
    }

    window.opslaanKrant = async function(index) {
      const titel = document.getElementById("titel"+index).value.trim();
      const tekst = document.getElementById("tekst"+index).value.trim();
      const duur = parseInt(document.getElementById("duur"+index).value, 10) || 1;
      const feedback = document.getElementById("feedbackKrant"+index);
      feedback.textContent = "";
      if (!titel || !tekst) {
        feedback.textContent = "Titel en tekst zijn verplicht.";
        return;
      }
      if (!parochieId) {
        feedback.textContent = "Parochie niet gevonden!";
        return;
      }
      const nu = new Date();
      const vervalDatum = new Date(nu.getTime() + duur*24*60*60*1000);
      db.collection("parochies").doc(parochieId).collection("zoekertjes").doc("krant"+index)
        .set({
          titel: titel,
          tekst: tekst,
          datum: firebase.firestore.Timestamp.fromDate(nu),
          vervalDatum: firebase.firestore.Timestamp.fromDate(vervalDatum)
        })
        .then(() => {
          feedback.textContent = "Opgeslagen!";
          laadKranten();
          setTimeout(() => { feedback.textContent = ""; }, 1800);
        })
        .catch((error) => {
          feedback.textContent = "Fout bij opslaan: " + error;
        });
    };

    window.onload = laadKranten;
  </script>
</body>
</html>
