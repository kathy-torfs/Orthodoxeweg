<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <title>Zoekertjesbeheer ‚Äì Parochie</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { margin:0; padding:0; font-family: Arial,sans-serif; background:#f8f5e9; color:#5b4320; }
    header { background:#e6d6b8; padding:2rem 1rem 0.7rem 1rem; text-align:center; }
    h1 { margin:0; font-size:2rem; color:#5d4c2f; }
    #parochieLabel {
      background: #fcf6e2; color: #7a5f35; padding: 10px 0 8px 0; text-align: center;
      font-weight: bold; letter-spacing: 1px; font-size: 1.08em;
      box-shadow: 0 2px 8px #cbb96d44; margin-bottom: 10px;
    }
    nav.menu {
      background-color: #7a5f35; padding: 12px 20px;
      display: flex; flex-wrap: wrap; gap: 14px; justify-content: center;
    }
    nav.menu a {
      color: #f8f5e9; text-decoration: none; font-weight: bold; font-size: 16px;
      padding: 6px 14px; border-radius: 8px; transition: background-color 0.3s;
    }
    nav.menu a:hover { background-color: #5e4724; }
    .uitlog-link {
      color: #fff; background: #9a2617; padding: 6px 16px; border-radius: 8px;
      font-size: 1em; text-decoration: none; font-weight: bold;
      margin-left: 14px; margin-right: 14px; transition: background 0.18s;
      cursor: pointer; border: none; float: right;
    }
    .krantencontainer {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 34px;
      max-width: 1180px;
      margin: 44px auto 40px auto;
      justify-items: center;
    }
    .krantblok {
      background: #fff;
      border-radius: 14px;
      box-shadow: 2px 4px 16px #0001;
      display: flex; flex-direction: column;
      align-items: stretch;
      min-width: 270px;
      min-height: 235px;
      padding: 24px 20px 18px 20px;
      justify-content: flex-end;
      border: 2.6px solid #b1b1b1;
      position: relative;
      overflow: hidden;
    }
    .krantblok input[type="text"] {
      width: 100%;
      margin-bottom: 10px;
      padding: 6px 7px;
      font-size: 1.08em;
      border-radius: 7px;
      border: 1.2px solid #cfcfcf;
      background: #f7f7f7;
      color: #333;
      font-weight: bold;
      outline: none;
      box-sizing: border-box;
    }
    .krantblok textarea {
      width: 100%;
      margin-bottom: 13px;
      padding: 8px 7px;
      border-radius: 7px;
      border: 1.2px solid #cfcfcf;
      background: #fcfcfc;
      color: #333;
      font-size: 1.08em;
      min-height: 64px;
      resize: vertical;
      box-sizing: border-box;
    }
    .krantblok .postit-buttons {
      display: flex;
      gap: 10px;
      align-items: center;
      margin-bottom: 6px;
    }
    .krantblok button {
      background: #7a5f35; color: #fff; font-weight: bold; padding: 8px 18px;
      border: none; border-radius: 8px; cursor: pointer; font-size: 1em;
      margin-right: 6px; margin-top: 0;
      transition: background 0.18s;
    }
    .krantblok button:hover { background: #b09765; }
    .feedback { color:#9a2617; font-size: 0.99em; text-align:left; min-height: 22px;}
    .vervalt-datum {
      font-size: 0.96em;
      color: #a08113;
      margin-bottom: 6px;
      display: block;
    }
    /* Kleuraccenten voor "krantenknipsels" (lichtblauw, geel, oranje enz) */
    .krantkleur0 { background:#fff980; border-color: #ebd700;}
    .krantkleur1 { background:#c2eaff; border-color: #53b6e2;}
    .krantkleur2 { background:#ffbae3; border-color: #e371bc;}
    .krantkleur3 { background:#d3ffbc; border-color: #79c663;}
    .krantkleur4 { background:#ffe2b7; border-color: #ffc75b;}
    .krantkleur5 { background:#e8d1ff; border-color: #b48ff4;}
    .krantkleur6 { background:#ffd8d8; border-color: #ff6a6a;}
    .krantkleur7 { background:#d2ffd2; border-color: #7fd97f;}
    .krantkleur8 { background:#fce5cd; border-color: #f9a825;}
    .krantkleur9 { background:#f0f8ff; border-color: #90c2e7;}
    .krantkleur10 { background:#fff3e0; border-color: #fbc02d;}
    .krantkleur11 { background:#ede7f6; border-color: #9575cd;}
    @media (max-width: 1100px) { .krantencontainer { grid-template-columns: repeat(2, 1fr);} }
    @media (max-width: 700px)  { .krantencontainer { grid-template-columns: 1fr; gap:15px;} }
  </style>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
</head>
<body>
  <header>
    <button class="uitlog-link" id="uitlogKnop">üö™ Uitloggen</button>
    <h1>Zoekertjesbeheer ‚Äì Parochie</h1>
    <div id="parochieLabel"></div>
  </header>
  <nav class="menu">
    <a href="https://kathy-torfs.github.io/Orthodoxeweg/volwassenmodus/startpagina.html">üè† Mijn parochie</a>
    <a href="https://kathy-torfs.github.io/Orthodoxeweg/volwassenmodus/parochie.html">üìå Overzicht</a>
    <a href="https://kathy-torfs.github.io/Orthodoxeweg/volwassenmodus/catechese/catechese.html">üìñ Catechese</a>
    <a href="https://kathy-torfs.github.io/Orthodoxeweg/volwassenmodus/gebeden/gebeden.html">üôè Gebeden</a>
    <a href="https://kathy-torfs.github.io/Orthodoxeweg/volwassenmodus/gebeden/geloofsbelijdenis.html">‚úù Geloofsbelijdenis</a>
    <a href="https://kathy-torfs.github.io/Orthodoxeweg/volwassenmodus/psalmen/psalmen.html">üìú Psalmen</a>
    <a href="https://kathy-torfs.github.io/Orthodoxeweg/volwassenmodus/heiligen.html">üëº Heiligen</a>
    <a href="https://kathy-torfs.github.io/Orthodoxeweg/volwassenmodus/bijbeldagboek.html">üìî Bijbeldagboek</a>
    <a href="https://kathy-torfs.github.io/Orthodoxeweg/volwassenmodus/verjaardagskalender.html">üéÇ Verjaardagskalender</a>
    <a href="https://kathy-torfs.github.io/Orthodoxeweg/volwassenmodus/profiel.html">üß∞ Mijn profiel</a>
  </nav>
  <div class="krantencontainer">
    <!-- 12 knipsels, elk met titel en tekst -->
    <!-- Krant0 t/m krant11 -->
    <!-- Zie JS voor dynamisch vullen -->
    <!-- Lege velden worden leeg gelaten -->
    <div id="krantBlokken"></div>
  </div>
  <script>
    // Welkomtekst & uitloggen
    const parochieNaam = localStorage.getItem("ingelogdeParochie");
    document.getElementById("parochieLabel").textContent = parochieNaam
      ? `U bent ingelogd in de parochie van ${parochieNaam}`
      : "‚ö†Ô∏è Geen geldige parochie geselecteerd!";
    document.getElementById("uitlogKnop").onclick = function() {
      localStorage.clear();
      window.location.href = "https://kathy-torfs.github.io/Orthodoxeweg/index.html";
    };

    // Firebase init
    const firebaseConfig = {
      apiKey: "AIzaSyBG1iQBmruHUZI1OeW8RgbJ_TPit_7a2LQ",
      authDomain: "orthodoxeweg.firebaseapp.com",
      projectId: "orthodoxeweg",
      storageBucket: "orthodoxeweg.appspot.com",
      messagingSenderId: "408582263618",
      appId: "1:408582263618:web:0a20f4bf0704989d3ceedb"
    };
    if (!firebase.apps.length) { firebase.initializeApp(firebaseConfig); }
    const db = firebase.firestore();

    // Haal correcte parochieId uit Firestore op basis van naam
    let parochieIdPromise = db.collection("parochies")
      .where("naam", "==", parochieNaam)
      .limit(1)
      .get()
      .then(snap => snap.empty ? null : snap.docs[0].id);

    // Genereer 12 krantenknipsels-blokken
    function maakKrantHTML(i, data, vervalTijd) {
      let titel = data && data.titel ? data.titel : "";
      let tekst = data && data.tekst ? data.tekst : "";
      let feedbackId = `feedbackKrant${i}`;
      let vervaltTekst = vervalTijd ? `<span class="vervalt-datum">Vervalt: ${vervalTijd}</span>` : "";
      return `
      <div class="krantblok krantkleur${i%12}">
        <input type="text" id="titel${i}" maxlength="45" placeholder="Titel..." value="${titel.replace(/"/g,"&quot;")}" />
        <textarea id="tekst${i}" maxlength="300" placeholder="Tekst...">${tekst}</textarea>
        <div class="postit-buttons">
          <select id="duur${i}" style="margin-right:10px;">
            <option value="1">1 dag</option>
            <option value="3">3 dagen</option>
            <option value="7">7 dagen</option>
            <option value="14">14 dagen</option>
          </select>
          <button onclick="opslaanKrant(${i})">Plaatsen</button>
        </div>
        ${vervaltTekst}
        <div class="feedback" id="${feedbackId}"></div>
      </div>
      `;
    }

    // Laad bestaande knipsels uit Firestore
    async function laadKranten() {
      const parochieId = await parochieIdPromise;
      let html = "";
      const nu = new Date();
      for (let i = 0; i < 12; i++) {
        let doc = await db.collection("parochies").doc(parochieId).collection("zoekertjes").doc("krant"+i).get();
        let data = doc.exists ? doc.data() : {};
        let verval = "";
        if (data.vervalDatum && data.vervalDatum.toDate) {
          let ver = data.vervalDatum.toDate();
          if (ver > nu) {
            verval = ver.toLocaleDateString("nl-BE", {day:"2-digit", month:"short", year:"numeric"});
          }
        }
        html += maakKrantHTML(i, data, verval);
      }
      document.getElementById("krantBlokken").innerHTML = html;
    }

    // Opslaan van een zoekertje/krantenknipsel
    window.opslaanKrant = async function(index) {
      const titel = document.getElementById("titel"+index).value.trim();
      const tekst = document.getElementById("tekst"+index).value.trim();
      const duur = parseInt(document.getElementById("duur"+index).value, 10) || 1;
      const feedback = document.getElementById("feedbackKrant"+index);
      feedback.textContent = "";
      if (!titel || !tekst) {
        feedback.textContent = "Titel en tekst zijn verplicht.";
        return;
      }
      const parochieId = await parochieIdPromise;
      if (!parochieId) {
        feedback.textContent = "Parochie niet gevonden!";
        return;
      }
      const nu = new Date();
      const vervalDatum = new Date(nu.getTime() + duur*24*60*60*1000);
      db.collection("parochies").doc(parochieId).collection("zoekertjes").doc("krant"+index)
        .set({
          titel: titel,
          tekst: tekst,
          datum: firebase.firestore.Timestamp.fromDate(nu),
          vervalDatum: firebase.firestore.Timestamp.fromDate(vervalDatum)
        })
        .then(() => {
          feedback.textContent = "Opgeslagen!";
          laadKranten();
          setTimeout(() => { feedback.textContent = ""; }, 1800);
        })
        .catch((error) => {
          feedback.textContent = "Fout bij opslaan: " + error;
        });
    };

    window.onload = laadKranten;
  </script>
</body>
</html>
