<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Orthodoxeweg â€“ Bijbel (tijdelijk LXX)</title>
  <link rel="icon" href="https://kathy-torfs.github.io/Orthodoxeweg/images/kruis.png" />
  <style>
    :root{
      --bg:#f5e9b8; --text:#6f4e1a; --bar:#6f4e1a; --menu:#7a5f35; --chip:#f5e9b8;
      --btn:#eee3c6; --btn-border:#b29467; --btn-active:#d3b87c;
      --card:#fffdf4; --card-border:#ceb27d;
    }
    *{box-sizing:border-box}
    body{ background:var(--bg); color:var(--text); font-family:Arial, sans-serif; margin:0; }

    .wrap{ max-width:1200px; margin:18px auto 28px; padding:0 16px; }
    h1{ text-align:center; margin:6px 0 12px; }

    .bar{
      background:var(--card); border:2px solid var(--card-border); border-radius:12px;
      box-shadow:0 6px 22px rgba(168,139,84,.18); padding:12px; margin-bottom:12px;
    }
    .row{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:center; }

    .url-input{
      flex: 1 1 520px; min-width:280px; display:flex; gap:8px; align-items:center;
    }
    .url-input input{
      width:100%; padding:10px 12px; border:1.5px solid var(--btn-border); border-radius:8px; background:#fffef8;
      font-size:16px; color:var(--text);
    }
    .btn{
      background:var(--btn); color:var(--text); border:1.5px solid var(--btn-border);
      border-radius:8px; padding:10px 14px; font-weight:700; cursor:pointer;
    }
    .btn.primary{ background:var(--btn-active); border-width:2px; }

    .note{ text-align:center; font-size:.95em; opacity:.85; margin:6px 0 12px; }
    .frame-box{
      background:#fffef8; border:2px solid var(--card-border); border-radius:12px; overflow:hidden;
      box-shadow:0 6px 22px rgba(168,139,84,.25);
    }
    iframe{ width:100%; height:78vh; border:0; background:#fff; }
    @media (max-width:700px){ iframe{ height:72vh; } }
  </style>
</head>
<body>
  <!-- Topbar + menubalk/uitloggen -->
  <script src="https://kathy-torfs.github.io/Orthodoxeweg/volwassenmodus/common/layout.js"></script>

  <div class="wrap">
    <h1>Tijdelijke Bijbelweergave (LXX)</h1>

    <!-- Bestemming kiezen -->
    <div class="bar">
      <div class="row url-input">
        <input id="srcInput" type="url"
               placeholder="Plak hier een LXX-URL (bv. een hoofdstukpagina van septuagint.bible)â€¦"
               inputmode="url" autocomplete="on" />
        <button id="btnGR" class="btn primary" type="button" title="Griekse originele pagina tonen">ðŸ‡¬ðŸ‡· Grieks</button>
        <button id="btnNL" class="btn" type="button" title="Automatische Nederlandse vertaling (Google Translate)">ðŸ‡³ðŸ‡± Nederlands (auto)</button>
      </div>

      <div class="row" style="margin-top:8px;">
        <span style="opacity:.75;">Snel kiezen:</span>
        <!-- Voorbeelden / startpunten -->
        <button class="btn preset" data-url="https://www.septuagint.bible/genesis">Genesis (overzicht)</button>
        <button class="btn preset" data-url="https://www.septuagint.bible/exodus">Exodus (overzicht)</button>
        <button class="btn preset" data-url="https://www.septuagint.bible/exodus/-/asset_publisher/08B6gAdPFYLY/content/kephalai-18?inheritRedirect=false&redirect=https%3A%2F%2Fwww.septuagint.bible%2Fexodus%3Fp_p_id%3D101_INSTANCE_08B6gAdPFYLY%26p_p_lifecycle%3D0%26p_p_state%3Dnormal%26p_p_mode%3Dview%26p_p_col_id%3Dcolumn-1%26p_p_col_pos%3D1%26p_p_col_count%3D2">Exodus 18</button>
      </div>
    </div>

    <p class="note">
      De Nederlandse weergave wordt tijdelijk geleverd via Google Translate.  
      Sommige sites blokkeren weergave in een iframe; in dat geval openen we automatisch een <b>nieuw tabblad</b>.
      Je laatste keuze wordt onthouden.
    </p>

    <!-- Viewer -->
    <div class="frame-box">
      <iframe id="lxxFrame" title="Bijbel (LXX)"
              referrerpolicy="no-referrer-when-downgrade"
              loading="lazy"
              sandbox="allow-same-origin allow-forms allow-scripts allow-popups allow-popups-to-escape-sandbox"></iframe>
    </div>
  </div>

  <script>
    // Helper: bouw Google Translate URL (naar NL)
    function toGoogleTranslate(url, {from="auto", to="nl"} = {}){
      const enc = encodeURIComponent(url);
      return `https://translate.google.com/translate?hl=${to}&sl=${from}&tl=${to}&u=${enc}`;
    }

    const input = document.getElementById("srcInput");
    const btnGR = document.getElementById("btnGR");
    const btnNL = document.getElementById("btnNL");
    const frame = document.getElementById("lxxFrame");

    // Presetbuttons
    document.querySelectorAll(".preset").forEach(b=>{
      b.addEventListener("click", ()=>{
        input.value = b.getAttribute("data-url");
        localStorage.setItem("bijbel_lxx_last_url", input.value);
        setMode("gr"); // laad meteen Grieks
      });
    });

    // Laad laatste of fallback (Genesis overzicht is een neutraal startpunt)
    const FALLBACK = "https://www.septuagint.bible/genesis";
    input.value = localStorage.getItem("bijbel_lxx_last_url") || FALLBACK;

    // Actieve knop UI
    function setActive(isGR){
      if (isGR){ btnGR.classList.add("primary"); btnNL.classList.remove("primary"); }
      else { btnNL.classList.add("primary"); btnGR.classList.remove("primary"); }
    }

    // Probeer url in iframe; lukt dat niet (X-Frame-Options), open in nieuw tabblad
    function trySetIframe(url, fallbackNewTab=true){
      return new Promise(resolve=>{
        let timer = null;
        const onLoad = () => {
          clearTimeout(timer);
          frame.removeEventListener("load", onLoad);
          resolve(true);
        };
        frame.addEventListener("load", onLoad, { once:true });
        frame.src = url;

        // Als binnen 2.2s geen load-event â†’ waarschijnlijk geblokkeerd
        timer = setTimeout(()=>{
          frame.removeEventListener("load", onLoad);
          if (fallbackNewTab){ window.open(url, "_blank", "noopener"); }
          resolve(false);
        }, 2200);
      });
    }

    async function setMode(mode){
      const raw = input.value.trim();
      if (!raw){ alert("Plak eerst een LXXâ€‘URL."); return; }
      localStorage.setItem("bijbel_lxx_last_url", raw);

      if (mode === "gr"){
        setActive(true);
        await trySetIframe(raw, false);
      } else {
        setActive(false);
        const ok = await trySetIframe(toGoogleTranslate(raw), true);
        if (!ok){
          // Zet iframe terug naar Grieks zodat het kader niet leeg blijft
          await trySetIframe(raw, false);
        }
      }
    }

    btnGR.addEventListener("click", ()=> setMode("gr"));
    btnNL.addEventListener("click", ()=> setMode("nl"));

    // Start in Grieks
    setMode("gr");
  </script>
</body>
</html>
