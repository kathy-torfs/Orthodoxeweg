<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bijbel â€“ Orthodoxeweg Volwassenmodus</title>
  <link rel="icon" href="https://kathy-torfs.github.io/Orthodoxeweg/images/kruis.png" />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+Greek:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primair:#7bb235; --donker:#67510C;
      --pastel1:#fff6e5; --pastel2:#fffde6; --pastel3:#ffe8ec; --pastel4:#e7f8ff;
      --pastel5:#e6ffe5; --pastel6:#fff2fb; --pastel7:#f5ffe5; --pastel8:#f5e8ff;
      --pastel9:#fff6fb; --pastel10:#e7fff9; --pastel11:#f3e6ff; --pastel12:#ffeae6;
    }
    body{margin:0;font-family:Arial, sans-serif;color:#333;min-height:100vh;background:var(--pastel1);transition:background .6s}
    .page{max-width:960px;margin:0 auto;padding:10px 14px 60px}
    .row{display:flex;gap:12px;align-items:center;justify-content:center;margin:12px 0}
    select{padding:8px 12px;border:1px solid #ccc;border-radius:8px;background:#fff}
    .boeken-bar{display:flex;flex-wrap:wrap;gap:.4rem;justify-content:center;margin:.5rem 0}
    .boeken-bar button{background:#fff;border:1px solid #ddd;border-radius:8px;padding:.45rem .7rem;cursor:pointer;font-size:.9rem;transition:.15s;white-space:nowrap}
    .boeken-bar button:hover,.boeken-bar button.actief{background:#7bb235;color:#fff;border-color:#7bb235}
    .hoofdstukken-bar{display:flex;flex-wrap:wrap;gap:.35rem;justify-content:center;margin:.5rem 0}
    .hoofdstukken-bar button{background:#fff;border:1px solid #ddd;border-radius:8px;padding:.35rem .6rem;font-size:.85rem;cursor:pointer}
    .hoofdstukken-bar button.actief{background:#67510C;color:#fff;border-color:#67510C}
    .tekst{margin-top:8px;line-height:1.6}
    .tekst h2{text-align:center;color:#67510C;margin:.6rem 0 .2rem}
    .vers{margin:0 0 .55rem 0;text-indent:1rem;font-size:1.05em}
    .gr{font-family:'Noto Serif Greek',serif;font-size:1.08em}
    .hint{text-align:center;color:#777}
    .error{color:#a40000;background:#ffecec;border:1px solid #ffc9c9;padding:.6rem .8rem;border-radius:8px;text-align:center}
  </style>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  <script defer src="common/layout.js"></script>
</head>
<body>
  <div id="volwassen-header"></div>

  <main class="page">
    <div class="row">
      <select id="testamentSel">
        <option value="LXX">ðŸ“œ Oude Testament (Grieks)</option>
        <option value="NT">ðŸ“– Nieuwe Testament (Vlaams)</option>
      </select>
    </div>

    <div class="boeken-bar" id="boekenBar"></div>
    <div class="hoofdstukken-bar" id="hoofdstukkenBar"></div>
    <div class="tekst" id="tekst"><p class="hint">Kies een boek om te beginnenâ€¦</p></div>
  </main>

  <script>
    // willekeurige pastelachtergrond
    (function(){
      const p=['var(--pastel1)','var(--pastel2)','var(--pastel3)','var(--pastel4)','var(--pastel5)','var(--pastel6)','var(--pastel7)','var(--pastel8)','var(--pastel9)','var(--pastel10)','var(--pastel11)','var(--pastel12)'];
      document.body.style.background=p[Math.floor(Math.random()*p.length)];
    })();

    // Firebase
    const firebaseConfig={apiKey:"AIzaSyBG1iQBmruHUZI1OeW8RgbJ_TPit_7a2LQ",authDomain:"orthodoxeweg.firebaseapp.com",projectId:"orthodoxeweg",storageBucket:"orthodoxeweg.appspot.com",messagingSenderId:"408582263618",appId:"1:408582263618:web:0a20f4bf0704989d3ceedb"};
    if(!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db=firebase.firestore();

    // Header
    (async function(){
      if(window.VolwassenLayout?.mountHeader){
        try{await window.VolwassenLayout.mountHeader({rootId:'volwassen-header',headerSrc:'common/header.html',active:'bijbel'});}catch(e){}
      }
    })();

    // Boeken (exacte volgorde)
    const LXX = {
      "Genesis":"genesis","Exodus":"exodus","Leviticus":"leviticus","Numeri":"numbers","Deuteronomium":"deuteronomy",
      "Jozua":"joshua","Richteren":"judges","Ruth":"ruth","1 Koningen":"i_kingdoms","2 Koningen":"ii_kingdoms",
      "3 Koningen":"iii_kingdoms","4 Koningen":"iv_kingdoms","1 Paralipomenon":"i_chronicles","2 Paralipomenon":"ii_chronicles",
      "1 Esdras":"i_esdras","2 Esdras":"ii_esdras","Nehemia":"nehemiah","Ester":"esther","Judit":"judith","Tobit":"tobit",
      "Job":"job","Psalmen":"psalms","Spreuken":"proverbs","Prediker":"ecclesiastes","Hooglied":"song_of_solomon",
      "Jesaja":"isaiah","Jeremia":"jeremiah","Klaagliederen":"lamentations","Baruch":"baruch","EzechiÃ«l":"ezekiel","DaniÃ«l":"daniel",
      "Hosea":"hosea","JoÃ«l":"joel","Amos":"amos","Obadja":"obadiah","Jona":"jonah","Micha":"micah","Nahum":"nahum","Habakuk":"habakkuk",
      "Haggai":"haggai","Zacharia":"zachariah","Zefanja":"zephaniah","Maleachi":"malachi",
      "1 MakkabeeÃ«n":"i_maccabees","2 MakkabeeÃ«n":"ii_maccabees","3 MakkabeeÃ«n":"iii_maccabees",
      "Wijsheid":"wisdom_of_solomon","Sirach":"wisdom_of_sirach"
    };

    const NT = {
      "Mattheus":"mattheus","Markus":"markus","Lukas":"lukas","Johannes":"johannes","Handelingen":"handelingen",
      "Romeinen":"romeinen","Galaten":"galaten","Efeze":"efeze","Filippenzen":"filippenzen","Kolossenzen":"kolossenzen",
      "Titus":"titus","Filemon":"filemon","HebreeÃ«n":"hebreeen","Jakobus":"jakobus","Judas":"judas","Openbaring":"openbaring"
    };

    const boekenBar = document.getElementById('boekenBar');
    const hoofdstukkenBar = document.getElementById('hoofdstukkenBar');
    const tekst = document.getElementById('tekst');
    const testamentSel = document.getElementById('testamentSel');

    let mode='LXX', actiefLabel=null, actiefPrefix=null, actiefH=null;

    // boeken renderen
    function renderBoeken(){
      boekenBar.innerHTML='';
      const lijst = (mode==='LXX'?LXX:NT);
      Object.keys(lijst).forEach(label=>{
        const b=document.createElement('button');
        b.textContent=label;
        b.onclick=()=>selectBoek(label,lijst[label]);
        boekenBar.appendChild(b);
      });
    }

    async function selectBoek(label,prefix){
      actiefLabel=label; actiefPrefix=prefix; actiefH=null;
      highlightBoek(label);
      hoofdstukkenBar.innerHTML='<p class="hint">Ladenâ€¦</p>';
      if(mode==='LXX') await laadHoofdstukkenLXX(prefix,label);
      else await laadHoofdstukkenNT(prefix,label);
    }

    function highlightBoek(label){
      [...boekenBar.querySelectorAll('button')].forEach(b=>b.classList.toggle('actief',b.textContent===label));
      tekst.innerHTML='<p class="hint">Hoofdstukken ladenâ€¦</p>';
    }

    async function laadHoofdstukkenLXX(prefix,label){
      try{
        const snap=await db.collection('bijbel_LXX')
          .where(firebase.firestore.FieldPath.documentId(),'>=',prefix+'_h')
          .where(firebase.firestore.FieldPath.documentId(),'<',prefix+'_i').get();
        if(snap.empty){tekst.innerHTML=`<div class="error">Geen hoofdstukken voor ${label}.</div>`;return;}
        const nrs=snap.docs.map(d=>Number((d.id.match(/_h(\d+)/)||[])[1])).filter(n=>!isNaN(n)).sort((a,b)=>a-b);
        hoofdstukkenBar.innerHTML='';
        nrs.forEach(n=>{
          const btn=document.createElement('button');
          btn.textContent=n;
          btn.onclick=()=>{actiefH=n; highlightH(n); laadLXX(prefix,n,label);};
          hoofdstukkenBar.appendChild(btn);
        });
      }catch(e){tekst.innerHTML=`<div class="error">${e}</div>`;}
    }

    async function laadHoofdstukkenNT(prefix,label){
      try{
        const snap=await db.collection('bijbel')
          .where(firebase.firestore.FieldPath.documentId(),'>=',prefix+'_h')
          .where(firebase.firestore.FieldPath.documentId(),'<',prefix+'_i').get();
        if(snap.empty){tekst.innerHTML=`<div class="error">Geen hoofdstukken voor ${label}.</div>`;return;}
        const nrs=snap.docs.map(d=>Number((d.id.match(/_h(\d+)/)||[])[1])).filter(n=>!isNaN(n)).sort((a,b)=>a-b);
        hoofdstukkenBar.innerHTML='';
        nrs.forEach(n=>{
          const btn=document.createElement('button');
          btn.textContent=n;
          btn.onclick=()=>{actiefH=n; highlightH(n); laadNT(prefix,n,label);};
          hoofdstukkenBar.appendChild(btn);
        });
      }catch(e){tekst.innerHTML=`<div class="error">${e}</div>`;}
    }

    function highlightH(n){
      [...hoofdstukkenBar.querySelectorAll('button')].forEach(b=>b.classList.toggle('actief',Number(b.textContent)===Number(n)));
    }

    async function laadLXX(prefix,h,label){
      tekst.innerHTML=`<h2>${label} ${h}</h2><p class="hint">Ladenâ€¦</p>`;
      const id=`${prefix}_h${h}`;
      const doc=await db.collection('bijbel_LXX').doc(id).get();
      if(!doc.exists){tekst.innerHTML=`<div class="error">Niet gevonden: ${id}</div>`;return;}
      const data=doc.data(); const verzen=data.verzen||{};
      const keys=Object.keys(verzen).map(Number).sort((a,b)=>a-b);
      tekst.innerHTML=`<h2>${label} ${h}</h2>`+keys.map(v=>`<p class="vers gr"><strong>${v}</strong> ${verzen[v]}</p>`).join('');
    }

    async function laadNT(prefix,h,label){
      tekst.innerHTML=`<h2>${label} ${h}</h2><p class="hint">Ladenâ€¦</p>`;
      const id=`${prefix}_h${h}`;
      const doc=await db.collection('bijbel').doc(id).get();
      if(!doc.exists){tekst.innerHTML=`<div class="error">Niet gevonden: ${id}</div>`;return;}
      const data=doc.data(); const verzen=data.verzen||{};
      const keys=Object.keys(verzen).map(Number).sort((a,b)=>a-b);
      tekst.innerHTML=`<h2>${label} ${h}</h2>`+keys.map(v=>`<p class="vers"><strong>${v}</strong> ${verzen[v]}</p>`).join('');
    }

    testamentSel.addEventListener('change',e=>{
      mode=e.target.value;
      tekst.innerHTML='<p class="hint">Kies een boekâ€¦</p>';
      hoofdstukkenBar.innerHTML=''; renderBoeken();
    });

    renderBoeken();
  </script>
</body>
</html>
