<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bijbel â€“ Orthodoxeweg Volwassenmodus</title>
  <link rel="icon" href="https://kathy-torfs.github.io/Orthodoxeweg/images/kruis.png" />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+Greek:wght@400;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --primair:#7bb235; --donker:#67510C;
      --pastel1:#fff6e5; --pastel2:#fffde6; --pastel3:#ffe8ec; --pastel4:#e7f8ff;
      --pastel5:#e6ffe5; --pastel6:#fff2fb; --pastel7:#f5ffe5; --pastel8:#f5e8ff;
      --pastel9:#fff6fb; --pastel10:#e7fff9; --pastel11:#f3e6ff; --pastel12:#ffeae6;
    }
    body { margin:0; font-family:Arial, sans-serif; color:#333;
      min-height:100vh; background:var(--pastel1); transition:background .6s;
    }
    .page-container { max-width:900px; margin:0 auto; padding:0 14px 44px 14px; }

    .testament-selector { text-align:center; margin:1rem 0; }
    select { padding:8px 12px; border-radius:8px; font-size:1em; border:1px solid #ccc; background:#fff; }

    .boeken-wrap { background:#f2f2f2; padding:0.6rem; border-radius:12px; margin-bottom:0.5rem; }
    .boeken-hint { font-size:.85rem; color:#666; margin:.2rem 0 .4rem; text-align:center; }

    .boeken-bar { display:flex; flex-wrap:wrap; gap:0.4rem; justify-content:center; overflow-x:hidden; }
    .boeken-bar button {
      background:#fff; border:1px solid #ddd; border-radius:8px;
      padding:0.45rem 0.7rem; cursor:pointer;
      font-size:0.9rem; transition:background .15s, color .15s, border-color .15s;
    }
    .boeken-bar button:hover { background:#7bb235; color:#fff; border-color:#7bb235; }
    .boeken-bar button.actief { background:#7bb235; color:#fff; border-color:#7bb235; }

    .hoofdstukken-bar { display:flex; flex-wrap:wrap; gap:.35rem; margin-top:.6rem; justify-content:center; }
    .hoofdstukken-bar button {
      background:#fff; border:1px solid #ddd; border-radius:8px;
      padding:.35rem .6rem; font-size:.85rem; cursor:pointer;
    }
    .hoofdstukken-bar button.actief { background:#67510C; color:#fff; border-color:#67510C; }

    .bijbel-tekst { margin-top:1rem; line-height:1.6; }
    .bijbel-tekst h2 { text-align:center; color:#67510C; margin:.6rem 0 .2rem; }
    .vers { margin:0 0 .55rem 0; text-indent:1rem; font-size:1.05em; }
    .grieks { font-family:'Noto Serif Greek', serif; font-size:1.1em; }

    #loadingMsg { text-align:center; color:#888; margin:16px 0; }
    .error { color:#a40000; background:#ffecec; border:1px solid #ffc9c9;
      padding:.6rem .8rem; border-radius:8px; }
  </style>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  <script defer src="common/layout.js"></script>
</head>
<body>
  <div id="volwassen-header"></div>

  <main class="page-container">
    <div class="testament-selector">
      <select id="testamentSelector">
        <option value="LXX">ðŸ“œ Oude Testament (Grieks)</option>
        <option value="NT">ðŸ“– Nieuwe Testament (Vlaams)</option>
      </select>
    </div>

    <div class="boeken-wrap">
      <div class="boeken-hint">Klik op een boek om te beginnen lezen.</div>
      <div id="boekenBar" class="boeken-bar"></div>
    </div>

    <div id="hoofdstukkenBar" class="hoofdstukken-bar"></div>
    <div id="bijbelTekst" class="bijbel-tekst">
      <div id="loadingMsg">Kies een boek om te beginnen lezenâ€¦</div>
    </div>
  </main>

  <script>
    // Achtergrond
    (function(){
      const p=['var(--pastel1)','var(--pastel2)','var(--pastel3)','var(--pastel4)','var(--pastel5)','var(--pastel6)','var(--pastel7)','var(--pastel8)','var(--pastel9)','var(--pastel10)','var(--pastel11)','var(--pastel12)'];
      document.body.style.background = p[Math.floor(Math.random()*p.length)];
    })();

    // Firebase
    const firebaseConfig = {
      apiKey:"AIzaSyBG1iQBmruHUZI1OeW8RgbJ_TPit_7a2LQ",
      authDomain:"orthodoxeweg.firebaseapp.com",
      projectId:"orthodoxeweg",
      storageBucket:"orthodoxeweg.appspot.com",
      messagingSenderId:"408582263618",
      appId:"1:408582263618:web:0a20f4bf0704989d3ceedb"
    };
    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db=firebase.firestore();

    async function mountHeaderSafe(){
      if(window.VolwassenLayout&&typeof window.VolwassenLayout.mountHeader==="function"){
        await window.VolwassenLayout.mountHeader({
          rootId:"volwassen-header",
          headerSrc:"common/header.html",
          active:"bijbel"
        });
      }
    }

    const boekenLXX=[
      "Genesis","Exodus","Leviticus","Numeri","Deuteronomium","Jozua","Richteren","Ruth",
      "1 Koningen","2 Koningen","3 Koningen","4 Koningen","1 Paralipomenon","2 Paralipomenon",
      "1 Esdras","2 Esdras","Tobit","Judit","Ester","Job","Psalmen","Spreuken","Prediker",
      "Hooglied","Wijsheid","Sirach","Jesaja","Jeremia","Klaagliederen","Baruch","EzechiÃ«l",
      "DaniÃ«l","Hosea","JoÃ«l","Amos","Obadja","Jona","Micha","Nahum","Habakuk","Zefanja",
      "Haggai","Zacharia","Maleachi"
    ];
    const boekenNT=[
      "Mattheus","Marcus","Lukas","Johannes","Handelingen","Romeinen","1 Korinthe","2 Korinthe",
      "Galaten","Efeze","Filippenzen","Kolossenzen","1 Thessalonika","2 Thessalonika",
      "1 Timotheus","2 Timotheus","Titus","Filemon","HebreeÃ«n","Jakobus","1 Petrus","2 Petrus",
      "1 Johannes","2 Johannes","3 Johannes","Judas","Openbaring"
    ];

    const boekenBar=document.getElementById('boekenBar');
    const hoofdstukkenBar=document.getElementById('hoofdstukkenBar');
    const bijbelTekst=document.getElementById('bijbelTekst');
    const testamentSelector=document.getElementById('testamentSelector');

    let huidigTestament='LXX';
    let actiefBoek=null;
    let actiefH=null;

    document.addEventListener('DOMContentLoaded',async()=>{
      await mountHeaderSafe();
      renderBoeken();
    });

    testamentSelector.addEventListener('change',e=>{
      huidigTestament=e.target.value;
      actiefBoek=null; actiefH=null;
      bijbelTekst.innerHTML='<div id="loadingMsg">Kies een boekâ€¦</div>';
      hoofdstukkenBar.innerHTML='';
      renderBoeken();
    });

    function renderBoeken(){
      boekenBar.innerHTML='';
      const lijst=(huidigTestament==='LXX')?boekenLXX:boekenNT;
      lijst.forEach(boek=>{
        const btn=document.createElement('button');
        btn.textContent=boek;
        btn.className=(boek===actiefBoek)?'actief':'';
        btn.onclick=()=>{actiefBoek=boek;actiefH=null;highlightBoek(boek);laadHoofdstukken(boek);};
        boekenBar.appendChild(btn);
      });
    }
    function highlightBoek(boek){[...boekenBar.querySelectorAll('button')].forEach(b=>b.classList.toggle('actief',b.textContent===boek));}

    async function laadHoofdstukken(boek){
      hoofdstukkenBar.innerHTML='';
      bijbelTekst.innerHTML=`<h2>${boek}</h2><div id="loadingMsg">Hoofdstukken ladenâ€¦</div>`;
      try{
        if(huidigTestament==='LXX'){
          const boekId=boek.toLowerCase().replace(/\s+/g,'_')
            .replace('wijsheid','wisdom_of_solomon')
            .replace('sirach','wisdom_of_sirach')
            .replace('zacharia','zachariah')
            .replace('zefanja','zephaniah');
          const docs=await db.collection('bijbel_LXX')
            .where(firebase.firestore.FieldPath.documentId(),'>=',boekId+'_h')
            .where(firebase.firestore.FieldPath.documentId(),'<',boekId+'_i').get();

          if(docs.empty){bijbelTekst.innerHTML=`<div class='error'>Geen hoofdstukken gevonden voor ${boekId}.</div>`;return;}
          const hoofdstukken=docs.docs.map(d=>Number(d.id.match(/_h(\d+)/)[1])).sort((a,b)=>a-b);
          hoofdstukken.forEach(n=>{
            const btn=document.createElement('button');
            btn.textContent=n;btn.className=(n===actiefH)?'actief':'';
            btn.onclick=()=>{actiefH=n;highlightH(n);laadHoofdstukLXX(boekId,n,boek);};
            hoofdstukkenBar.appendChild(btn);
          });
          actiefH=actiefH||hoofdstukken[0];
          highlightH(actiefH);
          await laadHoofdstukLXX(boekId,actiefH,boek);
        } else {
          bijbelTekst.innerHTML="<div class='error'>Gebruik NT-versie code.</div>";
        }
      }catch(e){console.error(e);bijbelTekst.innerHTML=`<div class='error'>${e}</div>`;}
    }

    function highlightH(n){[...hoofdstukkenBar.querySelectorAll('button')].forEach(b=>b.classList.toggle('actief',Number(b.textContent)===Number(n)));}

    async function laadHoofdstukLXX(boekPrefix,hNummer,boekLabel){
      const docId=`${boekPrefix}_h${hNummer}`;
      bijbelTekst.innerHTML=`<h2>${boekLabel} ${hNummer}</h2><div id='loadingMsg'>Ladenâ€¦</div>`;
      const doc=await db.collection('bijbel_LXX').doc(docId).get();
      if(!doc.exists){bijbelTekst.innerHTML=`<div class='error'>Niet gevonden: ${docId}</div>`;return;}
      const data=doc.data();
      const verzen=data.verzen || data;
      const keys=Object.keys(verzen).sort((a,b)=>Number(a)-Number(b));
      const html=keys.map(v=>`<p class='vers grieks'><strong>${v}</strong> ${verzen[v]}</p>`).join('');
      bijbelTekst.innerHTML=`<h2>${boekLabel} ${hNummer}</h2>${html}`;
    }
  </script>
</body>
</html>
